{==============================================================================
|    _________ _______  _______  ______  _______  Jegas, LLC                  |
|   /___  ___// _____/ / _____/ / __  / / _____/  JasonPSage@jegas.com        |
|      / /   / /__    / / ___  / /_/ / / /____                                |
|     / /   / ____/  / / /  / / __  / /____  /                                |
|____/ /   / /___   / /__/ / / / / / _____/ /                                 |
/_____/   /______/ /______/ /_/ /_/ /______/                                  |
|                 Under the Hood                                              |
===============================================================================
                       Copyright(c)2012 Jegas, LLC
==============================================================================}

//=============================================================================
{}
// Test results - bare min CGI Experiment
program cgi_get;
//=============================================================================

//=============================================================================
// GLOBAL DIRECTIVES
//=============================================================================
{$INCLUDE i_jegas_splash.pp}
//=============================================================================



//=============================================================================
uses strings,{$IFDEF LINUX}linux,{$ENDIF}dos;
//=============================================================================

//=============================================================================
const max_data = 1000;
//=============================================================================

//=============================================================================
type datarec = record
  name,value : string;
  end;
//=============================================================================

//=============================================================================
var data : array[1..max_data] of datarec;
    i,nrdata : longint;
    p  : PChar;
    literal,aname : boolean;
    sa: ansistring;
//=============================================================================

//=============================================================================
begin
//=============================================================================
  Writeln ('Content-type: text/html');
  Writeln;
  p:=getmem(8192);
  //strcopy(p,@GetEnv('QUERY_STRING'));
  sa:=GetEnv('QUERY_STRING');
  writeln(sa);
  strcopy(p,PCHAR(sa));
  nrdata:=1;
  aname:=true;
  while p^<>#0  do
    begin
    literal:=false;
    if p^='\' then
       begin
       literal:=true;
       inc(longint(p));
       end;
    if ((p^<>'=') and (p^<>'&')) or literal then
       with data[nrdata] do
          if aname then name:=name+p^ else value:=value+p^
    else
       begin
       if p^='&' then
           begin
           inc (nrdata);
           aname:=true;
           end
        else
           aname:=false;
        end;
    inc(longint(p));
    end;
  Writeln ('<H1>Form Results :</H1>');
  Writeln ('You submitted the following name/value pairs :');
  Writeln ('<UL>');
  for i:=1 to nrdata do writeln ('<LI> ',data[i].name,' = ',data[i].value);
  Writeln ('</UL>');
//=============================================================================
end.
//=============================================================================

//*****************************************************************************
// EOF
//*****************************************************************************

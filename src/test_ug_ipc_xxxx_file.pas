{==============================================================================
|    _________ _______  _______  ______  _______  Jegas, LLC                  |
|   /___  ___// _____/ / _____/ / __  / / _____/  JasonPSage@jegas.com        |
|      / /   / /__    / / ___  / /_/ / / /____                                |
|     / /   / ____/  / / /  / / __  / /____  /                                |
|____/ /   / /___   / /__/ / / / / / _____/ /                                 |
/_____/   /______/ /______/ /_/ /_/ /______/                                  |
|                 Under the Hood                                              |
===============================================================================
                       Copyright(c)2012 Jegas, LLC
==============================================================================}

//=============================================================================
{}
// Tests Jegas' Filebased Interprocess Communication Suite
program test_ug_ipc_xxxx_file;
//=============================================================================

//=============================================================================
// Global Directives
//=============================================================================
{$INCLUDE i_jegas_splash.pp}
{$SMARTLINK ON}
{$PACKRECORDS 4}
{$MODE objfpc}
//=============================================================================

//=============================================================================
uses
//=============================================================================
  ug_common,
  ug_jfilesys,
  ug_cgiin,
  ug_ipc_send_file,
  ug_ipc_recv_file;
//=============================================================================

//=============================================================================
var
//=============================================================================
  sacommid: AnsiString;
  saFIFO_OUT: AnsiString;
  saFIFO_IN: AnsiString;
  i8Err: int64;
  rMyCGI: rtCGI;
//=============================================================================

//=============================================================================
Begin
//=============================================================================
  rMyCGI.iEnvVarCount:=0;//shut up compiler
  Writeln(saCGIHdrPlainText);
  i8Err:=i8CGIIN;
  if i8Err=0 then
  Begin
    saFIFO_OUT:='c:\FIFO_cgiin\';
    saFIFO_IN:= 'c:\FIFO_cgiout\';
    //saCommID:=saFIFO_OUT;
    Writeln('I have ',rcgiin.iEnvVarCount,' ');
    saCommID:='';//shutup compiler
    //if bIPCSendCGI(rCGIIN,saCommid) then
    Begin
      Writeln('saCommID returned from SendCGI:',saCommid);
      saCommID:='200607231434090711171815599';
      if bIPCRecvCGI(rMyCGI,saCommID,saFIFO_OUT,'FIFO',true) then
      Begin
        Writeln('saCommID returned from RecvCGI:',saCommid);
        Writeln('Um.. guess it worked');
      End
      else
      Begin
        Writeln('bIPCRecvCGI failed');
      End;
    End
    //else
    //Begin
    //  Writeln('bIPCSendCGI Failed');
    //End;
  End
  else
  Begin
    Writeln('Got i8CGIIN err:',i8Err);
  End;   
//=============================================================================
End.
//=============================================================================

//*****************************************************************************
// EOF
//*****************************************************************************


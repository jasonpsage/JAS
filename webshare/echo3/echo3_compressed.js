Core={_copyFunction:function(f){return function(){f.apply(this,arguments)}},_createFunction:function(){return function(){}},extend:function(){var baseClass=arguments.length==1?null:arguments[0];var definition=arguments.length==1?arguments[0]:arguments[1];var x,name;if(arguments.length==2){if(typeof(baseClass)!="function"){throw new Error("Base class is not a function, cannot derive.");}}if(!definition){throw new Error("Object definition not provided.");}var constructorClass;if(definition.$construct){constructorClass=definition.$construct;delete definition.$construct}else{if(baseClass){constructorClass=Core._copyFunction(baseClass)}else{constructorClass=Core._createFunction()}}constructorClass.$virtual={};constructorClass.$super=baseClass;if(baseClass){var prototypeClass=Core._createFunction();prototypeClass.prototype=baseClass.prototype;constructorClass.prototype=new prototypeClass()}constructorClass.prototype.constructor=constructorClass;if(definition.$abstract){constructorClass.$abstract={};if(baseClass&&baseClass.$abstract){for(x in baseClass.$abstract){constructorClass.$abstract[x]=baseClass.$abstract[x]}}if(definition.$abstract instanceof Object){for(x in definition.$abstract){constructorClass.$abstract[x]=true;constructorClass.$virtual[x]=true}}delete definition.$abstract}if(baseClass){for(name in baseClass.$virtual){constructorClass.$virtual[name]=baseClass.$virtual[name]}}if(definition.$virtual){Core._inherit(constructorClass.prototype,definition.$virtual,constructorClass.$virtual);for(name in definition.$virtual){constructorClass.$virtual[name]=true}delete definition.$virtual}if(definition.hasOwnProperty("toString")){constructorClass.prototype.toString=definition.toString}if(definition.hasOwnProperty("valueOf")){constructorClass.prototype.valueOf=definition.valueOf}delete definition.toString;delete definition.valueOf;if(definition.$include){var mixins=definition.$include.reverse();Core._processMixins(constructorClass,mixins);delete definition.$include}var loadMethod=null;if(definition.$load){loadMethod=definition.$load;delete definition.$load}if(definition.$static){Core._inherit(constructorClass,definition.$static);delete definition.$static}Core._inherit(constructorClass.prototype,definition,constructorClass.$virtual);if(!constructorClass.$abstract){this._verifyAbstractImpl(constructorClass)}if(loadMethod){loadMethod.call(constructorClass)}return constructorClass},get:function(object,path){for(var i=0;i<path.length;++i){object=object[path[i]];if(!object){return null}}return object},_isVirtual:function(virtualProperties,propertyName){switch(propertyName){case"toString":case"valueOf":return true}return virtualProperties[propertyName]},_inherit:function(destination,source,virtualProperties){for(var name in source){if(virtualProperties&&destination[name]!==undefined&&!this._isVirtual(virtualProperties,name)){throw new Error("Cannot override non-virtual property \""+name+"\".");}else{destination[name]=source[name]}}},method:function(instance,method){return function(){return method.apply(instance,arguments)}},_processMixins:function(destination,mixins){for(var i=0;i<mixins.length;++i){for(var mixinProperty in mixins[i]){if(destination.prototype[mixinProperty]){continue}destination.prototype[mixinProperty]=mixins[i][mixinProperty]}}},set:function(object,path,value){var parentObject=null;for(var i=0;i<path.length-1;++i){parentObject=object;object=object[path[i]];if(!object){object={};parentObject[path[i]]=object}}object[path[path.length-1]]=value},_verifyAbstractImpl:function(constructorClass){var baseClass=constructorClass.$super;if(!baseClass||!baseClass.$abstract||baseClass.$abstract===true){return}for(var x in baseClass.$abstract){if(constructorClass.prototype[x]==null){throw new Error("Concrete class does not provide implementation of abstract method \""+x+"\".");}}}};Core.Debug={consoleElement:null,useAlertDialog:false,consoleWrite:function(text){if(Core.Debug.consoleElement){var entryElement=document.createElement("div");entryElement.appendChild(document.createTextNode(text));if(Core.Debug.consoleElement.childNodes.length===0){Core.Debug.consoleElement.appendChild(entryElement)}else{Core.Debug.consoleElement.insertBefore(entryElement,Core.Debug.consoleElement.firstChild)}}else if(Core.Debug.useAlertDialog){alert("DEBUG:"+text)}},toString:function(object){var s="";for(var x in object){if(typeof object[x]!="function"){s+=x+":"+object[x]+"\n"}}return s}};Core.Arrays={containsAll:function(array1,array2,unique){if(unique&&array1.length<array2.length){return false}if(array2.length===0){return true}var found,item;for(var i=0;i<array2.length;++i){found=false;item=array2[i];for(var j=0;j<array1.length;++j){if(item==array1[j]){found=true;break}}if(!found){return false}}return true},indexOf:function(array,item){for(var i=0;i<array.length;++i){if(item==array[i]){return i}}return-1},remove:function(array,item){for(var i=0;i<array.length;++i){if(item==array[i]){array.splice(i,1);return}}},removeDuplicates:function(array){array.sort();var removeCount=0;for(var i=array.length-1;i>0;--i){if(array[i]==array[i-1]){array[i]=array[array.length-1-removeCount];++removeCount}}if(removeCount>0){array.length=array.length-removeCount}}};Core.Arrays.LargeMap=Core.extend({$static:{garbageCollectEnabled:false},_removeCount:0,garbageCollectionInterval:250,map:null,$construct:function(){this.map={}},_garbageCollect:function(){this._removeCount=0;var newMap={};for(var key in this.map){newMap[key]=this.map[key]}this.map=newMap},remove:function(key){delete this.map[key];if(Core.Arrays.LargeMap.garbageCollectEnabled){++this._removeCount;if(this._removeCount>=this.garbageCollectionInterval){this._garbageCollect()}}},toString:function(){return Core.Debug.toString(this.map)}});Core.ListenerList=Core.extend({_data:null,$construct:function(){this._data=[]},addListener:function(eventType,eventTarget){this._data.push(eventType,eventTarget)},fireEvent:function(event){if(event.type==null){throw new Error("Cannot fire event, type property not set.");}var i,returnValue=true,listeners=[];for(i=0;i<this._data.length;i+=2){if(this._data[i]==event.type){listeners.push(this._data[i+1])}}for(i=0;i<listeners.length;++i){returnValue=listeners[i](event)&&returnValue}return returnValue},getListenerTypes:function(){var types=[];for(var i=0;i<this._data.length;i+=2){types.push(this._data[i])}Core.Arrays.removeDuplicates(types);return types},getListeners:function(eventType){var listeners=[];for(var i=0;i<this._data.length;i+=2){if(this._data[i]==eventType){listeners.push(this._data[i+1])}}return listeners},getListenerCount:function(eventType){var count=0;for(var i=0;i<this._data.length;i+=2){if(this._data[i]==eventType){++count}}return count},hasListeners:function(eventType){for(var i=0;i<this._data.length;i+=2){if(this._data[i]==eventType){return true}}return false},isEmpty:function(){return this._data.length===0},removeListener:function(eventType,eventTarget){for(var i=0;i<this._data.length;i+=2){if(this._data[i]==eventType&&eventTarget==this._data[i+1]){var oldLength=this._data.length;this._data.splice(i,2);return}}},toString:function(){var out="";for(var i=0;i<this._data.length;i+=2){if(i>0){out+=", "}out+=this._data[i]+":"+this._data[i+1]}return out}});Core.ResourceBundle=Core.extend({$static:{getParentLanguageCode:function(languageCode){if(languageCode.indexOf("-")==-1){return null}else{return languageCode.substring(0,languageCode.indexOf("-"))}}},_sourceMaps:null,_generatedMaps:null,_defaultMap:null,$construct:function(defaultMap){this._sourceMaps={};this._generatedMaps={};this._defaultMap=defaultMap},get:function(languageCode){var map=languageCode?this._generatedMaps[languageCode]:this._defaultMap;if(map){return map}map={};var x;var sourceMap=this._sourceMaps[languageCode];if(sourceMap){for(x in sourceMap){map[x]=sourceMap[x]}}var parentLanguageCode=Core.ResourceBundle.getParentLanguageCode(languageCode);if(parentLanguageCode){sourceMap=this._sourceMaps[parentLanguageCode];if(sourceMap){for(x in sourceMap){if(map[x]===undefined){map[x]=sourceMap[x]}}}}for(x in this._defaultMap){if(map[x]===undefined){map[x]=this._defaultMap[x]}}this._generatedMaps[languageCode]=map;return map},set:function(languageCode,map){this._generatedMaps={};this._sourceMaps[languageCode]=map},toString:function(){var out="ResourceBundle: ";for(var x in this._sourceMaps){out+=" "+x}return out}});Core.Web={dragInProgress:false,init:function(){if(Core.Web.initialized){return}Core.Web.Env._init();Core.Web.Measure._calculateExtentSizes();Core.Web.Measure.Bounds._initMeasureContainer();if(Core.Web.Env.QUIRK_CSS_POSITIONING_ONE_SIDE_ONLY){Core.Web.VirtualPosition._init()}if(Core.Web.Env.ENGINE_MSHTML){Core.Web.DOM.addEventListener(document,"selectstart",Core.Web._selectStartListener,false)}Core.Web.initialized=true},_selectStartListener:function(e){e=e?e:window.event;if(Core.Web.dragInProgress){Core.Web.DOM.preventEventDefault(e)}}};Core.Web.DOM={_focusPendingElement:null,_focusRunnable:null,addEventListener:function(eventSource,eventType,eventListener,useCapture){if(eventSource.addEventListener){eventSource.addEventListener(eventType,eventListener,useCapture)}else if(eventSource.attachEvent){eventSource.attachEvent("on"+eventType,eventListener)}},createDocument:function(namespaceUri,qualifiedName){if(document.implementation&&document.implementation.createDocument){var dom;if(Core.Web.Env.BROWSER_FIREFOX&&Core.Web.Env.BROWSER_VERSION_MAJOR==3&&Core.Web.Env.BROWSER_VERSION_MINOR===0){dom=new DOMParser().parseFromString("<?xml version='1.0' encoding='UTF-8'?><"+qualifiedName+"/>","application/xml")}else{dom=document.implementation.createDocument(namespaceUri,qualifiedName,null)}if(!dom.documentElement){dom.appendChild(dom.createElement(qualifiedName))}return dom}else if(window.ActiveXObject){var createdDocument=new ActiveXObject("Microsoft.XMLDOM");var documentElement=createdDocument.createElement(qualifiedName);createdDocument.appendChild(documentElement);return createdDocument}else{throw new Error("XML DOM creation not supported by browser environment.");}},focusElement:function(element){if(Core.Web.Env.QUIRK_DELAYED_FOCUS_REQUIRED){if(!this._focusRunnable){this._focusRunnable=new Core.Web.Scheduler.MethodRunnable(this._focusElementImpl)}Core.Web.DOM._focusPendingElement=element;Core.Web.Scheduler.add(this._focusRunnable)}else{this._focusElementImpl(element)}},_focusElementImpl:function(element){if(!element){element=Core.Web.DOM._focusPendingElement;Core.Web.DOM._focusPendingElement=null}if(element&&element.focus){try{element.focus()}catch(ex){}}},getChildElementByTagName:function(parentElement,tagName){var element=parentElement.firstChild;while(element){if(element.nodeType==1&&element.nodeName==tagName){return element}element=element.nextSibling}return null},getChildElementsByTagName:function(parentElement,tagName){var elements=[];var element=parentElement.firstChild;while(element){if(element.nodeType==1&&element.nodeName==tagName){elements.push(element)}element=element.nextSibling}return elements},getEventOffset:function(e){if(typeof e.offsetX=="number"){return{x:e.offsetX,y:e.offsetY}}else{var bounds=new Core.Web.Measure.Bounds(this.getEventTarget(e));return{x:e.clientX-bounds.left,y:e.clientY-bounds.top}}},getEventTarget:function(e){return e.target?e.target:e.srcElement},getEventRelatedTarget:function(e){return e.relatedTarget?e.relatedTarget:e.toElement},isAncestorOf:function(ancestorNode,descendantNode){var testNode=descendantNode;while(testNode!==null){if(testNode==ancestorNode){return true}testNode=testNode.parentNode}return false},preventEventDefault:function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},removeAllChildren:function(node){while(node.firstChild){node.removeChild(node.firstChild)}},removeEventListener:function(eventSource,eventType,eventListener,useCapture){if(eventSource.removeEventListener){eventSource.removeEventListener(eventType,eventListener,useCapture)}else if(eventSource.detachEvent){eventSource.detachEvent("on"+eventType,eventListener)}},removeNode:function(node){var parentNode=node.parentNode;if(!parentNode){return}if(Core.Web.Env.QUIRK_PERFORMANCE_LARGE_DOM_REMOVE){this._removeNodeRecursive(node)}else{parentNode.removeChild(node)}},_removeNodeRecursive:function(node){var childNode=node.firstChild;while(childNode){var nextChildNode=childNode.nextSibling;this._removeNodeRecursive(childNode);childNode=nextChildNode}node.parentNode.removeChild(node)},stopEventPropagation:function(e){if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}}};Core.Web.Env={ENGINE_PRESTO:null,ENGINE_WEBKIT:null,ENGINE_KHTML:null,ENGINE_MSHTML:null,ENGINE_GECKO:null,BROWSER_MOZILLA:null,BROWSER_OPERA:null,BROWSER_KONQUEROR:null,BROWSER_FIREFOX:null,BROWSER_INTERNET_EXPLORER:null,BROWSER_CHROME:null,BROWSER_VERSION_MAJOR:null,BROWSER_VERSION_MINOR:null,ENGINE_VERSION_MAJOR:null,ENGINE_VERSION_MINOR:null,DECEPTIVE_USER_AGENT:null,CSS_FLOAT:"cssFloat",MEASURE_OFFSET_EXCLUDES_BORDER:null,NOT_SUPPORTED_CSS_OPACITY:null,NOT_SUPPORTED_RELATIVE_COLUMN_WIDTHS:null,NOT_SUPPORTED_INPUT_SELECTION:null,NOT_SUPPORTED_RANGE:null,PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED:null,PROPRIETARY_EVENT_SELECT_START_SUPPORTED:null,PROPRIETARY_IE_OPACITY_FILTER_REQUIRED:null,PROPRIETARY_IE_PNG_ALPHA_FILTER_REQUIRED:null,PROPRIETARY_IE_RANGE:null,QUIRK_KEY_CODE_IS_CHAR_CODE:null,QUIRK_KEY_PRESS_FIRED_FOR_SPECIAL_KEYS:null,QUIRK_KEY_DOWN_NOT_FIRED_FOR_SPECIAL_KEYS:null,QUIRK_CSS_BORDER_COLLAPSE_INSIDE:null,QUIRK_CSS_POSITIONING_ONE_SIDE_ONLY:null,QUIRK_DELAYED_FOCUS_REQUIRED:null,QUIRK_IE_BLANK_SCREEN:null,QUIRK_IE_HAS_LAYOUT:null,QUIRK_IE_SELECT_LIST_DOM_UPDATE:null,QUIRK_IE_SELECT_PERCENT_WIDTH:null,QUIRK_IE_SELECT_Z_INDEX:null,QUIRK_IE_SECURE_ITEMS:null,QUIRK_IE_TABLE_PERCENT_WIDTH_SCROLLBAR_ERROR:null,QUIRK_MEASURE_OFFSET_HIDDEN_BORDER:null,QUIRK_OPERA_CSS_POSITIONING:null,QUIRK_PERFORMANCE_LARGE_DOM_REMOVE:null,QUIRK_WEBKIT_DOM_TEXT_ESCAPE:null,QUIRK_TABLE_CELL_WIDTH_EXCLUDES_PADDING:null,QUIRK_UNLOADED_IMAGE_HAS_SIZE:null,_ua:null,_uaAlpha:null,_init:function(){var browserVersion=null,engineVersion=null,engineId=false;this._ua=navigator.userAgent.toLowerCase();this._uaAlpha="/"+this._ua.replace(/[^a-z]+/g,"/")+"/";if(this._testUAString("opera")){this.BROWSER_OPERA=engineId=this.ENGINE_PRESTO=true;browserVersion=this._parseVersionInfo("opera/")}else if(this._testUAString("chrome")){this.BROWSER_CHROME=engineId=this.ENGINE_WEBKIT=true;browserVersion=this._parseVersionInfo("chrome/")}else if(this._testUAString("safari")){this.BROWSER_SAFARI=engineId=this.ENGINE_WEBKIT=true;browserVersion=this._parseVersionInfo("version/")}else if(this._testUAString("konqueror")){this.BROWSER_KONQUEROR=engineId=this.ENGINE_KHTML=true;browserVersion=this._parseVersionInfo("konqueror/")}else if(this._testUAString("firefox")){this.BROWSER_FIREFOX=this.BROWSER_MOZILLA=engineId=this.ENGINE_GECKO=true;browserVersion=this._parseVersionInfo("firefox/")}else if(this._testUAString("msie")){this.BROWSER_INTERNET_EXPLORER=engineId=this.ENGINE_MSHTML=true;engineVersion=browserVersion=this._parseVersionInfo("msie ")}if(!engineId){if(this._testUAString("presto")){this.ENGINE_PRESTO=true}else if(this._testUAString("webkit")){this.ENGINE_WEBKIT=true}else if(this._testUAString("khtml")){this.ENGINE_KHTML=true}else if(this._testUAString("trident")){this.ENGINE_MSHTML=true}else if(this._testUAString("gecko")){this.BROWSER_MOZILLA=this.ENGINE_GECKO=true}}if(!engineVersion){if(this.ENGINE_PRESTO){engineVersion=this._parseVersionInfo("presto/")}else if(this.ENGINE_WEBKIT){engineVersion=this._parseVersionInfo("webkit/")}else if(this.ENGINE_GECKO){engineVersion=this._parseVersionInfo("rv:");if(!browserVersion){browserVersion=engineVersion}}}if(browserVersion){this.BROWSER_VERSION_MAJOR=browserVersion.major;this.BROWSER_VERSION_MINOR=browserVersion.minor}if(engineVersion){this.ENGINE_VERSION_MAJOR=engineVersion.major;this.ENGINE_VERSION_MINOR=engineVersion.minor}this.DECEPTIVE_USER_AGENT=this.BROWSER_OPERA||this.BROWSER_SAFARI||this.BROWSER_CHROME||this.BROWSER_KONQUEROR;this.MEASURE_OFFSET_EXCLUDES_BORDER=false;if(this.BROWSER_INTERNET_EXPLORER){this.CSS_FLOAT="styleFloat";this.QUIRK_KEY_CODE_IS_CHAR_CODE=true;this.QUIRK_IE_SECURE_ITEMS=true;this.NOT_SUPPORTED_RANGE=true;this.NOT_SUPPORTED_INPUT_SELECTION=true;this.PROPRIETARY_IE_RANGE=true;this.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED=true;this.PROPRIETARY_EVENT_SELECT_START_SUPPORTED=true;this.QUIRK_DELAYED_FOCUS_REQUIRED=true;this.QUIRK_UNLOADED_IMAGE_HAS_SIZE=true;this.MEASURE_OFFSET_EXCLUDES_BORDER=true;this.QUIRK_IE_BLANK_SCREEN=true;this.QUIRK_IE_HAS_LAYOUT=true;if(this.BROWSER_VERSION_MAJOR<8){this.QUIRK_TABLE_CELL_WIDTH_EXCLUDES_PADDING=true;this.NOT_SUPPORTED_RELATIVE_COLUMN_WIDTHS=true;this.QUIRK_CSS_BORDER_COLLAPSE_INSIDE=true;this.NOT_SUPPORTED_CSS_OPACITY=true;this.PROPRIETARY_IE_OPACITY_FILTER_REQUIRED=true;this.QUIRK_IE_TABLE_PERCENT_WIDTH_SCROLLBAR_ERROR=true;this.QUIRK_IE_SELECT_PERCENT_WIDTH=true;if(this.BROWSER_VERSION_MAJOR<7){this.QUIRK_IE_SELECT_LIST_DOM_UPDATE=true;this.QUIRK_CSS_POSITIONING_ONE_SIDE_ONLY=true;this.PROPRIETARY_IE_PNG_ALPHA_FILTER_REQUIRED=true;this.QUIRK_IE_SELECT_Z_INDEX=true;Core.Arrays.LargeMap.garbageCollectEnabled=true}}}else if(this.ENGINE_GECKO){this.QUIRK_KEY_PRESS_FIRED_FOR_SPECIAL_KEYS=true;this.MEASURE_OFFSET_EXCLUDES_BORDER=true;this.QUIRK_MEASURE_OFFSET_HIDDEN_BORDER=true;if(this.BROWSER_FIREFOX){if(this.BROWSER_VERSION_MAJOR<2){this.QUIRK_DELAYED_FOCUS_REQUIRED=true}}else{this.QUIRK_PERFORMANCE_LARGE_DOM_REMOVE=true;this.QUIRK_DELAYED_FOCUS_REQUIRED=true}}else if(this.ENGINE_PRESTO){this.QUIRK_KEY_CODE_IS_CHAR_CODE=true;this.QUIRK_TABLE_CELL_WIDTH_EXCLUDES_PADDING=true;if(this.BROWSER_VERSION_MAJOR==9&&this.BROWSER_VERSION_MINOR>=50){this.QUIRK_OPERA_CSS_POSITIONING=true}this.NOT_SUPPORTED_RELATIVE_COLUMN_WIDTHS=true}else if(this.ENGINE_WEBKIT){this.MEASURE_OFFSET_EXCLUDES_BORDER=true;if(this.ENGINE_VERSION_MAJOR<526||(this.ENGINE_VERSION_MAJOR==526&&this.ENGINE_VERSION_MINOR<8)){this.QUIRK_WEBKIT_DOM_TEXT_ESCAPE=true}}},_parseVersionInfo:function(searchString){var version={};var ix1=this._ua.indexOf(searchString);if(ix1==-1){return}var ix2=this._ua.indexOf(".",ix1);var ix3=this._ua.length;if(ix2==-1){ix2=this._ua.length}else{for(var i=ix2+1;i<this._ua.length;i++){var c=this._ua.charAt(i);if(isNaN(c)){ix3=i;break}}}version.major=parseInt(this._ua.substring(ix1+searchString.length,ix2),10);if(ix2==this._ua.length){version.minor=0}else{version.minor=parseInt(this._ua.substring(ix2+1,ix3),10)}return version},_testUAString:function(browser){return this._uaAlpha.indexOf("/"+browser+"/")!=-1}};Core.Web.Event={Selection:{disable:function(element){Core.Web.Event.add(element,"mousedown",Core.Web.Event.Selection._disposeEvent,false);if(Core.Web.Env.PROPRIETARY_EVENT_SELECT_START_SUPPORTED){Core.Web.Event.add(element,"selectstart",Core.Web.Event.Selection._disposeEvent,false)}},_disposeEvent:function(e){Core.Web.DOM.preventEventDefault(e)},enable:function(element){Core.Web.Event.remove(element,"mousedown",Core.Web.Event.Selection._disposeEvent,false);if(Core.Web.Env.PROPRIETARY_EVENT_SELECT_START_SUPPORTED){Core.Web.Event.remove(element,"selectstart",Core.Web.Event.Selection._disposeEvent,false)}}},_nextId:0,_listenerCount:0,debugListenerCount:false,_capturingListenerMap:new Core.Arrays.LargeMap(),_bubblingListenerMap:new Core.Arrays.LargeMap(),add:function(element,eventType,eventTarget,capture){if(!element.__eventProcessorId){element.__eventProcessorId=++Core.Web.Event._nextId}var listenerList;if(element.__eventProcessorId==Core.Web.Event._lastId&&capture==Core.Web.Event._lastCapture){listenerList=Core.Web.Event._lastListenerList}else{var listenerMap=capture?Core.Web.Event._capturingListenerMap:Core.Web.Event._bubblingListenerMap;listenerList=listenerMap.map[element.__eventProcessorId];if(!listenerList){listenerList=new Core.ListenerList();listenerMap.map[element.__eventProcessorId]=listenerList}Core.Web.Event._lastId=element.__eventProcessorId;Core.Web.Event._lastCapture=capture;Core.Web.Event._lastListenerList=listenerList}if(!listenerList.hasListeners(eventType)){Core.Web.DOM.addEventListener(element,eventType,Core.Web.Event._processEvent,false);++Core.Web.Event._listenerCount}listenerList.addListener(eventType,eventTarget)},_processEvent:function(e){if(Core.Web.Event.debugListenerCount){Core.Debug.consoleWrite("Core.Web.Event listener count: "+Core.Web.Event._listenerCount)}e=e?e:window.event;if(!e.target&&e.srcElement){e.target=e.srcElement}var elementAncestry=[];var targetElement=e.target;while(targetElement){if(targetElement.__eventProcessorId){elementAncestry.push(targetElement)}targetElement=targetElement.parentNode}var listenerList,i,propagate=true;for(i=elementAncestry.length-1;i>=0;--i){listenerList=Core.Web.Event._capturingListenerMap.map[elementAncestry[i].__eventProcessorId];if(listenerList){e.registeredTarget=elementAncestry[i];if(!listenerList.fireEvent(e)){propagate=false;break}}}if(propagate){for(i=0;i<elementAncestry.length;++i){listenerList=Core.Web.Event._bubblingListenerMap.map[elementAncestry[i].__eventProcessorId];if(listenerList){e.registeredTarget=elementAncestry[i];if(!listenerList.fireEvent(e)){break}}}}Core.Web.DOM.stopEventPropagation(e)},remove:function(element,eventType,eventTarget,capture){Core.Web.Event._lastId=null;if(!element.__eventProcessorId){return}var listenerMap=capture?Core.Web.Event._capturingListenerMap:Core.Web.Event._bubblingListenerMap;var listenerList=listenerMap.map[element.__eventProcessorId];if(listenerList){listenerList.removeListener(eventType,eventTarget);if(listenerList.isEmpty()){listenerMap.remove(element.__eventProcessorId)}if(!listenerList.hasListeners(eventType)){Core.Web.DOM.removeEventListener(element,eventType,Core.Web.Event._processEvent,false);--Core.Web.Event._listenerCount}}},removeAll:function(element){Core.Web.Event._lastId=null;if(!element.__eventProcessorId){return}Core.Web.Event._removeAllImpl(element,Core.Web.Event._capturingListenerMap);Core.Web.Event._removeAllImpl(element,Core.Web.Event._bubblingListenerMap)},_removeAllImpl:function(element,listenerMap){var listenerList=listenerMap.map[element.__eventProcessorId];if(!listenerList){return}var types=listenerList.getListenerTypes();for(var i=0;i<types.length;++i){Core.Web.DOM.removeEventListener(element,types[i],Core.Web.Event._processEvent,false);--Core.Web.Event._listenerCount}listenerMap.remove(element.__eventProcessorId)},toString:function(){return"Capturing: "+Core.Web.Event._capturingListenerMap+"\n"+"Bubbling: "+Core.Web.Event._bubblingListenerMap}};Core.Web.HttpConnection=Core.extend({_url:null,_contentType:null,_method:null,_messageObject:null,_listenerList:null,_disposed:false,_xmlHttpRequest:null,_requestHeaders:null,$construct:function(url,method,messageObject,contentType){this._url=url;this._contentType=contentType;this._method=method;if(Core.Web.Env.QUIRK_WEBKIT_DOM_TEXT_ESCAPE&&messageObject instanceof Document){this._preprocessWebkitDOM(messageObject.documentElement)}this._messageObject=messageObject;this._listenerList=new Core.ListenerList()},_preprocessWebkitDOM:function(node){if(node.nodeType==3){var value=node.data;value=value.replace(/&/g,"&amp;");value=value.replace(/</g,"&lt;");value=value.replace(/>/g,"&gt;");node.data=value}else{var child=node.firstChild;while(child){this._preprocessWebkitDOM(child);child=child.nextSibling}}},addResponseListener:function(l){this._listenerList.addListener("response",l)},connect:function(){var usingActiveXObject=false;if(window.XMLHttpRequest){this._xmlHttpRequest=new XMLHttpRequest()}else if(window.ActiveXObject){usingActiveXObject=true;this._xmlHttpRequest=new ActiveXObject("Microsoft.XMLHTTP")}else{throw"Connect failed: Cannot create XMLHttpRequest.";}var instance=this;this._xmlHttpRequest.onreadystatechange=function(){if(!instance){return}try{instance._processReadyStateChange()}finally{if(instance._disposed){instance=null}}};this._xmlHttpRequest.open(this._method,this._url,true);if(this._requestHeaders&&(usingActiveXObject||this._xmlHttpRequest.setRequestHeader)){for(var h in this._requestHeaders){try{this._xmlHttpRequest.setRequestHeader(h,this._requestHeaders[h])}catch(e){throw new Error("Failed to set header \""+h+"\"");}}}if(this._contentType&&(usingActiveXObject||this._xmlHttpRequest.setRequestHeader)){this._xmlHttpRequest.setRequestHeader("Content-Type",this._contentType)}this._xmlHttpRequest.send(this._messageObject?this._messageObject:null)},dispose:function(){this._listenerList=null;this._messageObject=null;this._xmlHttpRequest=null;this._disposed=true;this._requestHeaders=null},getResponseHeader:function(header){return this._xmlHttpRequest?this._xmlHttpRequest.getResponseHeader(header):null},getAllResponseHeaders:function(){return this._xmlHttpRequest?this._xmlHttpRequest.getAllResponseHeaders():null},getStatus:function(){return this._xmlHttpRequest?this._xmlHttpRequest.status:null},getResponseText:function(){return this._xmlHttpRequest?this._xmlHttpRequest.responseText:null},getResponseXml:function(){return this._xmlHttpRequest?this._xmlHttpRequest.responseXML:null},_processReadyStateChange:function(){if(this._disposed){return}if(this._xmlHttpRequest.readyState==4){var responseEvent;try{var valid=!this._xmlHttpRequest.status||(this._xmlHttpRequest.status>=200&&this._xmlHttpRequest.status<=299);responseEvent={type:"response",source:this,valid:valid}}catch(ex){responseEvent={type:"response",source:this,valid:false,exception:ex}}Core.Web.Scheduler.run(Core.method(this,function(){this._listenerList.fireEvent(responseEvent);this.dispose()}))}},removeResponseListener:function(l){this._listenerList.removeListener("response",l)},setRequestHeader:function(header,value){if(!this._requestHeaders){this._requestHeaders={}}this._requestHeaders[header]=value}});Core.Web.Image={_Monitor:Core.extend({_processImageLoadRef:null,_queuedRunnable:null,_listener:null,_interval:null,_count:0,$construct:function(element,listener,interval){this._listener=listener;this._interval=interval||250;this._processImageLoadRef=Core.method(this,this._processImageLoad);var imgs=element.getElementsByTagName("img");this._count=imgs.length;for(var i=0;i<this._count;++i){if(!imgs[i].complete&&(Core.Web.Env.QUIRK_UNLOADED_IMAGE_HAS_SIZE||(!imgs[i].height&&!imgs[i].style.height))){Core.Web.DOM.addEventListener(imgs[i],"load",this._processImageLoadRef,false)}}},_processImageLoad:function(e){e=e?e:window.event;Core.Web.DOM.removeEventListener(Core.Web.DOM.getEventTarget(e),"load",this._processImageLoadRef,false);--this._count;if(this._queuedRunnable&&this._count===0){Core.Web.Scheduler.remove(this._queuedRunnable);this._queuedRunnable=null}if(!this._queuedRunnable){this._queuedRunnable=Core.Web.Scheduler.run(Core.method(this,function(){this._queuedRunnable=null;this._listener()}),this._count===0?0:this._interval)}}}),monitor:function(element,l,interval){var monitor=new Core.Web.Image._Monitor(element,l,interval)}};Core.Web.Key={_KEY_TABLES:{GECKO:{59:186,61:187,109:189},MAC_GECKO:{},PRESTO:{59:186,61:187,44:188,45:189,46:190,47:191,96:192,91:219,92:220,93:221,39:222},WEBKIT:{}},_keyTable:null,_loadKeyTable:function(){if(Core.Web.Env.ENGINE_GECKO){this._keyTable=this._KEY_TABLES.GECKO}else if(Core.Web.Env.ENGINE_PRESTO){this._keyTable=this._KEY_TABLES.PRESTO}else{this._keyTable={}}},translateKeyCode:function(keyCode){if(!this._keyTable){this._loadKeyTable()}return this._keyTable[keyCode]||keyCode}};Core.Web.Library={_loadedLibraries:{},evalLine:null,Group:Core.extend({_listenerList:null,_libraries:null,_loadedCount:0,_totalCount:0,$construct:function(){this._listenerList=new Core.ListenerList();this._libraries=[]},add:function(libraryUrl){if(Core.Web.Library._loadedLibraries[libraryUrl]){return}var libraryItem=new Core.Web.Library._Item(this,libraryUrl);this._libraries.push(libraryItem)},addLoadListener:function(l){this._listenerList.addListener("load",l)},hasNewLibraries:function(){return this._libraries.length>0},_install:function(){for(var i=0;i<this._libraries.length;++i){try{this._libraries[i]._install()}catch(ex){var e={type:"load",source:this,success:false,ex:ex,url:this._libraries[i]._url,cancel:false};try{this._listenerList.fireEvent(e)}finally{if(!e.cancel){throw new Error("Exception installing library \""+this._libraries[i]._url+"\"; "+ex);}}}}this._listenerList.fireEvent({type:"load",source:this,success:true});},_notifyRetrieved:function(){++this._loadedCount;if(this._loadedCount==this._totalCount){this._install();}},load:function(){this._totalCount=this._libraries.length;for(var i=0;i<this._libraries.length;++i){this._libraries[i]._retrieve();}},removeLoadListener:function(l){this._listenerList.removeListener("load",l);}}),_Item:Core.extend({_url:null,_group:null,_content:null,$construct:function(group,url){this._url=url;this._group=group;},_retrieveListener:function(e){if(!e.valid){throw new Error("Invalid HTTP response retrieving library \""+this._url+"\", received status: "+e.source.getStatus())}this._content=e.source.getResponseText();this._group._notifyRetrieved()},_install:function(){if(Core.Web.Library._loadedLibraries[this._url]){return}Core.Web.Library._loadedLibraries[this._url]=true;if(this._content==null){throw new Error("Attempt to install library when no content has been loaded.");}Core.Web.Library.evalLine=new Error().lineNumber+1;eval(this._content)},_retrieve:function(){var conn=new Core.Web.HttpConnection(this._url,"GET");conn.addResponseListener(Core.method(this,this._retrieveListener));conn.connect()}}),exec:function(requiredLibraries,f){var group=null;for(var i=0;i<requiredLibraries.length;++i){if(!Core.Web.Library._loadedLibraries[requiredLibraries[i]]){if(group==null){group=new Core.Web.Library.Group()}group.add(requiredLibraries[i])}}if(group==null){Core.Web.Scheduler.run(f);return}group.addLoadListener(f);group.load()}};Core.Web.Measure={_scrollElements:["div","body"],_hInch:96,_vInch:96,_hEx:7,_vEx:7,_hEm:13.3333,_vEm:13.3333,SCROLL_WIDTH:17,SCROLL_HEIGHT:17,_PARSER:/^(-?\d+(?:\.\d+)?)(.+)?$/,extentToPixels:function(extent,horizontal){var parts=this._PARSER.exec(extent);if(!parts){throw new Error("Invalid Extent: "+extent);}var value=parseFloat(parts[1]);var units=parts[2]?parts[2]:"px";if(!units||units=="px"){return value}var dpi=horizontal?Core.Web.Measure._hInch:Core.Web.Measure._vInch;switch(units){case"%":return null;case"in":return value*(horizontal?Core.Web.Measure._hInch:Core.Web.Measure._vInch);case"cm":return value*(horizontal?Core.Web.Measure._hInch:Core.Web.Measure._vInch)/2.54;case"mm":return value*(horizontal?Core.Web.Measure._hInch:Core.Web.Measure._vInch)/25.4;case"pt":return value*(horizontal?Core.Web.Measure._hInch:Core.Web.Measure._vInch)/72;case"pc":return value*(horizontal?Core.Web.Measure._hInch:Core.Web.Measure._vInch)/6;case"em":return value*(horizontal?Core.Web.Measure._hEm:Core.Web.Measure._vEm);case"ex":return value*(horizontal?Core.Web.Measure._hEx:Core.Web.Measure._vEx)}},_calculateExtentSizes:function(){var containerElement=document.getElementsByTagName("body")[0];var inchDiv4=document.createElement("div");inchDiv4.style.width="4in";inchDiv4.style.height="4in";containerElement.appendChild(inchDiv4);Core.Web.Measure._hInch=inchDiv4.offsetWidth/4;Core.Web.Measure._vInch=inchDiv4.offsetHeight/4;containerElement.removeChild(inchDiv4);var emDiv24=document.createElement("div");emDiv24.style.width="24em";emDiv24.style.height="24em";containerElement.appendChild(emDiv24);Core.Web.Measure._hEm=emDiv24.offsetWidth/24;Core.Web.Measure._vEm=emDiv24.offsetHeight/24;containerElement.removeChild(emDiv24);var exDiv24=document.createElement("div");exDiv24.style.width="24ex";exDiv24.style.height="24ex";containerElement.appendChild(exDiv24);Core.Web.Measure._hEx=exDiv24.offsetWidth/24;Core.Web.Measure._vEx=exDiv24.offsetHeight/24;containerElement.removeChild(exDiv24);var scrollDiv=document.createElement("div");scrollDiv.style.cssText="width:500px;height:100px;overflow:auto;";var largeDiv=document.createElement("div");largeDiv.style.cssText="width:100px;height:200px;";scrollDiv.appendChild(largeDiv);var testDiv=document.createElement("div");testDiv.style.cssText="width:100%;height:10px;";scrollDiv.appendChild(testDiv);containerElement.appendChild(scrollDiv);var measuredWidth=500-testDiv.offsetWidth;if(measuredWidth){Core.Web.Measure.SCROLL_WIDTH=Core.Web.Measure.SCROLL_HEIGHT=measuredWidth}containerElement.removeChild(scrollDiv)},_getScrollOffset:function(element){var valueT=0,valueL=0;do{if(element.scrollLeft||element.scrollTop){valueT+=element.scrollTop||0;valueL+=element.scrollLeft||0}element=element.offsetParent}while(element);return{left:valueL,top:valueT}},_getCumulativeOffset:function(element){var valueT=0,valueL=0,init=true;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;if(!init&&Core.Web.Env.MEASURE_OFFSET_EXCLUDES_BORDER){if(element.style.borderLeftWidth&&element.style.borderLeftStyle!="none"){var borderLeft=Core.Web.Measure.extentToPixels(element.style.borderLeftWidth,true);valueL+=borderLeft;if(Core.Web.Env.QUIRK_MEASURE_OFFSET_HIDDEN_BORDER&&element.style.overflow=="hidden"){valueL+=borderLeft}}if(element.style.borderTopWidth&&element.style.borderTopStyle!="none"){var borderTop=Core.Web.Measure.extentToPixels(element.style.borderTopWidth,false);valueT+=borderTop;if(Core.Web.Env.QUIRK_MEASURE_OFFSET_HIDDEN_BORDER&&element.style.overflow=="hidden"){valueT+=borderTop}}}init=false;element=element.offsetParent}while(element);return{left:valueL,top:valueT}},Bounds:Core.extend({$static:{FLAG_MEASURE_DIMENSION:0x1,FLAG_MEASURE_POSITION:0x2,_initMeasureContainer:function(){this._offscreenDiv=document.createElement("div");this._offscreenDiv.style.cssText="position: absolute; top: -1300px; left: -1700px; width: 1600px; height: 1200px;";document.body.appendChild(this._offscreenDiv)}},width:null,height:null,top:null,left:null,$construct:function(element,constraints){var flags=(constraints&&constraints.flags)||(Core.Web.Measure.Bounds.FLAG_MEASURE_DIMENSION|Core.Web.Measure.Bounds.FLAG_MEASURE_POSITION);if(element===document.body){return{x:0,y:0,height:window.innerHeight||document.documentElement.clientHeight,width:window.innerWidth||document.documentElement.clientWidth}}var testElement=element;while(testElement&&testElement!=document){testElement=testElement.parentNode}var rendered=testElement==document;var parentNode,nextSibling;if(flags&Core.Web.Measure.Bounds.FLAG_MEASURE_DIMENSION){if(!rendered){parentNode=element.parentNode;nextSibling=element.nextSibling;if(parentNode){parentNode.removeChild(element)}if(constraints){if(constraints.width){Core.Web.Measure.Bounds._offscreenDiv.width=constraints.width}if(constraints.height){Core.Web.Measure.Bounds._offscreenDiv.height=constraints.height}}Core.Web.Measure.Bounds._offscreenDiv.appendChild(element);if(constraints){Core.Web.Measure.Bounds._offscreenDiv.width="1600px";Core.Web.Measure.Bounds._offscreenDiv.height="1200px"}}this.width=element.offsetWidth;this.height=element.offsetHeight;if(!rendered){Core.Web.Measure.Bounds._offscreenDiv.removeChild(element);if(parentNode){parentNode.insertBefore(element,nextSibling)}}}if(rendered&&(flags&Core.Web.Measure.Bounds.FLAG_MEASURE_POSITION)){var cumulativeOffset=Core.Web.Measure._getCumulativeOffset(element);var scrollOffset=Core.Web.Measure._getScrollOffset(element);this.top=cumulativeOffset.top-scrollOffset.top;this.left=cumulativeOffset.left-scrollOffset.left}},toString:function(){return(this.left!=null?(this.left+","+this.top+" : "):"")+(this.width!=null?("["+this.width+"x"+this.height+"]"):"")}})};Core.Web.Scheduler={_runnables:[],_threadHandle:null,_nextExecution:null,add:function(runnable){Core.Arrays.remove(Core.Web.Scheduler._runnables,runnable);runnable._nextExecution=new Date().getTime()+(runnable.timeInterval?runnable.timeInterval:0);Core.Web.Scheduler._runnables.push(runnable);Core.Web.Scheduler._setTimeout(runnable._nextExecution)},_execute:function(){Core.Web.Scheduler._threadHandle=null;var currentTime=new Date().getTime();var nextInterval=Number.MAX_VALUE;var i,runnable;for(i=0;i<Core.Web.Scheduler._runnables.length;++i){runnable=Core.Web.Scheduler._runnables[i];if(runnable&&runnable._nextExecution&&runnable._nextExecution<=currentTime){runnable._nextExecution=null;try{runnable.run()}catch(ex){throw(ex);}}}var newRunnables=[];for(i=0;i<Core.Web.Scheduler._runnables.length;++i){runnable=Core.Web.Scheduler._runnables[i];if(runnable==null){continue}if(runnable._nextExecution){newRunnables.push(runnable);var interval=runnable._nextExecution-currentTime;if(interval<nextInterval){nextInterval=interval}continue}if(runnable.timeInterval!=null&&runnable.repeat){runnable._nextExecution=currentTime+runnable.timeInterval;newRunnables.push(runnable);if(runnable.timeInterval<nextInterval){nextInterval=runnable.timeInterval}}}Core.Web.Scheduler._runnables=newRunnables;if(nextInterval<Number.MAX_VALUE){Core.Web.Scheduler._setTimeout(currentTime+nextInterval)}},remove:function(runnable){var index=Core.Arrays.indexOf(Core.Web.Scheduler._runnables,runnable);Core.Web.Scheduler._runnables[index]=null},run:function(f,timeInterval,repeat){var runnable=new Core.Web.Scheduler.MethodRunnable(f,timeInterval,repeat);Core.Web.Scheduler.add(runnable);return runnable},_setTimeout:function(nextExecution){if(Core.Web.Scheduler._threadHandle!=null&&Core.Web.Scheduler._nextExecution<nextExecution){return}if(Core.Web.Scheduler._threadHandle!=null){window.clearTimeout(Core.Web.Scheduler._threadHandle)}var currentTime=new Date().getTime();Core.Web.Scheduler._nextExecution=nextExecution;var timeout=nextExecution-currentTime>0?nextExecution-currentTime:0;Core.Web.Scheduler._threadHandle=window.setTimeout(Core.Web.Scheduler._execute,timeout)},update:function(runnable){if(Core.Arrays.indexOf(Core.Web.Scheduler._runnables,runnable)==-1){return}var currentTime=new Date().getTime();var timeInterval=runnable.timeInterval?runnable.timeInterval:0;runnable._nextExecution=currentTime+timeInterval;Core.Web.Scheduler._setTimeout(runnable._nextExecution)}};Core.Web.Scheduler.Runnable=Core.extend({_nextExecution:null,$virtual:{timeInterval:null,repeat:false},$abstract:{run:function(){}}});Core.Web.Scheduler.MethodRunnable=Core.extend(Core.Web.Scheduler.Runnable,{f:null,$construct:function(f,timeInterval,repeat){if(!timeInterval&&repeat){throw new Error("Cannot create repeating runnable without time delay:"+f);}this.f=f;this.timeInterval=timeInterval;this.repeat=!!repeat},$virtual:{run:function(){this.f()}}});Core.Web.VirtualPosition={_OFFSETS_VERTICAL:["paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"],_OFFSETS_HORIZONTAL:["paddingLeft","paddingRight","marginLeft","marginRight","borderLeftWidth","borderRightWidth"],enabled:false,_calculateOffsets:function(offsetNames,style){var offsets=0;for(var i=0;i<offsetNames.length;++i){var value=style[offsetNames[i]];if(value){if(value.toString().indexOf("px")==-1){return-1}offsets+=parseInt(value,10)}}return offsets},_init:function(){this.enabled=true},redraw:function(element){if(!this.enabled){return}if(!element||!element.parentNode){return}var offsets;if(this._verifyPixelValue(element.style.top)&&this._verifyPixelValue(element.style.bottom)){var offsetHeight=element.parentNode.offsetHeight;if(!isNaN(offsetHeight)){offsets=this._calculateOffsets(this._OFFSETS_VERTICAL,element.style);if(offsets!=-1){var calculatedHeight=offsetHeight-parseInt(element.style.top,10)-parseInt(element.style.bottom,10)-offsets;if(calculatedHeight<=0){element.style.height=0}else{if(element.style.height!=calculatedHeight+"px"){element.style.height=calculatedHeight+"px"}}}}}if(this._verifyPixelValue(element.style.left)&&this._verifyPixelValue(element.style.right)){var offsetWidth=element.parentNode.offsetWidth;if(!isNaN(offsetWidth)){offsets=this._calculateOffsets(this._OFFSETS_HORIZONTAL,element.style);if(offsets!=-1){var calculatedWidth=offsetWidth-parseInt(element.style.left,10)-parseInt(element.style.right,10)-offsets;if(calculatedWidth<=0){element.style.width=0}else{if(element.style.width!=calculatedWidth+"px"){element.style.width=calculatedWidth+"px"}}}}}},_verifyPixelValue:function(value){if(value==null||value===""){return false}var valueString=value.toString();return valueString=="0"||valueString.indexOf("px")!=-1}};Echo={};Echo.Application=Core.extend({$static:{_nextUid:1,generateUid:function(){return this._nextUid++}},$abstract:true,$virtual:{init:function(){},dispose:function(){},isActive:function(){return true}},client:null,_idToComponentMap:null,_listenerList:null,_locale:null,_modalComponents:null,_styleSheet:null,_focusedComponent:null,rootComponent:null,updateManager:null,focusManager:null,$construct:function(){this._idToComponentMap=new Core.Arrays.LargeMap();this._listenerList=new Core.ListenerList();this.rootComponent=new Echo.Component();this.rootComponent.componentType="Root";this.rootComponent.register(this);this._modalComponents=[];this.updateManager=new Echo.Update.Manager(this);this.focusManager=new Echo.FocusManager(this)},addListener:function(eventType,eventTarget){this._listenerList.addListener(eventType,eventTarget)},doDispose:function(){this.updateManager.dispose();this.dispose()},doInit:function(){this.init()},_findModalContextRoot:function(searchComponent){searchComponent=searchComponent?searchComponent:this.rootComponent;for(var i=searchComponent.children.length-1;i>=0;--i){var foundComponent=this._findModalContextRoot(searchComponent.children[i]);if(foundComponent){return foundComponent}}if(searchComponent.modalSupport&&searchComponent.get("modal")){return searchComponent}return null},fireEvent:function(event){if(this._listenerList==null){return}this._listenerList.fireEvent(event)},focusNext:function(reverse){var focusedComponent=this.focusManager.find(null,reverse);if(focusedComponent!=null){this.setFocusedComponent(focusedComponent)}},getComponentByRenderId:function(renderId){return this._idToComponentMap.map[renderId]},getFocusedComponent:function(){return this._focusedComponent},getLayoutDirection:function(){return this._layoutDirection?this._layoutDirection:Echo.LayoutDirection.LTR},getLocale:function(){return this._locale},getModalContextRoot:function(){if(this._modalComponents.length===0){return null}else if(this._modalComponents.length==1){return this._modalComponents[0]}return this._findModalContextRoot()},getStyleSheet:function(){return this._styleSheet},notifyComponentUpdate:function(parent,propertyName,oldValue,newValue,rendered){if(parent.modalSupport&&propertyName=="modal"){this._setModal(parent,newValue)}if(this._listenerList.hasListeners("componentUpdate")){this._listenerList.fireEvent({type:"componentUpdate",parent:parent,propertyName:propertyName,oldValue:oldValue,newValue:newValue})}if(!rendered){this.updateManager._processComponentUpdate(parent,propertyName,oldValue,newValue)}},_registerComponent:function(component){if(this._idToComponentMap.map[component.renderId]){throw new Error("Component already exists with id: "+component.renderId);}this._idToComponentMap.map[component.renderId]=component;if(component.modalSupport&&component.get("modal")){this._setModal(component,true)}},removeListener:function(eventType,eventTarget){this._listenerList.removeListener(eventType,eventTarget)},setFocusedComponent:function(newValue){var oldValue=this._focusedComponent;while(newValue!=null&&!newValue.focusable){newValue=newValue.parent}if(this._modalComponents.length>0){var modalContextRoot=this.getModalContextRoot();if(!modalContextRoot.isAncestorOf(newValue)){return}}if(this._focusedComponent==newValue){return}this._focusedComponent=newValue;this._listenerList.fireEvent({type:"focus",source:this,oldValue:oldValue,newValue:newValue})},setLayoutDirection:function(newValue){this._layoutDirection=newValue;this.updateManager._processFullRefresh()},setLocale:function(newValue){this._locale=newValue;this.updateManager._processFullRefresh()},_setModal:function(component,modal){Core.Arrays.remove(this._modalComponents,component);if(modal){this._modalComponents.push(component)}if(this._modalComponents.length>0&&this._focusedComponent){var modalContextRoot=this.getModalContextRoot();if(!modalContextRoot.isAncestorOf(this._focusedComponent)){if(modalContextRoot.focusable){this.setFocusedComponent(modalContextRoot)}else{this.setFocusedComponent(this.focusManager.findInParent(modalContextRoot,false))}}}this.fireEvent({source:this,type:"modal",modal:this._modalComponents.length>0})},setStyleSheet:function(newValue){this._styleSheet=newValue;this.updateManager._processFullRefresh()},_unregisterComponent:function(component){this._idToComponentMap.remove(component.renderId);if(component.modalSupport){this._setModal(component,false)}}});Echo.ComponentFactory={_typeToConstructorMap:{},newInstance:function(typeName,renderId){var typeConstructor=this._typeToConstructorMap[typeName];if(!typeConstructor){throw new Error("Type not registered with ComponentFactory: "+typeName);}var component=new typeConstructor();component.renderId=renderId;return component},getConstructor:function(typeName){return this._typeToConstructorMap[typeName]},getSuperType:function(typeName){var typeConstructor=this._typeToConstructorMap[typeName];if(!typeConstructor){return"Component"}if(typeConstructor.$super){return typeConstructor.$super.prototype.componentType}else{return null}},registerType:function(typeName,typeConstructor){if(this._typeToConstructorMap[typeName]){throw new Error("Type already registered: "+typeName);}this._typeToConstructorMap[typeName]=typeConstructor}};Echo.Component=Core.extend({$static:{_nextRenderId:0},$load:function(){Echo.ComponentFactory.registerType("Component",this)},$abstract:true,$virtual:{componentType:"Component",focusable:false,getFocusComponent:function(index){return this.children[index]},pane:false},_layoutDirection:null,_locale:null,renderId:null,parent:null,application:null,_listenerList:null,_style:null,_styleName:null,_enabled:true,children:null,focusNextId:null,focusPreviousId:null,_localStyle:null,$construct:function(properties){this.children=[];this._localStyle={};if(properties){for(var name in properties){switch(name){case"style":this._style=properties.style;break;case"styleName":this._styleName=properties.styleName;break;case"renderId":this.renderId=properties.renderId;break;case"children":for(var i=0;i<properties.children.length;++i){this.add(properties.children[i])}break;case"events":for(var eventType in properties.events){this.addListener(eventType,properties.events[eventType])}break;default:this._localStyle[name]=properties[name]}}}},add:function(component,index){if(!(component instanceof Echo.Component)){throw new Error("Cannot add child: specified component object is not derived from Echo.Component. "+"Parent: "+this+", Child: "+component);}if(!component.componentType){throw new Error("Cannot add child: specified component object does not have a componentType property. "+"Parent: "+this+", Child: "+component);}if(component.parent){component.parent.remove(component)}component.parent=this;if(index==null||index==this.children.length){this.children.push(component)}else{this.children.splice(index,0,component)}if(this.application){component.register(this.application);this.application.notifyComponentUpdate(this,"children",null,component)}if(component._listenerList&&component._listenerList.hasListeners("parent")){component._listenerList.fireEvent({type:"parent",source:component,oldValue:null,newValue:this})}if(this._listenerList&&this._listenerList.hasListeners("children")){this._listenerList.fireEvent({type:"children",source:this,add:component,index:index})}},addListener:function(eventType,eventTarget){if(this._listenerList==null){this._listenerList=new Core.ListenerList()}this._listenerList.addListener(eventType,eventTarget);if(this.application){this.application.notifyComponentUpdate(this,"listeners",null,eventType)}},fireEvent:function(event){if(this._listenerList==null){return}this._listenerList.fireEvent(event)},get:function(name){return this._localStyle[name]},getComponent:function(index){return this.children[index]},getComponentCount:function(){return this.children.length},getIndex:function(name,index){var valueArray=this._localStyle[name];return valueArray?valueArray[index]:null},getLayoutDirection:function(){return this._layoutDirection},getLocale:function(){return this._locale},getLocalStyleData:function(){return this._localStyle},getRenderLayoutDirection:function(){var component=this;while(component){if(component._layoutDirection){return component._layoutDirection}component=component.parent}if(this.application){return this.application.getLayoutDirection()}return null},getRenderLocale:function(){var component=this;while(component){if(component._locale){return component._locale}component=component.parent}if(this.application){return this.application.getLocale()}return null},getStyle:function(){return this._style},getStyleName:function(){return this._styleName},indexOf:function(component){for(var i=0;i<this.children.length;++i){if(this.children[i]==component){return i}}return-1},isActive:function(){if(!this.isRenderEnabled()){return false}if(!this.application||!this.application.isActive()){return false}var modalContextRoot=this.application.getModalContextRoot();if(modalContextRoot!=null&&!modalContextRoot.isAncestorOf(this)){return false}return true},isAncestorOf:function(c){while(c!=null&&c!=this){c=c.parent}return c==this},isEnabled:function(){return this._enabled},isRenderEnabled:function(){var component=this;while(component!=null){if(!component._enabled){return false}component=component.parent}return true},register:function(application){if(application&&this.application){throw new Error("Attempt to re-register or change registered application of component.");}var i;if(!application){if(this.children!=null){for(i=0;i<this.children.length;++i){this.children[i].register(false)}}this.application._unregisterComponent(this);if(this.application._focusedComponent==this){this.application.setFocusedComponent(this.parent)}if(this._listenerList!=null&&this._listenerList.hasListeners("dispose")){this._listenerList.fireEvent({type:"dispose",source:this})}}this.application=application;if(application){if(this.renderId==null){this.renderId="CL."+(++Echo.Component._nextRenderId)}this.application._registerComponent(this);if(this._listenerList!=null&&this._listenerList.hasListeners("init")){this._listenerList.fireEvent({type:"init",source:this})}if(this.children!=null){for(i=0;i<this.children.length;++i){this.children[i].register(application)}}}},render:function(name,defaultValue){var value=this._localStyle[name];if(value==null){if(this._style!=null){value=this._style[name]}if(value==null&&this.application&&this.application._styleSheet){var style=this.application._styleSheet.getRenderStyle(this._styleName!=null?this._styleName:"",this.componentType);if(style){value=style[name]}}}return value==null?defaultValue:value},renderIndex:function(name,index,defaultValue){var valueArray=this._localStyle[name];var value=valueArray?valueArray[index]:null;if(value==null){if(this._style!=null){valueArray=this._style[name];value=valueArray?valueArray[index]:null}if(value==null&&this._styleName&&this.application&&this.application._styleSheet){var style=this.application._styleSheet.getRenderStyle(this._styleName!=null?this._styleName:"",this.componentType);if(style){valueArray=style[name];value=valueArray?valueArray[index]:null}}}return value==null?defaultValue:value},remove:function(componentOrIndex){var component;var index;if(typeof componentOrIndex=="number"){index=componentOrIndex;component=this.children[index];if(!component){throw new Error("Component.remove(): index out of bounds: "+index+", parent: "+this);}}else{component=componentOrIndex;index=this.indexOf(component);if(index==-1){return}}if(this.application){component.register(null)}this.children.splice(index,1);component.parent=null;if(this.application){this.application.notifyComponentUpdate(this,"children",component,null)}if(component._listenerList&&component._listenerList.hasListeners("parent")){component._listenerList.fireEvent({type:"parent",source:component,oldValue:this,newValue:null})}if(this._listenerList&&this._listenerList.hasListeners("children")){this._listenerList.fireEvent({type:"children",source:this,remove:component,index:index})}},removeAll:function(){while(this.children.length>0){this.remove(this.children.length-1)}},removeListener:function(eventType,eventTarget){if(this._listenerList==null){return}this._listenerList.removeListener(eventType,eventTarget);if(this.application){this.application.notifyComponentUpdate(this,"listeners",eventType,null)}},set:function(name,newValue,rendered){var oldValue=this._localStyle[name];if(oldValue===newValue){return}this._localStyle[name]=newValue;if(this._listenerList&&this._listenerList.hasListeners("property")){this._listenerList.fireEvent({type:"property",source:this,propertyName:name,oldValue:oldValue,newValue:newValue})}if(this.application){this.application.notifyComponentUpdate(this,name,oldValue,newValue,rendered)}},setEnabled:function(newValue){var oldValue=this._enabled;this._enabled=newValue;if(this.application){this.application.notifyComponentUpdate(this,"enabled",oldValue,newValue)}},setIndex:function(name,index,newValue,rendered){var valueArray=this._localStyle[name];var oldValue=null;if(valueArray){oldValue=valueArray[index];if(oldValue===newValue){return}}else{valueArray=[];this._localStyle[name]=valueArray}valueArray[index]=newValue;if(this.application){this.application.notifyComponentUpdate(this,name,oldValue,newValue,rendered)}if(this._listenerList&&this._listenerList.hasListeners("property")){this._listenerList.fireEvent({type:"property",source:this,propertyName:name,index:index,oldValue:oldValue,newValue:newValue})}},setLayoutDirection:function(newValue){var oldValue=this._layoutDirection;this._layoutDirection=newValue;if(this.application){this.application.notifyComponentUpdate(this,"layoutDirection",oldValue,newValue)}},setLocale:function(newValue){var oldValue=this._locale;this._locale=newValue;if(this.application){this.application.notifyComponentUpdate(this,"locale",oldValue,newValue)}},setStyle:function(newValue){var oldValue=this._style;this._style=newValue;if(this.application){this.application.notifyComponentUpdate(this,"style",oldValue,newValue)}},setStyleName:function(newValue){var oldValue=this._styleName;this._styleName=newValue;if(this.application){this.application.notifyComponentUpdate(this,"styleName",oldValue,newValue)}},toString:function(longFormat){var out=this.renderId+"/"+this.componentType;if(longFormat){out+="\n";var componentCount=this.getComponentCount();out+=this.renderId+"/properties:"+this._localStyle+"\n";for(var i=0;i<componentCount;++i){var component=this.getComponent(i);out+=this.renderId+"/child:"+component.renderId+"\n";out+=component.toString(true)}}return out}});Echo.FocusManager=Core.extend({_application:null,$construct:function(application){this._application=application},find:function(component,reverse){if(!component){component=this._application.getFocusedComponent();if(!component){component=this._application.rootComponent}}var setComponentId=reverse?component.focusPreviousId:component.focusNextId;if(setComponentId){var setComponent=this._application.getComponentByRenderId(setComponentId);if(setComponent&&setComponent.isActive()&&setComponent.focusable){return setComponent}}var originComponent=component;var visitedComponents={};var lastComponent=null;while(true){var nextComponent=null,componentIndex;if((reverse&&component==originComponent)||(lastComponent&&lastComponent.parent==component)){}else{var componentCount=component.getComponentCount();if(componentCount>0){nextComponent=component.getComponent(reverse?componentCount-1:0);if(visitedComponents[nextComponent.renderId]){nextComponent=null}}}if(nextComponent==null){if(component.parent){if(reverse){componentIndex=component.parent.indexOf(component);if(componentIndex>0){nextComponent=component.parent.getComponent(componentIndex-1)}}else{componentIndex=component.parent.indexOf(component);if(componentIndex<component.parent.getComponentCount()-1){nextComponent=component.parent.getComponent(componentIndex+1)}}}}if(nextComponent==null){nextComponent=component.parent}if(nextComponent==null){return null}lastComponent=component;component=nextComponent;visitedComponents[component.renderId]=true;if(component!=originComponent&&component.isActive()&&component.focusable){return component}}},findInParent:function(parentComponent,reverse,minimumDistance){if(!minimumDistance){minimumDistance=1}var visitedIds={},focusedComponent=this._application.getFocusedComponent();if(!focusedComponent){return null}visitedIds[focusedComponent.renderId]=true;var focusedIndex=this._getDescendantIndex(parentComponent,focusedComponent);if(focusedIndex==-1){return null}var componentIndex=focusedIndex;var component=focusedComponent;do{component=this.find(component,reverse,visitedIds);if(component==null||visitedIds[component.renderId]){return null}componentIndex=this._getDescendantIndex(parentComponent,component);visitedIds[component.renderId]=true}while(Math.abs(componentIndex-focusedIndex)<minimumDistance&&component!=focusedComponent);if(component==focusedComponent){return null}this._application.setFocusedComponent(component);return component},_getDescendantIndex:function(parent,descendant){while(descendant.parent!=parent&&descendant.parent!=null){descendant=descendant.parent}if(descendant.parent==null){return-1}return parent.indexOf(descendant)}});Echo.LayoutDirection=Core.extend({_ltr:false,$construct:function(ltr){this._ltr=ltr},isLeftToRight:function(){return this._ltr}});Echo.LayoutDirection.LTR=new Echo.LayoutDirection(true);Echo.LayoutDirection.RTL=new Echo.LayoutDirection(false);Echo.StyleSheet=Core.extend({_nameToStyleMap:null,_renderCache:null,$construct:function(initialValues){this._renderCache={};this._nameToStyleMap={};if(initialValues){for(var styleName in initialValues){for(var componentType in initialValues[styleName]){this.setStyle(styleName,componentType,initialValues[styleName][componentType])}}}},getRenderStyle:function(name,componentType){var typeToStyleMap=this._renderCache[name];if(!typeToStyleMap){return null}var style=typeToStyleMap[componentType];if(style!==undefined){return style}else{return this._loadRenderStyle(name,componentType)}},_loadRenderStyle:function(name,componentType){var typeToStyleMap=this._nameToStyleMap[name];if(typeToStyleMap==null){this._renderCache[name][componentType]=null;return null}var style=typeToStyleMap[componentType];if(style==null){var testType=componentType;while(style==null){testType=Echo.ComponentFactory.getSuperType(testType);if(testType==null){this._renderCache[name][testType]=null;return null}style=typeToStyleMap[testType]}}this._renderCache[name][componentType]=style;return style},getStyle:function(name,componentType){var typeToStyleMap=this._nameToStyleMap[name];if(typeToStyleMap==null){return null}return typeToStyleMap[componentType]},setStyle:function(name,componentType,style){this._renderCache[name]={};var typeToStyleMap=this._nameToStyleMap[name];if(typeToStyleMap==null){typeToStyleMap={};this._nameToStyleMap[name]=typeToStyleMap}typeToStyleMap[componentType]=style}});Echo.Update={};Echo.Update.ComponentUpdate=Core.extend({$static:{PropertyUpdate:function(oldValue,newValue){this.oldValue=oldValue;this.newValue=newValue}},_manager:null,parent:null,renderContext:null,_addedChildIds:null,_propertyUpdates:null,_removedChildIds:null,_removedDescendantIds:null,_updatedLayoutDataChildIds:null,_listenerUpdates:null,$construct:function(manager,parent){this._manager=manager;this.parent=parent},_addChild:function(child){if(!this._addedChildIds){this._addedChildIds=[]}this._addedChildIds.push(child.renderId);this._manager._idMap[child.renderId]=child},_appendRemovedDescendants:function(update){var i;if(update._removedDescendantIds!=null){if(this._removedDescendantIds==null){this._removedDescendantIds=[]}for(i=0;i<update._removedDescendantIds.length;++i){this._removedDescendantIds.push(update._removedDescendantIds[i])}}if(update._removedChildIds!=null){if(this._removedDescendantIds==null){this._removedDescendantIds=[]}for(i=0;i<update._removedChildIds.length;++i){this._removedDescendantIds.push(update._removedChildIds[i])}}if(this._removedDescendantIds!=null){Core.Arrays.removeDuplicates(this._removedDescendantIds)}},getAddedChildren:function(){if(!this._addedChildIds){return null}var components=[];for(var i=0;i<this._addedChildIds.length;++i){components[i]=this._manager._idMap[this._addedChildIds[i]]}return components},getRemovedChildren:function(){if(!this._removedChildIds){return null}var components=[];for(var i=0;i<this._removedChildIds.length;++i){components[i]=this._manager._removedIdMap[this._removedChildIds[i]]}return components},getRemovedDescendants:function(){if(!this._removedDescendantIds){return null}var components=[];for(var i=0;i<this._removedDescendantIds.length;++i){components[i]=this._manager._removedIdMap[this._removedDescendantIds[i]]}return components},getUpdatedLayoutDataChildren:function(){if(!this._updatedLayoutDataChildIds){return null}var components=[];for(var i=0;i<this._updatedLayoutDataChildIds.length;++i){components[i]=this._manager._idMap[this._updatedLayoutDataChildIds[i]]}return components},hasAddedChildren:function(){return this._addedChildIds!=null},hasRemovedChildren:function(){return this._removedChildIds!=null},hasUpdatedLayoutDataChildren:function(){return this._updatedLayoutDataChildIds!=null},hasUpdatedProperties:function(){return this._propertyUpdates!=null},getUpdatedProperty:function(name){if(this._propertyUpdates==null){return null}return this._propertyUpdates[name]},isListenerTypeUpdated:function(listenerType){return this._listenerUpdates==null?false:this._listenerUpdates[listenerType]},getUpdatedPropertyNames:function(){if(this._propertyUpdates==null){return[]}var updatedPropertyNames=[];for(var i in this._propertyUpdates){updatedPropertyNames.push(i)}return updatedPropertyNames},hasUpdatedPropertyIn:function(updatedPropertySet){for(var x in this._propertyUpdates){if(updatedPropertySet[x]){return true}}return false},isUpdatedPropertySetIn:function(updatedPropertySet){for(var x in this._propertyUpdates){if(!updatedPropertySet[x]){return false}}return true},_removeChild:function(child){this._manager._removedIdMap[child.renderId]=child;if(this._addedChildIds){Core.Arrays.remove(this._addedChildIds,child.renderId)}if(this._updatedLayoutDataChildIds){Core.Arrays.remove(this._updatedLayoutDataChildIds,child.renderId)}if(!this._removedChildIds){this._removedChildIds=[]}this._removedChildIds.push(child.renderId);for(var i=0;i<child.children.length;++i){this._removeDescendant(child.children[i])}},_removeDescendant:function(descendant){this._manager._removedIdMap[descendant.renderId]=descendant;if(!this._removedDescendantIds){this._removedDescendantIds=[]}this._removedDescendantIds.push(descendant.renderId);for(var i=0;i<descendant.children.length;++i){this._removeDescendant(descendant.children[i])}},toString:function(){var s="ComponentUpdate\n";s+="- Parent: "+this.parent+"\n";s+="- Adds: "+this._addedChildIds+"\n";s+="- Removes: "+this._removedChildIds+"\n";s+="- DescendantRemoves: "+this._removedDescendantIds+"\n";s+="- Properties: "+Core.Debug.toString(this._propertyUpdates)+"\n";s+="- LayoutDatas: "+this._updatedLayoutDataChildIds+"\n";return s},_updateLayoutData:function(child){this._manager._idMap[child.renderId]=child;if(this._updatedLayoutDataChildIds==null){this._updatedLayoutDataChildIds=[]}this._updatedLayoutDataChildIds.push(child.renderId)},_updateListener:function(listenerType){if(this._listenerUpdates==null){this._listenerUpdates={}}this._listenerUpdates[listenerType]=true},_updateProperty:function(propertyName,oldValue,newValue){if(this._propertyUpdates==null){this._propertyUpdates={}}var propertyUpdate=new Echo.Update.ComponentUpdate.PropertyUpdate(oldValue,newValue);this._propertyUpdates[propertyName]=propertyUpdate}});Echo.Update.Manager=Core.extend({_componentUpdateMap:null,fullRefreshRequired:false,application:null,_hasUpdates:false,_listenerList:null,_idMap:null,_removedIdMap:null,_lastAncestorTestParentId:null,$construct:function(application){this._componentUpdateMap={};this.application=application;this._listenerList=new Core.ListenerList();this._idMap={};this._removedIdMap={}},addUpdateListener:function(l){this._listenerList.addListener("update",l)},_createComponentUpdate:function(parent){this._hasUpdates=true;var update=this._componentUpdateMap[parent.renderId];if(!update){update=new Echo.Update.ComponentUpdate(this,parent);this._componentUpdateMap[parent.renderId]=update}return update},dispose:function(){this.application=null},_fireUpdate:function(){if(!this._listenerList.isEmpty()){this._listenerList.fireEvent({type:"update",source:this})}},getUpdates:function(){var updates=[];for(var key in this._componentUpdateMap){updates.push(this._componentUpdateMap[key])}return updates},hasUpdates:function(){return this._hasUpdates},_isAncestorBeingAdded:function(component){var child=component;var parent=component.parent;var originalParentId=parent?parent.renderId:null;if(originalParentId&&this._lastAncestorTestParentId==originalParentId){return false}while(parent){var update=this._componentUpdateMap[parent.renderId];if(update&&update._addedChildIds){for(var i=0;i<update._addedChildIds.length;++i){if(update._addedChildIds[i]==child.renderId){return true}}}child=parent;parent=parent.parent}this._lastAncestorTestParentId=originalParentId;return false},_processComponentAdd:function(parent,child){if(this.fullRefreshRequired){return}if(this._isAncestorBeingAdded(child)){return}var update=this._createComponentUpdate(parent);update._addChild(child)},_processComponentLayoutDataUpdate:function(updatedComponent){if(this.fullRefreshRequired){return}var parent=updatedComponent.parent;if(parent==null||this._isAncestorBeingAdded(parent)){return}var update=this._createComponentUpdate(parent);update._updateLayoutData(updatedComponent)},_processComponentListenerUpdate:function(parent,listenerType){if(this.fullRefreshRequired){return}if(this._isAncestorBeingAdded(parent)){return}var update=this._createComponentUpdate(parent);update._updateListener(listenerType)},_processComponentRemove:function(parent,child){if(this.fullRefreshRequired){return}if(this._isAncestorBeingAdded(parent)){return}var update=this._createComponentUpdate(parent);update._removeChild(child);var disposedIds=null;for(var testParentId in this._componentUpdateMap){var testUpdate=this._componentUpdateMap[testParentId];if(child.isAncestorOf(testUpdate.parent)){update._appendRemovedDescendants(testUpdate);if(disposedIds==null){disposedIds=[]}disposedIds.push(testParentId)}}if(disposedIds!=null){for(var i=0;i<disposedIds.length;++i){delete this._componentUpdateMap[disposedIds[i]]}}},_processComponentPropertyUpdate:function(component,propertyName,oldValue,newValue){if(this.fullRefreshRequired){return}if(this._isAncestorBeingAdded(component)){return}var update=this._createComponentUpdate(component);update._updateProperty(propertyName,oldValue,newValue)},_processFullRefresh:function(){for(var i=0;i<this.application.rootComponent.children.length;++i){this._processComponentRemove(this.application.rootComponent,this.application.rootComponent.children[i])}this.fullRefreshRequired=true;var update=this._createComponentUpdate(this.application.rootComponent);update.fullRefresh=true;this._fireUpdate()},_processComponentUpdate:function(parent,propertyName,oldValue,newValue){if(propertyName=="children"){if(newValue==null){this._processComponentRemove(parent,oldValue)}else{this._processComponentAdd(parent,newValue)}}else if(propertyName=="layoutData"){this._processComponentLayoutDataUpdate(parent)}else if(propertyName=="listeners"){this._processComponentListenerUpdate(parent,oldValue||newValue)}else{this._processComponentPropertyUpdate(parent,propertyName,oldValue,newValue)}this._fireUpdate()},purge:function(){this.fullRefreshRequired=false;this._componentUpdateMap={};this._idMap={};this._removedIdMap={};this._hasUpdates=false;this._lastAncestorTestParentId=null},removeUpdateListener:function(l){this._listenerList.removeListener("update",l)},toString:function(){var s="[ UpdateManager ]\n";if(this.fullRefreshRequired){s+="fullRefresh"}else{for(var key in this._componentUpdateMap){s+=this._componentUpdateMap[key]}}return s}});Echo.AbstractButton=Core.extend(Echo.Component,{$abstract:true,$load:function(){Echo.ComponentFactory.registerType("AbstractButton",this);Echo.ComponentFactory.registerType("AB",this)},componentType:"AbstractButton",focusable:true,$virtual:{doAction:function(){this.fireEvent({type:"action",source:this,actionCommand:this.get("actionCommand")})}}});Echo.Button=Core.extend(Echo.AbstractButton,{$load:function(){Echo.ComponentFactory.registerType("Button",this);Echo.ComponentFactory.registerType("B",this)},componentType:"Button"});Echo.ToggleButton=Core.extend(Echo.AbstractButton,{$load:function(){Echo.ComponentFactory.registerType("ToggleButton",this);Echo.ComponentFactory.registerType("TB",this)},$abstract:true,componentType:"ToggleButton"});Echo.CheckBox=Core.extend(Echo.ToggleButton,{$load:function(){Echo.ComponentFactory.registerType("CheckBox",this);Echo.ComponentFactory.registerType("CB",this)},componentType:"CheckBox"});Echo.RadioButton=Core.extend(Echo.ToggleButton,{$load:function(){Echo.ComponentFactory.registerType("RadioButton",this);Echo.ComponentFactory.registerType("RB",this)},componentType:"RadioButton"});Echo.AbstractListComponent=Core.extend(Echo.Component,{$abstract:true,$load:function(){Echo.ComponentFactory.registerType("AbstractListComponent",this);Echo.ComponentFactory.registerType("LC",this)},componentType:"AbstractListComponent",focusable:true,$virtual:{doAction:function(){this.fireEvent({type:"action",source:this,actionCommand:this.get("actionCommand")})}}});Echo.ListBox=Core.extend(Echo.AbstractListComponent,{$static:{SINGLE_SELECTION:0,MULTIPLE_SELECTION:2},$load:function(){Echo.ComponentFactory.registerType("ListBox",this);Echo.ComponentFactory.registerType("LB",this)},componentType:"ListBox"});Echo.SelectField=Core.extend(Echo.AbstractListComponent,{$load:function(){Echo.ComponentFactory.registerType("SelectField",this);Echo.ComponentFactory.registerType("SF",this)},componentType:"SelectField"});Echo.Column=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Column",this);Echo.ComponentFactory.registerType("C",this)},componentType:"Column"});Echo.Composite=Core.extend(Echo.Component,{$abstract:true,$load:function(){Echo.ComponentFactory.registerType("Composite",this);Echo.ComponentFactory.registerType("CM",this)},componentType:"Composite"});Echo.Panel=Core.extend(Echo.Composite,{$load:function(){Echo.ComponentFactory.registerType("Panel",this);Echo.ComponentFactory.registerType("P",this)},componentType:"Panel"});Echo.ContentPane=Core.extend(Echo.Component,{$static:{OVERFLOW_AUTO:0,OVERFLOW_HIDDEN:1,OVERFLOW_SCROLL:2},$load:function(){Echo.ComponentFactory.registerType("ContentPane",this);Echo.ComponentFactory.registerType("CP",this)},componentType:"ContentPane",pane:true});Echo.Grid=Core.extend(Echo.Component,{$static:{ORIENTATION_HORIZONTAL:0,ORIENTATION_VERTICAL:1,SPAN_FILL:-1},$load:function(){Echo.ComponentFactory.registerType("Grid",this);Echo.ComponentFactory.registerType("G",this)},componentType:"Grid"});Echo.Label=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Label",this);Echo.ComponentFactory.registerType("L",this)},componentType:"Label"});Echo.Row=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Row",this);Echo.ComponentFactory.registerType("R",this)},componentType:"Row"});Echo.SplitPane=Core.extend(Echo.Component,{$static:{ORIENTATION_HORIZONTAL_LEADING_TRAILING:0,ORIENTATION_HORIZONTAL_TRAILING_LEADING:1,ORIENTATION_HORIZONTAL_LEFT_RIGHT:2,ORIENTATION_HORIZONTAL_RIGHT_LEFT:3,ORIENTATION_VERTICAL_TOP_BOTTOM:4,ORIENTATION_VERTICAL_BOTTOM_TOP:5,DEFAULT_SEPARATOR_POSITION:"50%",DEFAULT_SEPARATOR_SIZE_FIXED:0,DEFAULT_SEPARATOR_SIZE_RESIZABLE:4,DEFAULT_SEPARATOR_COLOR:"#3f3f4f",OVERFLOW_AUTO:0,OVERFLOW_HIDDEN:1,OVERFLOW_SCROLL:2},$load:function(){Echo.ComponentFactory.registerType("SplitPane",this);Echo.ComponentFactory.registerType("SP",this)},componentType:"SplitPane",pane:true});Echo.TextComponent=Core.extend(Echo.Component,{$abstract:true,$load:function(){Echo.ComponentFactory.registerType("TextComponent",this);Echo.ComponentFactory.registerType("TC",this)},$virtual:{doAction:function(){this.fireEvent({type:"action",source:this,actionCommand:this.get("actionCommand")})},doKeyDown:function(keyCode){var e={type:"keyDown",source:this,keyCode:keyCode};this.fireEvent(e);return!e.veto},doKeyPress:function(keyCode,charCode){var e={type:"keyPress",source:this,keyCode:keyCode,charCode:charCode};this.fireEvent(e);return!e.veto}},componentType:"TextComponent",focusable:true});Echo.TextArea=Core.extend(Echo.TextComponent,{$load:function(){Echo.ComponentFactory.registerType("TextArea",this);Echo.ComponentFactory.registerType("TA",this)},componentType:"TextArea"});Echo.TextField=Core.extend(Echo.TextComponent,{$load:function(){Echo.ComponentFactory.registerType("TextField",this);Echo.ComponentFactory.registerType("TF",this)},componentType:"TextField"});Echo.PasswordField=Core.extend(Echo.TextField,{$load:function(){Echo.ComponentFactory.registerType("PasswordField",this);Echo.ComponentFactory.registerType("PF",this)},componentType:"PasswordField"});Echo.WindowPane=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("WindowPane",this);Echo.ComponentFactory.registerType("WP",this)},$static:{DEFAULT_BORDER:{color:"#36537a",borderInsets:20,contentInsets:3},DEFAULT_BACKGROUND:"#ffffff",DEFAULT_FOREGROUND:"#000000",DEFAULT_CONTROLS_INSETS:4,DEFAULT_CONTROLS_SPACING:4,DEFAULT_HEIGHT:"15em",DEFAULT_MINIMUM_WIDTH:100,DEFAULT_MINIMUM_HEIGHT:100,DEFAULT_TITLE_BACKGROUND:"#becafe",DEFAULT_TITLE_HEIGHT:30,DEFAULT_TITLE_INSETS:"5px 10px",DEFAULT_WIDTH:"30em"},componentType:"WindowPane",modalSupport:true,floatingPane:true,pane:true,focusable:true,_preMaximizedState:null,userClose:function(){this.fireEvent({type:"close",source:this})},userMaximize:function(){if(this.render("width")=="100%"&&this.render("height")=="100%"){if(this._preMaximizedState){this.set("width",this._preMaximizedState.width);this.set("height",this._preMaximizedState.height);this.set("positionX",this._preMaximizedState.x);this.set("positionY",this._preMaximizedState.y)}}else{this._preMaximizedState={x:this.get("positionX"),y:this.get("positionY"),width:this.get("width"),height:this.get("height")};this.set("width","100%");this.set("height","100%")}this.fireEvent({type:"maximize",source:this})},userMinimize:function(){this.fireEvent({type:"minimize",source:this})}});Echo.Render={_loadedPeerCount:0,_nextPeerId:0,_peers:{},_disposedComponents:null,_componentDepthArraySort:function(a,b){return Echo.Render._getComponentDepth(a.parent)-Echo.Render._getComponentDepth(b.parent)},_doRenderDisplay:function(component,includeSelf){var i,testComponent=component;var testParent=testComponent.parent;while(testParent){if(testParent.peer.isChildVisible&&!testParent.peer.isChildVisible(testComponent)){return}testComponent=testParent;testParent=testParent.parent}if(includeSelf){Echo.Render._doRenderDisplayImpl(component)}else{if(component.peer.isChildVisible){for(i=0;i<component.children.length;++i){if(component.peer.isChildVisible(component.children[i])){Echo.Render._doRenderDisplayImpl(component.children[i])}}}else{for(i=0;i<component.children.length;++i){Echo.Render._doRenderDisplayImpl(component.children[i])}}}},_doRenderDisplayImpl:function(component){if(!component.peer){return}if(component.peer.renderDisplay){component.peer.renderDisplay()}component.peer.displayed=true;var i;if(component.peer.isChildVisible){for(i=0;i<component.children.length;++i){if(component.peer.isChildVisible(component.children[i])){Echo.Render._doRenderDisplayImpl(component.children[i])}}}else{for(i=0;i<component.children.length;++i){Echo.Render._doRenderDisplayImpl(component.children[i])}}},_getComponentDepth:function(component){var depth=-1;while(component!=null){component=component.parent;++depth}return depth},_loadPeer:function(client,component){if(component.peer){return}var peerClass=Echo.Render._peers[component.componentType];if(!peerClass){throw new Error("Peer not found for: "+component.componentType);}++this._loadedPeerCount;component.peer=new peerClass();component.peer._peerId=this._nextPeerId++;component.peer.component=component;component.peer.client=client},notifyResize:function(parent){Echo.Render._doRenderDisplay(parent,false)},_processDispose:function(update){var i,components=update.getRemovedDescendants();if(components){for(i=0;i<components.length;++i){Echo.Render._renderComponentDisposeImpl(update,components[i])}}components=update.getRemovedChildren();if(components){for(i=0;i<components.length;++i){Echo.Render._renderComponentDisposeImpl(update,components[i])}}},processUpdates:function(client){var updateManager=client.application.updateManager;if(!updateManager.hasUpdates()){return}Echo.Render._disposedComponents={};var updates=updateManager.getUpdates();updates.sort(Echo.Render._componentDepthArraySort);var peer,i,j;for(i=0;i<updates.length;++i){updates[i].renderContext={};peer=updates[i].parent.peer;if(peer==null&&updates[i].parent.componentType=="Root"){Echo.Render._loadPeer(client,updates[i].parent)}}for(i=updates.length-1;i>=0;--i){if(updates[i]==null){continue}peer=updates[i].parent.peer;Echo.Render._processDispose(updates[i])}if(Echo.Client.profilingTimer){Echo.Client.profilingTimer.mark("rem")}for(i=0;i<updates.length;++i){if(updates[i]==null){continue}peer=updates[i].parent.peer;var fullRender=peer.renderUpdate(updates[i]);if(fullRender){for(j=i+1;j<updates.length;++j){if(updates[j]!=null&&updates[i].parent.isAncestorOf(updates[j].parent)){updates[j]=null}}}Echo.Render._setPeerDisposedState(updates[i].parent,false)}if(Echo.Client.profilingTimer){Echo.Client.profilingTimer.mark("up")}var displayed=[];for(i=0;i<updates.length;++i){if(updates[i]==null){continue}var cancelDisplay=false;for(j=0;j<displayed.length;++j){if(displayed[j].isAncestorOf(updates[i].parent)){cancelDisplay=true;break}}if(cancelDisplay){continue}if(updates[i].renderContext.displayRequired){for(j=0;j<updates[i].renderContext.displayRequired.length;++j){displayed.push(updates[i].renderContext.displayRequired[j]);Echo.Render._doRenderDisplay(updates[i].renderContext.displayRequired[j],true)}}else{displayed.push(updates[i].parent);Echo.Render._doRenderDisplay(updates[i].parent,true)}}if(Echo.Client.profilingTimer){Echo.Client.profilingTimer.mark("disp")}for(var peerId in Echo.Render._disposedComponents){var component=Echo.Render._disposedComponents[peerId];Echo.Render._unloadPeer(component)}Echo.Render._disposedComponents=null;updateManager.purge();Echo.Render.updateFocus(client)},registerPeer:function(componentName,peerObject){if(this._peers[componentName]){throw new Error("Peer already registered: "+componentName);}this._peers[componentName]=peerObject},renderComponentAdd:function(update,component,parentElement){if(!component.parent||!component.parent.peer||!component.parent.peer.client){throw new Error("Cannot find reference to the Client with which this component should be associated: "+"cannot load peer.  This is due to the component's parent's peer not being associated with a Client. "+"Component = "+component+", Parent = "+component.parent+", Parent Peer = "+(component.parent?component.parent.peer:"N/A")+", Parent Peer Client = "+((component.parent&&component.parent.peer)?component.parent.peer.client:"N/A"));}Echo.Render._loadPeer(component.parent.peer.client,component);Echo.Render._setPeerDisposedState(component,false);component.peer.renderAdd(update,parentElement)},renderComponentDisplay:function(parent){this._doRenderDisplay(parent,true)},renderComponentDispose:function(update,component){this._renderComponentDisposeImpl(update,component)},_renderComponentDisposeImpl:function(update,component){if(!component.peer||component.peer.disposed){return}Echo.Render._setPeerDisposedState(component,true);component.peer.renderDispose(update);for(var i=0;i<component.children.length;++i){Echo.Render._renderComponentDisposeImpl(update,component.children[i])}},renderComponentHide:function(component){if(!component.peer||component.peer.disposed){return}if(component.peer.displayed){if(component.peer.renderHide){component.peer.renderHide()}component.peer.displayed=false;for(var i=0;i<component.children.length;++i){Echo.Render.renderComponentHide(component.children[i])}}},_setPeerDisposedState:function(component,disposed){if(disposed){component.peer.disposed=true;Echo.Render._disposedComponents[component.peer._peerId]=component}else{component.peer.disposed=false;delete Echo.Render._disposedComponents[component.peer._peerId]}},_unloadPeer:function(component){component.peer.client=null;component.peer.component=null;component.peer=null;--this._loadedPeerCount},updateFocus:function(client){var focusedComponent=client.application.getFocusedComponent();if(focusedComponent&&focusedComponent.peer){if(!focusedComponent.peer.renderFocus){throw new Error("Cannot focus component: "+focusedComponent+", peer does not provide renderFocus() implementation.");}focusedComponent.peer.renderFocus()}}};Echo.Render.ComponentSync=Core.extend({$static:{FOCUS_PERMIT_ARROW_UP:0x1,FOCUS_PERMIT_ARROW_DOWN:0x2,FOCUS_PERMIT_ARROW_LEFT:0x4,FOCUS_PERMIT_ARROW_RIGHT:0x8,FOCUS_PERMIT_ARROW_ALL:0xf,SIZE_HEIGHT:0x1,SIZE_WIDTH:0x2},_peerId:null,client:null,component:null,displayed:false,disposed:false,$construct:function(){},$abstract:{renderAdd:function(update,parentElement){},renderDispose:function(update){},renderUpdate:function(update){}},$virtual:{clientKeyDown:null,clientKeyPress:null,clientKeyUp:null,getFocusFlags:null,getPreferredSize:null,isChildVisible:null,renderFocus:null,renderHide:null,renderDisplay:null}});Echo.Render.RootSync=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Root",this)},renderAdd:function(update,parentElement){throw new Error("Unsupported operation: renderAdd().");},_renderContent:function(update){Echo.Render.renderComponentDispose(update,update.parent);Core.Web.DOM.removeAllChildren(this.client.domainElement);for(var i=0;i<update.parent.children.length;++i){Echo.Render.renderComponentAdd(update,update.parent.children[i],this.client.domainElement)}},renderDispose:function(update){},renderUpdate:function(update){var property,fullRender=false;if(update.fullRefresh||update.hasAddedChildren()||update.hasRemovedChildren()){Echo.Sync.renderComponentDefaults(this.component,this.client.domainElement);var title=this.component.render("title");if(title){document.title=title}this._renderContent(update);fullRender=true}else{this.client.domainElement.dir=this.client.application.getLayoutDirection().isLeftToRight()?"ltr":"rtl";if(update.hasUpdatedProperties()){property=update.getUpdatedProperty("title");if(property){document.title=property.newValue}property=update.getUpdatedProperty("background");if(property){Echo.Sync.Color.renderClear(property.newValue,this.client.domainElement,"backgroundColor")}property=update.getUpdatedProperty("foreground");if(property){Echo.Sync.Color.renderClear(property.newValue,this.client.domainElement,"foreground")}property=update.getUpdatedProperty("font");if(property){Echo.Sync.Font.renderClear(property.newValue,this.client.domainElement)}Echo.Sync.LayoutDirection.render(this.component.getLayoutDirection(),this.client.domainElement)}}return fullRender}});Echo.Sync={getEffectProperty:function(component,defaultPropertyName,effectPropertyName,effectState,defaultDefaultPropertyValue,effectDefaultPropertyValue){var property;if(effectState){property=component.render(effectPropertyName,effectDefaultPropertyValue)}if(!property){property=component.render(defaultPropertyName,defaultDefaultPropertyValue)}return property},renderComponentDefaults:function(component,element){var color;if((color=component.render("foreground"))){element.style.color=color}if((color=component.render("background"))){element.style.backgroundColor=color}var font=component.render("font");if(font){Echo.Sync.Font.render(font,element)}if(component.getLayoutDirection()){element.dir=component.getLayoutDirection().isLeftToRight()?"ltr":"rtl"}}};Echo.Sync.Alignment={_HORIZONTALS:{left:true,center:true,right:true,leading:true,trailing:true},_VERTICALS:{top:true,middle:true,bottom:true},getRenderedHorizontal:function(alignment,layoutDirectionProvider){if(alignment==null){return null}var layoutDirection=layoutDirectionProvider?layoutDirectionProvider.getRenderLayoutDirection():Echo.LayoutDirection.LTR;var horizontal=typeof(alignment)=="object"?alignment.horizontal:alignment;switch(horizontal){case"leading":return layoutDirection.isLeftToRight()?"left":"right";case"trailing":return layoutDirection.isLeftToRight()?"right":"left";default:return horizontal in this._HORIZONTALS?horizontal:null}},getHorizontal:function(alignment){if(alignment==null){return null}if(typeof(alignment=="string")){return alignment in this._HORIZONTALS?alignment:null}else{return alignment.horizontal}},getVertical:function(alignment){if(alignment==null){return null}if(typeof(alignment=="string")){return alignment in this._VERTICALS?alignment:null}else{return alignment.vertical}},render:function(alignment,element,renderToElement,layoutDirectionProvider){if(alignment==null){return}var horizontal=Echo.Sync.Alignment.getRenderedHorizontal(alignment,layoutDirectionProvider);var vertical=typeof(alignment)=="object"?alignment.vertical:alignment;var horizontalValue;switch(horizontal){case"left":horizontalValue="left";break;case"center":horizontalValue="center";break;case"right":horizontalValue="right";break;default:horizontalValue="";break}var verticalValue;switch(vertical){case"top":verticalValue="top";break;case"middle":verticalValue="middle";break;case"bottom":verticalValue="bottom";break;default:verticalValue="";break}if(renderToElement){element.align=horizontalValue;element.vAlign=verticalValue}else{element.style.textAlign=horizontalValue;element.style.verticalAlign=verticalValue}}};Echo.Sync.Border={_PARSER_PX:new RegExp("^(-?\\d+px)?(?:^|$|(?= )) ?(none|hidden|dotted|dashed|solid|"+"double|groove|ridge|inset|outset)?(?:^|$|(?= )) ?(#[0-9a-fA-F]{6})?$"),_PARSER:new RegExp("^(-?\\d+(?:px|pt|pc|cm|mm|in|em|ex))?(?:^|$|(?= )) ?(none|hidden|dotted|dashed|solid|"+"double|groove|ridge|inset|outset)?(?:^|$|(?= )) ?(#[0-9a-fA-F]{6})?$"),_TEST_EXTENT_PX:/^-?\d+px$/,compose:function(size,style,color){if(typeof size=="number"){size+="px"}var out=[];if(size){out.push(size)}if(style){out.push(style)}if(color){out.push(color)}return out.join(" ")},isMultisided:function(border){return(border&&(border.top||border.bottom||border.left||border.right))?true:false},parse:function(border){if(!border){return{}}if(typeof(border)=="string"){var parts=this._PARSER.exec(border);return{size:parts[1],style:parts[2],color:parts[3]}}else{return Echo.Sync.Border.parse(border.top||border.right||border.bottom||border.left)}},render:function(border,element,styleAttribute){if(!border){return}styleAttribute=styleAttribute?styleAttribute:"border";if(typeof(border)=="string"){if(this._PARSER_PX.test(border)){element.style[styleAttribute]=border}else{var elements=this._PARSER.exec(border);if(elements==null){throw new Error("Invalid border: \""+border+"\"");}this.render(Echo.Sync.Extent.toPixels(elements[1])+"px "+elements[2]+" "+elements[3],element,styleAttribute)}}else{this.render(border.top,element,styleAttribute+"Top");if(border.right!==null){this.render(border.right||border.top,element,styleAttribute+"Right")}if(border.bottom!==null){this.render(border.bottom||border.top,element,styleAttribute+"Bottom")}if(border.left!==null){this.render(border.left||border.right||border.top,element,styleAttribute+"Left")}}},renderClear:function(border,element){if(border){if(border instanceof Object){element.style.border=""}this.render(border,element)}else{element.style.border=""}},getPixelSize:function(border,sideName){if(!border){return 0}if(typeof(border)=="string"){var extent=this._PARSER.exec(border)[1];if(extent==null){return 0}else if(this._TEST_EXTENT_PX.test(extent)){return parseInt(extent,10)}else{return Echo.Sync.Extent.toPixels(extent)}}else if(typeof(border)=="object"){while(true){var side=this.getPixelSize(border[sideName]);if(side==null){switch(sideName){case"left":sideName="right";continue;case"right":case"bottom":sideName="top";continue}}return side}}}};Echo.Sync.Color={adjust:function(value,r,g,b){var colorInt=parseInt(value.substring(1),16);var red=Math.floor(colorInt/0x10000)+r;var green=Math.floor(colorInt/0x100)%0x100+g;var blue=colorInt%0x100+b;return this.toHex(red,green,blue)},blend:function(value1,value2,ratio){ratio=ratio<0?0:(ratio>1?1:ratio);var colorInt1=parseInt(value1.substring(1),16);var colorInt2=parseInt(value2.substring(1),16);var red=Math.round(Math.floor(colorInt1/0x10000)*(1-ratio)+Math.floor(colorInt2/0x10000)*ratio);var green=Math.round(Math.floor(colorInt1/0x100)%0x100*(1-ratio)+Math.floor(colorInt2/0x100)%0x100*ratio);var blue=Math.round((colorInt1%0x100)*(1-ratio)+(colorInt2%0x100)*ratio);return this.toHex(red,green,blue)},render:function(color,element,styleAttribute){if(color){element.style[styleAttribute]=color}},renderClear:function(color,element,styleAttribute){element.style[styleAttribute]=color?color:""},renderFB:function(component,element){var color;if((color=component.render("foreground"))){element.style.color=color}if((color=component.render("background"))){element.style.backgroundColor=color}},toHex:function(red,green,blue){if(red<0){red=0}else if(red>255){red=255}if(green<0){green=0}else if(green>255){green=255}if(blue<0){blue=0}else if(blue>255){blue=255}return"#"+(red<16?"0":"")+red.toString(16)+(green<16?"0":"")+green.toString(16)+(blue<16?"0":"")+blue.toString(16)}};Echo.Sync.Extent={_PARSER:/^(-?\d+(?:\.\d+)?)(.+)?$/,_FORMATTED_INT_PIXEL_TEST:/^(-?\d+px *)$/,_FORMATTED_DECIMAL_PIXEL_TEST:/^(-?\d+(.\d+)?px *)$/,isPercent:function(extent){if(extent==null||typeof(extent)=="number"){return false}else{var parts=this._PARSER.exec(extent);if(!parts){return false}return parts[2]=="%"}},render:function(extent,element,styleAttribute,horizontal,allowPercent){var cssValue=Echo.Sync.Extent.toCssValue(extent,horizontal,allowPercent);if(cssValue!==""){element.style[styleAttribute]=cssValue}},toCssValue:function(extent,horizontal,allowPercent){switch(typeof(extent)){case"number":return Math.round(extent)+"px";case"string":if(this._FORMATTED_INT_PIXEL_TEST.test(extent)){return extent}else if(this._FORMATTED_DECIMAL_PIXEL_TEST.test(extent)){return Math.round(parseFloat(extent))+"px"}else{if(this.isPercent(extent)){return allowPercent?extent:""}else{var pixels=this.toPixels(extent,horizontal);return pixels==null?"":this.toPixels(extent,horizontal)+"px"}}break}return""},toPixels:function(extent,horizontal){if(extent==null){return 0}else if(typeof(extent)=="number"){return Math.round(extent)}else{return Math.round(Core.Web.Measure.extentToPixels(extent,horizontal))}}};Echo.Sync.FillImage={_REPEAT_VALUES:{"0":"no-repeat","x":"repeat-x","y":"repeat-y","xy":"repeat","no-repeat":"no-repeat","repeat-x":"repeat-x","repeat-y":"repeat-y","repeat":"repeat"},FLAG_ENABLE_IE_PNG_ALPHA_FILTER:0x1,getPosition:function(fillImage){if(fillImage.x||fillImage.y){var x,y;if(Echo.Sync.Extent.isPercent(fillImage.x)){x=fillImage.x}else{x=Echo.Sync.Extent.toPixels(fillImage.x,true)+"px"}if(Echo.Sync.Extent.isPercent(fillImage.y)){y=fillImage.y}else{y=Echo.Sync.Extent.toPixels(fillImage.y,false)+"px"}return x+" "+y}else{return null}},getRepeat:function(fillImage){if(this._REPEAT_VALUES[fillImage.repeat]){return this._REPEAT_VALUES[fillImage.repeat]}else{return null}},getUrl:function(fillImage){if(fillImage==null){return null}return typeof(fillImage)=="object"?fillImage.url:fillImage},render:function(fillImage,element,flags){if(fillImage==null){return}var isObject=typeof(fillImage)=="object";var url=isObject?fillImage.url:fillImage;if(Core.Web.Env.QUIRK_IE_SECURE_ITEMS&&document.location.protocol=="https:"){if(url.substring(0,5)!="http:"&&url.substring(0,6)!="https:"){url=document.location.protocol+"//"+document.location.hostname+(document.location.port?(":"+document.location.port):"")+url}}if(Core.Web.Env.PROPRIETARY_IE_PNG_ALPHA_FILTER_REQUIRED&&flags&&(flags&this.FLAG_ENABLE_IE_PNG_ALPHA_FILTER)){element.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+url+"', sizingMethod='scale')"}else{element.style.backgroundImage="url("+url+")"}if(isObject){var position=Echo.Sync.FillImage.getPosition(fillImage);element.style.backgroundPosition=position?position:"";element.style.backgroundRepeat=this._REPEAT_VALUES[fillImage.repeat]?this._REPEAT_VALUES[fillImage.repeat]:""}},renderClear:function(fillImage,element,flags){if(fillImage){this.render(fillImage,element,flags)}else{if(Core.Web.Env.PROPRIETARY_IE_PNG_ALPHA_FILTER_REQUIRED){element.style.filter=""}element.style.backgroundImage="";element.style.backgroundPosition="";element.style.backgroundRepeat=""}}};Echo.Sync.FillImageBorder={_NAMES:["top","topRight","right","bottomRight","bottom","bottomLeft","left","topLeft"],_MAP:[[0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0],[1,1,1,0,0,0,0,0],[0,0,0,0,1,0,0,0],[1,0,0,0,1,0,0,0],[0,0,1,1,1,0,0,0],[1,1,1,1,1,0,0,0],[0,0,0,0,0,0,1,0],[1,0,0,0,0,0,1,1],[0,0,1,0,0,0,1,0],[1,1,1,0,0,0,1,1],[0,0,0,0,1,1,1,0],[1,0,0,0,1,1,1,1],[0,0,1,1,1,1,1,0],[1,1,1,1,1,1,1,1]],_PROTOTYPES:[],_createSegment:function(parent,css){var child=document.createElement("div");child.style.cssText="font-size:1px;line-height:0;position:absolute;"+css;parent.appendChild(child)},_createPrototype:function(key){var div=document.createElement("div");if(Core.Web.Env.QUIRK_IE_HAS_LAYOUT){div.style.zoom=1}if(key&0x1){this._createSegment(div,"top:0;");if(key&0x2){this._createSegment(div,"top:0;right:0;")}}if(key&0x2){this._createSegment(div,"right:0;");if(key&0x4){this._createSegment(div,"bottom:0;right:0;")}}if(key&0x4){this._createSegment(div,"bottom:0;");if(key&0x8){this._createSegment(div,"bottom:0;left:0;")}}if(key&0x8){this._createSegment(div,"left:0;");if(key&0x1){this._createSegment(div,"top:0;left:0;")}}return div},getBorder:function(containerDiv){var border=[];var child=containerDiv.firstChild;while(child){if(child.__FIB_segment!=null){border[child.__FIB_segment]=child}child=child.nextSibling}return border},getContainerContent:function(containerDiv){if(!containerDiv.__FIB_hasContent){return null}var child=containerDiv.firstChild;while(child){if(child.__FIB_content){return child}child=child.nextSibling}return null},renderContainer:function(fillImageBorder,configuration){fillImageBorder=fillImageBorder||{};configuration=configuration||{};var bi=Echo.Sync.Insets.toPixels(fillImageBorder.borderInsets);var key=(bi.left&&0x8)|(bi.bottom&&0x4)|(bi.right&&0x2)|(bi.top&&0x1);var map=this._MAP[key];var prototypeDiv=this._PROTOTYPES[key]?this._PROTOTYPES[key]:this._PROTOTYPES[key]=this._createPrototype(key);var div,child,childClone,firstChild,i,content=null,border=[],insertBefore=null,testChild,insets;if(configuration.update){div=configuration.update;child=div.firstChild;while(child){testChild=child;child=child.nextSibling;if(testChild.__FIB_segment!=null){insertBefore=child;div.removeChild(testChild)}if(testChild.__FIB_content){content=testChild}}child=prototypeDiv.firstChild;while(child){childClone=child.cloneNode(true);if(!firstChild){firstChild=childClone}if(insertBefore){div.insertBefore(childClone,insertBefore)}else{div.appendChild(childClone)}child=child.nextSibling}}else{div=prototypeDiv.cloneNode(true);firstChild=div.firstChild;if(configuration.content||configuration.child){content=document.createElement("div");content.__FIB_content=true;if(configuration.child){content.appendChild(configuration.child)}div.__FIB_hasContent=true;div.appendChild(content)}if(configuration.absolute){div.__FIB_absolute=true;div.style.position="absolute"}else{div.style.position="relative";if(content){content.style.position="relative";if(Core.Web.Env.QUIRK_IE_HAS_LAYOUT){content.style.zoom=1}}}}div.__key=key;child=firstChild;for(i=0;i<8;++i){if(!map[i]){continue}child.__FIB_segment=i;border[i]=child;if(fillImageBorder.color){child.style.backgroundColor=fillImageBorder.color}if(i===0||i===1||i===7){child.style.height=bi.top+"px"}else if(i>=3&&i<=5){child.style.height=bi.bottom+"px"}if(i>=1&&i<=3){child.style.width=bi.right+"px"}else if(i>=5){child.style.width=bi.left+"px"}Echo.Sync.FillImage.render(fillImageBorder[this._NAMES[i]],child,Echo.Sync.FillImage.FLAG_ENABLE_IE_PNG_ALPHA_FILTER);child=child.nextSibling}if(bi.top){border[0].style.left=bi.left+"px";border[0].style.right=bi.right+"px"}if(bi.right){border[2].style.top=bi.top+"px";border[2].style.bottom=bi.bottom+"px"}if(bi.bottom){border[4].style.left=bi.left+"px";border[4].style.right=bi.right+"px"}if(bi.left){border[6].style.top=bi.top+"px";border[6].style.bottom=bi.bottom+"px"}if(div.__FIB_absolute){if(content){var ci=Echo.Sync.Insets.toPixels(fillImageBorder.contentInsets);content.style.position="absolute";content.style.overflow="auto";content.style.top=ci.top+"px";content.style.right=ci.right+"px";content.style.bottom=ci.bottom+"px";content.style.left=ci.left+"px"}}else{if(content){Echo.Sync.Insets.render(fillImageBorder.contentInsets,content,"padding")}if(!configuration.update){div.style.position="relative";if(content){content.style.position="relative"}}}return div},renderContainerDisplay:function(containerDiv){var content;if(Core.Web.VirtualPosition.enabled){if(containerDiv.__FIB_absolute){Core.Web.VirtualPosition.redraw(containerDiv);if((content=this.getContainerContent(containerDiv))){Core.Web.VirtualPosition.redraw(content)}}var border=this.getBorder(containerDiv);for(var i=0;i<8;i+=2){if(border[i]){Core.Web.VirtualPosition.redraw(border[i])}}}}};Echo.Sync.Font={render:function(font,element){if(!font){return}if(font.typeface){if(font.typeface instanceof Array){element.style.fontFamily=font.typeface.join(",")}else{element.style.fontFamily=font.typeface}}if(font.size){element.style.fontSize=Echo.Sync.Extent.toCssValue(font.size)}if(font.bold){element.style.fontWeight="bold"}if(font.italic){element.style.fontStyle="italic"}if(font.underline){element.style.textDecoration="underline"}else if(font.overline){element.style.textDecoration="overline"}else if(font.lineThrough){element.style.textDecoration="line-through"}},renderClear:function(font,element){if(font){this.render(font,element);if(!font.typeface){element.style.fontFamily=""}if(!font.underline){element.style.textDecoration=""}if(!font.bold){element.style.fontWeight=""}if(!font.size){element.style.fontSize=""}if(!font.italic){element.style.fontStyle=""}}else{element.style.fontFamily="";element.style.fontSize="";element.style.fontWeight="";element.style.fontStyle="";element.style.textDecoration=""}}};Echo.Sync.ImageReference={getUrl:function(imageReference){return imageReference?(typeof(imageReference)=="string"?imageReference:imageReference.url):null},renderImg:function(imageReference,imgElement){if(!imageReference){return}if(typeof(imageReference)=="string"){imgElement.src=imageReference}else{imgElement.src=imageReference.url;if(imageReference.width){imgElement.style.width=Echo.Sync.Extent.toCssValue(imageReference.width,true)}if(imageReference.height){imgElement.style.height=Echo.Sync.Extent.toCssValue(imageReference.height,false)}}}};Echo.Sync.Insets={_FORMATTED_PIXEL_INSETS:/^(-?\d+px *){1,4}$/,_ZERO:{top:0,right:0,bottom:0,left:0},_INDEX_MAPS:{1:[0,0,0,0],2:[0,1,0,1],3:[0,1,2,1],4:[0,1,2,3]},render:function(insets,element,styleAttribute){switch(typeof(insets)){case"number":element.style[styleAttribute]=Math.round(insets)+"px";break;case"string":if(this._FORMATTED_PIXEL_INSETS.test(insets)){element.style[styleAttribute]=insets}else{var pixelInsets=this.toPixels(insets);element.style[styleAttribute]=pixelInsets.top+"px "+pixelInsets.right+"px "+pixelInsets.bottom+"px "+pixelInsets.left+"px"}break}},renderPosition:function(insets,element){var insetsPx=this.toPixels(insets);element.style.top=insetsPx.top+"px";element.style.right=insetsPx.right+"px";element.style.bottom=insetsPx.bottom+"px";element.style.left=insetsPx.left+"px"},toCssValue:function(insets){switch(typeof(insets)){case"number":return insets+"px";case"string":if(this._FORMATTED_PIXEL_INSETS.test(insets)){return insets}else{var pixelInsets=this.toPixels(insets);return pixelInsets.top+"px "+pixelInsets.right+"px "+pixelInsets.bottom+"px "+pixelInsets.left+"px"}break}return""},toPixels:function(insets){if(insets==null){return this._ZERO}else if(typeof(insets)=="number"){insets=Math.round(insets);return{top:insets,right:insets,bottom:insets,left:insets}}insets=insets.split(" ");var map=this._INDEX_MAPS[insets.length];return{top:Echo.Sync.Extent.toPixels(insets[map[0]],false),right:Echo.Sync.Extent.toPixels(insets[map[1]],true),bottom:Echo.Sync.Extent.toPixels(insets[map[2]],false),left:Echo.Sync.Extent.toPixels(insets[map[3]],true)}}};Echo.Sync.LayoutDirection={render:function(layoutDirection,element){if(layoutDirection){element.dir=layoutDirection.isLeftToRight()?"ltr":"rtl"}}};Echo.Sync.TriCellTable=Core.extend({$static:{INVERTED:1,VERTICAL:2,LEADING_TRAILING:0,TRAILING_LEADING:1,TOP_BOTTOM:2,BOTTOM_TOP:3,_createTablePrototype:function(){var table=document.createElement("table");table.style.borderCollapse="collapse";table.style.padding="0";var tbody=document.createElement("tbody");table.appendChild(tbody);return table},getInvertedOrientation:function(component,propertyName,defaultValue){return this.getOrientation(component,propertyName,defaultValue)^this.INVERTED},getOrientation:function(component,propertyName,defaultValue){var position=component.render(propertyName,defaultValue);var orientation;if(position){switch(Echo.Sync.Alignment.getRenderedHorizontal(position,component)){case"left":return this.LEADING_TRAILING;case"right":return this.TRAILING_LEADING}switch(Echo.Sync.Alignment.getVertical(position,component)){case"top":return this.TOP_BOTTOM;case"bottom":return this.BOTTOM_TOP}}return component.getRenderLayoutDirection().isLeftToRight()?this.TRAILING_LEADING:this.LEADING_TRAILING}},$load:function(){this._tablePrototype=this._createTablePrototype()},tableElement:null,tbodyElement:null,$construct:function(orientation0_1,margin0_1,orientation01_2,margin01_2){this.tableElement=Echo.Sync.TriCellTable._tablePrototype.cloneNode(true);this.tbodyElement=this.tableElement.firstChild;if(orientation01_2==null){this._configure2(orientation0_1,margin0_1)}else{this._configure3(orientation0_1,margin0_1,orientation01_2,margin01_2)}},_addColumn:function(tr,td){if(td!=null){tr.appendChild(td)}},_addRow:function(td){if(td==null){return}var tr=document.createElement("tr");tr.appendChild(td);this.tbodyElement.appendChild(tr)},_addSpacer:function(parentElement,size,vertical){var divElement=document.createElement("div");if(vertical){divElement.style.cssText="width:1px;height:"+size+"px;font-size:1px;line-height:0;"}else{divElement.style.cssText="width:"+size+"px;height:1px;font-size:1px;line-height:0;"}parentElement.appendChild(divElement)},_configure2:function(orientation0_1,margin0_1){this.tdElements=[document.createElement("td"),document.createElement("td")];this.tdElements[0].style.padding="0";this.tdElements[1].style.padding="0";this.marginTdElements=[];if(margin0_1){this.marginTdElements[0]=document.createElement("td");this.marginTdElements[0].style.padding="0";if((orientation0_1&Echo.Sync.TriCellTable.VERTICAL)===0){this.marginTdElements[0].style.width=margin0_1+"px";this._addSpacer(this.marginTdElements[0],margin0_1,false)}else{this.marginTdElements[0].style.height=margin0_1+"px";this._addSpacer(this.marginTdElements[0],margin0_1,true)}}if(orientation0_1&Echo.Sync.TriCellTable.VERTICAL){if(orientation0_1&Echo.Sync.TriCellTable.INVERTED){this._addRow(this.tdElements[1]);this._addRow(this.marginTdElements[0]);this._addRow(this.tdElements[0])}else{this._addRow(this.tdElements[0]);this._addRow(this.marginTdElements[0]);this._addRow(this.tdElements[1])}}else{var tr=document.createElement("tr");if(orientation0_1&Echo.Sync.TriCellTable.INVERTED){this._addColumn(tr,this.tdElements[1]);this._addColumn(tr,this.marginTdElements[0]);this._addColumn(tr,this.tdElements[0])}else{this._addColumn(tr,this.tdElements[0]);this._addColumn(tr,this.marginTdElements[0]);this._addColumn(tr,this.tdElements[1])}this.tbodyElement.appendChild(tr)}},_configure3:function(orientation0_1,margin0_1,orientation01_2,margin01_2){this.tdElements=[];for(var i=0;i<3;++i){this.tdElements[i]=document.createElement("td");this.tdElements[i].style.padding="0"}this.marginTdElements=[];if(margin0_1||margin01_2!=null){if(margin0_1&&margin0_1>0){this.marginTdElements[0]=document.createElement("td");if(orientation0_1&Echo.Sync.TriCellTable.VERTICAL){this.marginTdElements[0].style.height=margin0_1+"px";this._addSpacer(this.marginTdElements[0],margin0_1,true)}else{this.marginTdElements[0].style.width=margin0_1+"px";this._addSpacer(this.marginTdElements[0],margin0_1,false)}}if(margin01_2!=null&&margin01_2>0){this.marginTdElements[1]=document.createElement("td");if(orientation0_1&Echo.Sync.TriCellTable.VERTICAL){this.marginTdElements[1].style.height=margin01_2+"px";this._addSpacer(this.marginTdElements[1],margin01_2,true)}else{this.marginTdElements[1].style.width=margin01_2+"px";this._addSpacer(this.marginTdElements[1],margin01_2,false)}}}if(orientation0_1&Echo.Sync.TriCellTable.VERTICAL){if(orientation01_2&Echo.Sync.TriCellTable.VERTICAL){if(orientation01_2&Echo.Sync.TriCellTable.INVERTED){this._addRow(this.tdElements[2]);this._addRow(this.marginTdElements[1])}if(orientation0_1&Echo.Sync.TriCellTable.INVERTED){this._addRow(this.tdElements[1]);this._addRow(this.marginTdElements[0]);this._addRow(this.tdElements[0])}else{this._addRow(this.tdElements[0]);this._addRow(this.marginTdElements[0]);this._addRow(this.tdElements[1])}if(!(orientation01_2&Echo.Sync.TriCellTable.INVERTED)){this._addRow(this.marginTdElements[1]);this._addRow(this.tdElements[2])}}else{var rows=(margin0_1&&margin0_1>0)?3:2;this.tdElements[2].rowSpan=rows;if(this.marginTdElements[1]){this.marginTdElements[1].rowSpan=rows}var tr=document.createElement("tr");if(orientation01_2&Echo.Sync.TriCellTable.INVERTED){this._addColumn(tr,this.tdElements[2]);this._addColumn(tr,this.marginTdElements[1]);if(orientation0_1&Echo.Sync.TriCellTable.INVERTED){this._addColumn(tr,this.tdElements[1])}else{this._addColumn(tr,this.tdElements[0])}}else{if(orientation0_1&Echo.Sync.TriCellTable.INVERTED){this._addColumn(tr,this.tdElements[1])}else{this._addColumn(tr,this.tdElements[0])}this._addColumn(tr,this.marginTdElements[1]);this._addColumn(tr,this.tdElements[2])}this.tbodyElement.appendChild(tr);this._addRow(this.marginTdElements[0]);if(orientation0_1&Echo.Sync.TriCellTable.INVERTED){this._addRow(this.tdElements[0])}else{this._addRow(this.tdElements[1])}}}else{if(orientation01_2&Echo.Sync.TriCellTable.VERTICAL){var columns=margin0_1?3:2;this.tdElements[2].setAttribute("colspan",columns);if(this.marginTdElements[1]!=null){this.marginTdElements[1].setAttribute("colspan",columns)}if(orientation01_2&Echo.Sync.TriCellTable.INVERTED){this._addRow(this.tdElements[2]);this._addRow(this.marginTdElements[1])}tr=document.createElement("tr");if((orientation0_1&Echo.Sync.TriCellTable.INVERTED)===0){this._addColumn(tr,this.tdElements[0]);this._addColumn(tr,this.marginTdElements[0]);this._addColumn(tr,this.tdElements[1])}else{this._addColumn(tr,this.tdElements[1]);this._addColumn(tr,this.marginTdElements[0]);this._addColumn(tr,this.tdElements[0])}this.tbodyElement.appendChild(tr);if(!(orientation01_2&Echo.Sync.TriCellTable.INVERTED)){this._addRow(this.marginTdElements[1]);this._addRow(this.tdElements[2])}}else{tr=document.createElement("tr");if(orientation01_2&Echo.Sync.TriCellTable.INVERTED){this._addColumn(tr,this.tdElements[2]);this._addColumn(tr,this.marginTdElements[1])}if(orientation0_1&Echo.Sync.TriCellTable.INVERTED){this._addColumn(tr,this.tdElements[1]);this._addColumn(tr,this.marginTdElements[0]);this._addColumn(tr,this.tdElements[0])}else{this._addColumn(tr,this.tdElements[0]);this._addColumn(tr,this.marginTdElements[0]);this._addColumn(tr,this.tdElements[1])}if(!(orientation01_2&Echo.Sync.TriCellTable.INVERTED)){this._addColumn(tr,this.marginTdElements[1]);this._addColumn(tr,this.tdElements[2])}this.tbodyElement.appendChild(tr)}}}});Echo.Sync.Label=Core.extend(Echo.Render.ComponentSync,{$static:{_defaultIconTextMargin:5},$load:function(){Echo.Render.registerPeer("Label",this)},_node:null,_formatWhitespace:function(text,parentElement){text=text.replace(/\t/g," \u00a0 \u00a0");text=text.replace(/ {2}/g," \u00a0");var lines=text.split('\n');for(var i=0;i<lines.length;i++){var line=lines[i];if(i>0){parentElement.appendChild(document.createElement("br"))}if(line.length>0){parentElement.appendChild(document.createTextNode(line))}}},renderAdd:function(update,parentElement){this._containerElement=parentElement;var icon=this.component.render("icon"),text=this.component.render("text"),foreground=this.component.render("foreground"),background=this.component.render("background"),toolTip=this.component.render("toolTipText"),img;if(text!=null){var lineWrap=this.component.render("lineWrap",true);var formatWhitespace=this.component.render("formatWhitespace",false)&&(text.indexOf(' ')!=-1||text.indexOf('\n')!=-1||text.indexOf('\t')!=-1);if(icon){var iconTextMargin=this.component.render("iconTextMargin",Echo.Sync.Label._defaultIconTextMargin);var orientation=Echo.Sync.TriCellTable.getOrientation(this.component,"textPosition");var tct=new Echo.Sync.TriCellTable(orientation,Echo.Sync.Extent.toPixels(iconTextMargin));img=document.createElement("img");Echo.Sync.ImageReference.renderImg(icon,img);if(formatWhitespace){this._formatWhitespace(text,tct.tdElements[0])}else{tct.tdElements[0].appendChild(document.createTextNode(text))}if(!lineWrap){tct.tdElements[0].style.whiteSpace="nowrap"}tct.tdElements[1].appendChild(img);this._node=tct.tableElement;this._node.id=this.component.renderId;Echo.Sync.renderComponentDefaults(this.component,this._node)}else{var font=this.component.render("font");if(!this.client.designMode&&!toolTip&&!font&&lineWrap&&!foreground&&!background&&!formatWhitespace&&!this.component.getLayoutDirection()){this._node=document.createTextNode(text)}else{this._node=document.createElement("span");this._node.id=this.component.renderId;if(formatWhitespace){this._formatWhitespace(text,this._node)}else{this._node.appendChild(document.createTextNode(text))}if(!lineWrap){this._node.style.whiteSpace="nowrap"}Echo.Sync.renderComponentDefaults(this.component,this._node)}}}else if(icon){img=document.createElement("img");Echo.Sync.ImageReference.renderImg(icon,img);this._node=document.createElement("span");this._node.id=this.component.renderId;this._node.appendChild(img);Echo.Sync.Color.render(this.component.render("background"),this._node,"backgroundColor")}else{if(this.client.designMode){this._node=document.createElement("span");this._node.id=this.component.renderId}else{this._node=null}}if(this._node){if(toolTip){this._node.title=toolTip}parentElement.appendChild(this._node)}},renderDispose:function(update){this._containerElement=null;this._node=null},renderUpdate:function(update){if(this._node){this._node.parentNode.removeChild(this._node)}this.renderAdd(update,this._containerElement);return false}});Echo.Client=Core.extend({$static:{DEFAULT_CONFIGURATION:{"StopError.Message":"This application has been stopped due to an error.","WaitIndicator.Text":"Please wait...","Action.Continue":"Continue","Action.Restart":"Restart Application"},STYLE_CRITICAL:0,STYLE_MESSAGE:1,_activeClients:[],_globalWindowResizeListener:function(e){for(var i=0;i<Echo.Client._activeClients.length;++i){Echo.Client._activeClients[i]._windowResizeListener(e)}}},$load:function(){Core.Web.DOM.addEventListener(window,"resize",this._globalWindowResizeListener,false)},configuration:null,designMode:false,domainElement:null,application:null,_lastInputRestrictionId:0,_inputRestrictionCount:0,_inputRestrictionListeners:null,_inputRescriptionMap:null,_keyFocusedComponentId:null,_lastKeyCode:null,_processKeyRef:null,_waitIndicatorActive:false,_processApplicationFocusRef:null,parent:null,_waitIndicator:null,_preWaitIndicatorDelay:500,_waitIndicatorRunnable:null,$construct:function(){this.configuration={};for(var x in Echo.Client.DEFAULT_CONFIGURATION){this.configuration[x]=Echo.Client.DEFAULT_CONFIGURATION[x]}this._inputRestrictionMap={};this._processKeyRef=Core.method(this,this._processKey);this._processApplicationFocusRef=Core.method(this,this._processApplicationFocus);this._waitIndicator=new Echo.Client.DefaultWaitIndicator();this._waitIndicatorRunnable=new Core.Web.Scheduler.MethodRunnable(Core.method(this,this._waitIndicatorActivate),this._preWaitIndicatorDelay,false)},$abstract:true,$virtual:{getResourceUrl:function(packageName,resourceName){if(this.parent){return this.parent.getResourceUrl(packageName,resourceName)}else{return null}},verifyInput:function(component){if(this._inputRestrictionCount!==0){return false}if(component){return component.isActive()}else{return this.application.isActive()}},dispose:function(){this.configure(null,null);this._setWaitVisible(false)}},addElement:function(element){Core.Web.Event.add(element,"keypress",this._processKeyRef,false);Core.Web.Event.add(element,"keydown",this._processKeyRef,false);Core.Web.Event.add(element,"keyup",this._processKeyRef,false)},configure:function(application,domainElement){if(this.application){Core.Arrays.remove(Echo.Client._activeClients,this);this.removeElement(this.domainElement);this.application.removeListener("focus",this._processApplicationFocusRef);this.application.doDispose();this.application.client=null}this.application=application;this.domainElement=domainElement;if(this.application){this.application.client=this;this.application.doInit();this.application.addListener("focus",this._processApplicationFocusRef);this.addElement(this.domainElement);Echo.Client._activeClients.push(this)}},createInputRestriction:function(){this._setWaitVisible(true);var id=(++this._lastInputRestrictionId).toString();++this._inputRestrictionCount;this._inputRestrictionMap[id]=true;return id},displayError:function(parentElement,message,detail,actionText,actionFunction,style){parentElement=parentElement||document.body;var restriction=this.createInputRestriction();this._setWaitVisible(false);var blackoutDiv=document.createElement("div");blackoutDiv.style.cssText="position:absolute;z-index:32766;width:100%;height:100%;background-color:#000000;opacity:0.75";if(Core.Web.Env.PROPRIETARY_IE_OPACITY_FILTER_REQUIRED){blackoutDiv.style.filter="alpha(opacity=75)"}parentElement.appendChild(blackoutDiv);var div=document.createElement("div");div.style.cssText="position:absolute;z-index:32767;width:100%;height:100%;overflow:hidden;";parentElement.appendChild(div);var contentDiv=document.createElement("div");contentDiv.style.cssText="color:#ffffff;padding:20px 40px 0px;"+(style===Echo.Client.STYLE_MESSAGE?"border-bottom:4px solid #1f1faf;background-color:#1f1f5f":"border-bottom:4px solid #af1f1f;background-color:#5f1f1f");if(message){var messageDiv=document.createElement("div");messageDiv.style.cssText="font-weight: bold; margin-bottom:20px;";messageDiv.appendChild(document.createTextNode(message));contentDiv.appendChild(messageDiv)}if(detail){var detailDiv=document.createElement("div");detailDiv.style.cssText="max-height:10em;overflow:auto;margin-bottom:20px;";detailDiv.appendChild(document.createTextNode(detail));contentDiv.appendChild(detailDiv)}div.appendChild(contentDiv);if(actionText){var actionDiv=document.createElement("div");actionDiv.tabIndex="0";actionDiv.style.cssText="margin-bottom:20px;cursor:pointer;font-weight:bold;padding:2px 10px;"+(style===Echo.Client.STYLE_MESSAGE?"border: 1px outset #2f2faf;background-color:#2f2faf;":"border: 1px outset #af2f2f;background-color:#af2f2f;");actionDiv.appendChild(document.createTextNode(actionText));contentDiv.appendChild(actionDiv);var listener=Core.method(this,function(e){if(e.type!="keypress"||e.keyCode==13){try{Core.Web.DOM.removeEventListener(actionDiv,"click",listener,false);Core.Web.DOM.removeEventListener(actionDiv,"keypress",listener,false);div.parentNode.removeChild(div);blackoutDiv.parentNode.removeChild(blackoutDiv);this.removeInputRestriction(restriction)}finally{if(actionFunction){actionFunction()}}}});Core.Web.DOM.addEventListener(actionDiv,"click",listener,false);Core.Web.DOM.addEventListener(actionDiv,"keypress",listener,false);Core.Web.DOM.focusElement(actionDiv)}},exec:function(requiredLibraries,f){var restriction=this.createInputRestriction();Core.Web.Library.exec(requiredLibraries,Core.method(this,function(e){if(e&&!e.success){this.fail("Cannot install library: "+e.url+" Exception: "+e.ex);return}this.removeInputRestriction(restriction);f()}))},fail:function(detail){var element=this.domainElement;try{this.dispose()}finally{if(this.configuration["StopError.URI"]){window.location.href=this.configuration["StopError.URI"]}else{this.displayError(element,this.configuration["StopError.Message"],detail,this.configuration["Action.Restart"],function(){window.location.reload()})}}},forceRedraw:function(){if(this.parent){this.parent.forceRedraw()}else if(Core.Web.Env.QUIRK_IE_BLANK_SCREEN){if(this.domainElement&&this.domainElement.offsetHeight===0){var displayState=document.documentElement.style.display||"";document.documentElement.style.display="none";document.documentElement.style.display=displayState}}},getWaitIndicator:function(){return this._waitIndicator},_processApplicationFocus:function(e){var focusedComponent=this.application.getFocusedComponent();if(focusedComponent&&focusedComponent.peer&&focusedComponent.peer.renderFocus){focusedComponent.peer.renderFocus()}},_processKey:function(e){var up=e.type=="keyup",press=e.type=="keypress",component=this.application.getFocusedComponent(),bubble=true,keyEvent=null,keyCode;if(press){keyCode=this._lastKeyCode}else{keyCode=this._lastKeyCode=Core.Web.Key.translateKeyCode(e.keyCode)}if(!up){if(keyCode==8){var nodeName=e.target.nodeName?e.target.nodeName.toLowerCase():null;if(nodeName!="input"&&nodeName!="textarea"){Core.Web.DOM.preventEventDefault(e)}}else if(!press&&keyCode==9){this.application.focusNext(e.shiftKey);Core.Web.DOM.preventEventDefault(e)}if(press&&Core.Web.Env.QUIRK_KEY_PRESS_FIRED_FOR_SPECIAL_KEYS&&!e.charCode){return true}}if(!component){return true}if(up||press){if(this._keyFocusedComponentId!=component.renderId){return true}}else{this._keyFocusedComponentId=component.renderId}var eventMethod=press?"clientKeyPress":(up?"clientKeyUp":"clientKeyDown");while(component&&bubble){if(component.peer&&component.peer[eventMethod]){if(!keyEvent){keyEvent={type:e.type,source:this,keyCode:keyCode,domEvent:e};if(press){keyEvent.charCode=Core.Web.Env.QUIRK_KEY_CODE_IS_CHAR_CODE?e.keyCode:e.charCode}}bubble=component.peer[eventMethod](keyEvent)}component=component.parent}return true},processUpdates:function(){var ir=null;try{ir=this.createInputRestriction();Echo.Render.processUpdates(this);this.removeInputRestriction(ir);this.forceRedraw()}catch(ex){if(ex.lineNumber){Core.Debug.consoleWrite("Reported Line #: "+ex.lineNumber);Core.Debug.consoleWrite("Evaluated Line #: "+(ex.lineNumber-Core.Web.Library.evalLine)+" (if evaluated script)")}if(ex.stack){Core.Debug.consoleWrite("Exception: "+ex+", Stack Trace: "+ex.stack)}this.fail("Exception during Client.processUpdates(): "+ex.message);throw(ex);}},registerRestrictionListener:function(component,l){if(!this._inputRestrictionListeners){this._inputRestrictionListeners={}}this._inputRestrictionListeners[component.renderId]=l},removeInputRestriction:function(id){if(this._inputRestrictionMap[id]===undefined){return}delete this._inputRestrictionMap[id];--this._inputRestrictionCount;if(this._inputRestrictionCount===0){this._setWaitVisible(false);if(this._inputRestrictionListeners){var listeners=this._inputRestrictionListeners;this._inputRestrictionListeners=null;for(var x in listeners){listeners[x]()}}}},_setWaitVisible:function(visible){if(visible){if(!this._waitIndicatorActive){this._waitIndicatorActive=true;Core.Web.Scheduler.add(this._waitIndicatorRunnable)}}else{if(this._waitIndicatorActive){this._waitIndicatorActive=false;Core.Web.Scheduler.remove(this._waitIndicatorRunnable);this._waitIndicator.deactivate(this);this.forceRedraw()}}},setWaitIndicator:function(waitIndicator){if(this._waitIndicator){this._setWaitVisible(false);if(this._waitIndicator.dispose){this._waitIndicator.dispose(this)}}this._waitIndicator=waitIndicator},removeElement:function(element){Core.Web.Event.remove(element,"keypress",this._processKeyRef,false);Core.Web.Event.remove(element,"keydown",this._processKeyRef,false);Core.Web.Event.remove(element,"keyup",this._processKeyRef,false)},_waitIndicatorActivate:function(){this._waitIndicator.activate(this)},_windowResizeListener:function(e){if(this.application.rootComponent.peer){Echo.Render.notifyResize(this.application.rootComponent)}}});Echo.Client.Timer=Core.extend({_times:null,_labels:null,$construct:function(){this._times=[new Date().getTime()];this._labels=["Start"]},mark:function(label){this._times.push(new Date().getTime());this._labels.push(label)},toString:function(){var out="";for(var i=1;i<this._times.length;++i){var time=this._times[i]-this._times[i-1];out+=this._labels[i]+":"+time+" "}out+="TOT:"+(this._times[this._times.length-1]-this._times[0])+"ms";return out}});Echo.Client.WaitIndicator=Core.extend({$abstract:{activate:function(client){},deactivate:function(client){}},$virtual:{dispose:null}});Echo.Client.DefaultWaitIndicator=Core.extend(Echo.Client.WaitIndicator,{$construct:function(){this._divElement=document.createElement("div");this._divElement.style.cssText="display: none;z-index:32000;position:absolute;top:30px;right:30px;"+"width:200px;padding:20px;border:1px outset #abcdef;background-color:#abcdef;color:#000000;text-align:center;";this._textNode=document.createTextNode("");this._divElement.appendChild(this._textNode);this._fadeRunnable=new Core.Web.Scheduler.MethodRunnable(Core.method(this,this._tick),50,true);document.body.appendChild(this._divElement)},activate:function(client){if(client.configuration["WaitIndicator.Background"]){this._divElement.style.backgroundColor=client.configuration["WaitIndicator.Background"];this._divElement.style.borderColor=client.configuration["WaitIndicator.Background"]}if(client.configuration["WaitIndicator.Foreground"]){this._divElement.style.color=client.configuration["WaitIndicator.Foreground"]}this._textNode.nodeValue=client.configuration["WaitIndicator.Text"];this._divElement.style.display="block";Core.Web.Scheduler.add(this._fadeRunnable);this._opacity=0},deactivate:function(client){this._divElement.style.display="none";Core.Web.Scheduler.remove(this._fadeRunnable)},dispose:function(client){if(this._divElement&&this._divElement.parentNode){this._divElement.parentNode.removeChild(this._divElement)}this._divElement=null;this._textNode=null},_tick:function(){++this._opacity;var opacityValue=1-(Math.abs((this._opacity%40)-20)/30);if(!Core.Web.Env.PROPRIETARY_IE_OPACITY_FILTER_REQUIRED){this._divElement.style.opacity=opacityValue}}});Echo.Serial={_translatorMap:{},_translatorTypeData:[],addPropertyTranslator:function(className,translator){this._translatorMap[className]=translator},addPropertyTranslatorByType:function(type,translator){this._translatorTypeData.push(type,translator)},getPropertyTranslator:function(className){return this._translatorMap[className]},getPropertyTranslatorByType:function(type){for(var i=0;i<this._translatorTypeData.length;i+=2){if(this._translatorTypeData[i]==type){return this._translatorTypeData[i+1]}}return null},loadComponent:function(client,cElement,propertyMap,styleMap){if(!cElement.nodeName=="c"){throw new Error("Element is not a component.");}var type=cElement.getAttribute("t");var id=cElement.getAttribute("i");var component=Echo.ComponentFactory.newInstance(type,id);var styleData=component.getLocalStyleData();var element=cElement.firstChild;while(element){if(element.nodeType==1){switch(element.nodeName){case"c":var childComponent=this.loadComponent(client,element,propertyMap,styleMap);component.add(childComponent);break;case"p":this.loadProperty(client,element,component,styleData,propertyMap);break;case"s":component.setStyleName(element.firstChild?element.firstChild.nodeValue:null);break;case"sr":component.setStyle(styleMap?styleMap[element.firstChild.nodeValue]:null);break;case"e":this._loadComponentEvent(client,element,component);break;case"en":component.setEnabled(element.firstChild.nodeValue=="true");break;case"locale":component.setLocale(element.firstChild?element.firstChild.nodeValue:null);break;case"dir":component.setLayoutDirection(element.firstChild?(element.firstChild.nodeValue=="rtl"?Echo.LayoutDirection.RTL:Echo.LayoutDirection.LTR):null);break;case"f":if(element.getAttribute("n")){component.focusNextId=element.getAttribute("n")}if(element.getAttribute("p")){component.focusPreviousId=element.getAttribute("p")}}}element=element.nextSibling}return component},_loadComponentEvent:function(client,eventElement,component){if(client.addComponentListener){var eventType=eventElement.getAttribute("t");client.addComponentListener(component,eventType)}},loadProperty:function(client,pElement,object,styleData,propertyMap){var name=pElement.getAttribute("n");var type=pElement.getAttribute("t");var index=pElement.getAttribute("x");var value;if(type){var translator=Echo.Serial._translatorMap[type];if(!translator){throw new Error("Translator not available for property type: "+type);}value=translator.toProperty(client,pElement)}else{if(propertyMap){var propertyReference=pElement.getAttribute("r");if(propertyReference){value=propertyMap[propertyReference]}else{value=Echo.Serial.String.toProperty(client,pElement)}}else{value=Echo.Serial.String.toProperty(client,pElement)}}if(name){if(styleData){if(index==null){styleData[name]=value}else{var indexValues=styleData[name];if(!indexValues){indexValues=[];styleData[name]=indexValues}indexValues[index]=value}}else{if(index==null){object.set(name,value)}else{object.setIndex(name,index,value)}}}else{var propertyMethod=pElement.getAttribute("m");if(index==null){object[propertyMethod](value)}else{object[propertyMethod](index,value)}}},loadStyleSheet:function(client,ssElement,propertyMap){var styleSheet=new Echo.StyleSheet();var ssChild=ssElement.firstChild;while(ssChild){if(ssChild.nodeType==1){if(ssChild.nodeName=="s"){var style={};var sChild=ssChild.firstChild;while(sChild){if(sChild.nodeType==1){if(sChild.nodeName=="p"){this.loadProperty(client,sChild,null,style,propertyMap)}}sChild=sChild.nextSibling}styleSheet.setStyle(ssChild.getAttribute("n")||"",ssChild.getAttribute("t"),style)}}ssChild=ssChild.nextSibling}return styleSheet},storeProperty:function(client,pElement,value){if(value==null){}else if(typeof(value)=="object"){var translator=null;if(value.className){translator=this._translatorMap[value.className]}else{translator=this.getPropertyTranslatorByType(value.constructor)}if(!translator||!translator.toXml){return}translator.toXml(client,pElement,value)}else{pElement.appendChild(pElement.ownerDocument.createTextNode(value.toString()))}}};Echo.Serial.PropertyTranslator=Core.extend({$abstract:true,$static:{toProperty:function(client,pElement){return null},toXml:null}});Echo.Serial.Null=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(client,pElement){return null}},$load:function(){Echo.Serial.addPropertyTranslator("0",this)}});Echo.Serial.Boolean=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(client,pElement){return pElement.firstChild.data=="true"}},$load:function(){Echo.Serial.addPropertyTranslator("b",this)}});Echo.Serial.Integer=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(client,pElement){return parseInt(pElement.firstChild.data,10)}},$load:function(){Echo.Serial.addPropertyTranslator("i",this)}});Echo.Serial.Number=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(client,pElement){return parseFloat(pElement.firstChild.data)}},$load:function(){Echo.Serial.addPropertyTranslator("n",this)}});Echo.Serial.String=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(client,pElement){var textNode=pElement.firstChild;if(!textNode){return""}var text=textNode.data;while(textNode.nextSibling){textNode=textNode.nextSibling;text+=textNode.data}return text}},$load:function(){Echo.Serial.addPropertyTranslator("s",this)}});Echo.Serial.Date=Core.extend(Echo.Serial.PropertyTranslator,{$static:{_expr:/(\d{4})\.(\d{2}).(\d{2})/,toProperty:function(client,pElement){var value=Echo.Serial.String.toProperty(client,pElement);var result=this._expr.exec(value);if(!result){return null}return new Date(result[1],parseInt(result[2],10)-1,result[3])},toXml:function(client,pElement,value){pElement.appendChild(pElement.ownerDocument.createTextNode(value.getFullYear()+"."+(value.getMonth()+1)+"."+value.getDate()))}},$load:function(){Echo.Serial.addPropertyTranslator("d",this);Echo.Serial.addPropertyTranslatorByType(Date,this)}});Echo.Serial.Map=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(client,pElement){var mapObject={};var element=pElement.firstChild;while(element){if(element.nodeType!=1){continue}Echo.Serial.loadProperty(client,element,null,mapObject,null);element=element.nextSibling}return mapObject}},$load:function(){Echo.Serial.addPropertyTranslator("m",this)}});Echo.Serial.Alignment=Core.extend(Echo.Serial.PropertyTranslator,{$static:{_HORIZONTAL_MAP:{"leading":"leading","trailing":"trailing","left":"left","center":"center","right":"right"},_VERTICAL_MAP:{"top":"top","center":"middle","bottom":"bottom"},toProperty:function(client,pElement){var element=Core.Web.DOM.getChildElementByTagName(pElement,"a");var h=this._HORIZONTAL_MAP[element.getAttribute("h")];var v=this._VERTICAL_MAP[element.getAttribute("v")];if(h){if(v){return{horizontal:h,vertical:v}}return h}if(v){return v}return null}},$load:function(){Echo.Serial.addPropertyTranslator("Alignment",this);Echo.Serial.addPropertyTranslator("AL",this)}});Echo.Serial.Border=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(client,pElement){if(pElement.firstChild.nodeType==3){return pElement.firstChild.data}else if(pElement.getAttribute("v")){return pElement.getAttribute("v")}else{var element=Core.Web.DOM.getChildElementByTagName(pElement,"b");var border={};var value=element.getAttribute("t");if(value){border.top=value;value=element.getAttribute("r");if(value){border.right=value;value=element.getAttribute("b");if(value){border.bottom=value;value=element.getAttribute("l");if(value){border.left=value}}}}else{throw new Error("Invalid multi-sided border: no sides set.");}return border}}},$load:function(){Echo.Serial.addPropertyTranslator("Border",this);Echo.Serial.addPropertyTranslator("BO",this)}});Echo.Serial.FillImage=Core.extend(Echo.Serial.PropertyTranslator,{$static:{parseElement:function(client,fiElement){var url=fiElement.getAttribute("u");if(client.decompressUrl){url=client.decompressUrl(url)}var repeat=fiElement.getAttribute("r");var x=fiElement.getAttribute("x");var y=fiElement.getAttribute("y");if(repeat||x||y){return{url:url,repeat:repeat,x:x,y:y}}else{return url}},toProperty:function(client,pElement){var element=Core.Web.DOM.getChildElementByTagName(pElement,"fi");return this.parseElement(client,element)}},$load:function(){Echo.Serial.addPropertyTranslator("FillImage",this);Echo.Serial.addPropertyTranslator("FI",this)}});Echo.Serial.FillImageBorder=Core.extend(Echo.Serial.PropertyTranslator,{$static:{_NAMES:["topLeft","top","topRight","left","right","bottomLeft","bottom","bottomRight"],_parseElement:function(client,fibElement){var fillImageBorder={contentInsets:fibElement.getAttribute("ci")?fibElement.getAttribute("ci"):null,borderInsets:fibElement.getAttribute("bi")?fibElement.getAttribute("bi"):null,color:fibElement.getAttribute("bc")};var element=fibElement.firstChild;var i=0;while(element){if(element.nodeType==1){if(element.nodeName=="fi"){fillImageBorder[this._NAMES[i]]=Echo.Serial.FillImage.parseElement(client,element);++i}else if(element.nodeName=="null-fi"){++i}}element=element.nextSibling}if(!(i===0||i==8)){throw new Error("Invalid FillImageBorder image count: "+i);}return fillImageBorder},toProperty:function(client,pElement){var element=Core.Web.DOM.getChildElementByTagName(pElement,"fib");return Echo.Serial.FillImageBorder._parseElement(client,element)}},$load:function(){Echo.Serial.addPropertyTranslator("FillImageBorder",this);Echo.Serial.addPropertyTranslator("FIB",this)}});Echo.Serial.Font=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(client,pElement){var element=Core.Web.DOM.getChildElementByTagName(pElement,"f");var tfElements=Core.Web.DOM.getChildElementsByTagName(element,"tf");var font={};if(tfElements.length>1){font.typeface=[];for(var i=0;i<tfElements.length;++i){font.typeface[i]=tfElements[i].firstChild.data}}else if(tfElements.length==1){font.typeface=tfElements[0].firstChild.data}var size=element.getAttribute("sz");if(size){font.size=size}if(element.getAttribute("bo")){font.bold=true}if(element.getAttribute("it")){font.italic=true}if(element.getAttribute("un")){font.underline=true}if(element.getAttribute("ov")){font.overline=true}if(element.getAttribute("lt")){font.lineThrough=true}return font}},$load:function(){Echo.Serial.addPropertyTranslator("Font",this);Echo.Serial.addPropertyTranslator("F",this)}});Echo.Serial.ImageReference=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(client,pElement){var url;if(pElement.firstChild.nodeType==1){var iElement=pElement.firstChild;url=iElement.firstChild.data;if(client.decompressUrl){url=client.decompressUrl(url)}var width=iElement.getAttribute("w");width=width?width:null;var height=iElement.getAttribute("h");height=height?height:null;if(width||height){return{url:url,width:width,height:height}}else{return url}}else{url=pElement.firstChild.data;return client.decompressUrl?client.decompressUrl(url):url}}},$load:function(){Echo.Serial.addPropertyTranslator("ImageReference",this);Echo.Serial.addPropertyTranslator("I",this)}});Echo.Serial.LayoutData=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(client,pElement){var layoutData={};var element=pElement.firstChild;while(element){if(element.nodeType==1){if(element.nodeName=="p"){Echo.Serial.loadProperty(client,element,null,layoutData)}}element=element.nextSibling}return layoutData}},$load:function(){Echo.Serial.addPropertyTranslator("LayoutData",this);Echo.Serial.addPropertyTranslator("L",this)}});Echo.FreeClient=Core.extend(Echo.Client,{_processUpdateRef:null,_doRenderRef:null,_resourcePaths:null,_renderPending:false,$construct:function(application,domainElement){Echo.Client.call(this);this._doRenderRef=Core.method(this,this._doRender);this._processUpdateRef=Core.method(this,this._processUpdate);this.configure(application,domainElement);this._processUpdate()},addResourcePath:function(packageName,baseUrl){if(!this._resourcePaths){this._resourcePaths={}}this._resourcePaths[packageName]=baseUrl},dispose:function(){this.application.updateManager.removeUpdateListener(this._processUpdateRef);Echo.Render.renderComponentDispose(null,this.application.rootComponent);Echo.Client.prototype.dispose.call(this)},_doRender:function(){if(this.application){this.processUpdates();this._renderPending=false}},getResourceUrl:function(packageName,resourceName){if(this._resourcePaths&&this._resourcePaths[packageName]){return this._resourcePaths[packageName]+resourceName}else{return Echo.Client.prototype.getResourceUrl.call(this,packageName,resourceName)}},init:function(){Core.Web.init();this.application.updateManager.addUpdateListener(this._processUpdateRef)},loadStyleSheet:function(url){var conn=new Core.Web.HttpConnection(url,"GET");conn.addResponseListener(Core.method(this,this._processStyleSheet));conn.connect()},_processStyleSheet:function(e){if(!e.valid){throw new Error("Received invalid response from StyleSheet HTTP request.");}var ssElement=e.source.getResponseXml().documentElement;var styleSheet=Echo.Serial.loadStyleSheet(this,ssElement);this.application.setStyleSheet(styleSheet)},_processUpdate:function(e){if(!this._renderPending){this._renderPending=true;Core.Web.Scheduler.run(this._doRenderRef)}}});Echo.Arc={};Echo.Arc.Application=Core.extend(Echo.Application,{arcSync:null,isActive:function(){if(!this.arcSync.component.isActive()){return false}else{return Echo.Application.prototype.isActive.call(this)}}});Echo.Arc.Client=Core.extend(Echo.FreeClient,{arcSync:null,verifyInput:function(component,flags){if(!this.arcSync.client.verifyInput(this.arcSync.component,flags)){return false}return Echo.FreeClient.prototype.verifyInput.call(this,component,flags)}});Echo.Arc.ComponentSync=Core.extend(Echo.Render.ComponentSync,{arcApplication:null,arcClient:null,baseComponent:null,_defaultDomainElement:null,_applicationFocusRef:null,$abstract:{createComponent:function(){}},$virtual:{getDomainElement:function(){if(!this._defaultDomainElement){this._defaultDomainElement=document.createElement("div")}return this._defaultDomainElement},_processApplicationFocus:function(e){if(e.source==this.component.application){if(e.newValue!=this.component){this.arcApplication.setFocusedComponent(null)}}else if(e.source==this.arcApplication&&e.newValue){this.component.application.setFocusedComponent(this.component)}},renderAdd:function(update,parentElement){var element=this.getDomainElement();parentElement.appendChild(element)},renderDisplay:function(){if(this.arcApplication){if(!this.baseComponent.peer){return}Echo.Render.renderComponentDisplay(this.baseComponent)}else{this.arcApplication=new Echo.Arc.Application();this.arcApplication.arcSync=this;this.arcApplication.setStyleSheet(this.client.application.getStyleSheet());this.baseComponent=this.createComponent();if(!this.baseComponent){throw new Error("Invalid base component: null");}this.arcApplication.rootComponent.add(this.baseComponent);this.arcClient=new Echo.Arc.Client(this.arcApplication,this.getDomainElement());this.arcClient.arcSync=this;this.arcClient.parent=this.client;this.arcClient.init();this._applicationFocusRef=Core.method(this,this._processApplicationFocus);this.arcApplication.addListener("focus",this._applicationFocusRef);this.client.application.addListener("focus",this._applicationFocusRef)}},renderDispose:function(update){if(this._applicationFocusRef){this.arcApplication.removeListener("focus",this._applicationFocusRef);this.client.application.removeListener("focus",this._applicationFocusRef);this._applicationFocusRef=null}if(this.arcClient){this.arcClient.dispose();this.arcClient=null}if(this.arcApplication){this.arcApplication.arcSync=null;this.arcApplication=null;this.baseComponent=null}this._defaultDomainElement=null},renderHide:function(){if(this.arcApplication){if(!this.baseComponent.peer){return}Echo.Render.renderComponentHide(this.baseComponent)}},renderUpdate:function(update){var domainElement=this.getDomainElement();var containerElement=domainElement.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(domainElement);this.renderAdd(update,containerElement)}}});Echo.Arc.ChildContainer=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("ArcChildContainer",this)},componentType:"ArcChildContainer"});Echo.Arc.ChildContainerPeer=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("ArcChildContainer",this)},renderAdd:function(update,parentElement){this._div=document.createElement("div");var component=this.component.get("component");if(component){if(!component.parent||!component.parent.peer||!component.parent.peer.client){throw new Error("Invalid component: not part of registered hierarchy.");}Echo.Render.renderComponentAdd(null,component,this._div)}parentElement.appendChild(this._div)},renderDisplay:function(){var component=this.component.get("component");if(component){Echo.Render.renderComponentDisplay(component)}},renderDispose:function(update){var component=this.component.get("component");if(component){Echo.Render.renderComponentDispose(null,component)}this._div=null},renderUpdate:function(update){}});Echo.DebugConsole={_installed:false,_rendered:false,_titleDiv:null,_contentDiv:null,_div:null,_logging:false,_maximized:false,_mouseMoveRef:null,_mouseDownRef:null,_addControl:function(text,method){var button=document.createElement("span");button.style.cssText="padding:0 8px 0 0;cursor:pointer;";button.appendChild(document.createTextNode("["+text+"]"));this._controlsDiv.appendChild(button);Core.Web.DOM.addEventListener(button,"click",Core.method(this,method),false)},_clearListener:function(e){while(this._contentDiv.firstChild){this._contentDiv.removeChild(this._contentDiv.firstChild)}},_closeListener:function(e){this._div.style.display="none"},_consoleWrite:function(text){if(!this._logging){return}if(!this._rendered){this._render()}var lineDiv=document.createElement("div");lineDiv.appendChild(document.createTextNode(text));this._contentDiv.appendChild(lineDiv);this._contentDiv.scrollTop=10000000},_keyListener:function(e){e=e?e:window.event;if(!(e.keyCode==67&&e.ctrlKey&&e.altKey)){return}this._logging=true;this.setVisible(!this.isVisible())},install:function(){if(this._installed){return}Core.Web.DOM.addEventListener(document,"keydown",Core.method(this,this._keyListener),false);Core.Debug.consoleWrite=function(text){Echo.DebugConsole._consoleWrite(text)};if(document.URL.toString().indexOf("?debug")!=-1){this.setVisible(true);this._logging=true}this._installed=true},isVisible:function(){if(!this._rendered){return false}return this._div.style.display=="block"},_maximizeListener:function(e){this._maximized=!this._maximized;this._div.style.top="20px";this._div.style.right="20px";this._div.style.left="";this._div.style.bottom="";if(this._maximized){var height=document.height||600;var width=document.width||600;this._div.style.width=(width-50)+"px";this._div.style.height=(height-50)+"px";this._contentDiv.style.width=(width-72)+"px";this._contentDiv.style.height=(height-85)+"px"}else{this._div.style.width="300px";this._div.style.height="300px";this._contentDiv.style.width="278px";this._contentDiv.style.height="265px"}},_render:function(){var button;this._div=document.createElement("div");this._div.id="__DebugConsole__";this._div.style.cssText="display:none;position:absolute;top:20px;right:20px;width:300px;height:300px;background-color:#2f2f3f;"+"border:5px solid #3f6fff;overflow:hidden;z-index:32500;";this._titleDiv=document.createElement("div");this._titleDiv.style.cssText="position:relative;"+"margin:1px;height:20px;padding:3px 10px;background-color:#5f5f8f;color:#ffffff;overflow:hidden;cursor:move;";Core.Web.DOM.addEventListener(this._titleDiv,"mousedown",Core.method(this,this._titleMouseDown),false);Core.Web.Event.Selection.disable(this._titleDiv);this._div.appendChild(this._titleDiv);var titleTextDiv=document.createElement("div");titleTextDiv.style.cssText="position:absolute;font-weight:bold;";titleTextDiv.appendChild(document.createTextNode("Debug Console"));this._titleDiv.appendChild(titleTextDiv);this._controlsDiv=document.createElement("div");this._controlsDiv.style.cssText="position:absolute;right:0;background-color:#5f5f8f;";this._titleDiv.appendChild(this._controlsDiv);this._addControl("C",this._clearListener);this._addControl("^",this._maximizeListener);this._addControl("X",this._closeListener);this._contentDiv=document.createElement("div");this._contentDiv.style.cssText="font-family:monospace;font-size:9px;position:absolute;top:28px;left:1px;"+"width:278px;height:265px;padding:3px 10px;background-color:#1f1f2f;overflow:auto;color:#3fff6f;";this._div.appendChild(this._contentDiv);document.body.appendChild(this._div);this._titleMouseUpRef=Core.method(this,this._titleMouseUp);this._titleMouseMoveRef=Core.method(this,this._titleMouseMove);this._rendered=true},_titleMouseDown:function(e){this._drag={originX:e.clientX,originY:e.clientY,initialX:this._div.offsetLeft,initialY:this._div.offsetTop};Core.Web.DOM.preventEventDefault(e);Core.Web.DOM.addEventListener(document.body,"mouseup",this._titleMouseUpRef,false);Core.Web.DOM.addEventListener(document.body,"mousemove",this._titleMouseMoveRef,false)},_titleMouseMove:function(e){if(!this._drag){return}this._div.style.right=this._div.style.bottom="";this._div.style.top=(e.clientY-this._drag.originY+this._drag.initialY)+"px";this._div.style.left=(e.clientX-this._drag.originX+this._drag.initialX)+"px"},_titleMouseUp:function(e){this._drag=null;Core.Web.DOM.removeEventListener(document.body,"mouseup",this._titleMouseUpRef,false);Core.Web.DOM.removeEventListener(document.body,"mousemove",this._titleMouseMoveRef,false)},setVisible:function(newValue){if(!this._rendered){this._render()}this._div.style.display=newValue?"block":"none"}};Echo.Sync.ArrayContainer=Core.extend(Echo.Render.ComponentSync,{$abstract:{cellElementNodeName:null,renderChildLayoutData:function(child,cellElement){}},$virtual:{prevFocusKey:null,prevFocusFlag:null,nextFocusKey:null,nextFocusFlag:null,invertFocusRtl:false},element:null,containerElement:null,spacingPrototype:null,cellSpacing:null,_childIdToElementMap:null,clientKeyDown:function(e){switch(e.keyCode){case this.prevFocusKey:case this.nextFocusKey:var focusPrevious=e.keyCode==this.prevFocusKey;if(this.invertFocusRtl&&!this.component.getRenderLayoutDirection().isLeftToRight()){focusPrevious=!focusPrevious}var focusedComponent=this.client.application.getFocusedComponent();if(focusedComponent&&focusedComponent.peer&&focusedComponent.peer.getFocusFlags){var focusFlags=focusedComponent.peer.getFocusFlags();if((focusPrevious&&focusFlags&this.prevFocusFlag)||(!focusPrevious&&focusFlags&this.nextFocusFlag)){var focusChild=this.client.application.focusManager.findInParent(this.component,focusPrevious);if(focusChild){this.client.application.setFocusedComponent(focusChild);Core.Web.DOM.preventEventDefault(e.domEvent);return false}}}break}return true},_renderAddChild:function(update,child,index){var cellElement=document.createElement(this.cellElementNodeName);this._childIdToElementMap[child.renderId]=cellElement;Echo.Render.renderComponentAdd(update,child,cellElement);this.renderChildLayoutData(child,cellElement);if(index!=null){var currentChildCount;if(this.containerElement.childNodes.length>=3&&this.cellSpacing){currentChildCount=(this.containerElement.childNodes.length+1)/2}else{currentChildCount=this.containerElement.childNodes.length}if(index==currentChildCount){index=null}}if(index==null||!this.containerElement.firstChild){if(this.cellSpacing&&this.containerElement.firstChild){this.containerElement.appendChild(this.spacingPrototype.cloneNode(false))}this.containerElement.appendChild(cellElement)}else{var insertionIndex=this.cellSpacing?index*2:index;var beforeElement=this.containerElement.childNodes[insertionIndex];this.containerElement.insertBefore(cellElement,beforeElement);if(this.cellSpacing){this.containerElement.insertBefore(this.spacingPrototype.cloneNode(false),beforeElement)}}},renderAddChildren:function(update){this._childIdToElementMap={};var componentCount=this.component.getComponentCount();for(var i=0;i<componentCount;++i){var child=this.component.getComponent(i);this._renderAddChild(update,child)}},renderDispose:function(update){this.element=null;this.containerElement=null;this._childIdToElementMap=null;this.spacingPrototype=null},_renderRemoveChild:function(update,child){var childElement=this._childIdToElementMap[child.renderId];if(!childElement){return}if(this.cellSpacing){if(childElement.previousSibling){this.containerElement.removeChild(childElement.previousSibling)}else if(childElement.nextSibling){this.containerElement.removeChild(childElement.nextSibling)}}this.containerElement.removeChild(childElement);delete this._childIdToElementMap[child.renderId]},renderUpdate:function(update){var i,fullRender=false;if(update.hasUpdatedProperties()||update.hasUpdatedLayoutDataChildren()){fullRender=true}else{var removedChildren=update.getRemovedChildren();if(removedChildren){for(i=0;i<removedChildren.length;++i){this._renderRemoveChild(update,removedChildren[i])}}var addedChildren=update.getAddedChildren();if(addedChildren){for(i=0;i<addedChildren.length;++i){this._renderAddChild(update,addedChildren[i],this.component.indexOf(addedChildren[i]))}}}if(fullRender){var element=this.element;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement)}return fullRender}});Echo.Sync.Column=Core.extend(Echo.Sync.ArrayContainer,{$load:function(){Echo.Render.registerPeer("Column",this)},cellElementNodeName:"div",prevFocusKey:38,prevFocusFlag:Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_UP,nextFocusKey:40,nextFocusFlag:Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_DOWN,renderAdd:function(update,parentElement){this.element=this.containerElement=document.createElement("div");this.element.id=this.component.renderId;this.element.style.outlineStyle="none";this.element.tabIndex="-1";Echo.Sync.renderComponentDefaults(this.component,this.element);Echo.Sync.Border.render(this.component.render("border"),this.element);Echo.Sync.Insets.render(this.component.render("insets"),this.element,"padding");this.cellSpacing=Echo.Sync.Extent.toPixels(this.component.render("cellSpacing"),false);if(this.cellSpacing){this.spacingPrototype=document.createElement("div");this.spacingPrototype.style.height=this.cellSpacing+"px";this.spacingPrototype.style.fontSize="1px";this.spacingPrototype.style.lineHeight="0"}this.renderAddChildren(update);parentElement.appendChild(this.element)},renderChildLayoutData:function(child,cellElement){var layoutData=child.render("layoutData");if(layoutData){Echo.Sync.Color.render(layoutData.background,cellElement,"backgroundColor");Echo.Sync.FillImage.render(layoutData.backgroundImage,cellElement);Echo.Sync.Insets.render(layoutData.insets,cellElement,"padding");Echo.Sync.Alignment.render(layoutData.alignment,cellElement,true,this.component);if(layoutData.height){cellElement.style.height=Echo.Sync.Extent.toPixels(layoutData.height,false)+"px"}}}});Echo.Sync.Row=Core.extend(Echo.Sync.ArrayContainer,{$static:{_createRowPrototype:function(){var div=document.createElement("div");div.style.outlineStyle="none";div.tabIndex="-1";var table=document.createElement("table");table.style.borderCollapse="collapse";div.appendChild(table);var tbody=document.createElement("tbody");table.appendChild(tbody);tbody.appendChild(document.createElement("tr"));return div},_rowPrototype:null},$load:function(){this._rowPrototype=this._createRowPrototype();Echo.Render.registerPeer("Row",this)},cellElementNodeName:"td",prevFocusKey:37,prevFocusFlag:Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_LEFT,nextFocusKey:39,nextFocusFlag:Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_RIGHT,invertFocusRtl:true,renderAdd:function(update,parentElement){this.element=Echo.Sync.Row._rowPrototype.cloneNode(true);this.element.id=this.component.renderId;Echo.Sync.renderComponentDefaults(this.component,this.element);Echo.Sync.Border.render(this.component.render("border"),this.element);Echo.Sync.Insets.render(this.component.render("insets"),this.element,"padding");Echo.Sync.Alignment.render(this.component.render("alignment"),this.element,true,this.component);this.containerElement=this.element.firstChild.firstChild.firstChild;this.cellSpacing=Echo.Sync.Extent.toPixels(this.component.render("cellSpacing"),false);if(this.cellSpacing){this.spacingPrototype=document.createElement("td");this.spacingPrototype.style.padding=0;this.spacingPrototype.style.width=this.cellSpacing+"px"}this.renderAddChildren(update);parentElement.appendChild(this.element)},renderChildLayoutData:function(child,cellElement){var layoutData=child.render("layoutData");var insets;if(layoutData){insets=layoutData.insets;Echo.Sync.Color.render(layoutData.background,cellElement,"backgroundColor");Echo.Sync.FillImage.render(layoutData.backgroundImage,cellElement);Echo.Sync.Alignment.render(layoutData.alignment,cellElement,true,this.component);if(layoutData.width){if(Echo.Sync.Extent.isPercent(layoutData.width)){cellElement.style.width=layoutData.width;if(this.element.firstChild.style.width!="100%"){this.element.firstChild.style.width="100%"}}else{cellElement.style.width=Echo.Sync.Extent.toPixels(layoutData.width,true)+"px"}}}if(!insets){insets=0}Echo.Sync.Insets.render(insets,cellElement,"padding")}});Echo.Sync.Button=Core.extend(Echo.Render.ComponentSync,{$static:{_defaultIconTextMargin:5,_prototypeButton:null,_createPrototypeButton:function(){var div=document.createElement("div");div.tabIndex="0";div.style.outlineStyle="none";div.style.cursor="pointer";return div}},$load:function(){this._prototypeButton=this._createPrototypeButton();Echo.Render.registerPeer("Button",this)},enabled:null,div:null,_textElement:null,iconImg:null,_processRolloverExitRef:null,_processInitEventRef:null,_focused:false,$construct:function(){this._processInitEventRef=Core.method(this,this._processInitEvent)},$virtual:{doAction:function(){this.component.doAction()},renderContent:function(){var text=this.component.render("text");var icon=Echo.Sync.getEffectProperty(this.component,"icon","disabledIcon",!this.enabled);if(text!=null){if(icon){var iconTextMargin=this.component.render("iconTextMargin",Echo.Sync.Button._defaultIconTextMargin);var orientation=Echo.Sync.TriCellTable.getOrientation(this.component,"textPosition");var tct=new Echo.Sync.TriCellTable(orientation,Echo.Sync.Extent.toPixels(iconTextMargin));this.renderButtonText(tct.tdElements[0],text);this.iconImg=this.renderButtonIcon(tct.tdElements[1],icon);this.div.appendChild(tct.tableElement)}else{this.renderButtonText(this.div,text)}}else if(icon){this.iconImg=this.renderButtonIcon(this.div,icon)}},setPressedState:function(pressedState){var foreground=Echo.Sync.getEffectProperty(this.component,"foreground","pressedForeground",pressedState);var background=Echo.Sync.getEffectProperty(this.component,"background","pressedBackground",pressedState);var backgroundImage=Echo.Sync.getEffectProperty(this.component,"backgroundImage","pressedBackgroundImage",pressedState);var font=Echo.Sync.getEffectProperty(this.component,"font","pressedFont",pressedState);var border=Echo.Sync.getEffectProperty(this.component,"border","pressedBorder",pressedState);Echo.Sync.Color.renderClear(foreground,this.div,"color");Echo.Sync.Color.renderClear(background,this.div,"backgroundColor");Echo.Sync.FillImage.renderClear(backgroundImage,this.div,"backgroundColor");Echo.Sync.Border.renderClear(border,this.div);if(this._textElement){Echo.Sync.Font.renderClear(font,this._textElement)}if(this.iconImg){var iconUrl=Echo.Sync.ImageReference.getUrl(Echo.Sync.getEffectProperty(this.component,"icon","pressedIcon",pressedState));if(iconUrl!=this.iconImg.src){this.iconImg.src=iconUrl}}},setRolloverState:function(rolloverState){var foreground=Echo.Sync.getEffectProperty(this.component,"foreground","rolloverForeground",rolloverState);var background=Echo.Sync.getEffectProperty(this.component,"background","rolloverBackground",rolloverState);var backgroundImage=Echo.Sync.getEffectProperty(this.component,"backgroundImage","rolloverBackgroundImage",rolloverState);var font=Echo.Sync.getEffectProperty(this.component,"font","rolloverFont",rolloverState);var border=Echo.Sync.getEffectProperty(this.component,"border","rolloverBorder",rolloverState);Echo.Sync.Color.renderClear(foreground,this.div,"color");Echo.Sync.Color.renderClear(background,this.div,"backgroundColor");Echo.Sync.FillImage.renderClear(backgroundImage,this.div,"backgroundColor");Echo.Sync.Border.renderClear(border,this.div);if(this._textElement){Echo.Sync.Font.renderClear(font,this._textElement)}if(this.iconImg){var iconUrl=Echo.Sync.ImageReference.getUrl(Echo.Sync.getEffectProperty(this.component,"icon","rolloverIcon",rolloverState));if(iconUrl!=this.iconImg.src){this.iconImg.src=iconUrl}}}},_addEventListeners:function(){this._processRolloverExitRef=Core.method(this,this._processRolloverExit);Core.Web.Event.remove(this.div,"focus",this._processInitEventRef);Core.Web.Event.remove(this.div,"mouseover",this._processInitEventRef);Core.Web.Event.add(this.div,"click",Core.method(this,this._processClick),false);if(this.component.render("rolloverEnabled")){Core.Web.Event.add(this.div,Core.Web.Env.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED?"mouseenter":"mouseover",Core.method(this,this._processRolloverEnter),false);Core.Web.Event.add(this.div,Core.Web.Env.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED?"mouseleave":"mouseout",Core.method(this,this._processRolloverExit),false)}if(this.component.render("pressedEnabled")){Core.Web.Event.add(this.div,"mousedown",Core.method(this,this._processPress),false);Core.Web.Event.add(this.div,"mouseup",Core.method(this,this._processRelease),false)}Core.Web.Event.add(this.div,"focus",Core.method(this,this._processFocus),false);Core.Web.Event.add(this.div,"blur",Core.method(this,this._processBlur),false);Core.Web.Event.Selection.disable(this.div)},clientKeyDown:function(e){if(!this.client||!this.client.verifyInput(this.component)){return true}if(e.keyCode==13){this.doAction();return false}else{return true}},getFocusFlags:function(){return Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_ALL},_processBlur:function(e){this._renderFocusStyle(false)},_processClick:function(e){if(!this.client||!this.client.verifyInput(this.component)){return true}this.client.application.setFocusedComponent(this.component);this.doAction()},_processFocus:function(e){if(!this.client||!this.client.verifyInput(this.component)){return true}this.client.application.setFocusedComponent(this.component)},_processInitEvent:function(e){this._addEventListeners();switch(e.type){case"focus":this._processFocus(e);break;case"mouseover":if(this.component.render("rolloverEnabled")){this._processRolloverEnter(e)}break}},_processPress:function(e){if(!this.client||!this.client.verifyInput(this.component)){return true}Core.Web.DOM.preventEventDefault(e);this.setPressedState(true)},_processRelease:function(e){if(!this.client){return true}this.setPressedState(false)},_processRolloverEnter:function(e){if(!this.client||!this.client.verifyInput(this.component)||Core.Web.dragInProgress){return true}this.client.application.addListener("focus",this._processRolloverExitRef);this.setRolloverState(true);return true},_processRolloverExit:function(e){if(!this.client||!this.client.application){return true}if(this._processRolloverExitRef){this.client.application.removeListener("focus",this._processRolloverExitRef)}this.setRolloverState(false);return true},renderAdd:function(update,parentElement){this.enabled=this.component.isRenderEnabled();this.div=Echo.Sync.Button._prototypeButton.cloneNode(false);this.div.id=this.component.renderId;Echo.Sync.LayoutDirection.render(this.component.getLayoutDirection(),this.div);if(this.enabled){Echo.Sync.Color.renderFB(this.component,this.div);Echo.Sync.Border.render(this.component.render("border"),this.div);Echo.Sync.FillImage.render(this.component.render("backgroundImage"),this.div)}else{Echo.Sync.Color.render(Echo.Sync.getEffectProperty(this.component,"foreground","disabledForeground",true),this.div,"color");Echo.Sync.Color.render(Echo.Sync.getEffectProperty(this.component,"background","disabledBackground",true),this.div,"backgroundColor");Echo.Sync.Border.render(Echo.Sync.getEffectProperty(this.component,"border","disabledBorder",true),this.div);Echo.Sync.FillImage.render(Echo.Sync.getEffectProperty(this.component,"backgroundImage","disabledBackgroundImage",true),this.div)}Echo.Sync.Insets.render(this.component.render("insets"),this.div,"padding");Echo.Sync.Alignment.render(this.component.render("alignment"),this.div,true,this.component);var toolTipText=this.component.render("toolTipText");if(toolTipText){this.div.title=toolTipText}var width=this.component.render("width");if(width){this.div.style.width=Echo.Sync.Extent.toCssValue(width,true,true)}var height=this.component.render("height");if(height){this.div.style.height=Echo.Sync.Extent.toCssValue(height,false);this.div.style.overflow="hidden"}this.renderContent();if(this.enabled){Core.Web.Event.add(this.div,"focus",this._processInitEventRef,false);Core.Web.Event.add(this.div,"mouseover",this._processInitEventRef,false)}parentElement.appendChild(this.div)},renderButtonText:function(element,text){this._textElement=element;var textAlignment=this.component.render("textAlignment");if(textAlignment){Echo.Sync.Alignment.render(textAlignment,element,true,this.component)}if(this.enabled){Echo.Sync.Font.render(this.component.render("font"),this._textElement)}else{Echo.Sync.Font.render(Echo.Sync.getEffectProperty(this.component,"font","disabledFont",true),this._textElement)}element.appendChild(document.createTextNode(text));if(!this.component.render("lineWrap",true)){element.style.whiteSpace="nowrap"}},renderButtonIcon:function(element,icon){var alignment=this.component.render("alignment");if(alignment){Echo.Sync.Alignment.render(alignment,element,true,this.component)}var imgElement=document.createElement("img");Echo.Sync.ImageReference.renderImg(icon,imgElement);element.appendChild(imgElement);return imgElement},renderDispose:function(update){if(this._processRolloverExitRef){this.client.application.removeListener("focus",this._processRolloverExitRef)}Core.Web.Event.removeAll(this.div);this._focused=false;this.div=null;this._textElement=null;this.iconImg=null},renderFocus:function(){if(this._focused){return}this._renderFocusStyle(true);Core.Web.DOM.focusElement(this.div)},renderUpdate:function(update){var element=this.div;var containerElement=element.parentNode;this.renderDispose(update);containerElement.removeChild(element);this.renderAdd(update,containerElement);return false},_renderFocusStyle:function(focusState){if(this._focused==focusState){return}this._focused=focusState;var background;if(!this.component.render("focusedEnabled")){background=this.component.render("background");if(background!=null){var newBackground=focusState?Echo.Sync.Color.adjust(background,0x20,0x20,0x20):background;Echo.Sync.Color.render(newBackground,this.div,"backgroundColor")}return}else{var foreground=Echo.Sync.getEffectProperty(this.component,"foreground","focusedForeground",focusState);background=Echo.Sync.getEffectProperty(this.component,"background","focusedBackground",focusState);var backgroundImage=Echo.Sync.getEffectProperty(this.component,"backgroundImage","focusedBackgroundImage",focusState);var font=Echo.Sync.getEffectProperty(this.component,"font","focusedFont",focusState);var border=Echo.Sync.getEffectProperty(this.component,"border","focusedBorder",focusState);Echo.Sync.Color.renderClear(foreground,this.div,"color");Echo.Sync.Color.renderClear(background,this.div,"backgroundColor");Echo.Sync.FillImage.renderClear(backgroundImage,this.div,"backgroundColor");Echo.Sync.Border.renderClear(border,this.div);if(this._textElement){Echo.Sync.Font.renderClear(font,this._textElement)}if(this.iconImg){var iconUrl=Echo.Sync.ImageReference.getUrl(Echo.Sync.getEffectProperty(this.component,"icon","focusedIcon",focusState));if(iconUrl!=this.iconImg.src){this.iconImg.src=iconUrl}}}}});Echo.Sync.Composite=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Composite",this)},div:null,contentDiv:null,$virtual:{renderStyle:function(){Echo.Sync.renderComponentDefaults(this.component,this.div)}},renderAdd:function(update,parentElement){this.div=this.contentDiv=document.createElement("div");this.div.id=this.component.renderId;if(this.component.children.length!==0){this.renderStyle();Echo.Render.renderComponentAdd(update,this.component.children[0],this.contentDiv)}parentElement.appendChild(this.div)},renderDispose:function(update){this.div=null},renderUpdate:function(update){var element=this.div;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement);return true}});Echo.Sync.Panel=Core.extend(Echo.Sync.Composite,{$load:function(){Echo.Render.registerPeer("Panel",this)},renderDisplay:function(){if(this._imageBorder){Echo.Sync.FillImageBorder.renderContainerDisplay(this.div)}},renderStyle:function(){this._imageBorder=this.component.render("imageBorder");var child=this.component.children.length!==0?this.component.children[0]:null;var width=this.component.render("width");var height=this.component.render("height");if(Echo.Sync.Extent.isPercent(height)){height=null}if(child&&child.pane){this.div.style.position="relative";if(!height){height="10em"}}if(width||height){this.contentDiv.style.overflow="hidden";if(height&&this._imageBorder){var insetsPx=Echo.Sync.Insets.toPixels(this._imageBorder.contentInsets);var contentHeight=Echo.Sync.Extent.toPixels(height)-insetsPx.top-insetsPx.bottom;if(!child||!child.pane){insetsPx=Echo.Sync.Insets.toPixels(this.component.render("insets"));contentHeight-=insetsPx.top+insetsPx.bottom}this.contentDiv.style.height=contentHeight+"px"}}if(this._imageBorder){this.div=Echo.Sync.FillImageBorder.renderContainer(this._imageBorder,{child:this.contentDiv})}else{Echo.Sync.Border.render(this.component.render("border"),this.contentDiv)}Echo.Sync.renderComponentDefaults(this.component,this.contentDiv);if(!child||!child.pane){Echo.Sync.Insets.render(this.component.render("insets"),this.contentDiv,"padding")}Echo.Sync.Alignment.render(this.component.render("alignment"),this.contentDiv,true,this.component);Echo.Sync.FillImage.render(this.component.render("backgroundImage"),this.contentDiv);Echo.Sync.Extent.render(width,this.div,"width",true,true);Echo.Sync.Extent.render(height,this.div,"height",false,false)}});Echo.Sync.ContentPane=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("ContentPane",this)},_floatingPaneStack:null,_zIndexRenderRequired:false,$construct:function(){this._floatingPaneStack=[]},getSize:function(){return new Core.Web.Measure.Bounds(this._div)},raise:function(child){if(this._floatingPaneStack[this._floatingPaneStack.length-1]==child){return}Core.Arrays.remove(this._floatingPaneStack,child);this._floatingPaneStack.push(child);this._renderFloatingPaneZIndices();this._storeFloatingPaneZIndices()},renderAdd:function(update,parentElement){var i;this._div=document.createElement("div");this._div.id=this.component.renderId;this._div.style.position="absolute";this._div.style.width="100%";this._div.style.height="100%";this._div.style.overflow="hidden";this._div.style.zIndex="0";Echo.Sync.renderComponentDefaults(this.component,this._div);var background=this.component.render("background");var backgroundImage=this.component.render("backgroundImage");Echo.Sync.FillImage.render(backgroundImage,this._div);if(!background&&!backgroundImage){Echo.Sync.FillImage.render(this.client.getResourceUrl("Echo","resource/Transparent.gif"),this._div)}this._childIdToElementMap={};var componentCount=this.component.getComponentCount();for(i=0;i<componentCount;++i){var child=this.component.getComponent(i);this._renderAddChild(update,child)}this._pendingScrollX=this.component.render("horizontalScroll");this._pendingScrollY=this.component.render("verticalScroll");parentElement.appendChild(this._div);if(this._zIndexRenderRequired){this._renderFloatingPaneZIndices()}},_renderAddChild:function(update,child){var childDiv=document.createElement("div");this._childIdToElementMap[child.renderId]=childDiv;childDiv.style.position="absolute";if(child.floatingPane){var zIndex=child.render("zIndex");if(zIndex!=null){var added=false;var i=0;while(i<this._floatingPaneStack.length&&!added){var testZIndex=this._floatingPaneStack[i].render("zIndex");if(testZIndex!=null&&testZIndex>zIndex){this._floatingPaneStack.splice(i,0,child);added=true}++i}if(!added){this._floatingPaneStack.push(child)}}else{this._floatingPaneStack.push(child)}childDiv.style.zIndex="1";childDiv.style.left=childDiv.style.top=0;this._zIndexRenderRequired=true}else{var insets=this.component.render("insets",0);var pixelInsets=Echo.Sync.Insets.toPixels(insets);childDiv.style.zIndex="0";childDiv.style.left=pixelInsets.left+"px";childDiv.style.top=pixelInsets.top+"px";childDiv.style.bottom=pixelInsets.bottom+"px";childDiv.style.right=pixelInsets.right+"px";if(child.pane){childDiv.style.overflow="hidden"}else{switch(this.component.render("overflow")){case Echo.ContentPane.OVERFLOW_HIDDEN:childDiv.style.overflow="hidden";break;case Echo.ContentPane.OVERFLOW_SCROLL:childDiv.style.overflow="scroll";break;default:childDiv.style.overflow="auto";break}}}Echo.Render.renderComponentAdd(update,child,childDiv);this._div.appendChild(childDiv)},renderDisplay:function(){var child=this._div.firstChild;while(child){Core.Web.VirtualPosition.redraw(child);child=child.nextSibling}if(this._pendingScrollX||this._pendingScrollY){var componentCount=this.component.getComponentCount();for(var i=0;i<componentCount;++i){child=this.component.getComponent(i);if(!child.floatingPane){var contentElement=this._childIdToElementMap[child.renderId];var position,percent;if(this._pendingScrollX){var x=Echo.Sync.Extent.toPixels(this._pendingScrollX);if(Echo.Sync.Extent.isPercent(this._pendingScrollX)||x<0){percent=x<0?100:parseInt(this._pendingScrollX,10);position=Math.round((contentElement.scrollWidth-contentElement.offsetWidth)*percent/100);if(position>0){contentElement.scrollLeft=position;if(Core.Web.Env.ENGINE_MSHTML){position=Math.round((contentElement.scrollWidth-contentElement.offsetWidth)*percent/100);contentElement.scrollLeft=position}}}else{contentElement.scrollLeft=x}this._pendingScrollX=null}if(this._pendingScrollY){var y=Echo.Sync.Extent.toPixels(this._pendingScrollY);if(Echo.Sync.Extent.isPercent(this._pendingScrollY)||y<0){percent=y<0?100:parseInt(this._pendingScrollY,10);position=Math.round((contentElement.scrollHeight-contentElement.offsetHeight)*percent/100);if(position>0){contentElement.scrollTop=position;if(Core.Web.Env.ENGINE_MSHTML){position=Math.round((contentElement.scrollHeight-contentElement.offsetHeight)*percent/100);contentElement.scrollTop=position}}}else{contentElement.scrollTop=y}this._pendingScrollY=null}break}}}},renderDispose:function(update){this._childIdToElementMap=null;this._div=null},_renderFloatingPaneZIndices:function(){for(var i=0;i<this._floatingPaneStack.length;++i){var childElement=this._childIdToElementMap[this._floatingPaneStack[i].renderId];childElement.style.zIndex=2+i}this._zIndexRenderRequired=false},_renderRemoveChild:function(update,child){if(child.floatingPane){Core.Arrays.remove(this._floatingPaneStack,child)}var childDiv=this._childIdToElementMap[child.renderId];if(!childDiv){return}childDiv.parentNode.removeChild(childDiv);delete this._childIdToElementMap[child.renderId]},renderUpdate:function(update){var i,fullRender=false;if(update.hasUpdatedProperties()||update.hasUpdatedLayoutDataChildren()){fullRender=true}else{var removedChildren=update.getRemovedChildren();if(removedChildren){for(i=0;i<removedChildren.length;++i){this._renderRemoveChild(update,removedChildren[i])}}var addedChildren=update.getAddedChildren();update.renderContext.displayRequired=[];if(addedChildren){for(i=0;i<addedChildren.length;++i){if(!addedChildren[i].floatingPane){update.renderContext.displayRequired=null}this._renderAddChild(update,addedChildren[i],this.component.indexOf(addedChildren[i]));if(update.renderContext.displayRequired){update.renderContext.displayRequired.push(addedChildren[i])}}if(this._zIndexRenderRequired){this._renderFloatingPaneZIndices()}}}if(fullRender){this._floatingPaneStack=[];var element=this._div;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement)}return fullRender},_storeFloatingPaneZIndices:function(){for(var i=0;i<this._floatingPaneStack.length;++i){this._floatingPaneStack[i].set("zIndex",i)}}});Echo.Sync.Grid=Core.extend(Echo.Render.ComponentSync,{$static:{_createPrototypeTable:function(){var table=document.createElement("table");table.style.outlineStyle="none";table.tabIndex="-1";table.style.borderCollapse="collapse";var colGroup=document.createElement("colgroup");table.appendChild(colGroup);table.appendChild(document.createElement("tbody"));return table},Processor:Core.extend({$static:{Cell:Core.extend({xSpan:null,ySpan:null,index:null,component:null,$construct:function(component,index,xSpan,ySpan){this.component=component;this.index=index;this.xSpan=xSpan;this.ySpan=ySpan}})},cellArrays:null,grid:null,gridXSize:null,gridYSize:null,xExtents:null,yExtents:null,horizontalOrientation:null,$construct:function(grid){this.grid=grid;this.cellArrays=[];this.horizontalOrientation=grid.render("orientation")!=Echo.Grid.ORIENTATION_VERTICAL;var cells=this.createCells();if(cells==null){this.gridXSize=0;this.gridYSize=0;return}this.renderCellMatrix(cells);this.calculateExtents();this.reduceY();this.reduceX()},addExtents:function(a,b,horizontal){var ap=Echo.Sync.Extent.isPercent(a),bp=Echo.Sync.Extent.isPercent(b);if(ap||bp){if(ap&&bp){return(parseFloat(a)+parseFloat(b))+"%"}else{return ap?a:b}}else{return Echo.Sync.Extent.toPixels(a)+Echo.Sync.Extent.toPixels(b)}},calculateExtents:function(){var i,xProperty=this.horizontalOrientation?"columnWidth":"rowHeight",yProperty=this.horizontalOrientation?"rowHeight":"columnWidth";this.xExtents=[];for(i=0;i<this.gridXSize;++i){this.xExtents.push(this.grid.renderIndex(xProperty,i))}this.yExtents=[];for(i=0;i<this.gridYSize;++i){this.yExtents.push(this.grid.renderIndex(yProperty,i))}},createCells:function(){var childCount=this.grid.getComponentCount();if(childCount===0){return null}var cells=[];for(var i=0;i<childCount;++i){var child=this.grid.getComponent(i);var layoutData=child.render("layoutData");if(layoutData){var xSpan=this.horizontalOrientation?layoutData.columnSpan:layoutData.rowSpan;var ySpan=this.horizontalOrientation?layoutData.rowSpan:layoutData.columnSpan;cells.push(new Echo.Sync.Grid.Processor.Cell(child,i,xSpan?xSpan:1,ySpan?ySpan:1))}else{cells.push(new Echo.Sync.Grid.Processor.Cell(child,i,1,1))}}return cells},_getCellArray:function(y){while(y>=this.cellArrays.length){this.cellArrays.push([])}return this.cellArrays[y]},getColumnCount:function(){return this.horizontalOrientation?this.gridXSize:this.gridYSize},getCell:function(column,row){if(this.horizontalOrientation){return this.cellArrays[row][column]}else{return this.cellArrays[column][row]}},getRowCount:function(){return this.horizontalOrientation?this.gridYSize:this.gridXSize},reduceX:function(){var xRemoves=[],x=1,y,length=this.cellArrays[0].length;while(x<length){y=0;var identical=true;while(y<this.cellArrays.length){if(this.cellArrays[y][x]!=this.cellArrays[y][x-1]){identical=false;break}++y}if(identical){xRemoves[x]=true}++x}if(xRemoves.length===0){return}for(var removedX=this.gridXSize-1;removedX>=1;--removedX){if(!xRemoves[removedX]){continue}for(y=0;y<this.gridYSize;++y){if(y===0||this.cellArrays[y][removedX-1]!=this.cellArrays[y-1][removedX-1]){if(this.cellArrays[y][removedX-1]!=null){--this.cellArrays[y][removedX-1].xSpan}}this.cellArrays[y].splice(removedX,1)}var removedXExtent=this.xExtents.splice(removedX,1)[0];if(removedXExtent){this.xExtents[removedX-1]=this.addExtents(this.xExtents[removedX-1],removedXExtent,this.horizontalOrientation?true:false)}--this.gridXSize}},reduceY:function(){var yRemoves=[],y=1,x,size=this.cellArrays.length,previousCellArray,currentCellArray=this.cellArrays[0];while(y<size){previousCellArray=currentCellArray;currentCellArray=this.cellArrays[y];x=0;var identical=true;while(x<currentCellArray.length){if(currentCellArray[x]!=previousCellArray[x]){identical=false;break}++x}if(identical){yRemoves[y]=true}++y}if(yRemoves.length===0){return}for(var removedY=this.gridYSize-1;removedY>=0;--removedY){if(!yRemoves[removedY]){continue}var retainedCellArray=this.cellArrays[removedY-1];for(x=0;x<this.gridXSize;++x){if(x===0||retainedCellArray[x]!=retainedCellArray[x-1]){if(retainedCellArray[x]!=null){--retainedCellArray[x].ySpan}}}this.cellArrays.splice(removedY,1);var removedYExtent=this.yExtents.splice(removedY,1)[0];if(removedYExtent){this.yExtents[removedY-1]=this.addExtents(this.yExtents[removedY-1],removedYExtent,this.horizontalOrientation?false:true)}--this.gridYSize}},renderCellMatrix:function(cells){this.gridXSize=parseInt(this.grid.render("size",2),10);var x=0,y=0,xIndex,yIndex,yCells=this._getCellArray(y);for(var componentIndex=0;componentIndex<cells.length;++componentIndex){if(cells[componentIndex].xSpan==Echo.Grid.SPAN_FILL||cells[componentIndex].xSpan>this.gridXSize-x){cells[componentIndex].xSpan=this.gridXSize-x}if(cells[componentIndex].xSpan<1){cells[componentIndex].xSpan=1}if(cells[componentIndex].ySpan<1){cells[componentIndex].ySpan=1}if(cells[componentIndex].xSpan!=1||cells[componentIndex].ySpan!=1){for(xIndex=1;xIndex<cells[componentIndex].xSpan;++xIndex){if(yCells[x+xIndex]!=null){cells[componentIndex].xSpan=xIndex;break}}for(yIndex=0;yIndex<cells[componentIndex].ySpan;++yIndex){var yIndexCells=this._getCellArray(y+yIndex);for(xIndex=0;xIndex<cells[componentIndex].xSpan;++xIndex){yIndexCells[x+xIndex]=cells[componentIndex]}}}yCells[x]=cells[componentIndex];if(componentIndex<cells.length-1){var nextRenderPointFound=false;while(!nextRenderPointFound){if(x<this.gridXSize-1){++x}else{x=0;++y;yCells=this._getCellArray(y)}nextRenderPointFound=yCells[x]==null}}}this.gridYSize=this.cellArrays.length}})},$load:function(){this._prototypeTable=this._createPrototypeTable();Echo.Render.registerPeer("Grid",this)},_columnCount:null,_rowCount:null,clientKeyDown:function(e){var focusPrevious,focusedComponent,focusFlags,focusChild;switch(e.keyCode){case 37:case 39:focusPrevious=this.component.getRenderLayoutDirection().isLeftToRight()?e.keyCode==37:e.keyCode==39;focusedComponent=this.client.application.getFocusedComponent();if(focusedComponent&&focusedComponent.peer&&focusedComponent.peer.getFocusFlags){focusFlags=focusedComponent.peer.getFocusFlags();if((focusPrevious&&focusFlags&Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_LEFT)||(!focusPrevious&&focusFlags&Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_RIGHT)){focusChild=this.client.application.focusManager.findInParent(this.component,focusPrevious);if(focusChild){this.client.application.setFocusedComponent(focusChild);Core.Web.DOM.preventEventDefault(e.domEvent);return false}}}break;case 38:case 40:focusPrevious=e.keyCode==38;focusedComponent=this.client.application.getFocusedComponent();if(focusedComponent&&focusedComponent.peer&&focusedComponent.peer.getFocusFlags){focusFlags=focusedComponent.peer.getFocusFlags();if((focusPrevious&&focusFlags&Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_UP)||(!focusPrevious&&focusFlags&Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_DOWN)){focusChild=this.client.application.focusManager.findInParent(this.component,focusPrevious,this._columnCount);if(focusChild){this.client.application.setFocusedComponent(focusChild);Core.Web.DOM.preventEventDefault(e.domEvent);return false}}}break}return true},renderAdd:function(update,parentElement){var gridProcessor=new Echo.Sync.Grid.Processor(this.component),defaultInsets=Echo.Sync.Insets.toCssValue(this.component.render("insets",0)),defaultPixelInsets,defaultBorder=this.component.render("border",""),width=this.component.render("width"),height=this.component.render("height"),td,columnIndex;defaultPixelInsets=Echo.Sync.Insets.toPixels(defaultInsets);this._columnCount=gridProcessor.getColumnCount();this._rowCount=gridProcessor.getRowCount();this._table=Echo.Sync.Grid._prototypeTable.cloneNode(true);this._table.id=this.component.renderId;Echo.Sync.renderComponentDefaults(this.component,this._table);Echo.Sync.Border.render(defaultBorder,this._table);this._table.style.padding=defaultInsets;if(width&&Core.Web.Env.QUIRK_IE_TABLE_PERCENT_WIDTH_SCROLLBAR_ERROR&&Echo.Sync.Extent.isPercent(width)){this._renderPercentWidthByMeasure=parseInt(width,10);width=null}if(width){if(Echo.Sync.Extent.isPercent(width)){this._table.style.width=width}else{this._table.style.width=Echo.Sync.Extent.toCssValue(width,true)}}if(height){if(Echo.Sync.Extent.isPercent(height)){this._table.style.height=height}else{this._table.style.height=Echo.Sync.Extent.toCssValue(height,false)}}var colGroup=this._table.firstChild;for(columnIndex=0;columnIndex<this._columnCount;++columnIndex){var col=document.createElement("col");width=gridProcessor.xExtents[columnIndex];if(width!=null){if(Echo.Sync.Extent.isPercent(width)){col.style.width=width.toString()}else{var widthValue=Echo.Sync.Extent.toPixels(width,true);if(Core.Web.Env.QUIRK_TABLE_CELL_WIDTH_EXCLUDES_PADDING){widthValue-=defaultPixelInsets.left+defaultPixelInsets.right;if(widthValue<0){widthValue=0}}col.style.width=widthValue+"px"}}colGroup.appendChild(col)}var tbody=colGroup.nextSibling;var size=parseInt(this.component.render("size",2),10);var tr;var renderedComponentIds={};var xSpan,ySpan;if(gridProcessor.horizontalOrientation){xSpan="colSpan";ySpan="rowSpan"}else{xSpan="rowSpan";ySpan="colSpan"}var tdPrototype=document.createElement("td");Echo.Sync.Border.render(defaultBorder,tdPrototype);tdPrototype.style.padding=defaultInsets;for(var rowIndex=0;rowIndex<this._rowCount;++rowIndex){tr=document.createElement("tr");height=gridProcessor.yExtents[rowIndex];if(height){tr.style.height=Echo.Sync.Extent.toCssValue(height,false)}tbody.appendChild(tr);for(columnIndex=0;columnIndex<this._columnCount;++columnIndex){var cell=gridProcessor.getCell(columnIndex,rowIndex);if(cell==null){td=document.createElement("td");tr.appendChild(td);continue}if(renderedComponentIds[cell.component.renderId]){continue}renderedComponentIds[cell.component.renderId]=true;td=tdPrototype.cloneNode(false);if(cell.xSpan>1){td.setAttribute(xSpan,cell.xSpan)}if(cell.ySpan>1){td.setAttribute(ySpan,cell.ySpan)}var layoutData=cell.component.render("layoutData");if(layoutData){var columnWidth=gridProcessor.xExtents[columnIndex];if(Core.Web.Env.QUIRK_TABLE_CELL_WIDTH_EXCLUDES_PADDING&&columnWidth&&!Echo.Sync.Extent.isPercent(columnWidth)){var cellInsets=Echo.Sync.Insets.toPixels(layoutData.insets);if(defaultPixelInsets.left+defaultPixelInsets.right<cellInsets.left+cellInsets.right){td.style.width=(Echo.Sync.Extent.toPixels(columnWidth)-(cellInsets.left+cellInsets.right))+"px"}}Echo.Sync.Insets.render(layoutData.insets,td,"padding");Echo.Sync.Alignment.render(layoutData.alignment,td,true,this.component);Echo.Sync.FillImage.render(layoutData.backgroundImage,td);Echo.Sync.Color.render(layoutData.background,td,"backgroundColor")}Echo.Render.renderComponentAdd(update,cell.component,td);tr.appendChild(td)}}parentElement.appendChild(this._table)},renderDisplay:function(){if(this._renderPercentWidthByMeasure){this._table.style.width="";var tableParent=this._table.parentNode;var availableWidth=tableParent.offsetWidth;if(tableParent.style.paddingLeft){availableWidth-=parseInt(tableParent.style.paddingLeft,10)}if(tableParent.style.paddingRight){availableWidth-=parseInt(tableParent.style.paddingRight,10)}var width=((availableWidth*this._renderPercentWidthByMeasure)/100)-Core.Web.Measure.SCROLL_WIDTH;if(width>0){this._table.style.width=width+"px"}}},renderDispose:function(update){Core.Web.Event.removeAll(this._table);this._table=null;this._renderPercentWidthByMeasure=null},renderUpdate:function(update){var element=this._table;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement);return true}});Echo.Sync.ListComponent=Core.extend(Echo.Render.ComponentSync,{$static:{DEFAULT_DIV_BORDER:"1px solid #7f7f7f",DEFAULT_SELECTED_BACKGROUND:"#0a246a",DEFAULT_SELECTED_FOREGROUND:"#ffffff"},$abstract:{listBox:null},_hasRenderedSelectedItems:false,_multipleSelect:false,_selectedIdPriority:false,_alternateRender:false,_element:null,_div:null,_focused:false,_getSelection:function(){var selection=this._selectedIdPriority?null:this.component.get("selection");if(selection==null){var selectedId=this.component.get("selectedId");if(selectedId){var items=this.component.get("items");for(var i=0;i<items.length;++i){if(items[i].id==selectedId){selection=i;break}}}if(selection==null){selection=this.listBox?[]:0}}return selection},_processBlur:function(e){this._focused=false},_processClick:function(e){if(!this.client||!this.client.verifyInput(this.component)){Core.Web.DOM.preventEventDefault(e);this._renderSelection();return true}var child=this._div.firstChild;var i=0;while(child){if(child==e.target){break}child=child.nextSibling;++i}if(child==null){return}if(this._multipleSelect&&e.ctrlKey){var selection=this._getSelection();if(selection==null){selection=[]}else if(typeof(selection)=="number"){selection=[selection]}var arrayIndex=Core.Arrays.indexOf(selection,i);if(arrayIndex==-1){selection.push(i)}else{selection.splice(arrayIndex,1)}}else{selection=i}this._setSelection(selection);this.component.doAction();this._renderSelection()},_processChange:function(e){if(!this.client||!this.client.verifyInput(this.component)){Core.Web.DOM.preventEventDefault(e);this._renderSelection();return false}var selection;if(this._multipleSelect){selection=[];for(var i=0;i<this._element.options.length;++i){if(this._element.options[i].selected){selection.push(i)}}}else{if(this._element.selectedIndex!=-1){selection=this._element.selectedIndex}}this._setSelection(selection);this.component.doAction()},_processFocus:function(e){this._focused=true;if(!this.client||!this.client.verifyInput(this.component)){return true}this.client.application.setFocusedComponent(this.component)},_processSelectStart:function(e){Core.Web.DOM.preventEventDefault(e)},renderAdd:function(update,parentElement){this._multipleSelect=this.component.get("selectionMode")==Echo.ListBox.MULTIPLE_SELECTION;if(this.listBox&&Core.Web.Env.QUIRK_IE_SELECT_LIST_DOM_UPDATE){this._alternateRender=true}this._enabled=this.component.isRenderEnabled();if(this._alternateRender){this._renderMainAsDiv(update,parentElement)}else{this._renderMainAsSelect(update,parentElement)}},renderDisplay:function(){this._renderSelection()},renderDispose:function(update){Core.Web.Event.removeAll(this._element);this._element=null;if(this._div){Core.Web.Event.removeAll(this._div);this._div=null}},renderFocus:function(){if(this._focused){return}this._focused=true;Core.Web.DOM.focusElement(this._element)},_renderMainAsDiv:function(update,parentElement){this._element=document.createElement("table");this._element.id=this.component.renderId;var tbodyElement=document.createElement("tbody");this._element.appendChild(tbodyElement);var trElement=document.createElement("tr");tbodyElement.appendChild(trElement);var tdElement=document.createElement("td");trElement.appendChild(tdElement);this._div=document.createElement("div");tdElement.appendChild(this._div);this._div.style.cssText="cursor:default;overflow:auto;";this._div.style.height=Echo.Sync.Extent.toCssValue(this.component.render("height","6em"),false,false);var width=this.component.render("width");if(!Echo.Sync.Extent.isPercent(width)){this._div.style.width=Echo.Sync.Extent.toCssValue(width,true,false)}if(this._enabled){Echo.Sync.renderComponentDefaults(this.component,this._element)}else{Echo.Sync.LayoutDirection.render(this.component.getLayoutDirection(),this._element);Echo.Sync.Color.render(Echo.Sync.getEffectProperty(this.component,"foreground","disabledForeground",true),this._div,"color");Echo.Sync.Color.render(Echo.Sync.getEffectProperty(this.component,"background","disabledBackground",true),this._div,"backgroundColor");Echo.Sync.Font.render(Echo.Sync.getEffectProperty(this.component,"font","disabledFont",true),this._div)}Echo.Sync.Border.render(Echo.Sync.getEffectProperty(this.component,"border","disabledBorder",!this._enabled,Echo.Sync.ListComponent.DEFAULT_DIV_BORDER,null),this._div);Echo.Sync.Insets.render(this.component.render("insets"),this._div,"padding");var items=this.component.get("items");if(items){for(var i=0;i<items.length;++i){var optionElement=document.createElement("div");if(items[i].text){optionElement.appendChild(document.createTextNode(items[i].text))}else{optionElement.appendChild(document.createTextNode(items[i].toString()))}if(items[i].foreground){Echo.Sync.Color.render(items[i].foreground,optionElement,"color")}if(items[i].background){Echo.Sync.Color.render(items[i].background,optionElement,"backgroundColor")}if(items[i].font){Echo.Sync.Font.render(items[i].font,optionElement)}this._div.appendChild(optionElement)}}if(this._enabled){Core.Web.Event.add(this._element,"blur",Core.method(this,this._processBlur),false);Core.Web.Event.add(this._element,"focus",Core.method(this,this._processFocus),false);Core.Web.Event.add(this._div,"click",Core.method(this,this._processClick),false);Core.Web.Event.add(this._div,"selectstart",Core.method(this,this._processSelectStart),false)}parentElement.appendChild(this._element)},_renderMainAsSelect:function(update,parentElement){this._div=document.createElement("div");this._element=document.createElement("select");this._element.id=this.component.renderId;this._element.size=this.listBox?6:1;if(!this._enabled){this._element.disabled=true}if(this._multipleSelect){this._element.multiple="multiple"}this._element.style.height=Echo.Sync.Extent.toCssValue(this.component.render("height"),false,false);var width=this.component.render("width");if(width){if(Echo.Sync.Extent.isPercent(width)){if(!Core.Web.Env.QUIRK_IE_SELECT_PERCENT_WIDTH){this._div.style.width=width;this._element.style.width="100%"}}else{this._element.style.width=Echo.Sync.Extent.toCssValue(width,true,false)}}if(this._enabled){Echo.Sync.renderComponentDefaults(this.component,this._element)}else{Echo.Sync.LayoutDirection.render(this.component.getLayoutDirection(),this._element);Echo.Sync.Color.render(Echo.Sync.getEffectProperty(this.component,"foreground","disabledForeground",true),this._element,"color");Echo.Sync.Color.render(Echo.Sync.getEffectProperty(this.component,"background","disabledBackground",true),this._element,"backgroundColor");Echo.Sync.Font.render(Echo.Sync.getEffectProperty(this.component,"font","disabledFont",true),this._element)}Echo.Sync.Border.render(Echo.Sync.getEffectProperty(this.component,"border","disabledBorder",!this._enabled),this._element);Echo.Sync.Insets.render(this.component.render("insets"),this._element,"padding");var items=this.component.get("items");if(items){for(var i=0;i<items.length;++i){var optionElement=document.createElement("option");if(items[i].text==null){optionElement.appendChild(document.createTextNode(items[i].toString()))}else{optionElement.appendChild(document.createTextNode(items[i].text))}if(items[i].foreground){Echo.Sync.Color.render(items[i].foreground,optionElement,"color")}if(items[i].background){Echo.Sync.Color.render(items[i].background,optionElement,"backgroundColor")}if(items[i].font){Echo.Sync.Font.render(items[i].font,optionElement)}this._element.appendChild(optionElement)}}if(this._enabled){Core.Web.Event.add(this._element,"change",Core.method(this,this._processChange),false);Core.Web.Event.add(this._element,"blur",Core.method(this,this._processBlur),false);Core.Web.Event.add(this._element,"focus",Core.method(this,this._processFocus),false)}this._div.appendChild(this._element);parentElement.appendChild(this._div)},_renderSelection:function(){var selection=this._getSelection(),i;if(this._alternateRender){if(this._hasRenderedSelectedItems){var items=this.component.get("items");for(i=0;i<items.length;++i){Echo.Sync.Color.renderClear(items[i].foreground,this._div.childNodes[i],"color");Echo.Sync.Color.renderClear(items[i].background,this._div.childNodes[i],"backgroundColor")}}if(selection instanceof Array){for(i=0;i<selection.length;++i){if(selection[i]>=0&&selection[i]<this._div.childNodes.length){Echo.Sync.Color.render(Echo.Sync.ListComponent.DEFAULT_SELECTED_FOREGROUND,this._div.childNodes[selection[i]],"color");Echo.Sync.Color.render(Echo.Sync.ListComponent.DEFAULT_SELECTED_BACKGROUND,this._div.childNodes[selection[i]],"backgroundColor")}}}else if(selection>=0&&selection<this._div.childNodes.length){Echo.Sync.Color.render(Echo.Sync.ListComponent.DEFAULT_SELECTED_FOREGROUND,this._div.childNodes[selection],"color");Echo.Sync.Color.render(Echo.Sync.ListComponent.DEFAULT_SELECTED_BACKGROUND,this._div.childNodes[selection],"backgroundColor")}}else{if(this._hasRenderedSelectedItems){this._element.selectedIndex=-1}if(selection instanceof Array){for(i=0;i<selection.length;++i){if(selection[i]>=0&&selection[i]<this._element.options.length){this._element.options[selection[i]].selected=true}}}else if(selection>=0&&selection<this._element.options.length){this._element.options[selection].selected=true}}this._hasRenderedSelectedItems=true},renderUpdate:function(update){if(update.getUpdatedProperty("selectedId")&&!update.getUpdatedProperty("selection")){this._selectedIdPriority=true}var element=this._element;var containerElement=element.parentNode;this.renderDispose(update);containerElement.removeChild(element);this.renderAdd(update,containerElement);return false},_setSelection:function(selection){this._selectedIdPriority=false;var selectedId=null;if(selection instanceof Array&&selection.length==1){selection=selection[0]}var items=this.component.get("items");if(selection instanceof Array){selectedId=[];for(var i=0;i<selection.length;++i){var selectedIndex=selection[i];if(selectedIndex<items.length){if(items[selectedIndex].id!=null){selectedId.push(items[selectedIndex].id)}}}}else{if(selection<items.length){if(items[selection].id!=null){selectedId=items[selection].id}}}this.component.set("selection",selection);this.component.set("selectedId",selectedId)}});Echo.Sync.ListBox=Core.extend(Echo.Sync.ListComponent,{listBox:true,$load:function(){Echo.Render.registerPeer("ListBox",this)}});Echo.Sync.SelectField=Core.extend(Echo.Sync.ListComponent,{listBox:false,$load:function(){Echo.Render.registerPeer("SelectField",this)}});Echo.Sync.SplitPane=Core.extend(Echo.Render.ComponentSync,{$static:{ChildPane:Core.extend({minimumSize:0,maximumSize:null,component:null,layoutData:null,scrollLeft:0,scrollTop:0,scrollRequired:false,_permanentSizes:false,_peer:null,$construct:function(splitPanePeer,component){this._peer=splitPanePeer;this.component=component;this.layoutData=component.render("layoutData")},loadDisplayData:function(){if(this._permanentSizes){return}var size;this._permanentSizes=true;if(this.layoutData){if(this.layoutData.minimumSize){if(Echo.Sync.Extent.isPercent(this.layoutData.minimumSize)){size=this._peer._getSize();this.minimumSize=Math.round((this._peer._orientationVertical?size.height:size.width)*parseInt(this.layoutData.minimumSize,10)/100);this._permanentSizes=false}else{this.minimumSize=Math.round(Echo.Sync.Extent.toPixels(this.layoutData.minimumSize,!this._peer._orientationVertical))}}if(this.layoutData.maximumSize){if(Echo.Sync.Extent.isPercent(this.layoutData.maximumSize)){size=this._peer._getSize();this.maximumSize=Math.round((this._peer._orientationVertical?size.height:size.width)*parseInt(this.layoutData.maximumSize,10)/100);this._permanentSizes=false}else{this.maximumSize=Math.round(Echo.Sync.Extent.toPixels(this.layoutData.maximumSize,!this._peer._orientationVertical))}}}},loadScrollPositions:function(paneDiv){paneDiv.scrollLeft=this.scrollLeft;paneDiv.scrollTop=this.scrollTop},storeScrollPositions:function(paneDiv){this.scrollLeft=paneDiv.scrollLeft;this.scrollTop=paneDiv.scrollTop}})},$load:function(){Echo.Render.registerPeer("SplitPane",this)},_childPanes:null,_paneDivs:null,_separatorDiv:null,_autoPositioned:false,_overlay:null,_redisplayRequired:false,_requested:null,_rendered:null,_processSeparatorMouseMoveRef:null,_processSeparatorMouseUpRef:null,_initialAutoSizeComplete:false,_size:null,$construct:function(){this._childPanes=[];this._paneDivs=[];this._processSeparatorMouseMoveRef=Core.method(this,this._processSeparatorMouseMove);this._processSeparatorMouseUpRef=Core.method(this,this._processSeparatorMouseUp)},clientKeyDown:function(e){var focusPrevious,focusedComponent,focusFlags,focusChild;switch(e.keyCode){case 37:case 39:if(!this._orientationVertical){focusPrevious=(e.keyCode==37)^(!this._orientationTopLeft);focusedComponent=this.client.application.getFocusedComponent();if(focusedComponent&&focusedComponent.peer&&focusedComponent.peer.getFocusFlags){focusFlags=focusedComponent.peer.getFocusFlags();if((focusPrevious&&focusFlags&Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_LEFT)||(!focusPrevious&&focusFlags&Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_RIGHT)){focusChild=this.client.application.focusManager.findInParent(this.component,focusPrevious);if(focusChild){this.client.application.setFocusedComponent(focusChild);Core.Web.DOM.preventEventDefault(e.domEvent);return false}}}}break;case 38:case 40:if(this._orientationVertical){focusPrevious=(e.keyCode==38)^(!this._orientationTopLeft);focusedComponent=this.client.application.getFocusedComponent();if(focusedComponent&&focusedComponent.peer&&focusedComponent.peer.getFocusFlags){focusFlags=focusedComponent.peer.getFocusFlags();if((focusPrevious&&focusFlags&Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_UP)||(!focusPrevious&&focusFlags&Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_DOWN)){focusChild=this.client.application.focusManager.findInParent(this.component,focusPrevious);if(focusChild){this.client.application.setFocusedComponent(focusChild);Core.Web.DOM.preventEventDefault(e.domEvent);return false}}}}break}return true},_getBoundedSeparatorPosition:function(position){if(this._childPanes[1]){var totalSize=this._orientationVertical?this._getSize().height:this._getSize().width;if(position>totalSize-this._childPanes[1].minimumSize-this._separatorSize){position=totalSize-this._childPanes[1].minimumSize-this._separatorSize}else if(this._childPanes[1].maximumSize!=null&&position<totalSize-this._childPanes[1].maximumSize-this._separatorSize){position=totalSize-this._childPanes[1].maximumSize-this._separatorSize}}if(this._childPanes[0]){if(position<this._childPanes[0].minimumSize){position=this._childPanes[0].minimumSize}else if(this._childPanes[0].maximumSize!=null&&position>this._childPanes[0].maximumSize){position=this._childPanes[0].maximumSize}}return position},_getInsetsSizeAdjustment:function(position,layoutData){if(!layoutData||layoutData.insets==null){return 0}var layoutDataInsets=Echo.Sync.Insets.toPixels(layoutData.insets);var adjustment;if(this._orientationVertical){adjustment=layoutDataInsets.top+layoutDataInsets.bottom}else{adjustment=layoutDataInsets.left+layoutDataInsets.right}if(position!=null&&adjustment>position){adjustment=position}return adjustment},getPreferredSize:function(dimension){if(this.component.children.length===0){return null}var bounds,insets,layoutData;dimension=dimension||(Echo.Render.ComponentSync.SIZE_WIDTH|Echo.Render.ComponentSync.SIZE_HEIGHT);var size0;if(this.component.children[0].peer.getPreferredSize){size0=this.component.children[0].peer.getPreferredSize(dimension)}else if(!this.component.children[0].pane&&(dimension&Echo.Render.ComponentSync.SIZE_HEIGHT)&&this._paneDivs[0].firstChild){bounds=new Core.Web.Measure.Bounds(this._paneDivs[0].firstChild);size0={height:bounds.height===0?null:bounds.height};if(size0.height){layoutData=this.component.children[0].render("layoutData");if(layoutData&&layoutData.insets){insets=Echo.Sync.Insets.toPixels(layoutData.insets);size0.height+=insets.top+insets.bottom}}}else{size0={}}var size1;if(this.component.children.length==1){size1={width:0,height:0}}else if(this.component.children[1].peer.getPreferredSize){size1=this.component.children[1].peer.getPreferredSize(dimension)}else if(!this.component.children[1].pane&&(dimension&Echo.Render.ComponentSync.SIZE_HEIGHT)&&this._paneDivs[1].firstChild){bounds=new Core.Web.Measure.Bounds(this._paneDivs[1].firstChild);size1={height:bounds.height===0?null:bounds.height};if(size1.height){layoutData=this.component.children[1].render("layoutData");if(layoutData&&layoutData.insets){insets=Echo.Sync.Insets.toPixels(layoutData.insets);size1.height+=insets.top+insets.bottom}}}else{size1={}}var height=null;if((dimension&Echo.Render.ComponentSync.SIZE_HEIGHT)&&size0.height!=null&&size1.height!=null){if(this._orientationVertical){height=size0.height+size1.height+this._separatorSize}else{height=size0.height>size1.height?size0.height:size1.height}}var width=null;if((dimension&Echo.Render.ComponentSync.SIZE_WIDTH)&&size0.width!=null&&size1.width!=null){if(this._orientationVertical){width=size0.width>size1.width?size0.width:size1.width}else{width=size0.width+size1.width+this._separatorSize}}return{height:height,width:width}},_getSize:function(){if(!this._size){this._size=new Core.Web.Measure.Bounds(this._splitPaneDiv)}return this._size},_hasRelocatedChildren:function(update){var oldChild0=this._childPanes[0]?this._childPanes[0].component:null;var oldChild1=this._childPanes[1]?this._childPanes[1].component:null;var childCount=this.component.getComponentCount();var newChild0=childCount>0?this.component.getComponent(0):null;var newChild1=childCount>1?this.component.getComponent(1):null;return(oldChild0!=null&&oldChild0==newChild1)||(oldChild1!=null&&oldChild1==newChild0)},_loadRenderData:function(){var orientation=this.component.render("orientation",Echo.SplitPane.ORIENTATION_HORIZONTAL_LEADING_TRAILING);switch(orientation){case Echo.SplitPane.ORIENTATION_HORIZONTAL_LEADING_TRAILING:this._orientationTopLeft=this.component.getRenderLayoutDirection().isLeftToRight();this._orientationVertical=false;break;case Echo.SplitPane.ORIENTATION_HORIZONTAL_TRAILING_LEADING:this._orientationTopLeft=!this.component.getRenderLayoutDirection().isLeftToRight();this._orientationVertical=false;break;case Echo.SplitPane.ORIENTATION_HORIZONTAL_LEFT_RIGHT:this._orientationTopLeft=true;this._orientationVertical=false;break;case Echo.SplitPane.ORIENTATION_HORIZONTAL_RIGHT_LEFT:this._orientationTopLeft=false;this._orientationVertical=false;break;case Echo.SplitPane.ORIENTATION_VERTICAL_TOP_BOTTOM:this._orientationTopLeft=true;this._orientationVertical=true;break;case Echo.SplitPane.ORIENTATION_VERTICAL_BOTTOM_TOP:this._orientationTopLeft=false;this._orientationVertical=true;break;default:throw new Error("Invalid orientation: "+orientation);}this._resizable=this.component.render("resizable");this._autoPositioned=this.component.render("autoPositioned");this._requested=this.component.render("separatorPosition");var defaultSeparatorSize=this._resizable?Echo.SplitPane.DEFAULT_SEPARATOR_SIZE_RESIZABLE:Echo.SplitPane.DEFAULT_SEPARATOR_SIZE_FIXED;var separatorSizeExtent=this.component.render(this._orientationVertical?"separatorHeight":"separatorWidth",defaultSeparatorSize);this._separatorSize=Echo.Sync.Extent.toPixels(separatorSizeExtent,this._orientationVertical);if(this._separatorSize==null){this._separatorSize=defaultSeparatorSize}this._separatorVisible=this._resizable||(this.component.render("separatorVisible",true)&&this._separatorSize>0);if(!this._separatorVisible){this._separatorSize=0}if(this._separatorSize>0){this._separatorColor=this.component.render("separatorColor",Echo.SplitPane.DEFAULT_SEPARATOR_COLOR);this._separatorRolloverColor=this.component.render("separatorRolloverColor")||Echo.Sync.Color.adjust(this._separatorColor,0x20,0x20,0x20);this._separatorImage=this.component.render(this._orientationVertical?"separatorVerticalImage":"separatorHorizontalImage");this._separatorRolloverImage=this.component.render(this._orientationVertical?"separatorVerticalRolloverImage":"separatorHorizontalRolloverImage")}},_overlayAdd:function(){if(this._overlay){return}this._overlay=document.createElement("div");this._overlay.style.cssText="position:absolute;z-index:32600;width:100%;height:100%;";Echo.Sync.FillImage.render(this.client.getResourceUrl("Echo","resource/Transparent.gif"),this._overlay);document.body.appendChild(this._overlay)},_overlayRemove:function(){if(!this._overlay){return}document.body.removeChild(this._overlay);this._overlay=null},_processSeparatorMouseDown:function(e){if(!this.client||!this.client.verifyInput(this.component)){return true}Core.Web.DOM.preventEventDefault(e);Core.Web.dragInProgress=true;this._dragInitPosition=this._rendered;if(this._orientationVertical){this._dragInitMouseOffset=e.clientY}else{this._dragInitMouseOffset=e.clientX}Core.Web.Event.add(document.body,"mousemove",this._processSeparatorMouseMoveRef,true);Core.Web.Event.add(document.body,"mouseup",this._processSeparatorMouseUpRef,true);this._overlayAdd()},_processSeparatorMouseMove:function(e){var mousePosition=this._orientationVertical?e.clientY:e.clientX;this._rendered=this._getBoundedSeparatorPosition(this._orientationTopLeft?this._dragInitPosition+mousePosition-this._dragInitMouseOffset:this._dragInitPosition-mousePosition+this._dragInitMouseOffset);this._redraw(this._rendered)},_processSeparatorMouseUp:function(e){Core.Web.DOM.preventEventDefault(e);this._overlayRemove();Core.Web.dragInProgress=false;this._removeSeparatorListeners();this.component.set("separatorPosition",this._rendered);this._requested=this._rendered;if(this._paneDivs[0]){Core.Web.VirtualPosition.redraw(this._paneDivs[0])}if(this._paneDivs[1]){Core.Web.VirtualPosition.redraw(this._paneDivs[1])}Echo.Render.notifyResize(this.component)},_processSeparatorRolloverEnter:function(e){if(!this.client||!this.client.verifyInput(this.component)){return true}if(this._separatorRolloverImage){Echo.Sync.FillImage.render(this._separatorRolloverImage,this._separatorDiv,0)}else{Echo.Sync.Color.render(this._separatorRolloverColor,this._separatorDiv,"backgroundColor")}},_processSeparatorRolloverExit:function(e){if(this._separatorRolloverImage){Echo.Sync.FillImage.renderClear(this._separatorImage,this._separatorDiv,0)}else{Echo.Sync.Color.render(this._separatorColor,this._separatorDiv,"backgroundColor")}},_redraw:function(position){var insetsAdjustment=0;if(this.component.getComponentCount()>0){var layoutData=this.component.getComponent(0).render("layoutData");insetsAdjustment=this._getInsetsSizeAdjustment(position,layoutData)}var sizeAttr=this._orientationVertical?"height":"width";var positionAttr=this._orientationVertical?(this._orientationTopLeft?"top":"bottom"):(this._orientationTopLeft?"left":"right");if(this._paneDivs[0]){this._paneDivs[0].style[sizeAttr]=(position-insetsAdjustment)+"px"}if(this._paneDivs[1]){this._paneDivs[1].style[positionAttr]=(position+this._separatorSize)+"px"}if(this._separatorDiv){this._separatorDiv.style[positionAttr]=position+"px"}},_removeSeparatorListeners:function(){Core.Web.Event.remove(document.body,"mousemove",this._processSeparatorMouseMoveRef,true);Core.Web.Event.remove(document.body,"mouseup",this._processSeparatorMouseUpRef,true)},renderAdd:function(update,parentElement){this._initialAutoSizeComplete=false;this._loadRenderData();var childCount=this.component.getComponentCount();if(childCount>2){throw new Error("Cannot render SplitPane with more than two child components.");}var child0=childCount<1?null:this.component.getComponent(0);var child1=childCount<2?null:this.component.getComponent(1);this._splitPaneDiv=document.createElement("div");this._splitPaneDiv.id=this.component.renderId;this._splitPaneDiv.style.cssText="position:absolute;overflow:hidden;top:0;left:0;right:0;bottom:0;";Echo.Sync.renderComponentDefaults(this.component,this._splitPaneDiv);if(this._separatorVisible){this._separatorDiv=document.createElement("div");this._separatorDiv.style.cssText="position:absolute;font-size:1px;line-height:0;z-index:2;";Echo.Sync.Color.render(this._separatorColor,this._separatorDiv,"backgroundColor");var resizeCursor=null;if(this._orientationVertical){resizeCursor=this._orientationTopLeft?"s-resize":"n-resize";this._separatorDiv.style.width="100%";this._separatorDiv.style.height=this._separatorSize+"px";Echo.Sync.FillImage.render(this._separatorImage,this._separatorDiv,0)}else{resizeCursor=this._orientationTopLeft?"e-resize":"w-resize";this._separatorDiv.style.height="100%";this._separatorDiv.style.width=this._separatorSize+"px";Echo.Sync.FillImage.render(this._separatorImage,this._separatorDiv,0)}if(this._resizable&&resizeCursor){this._separatorDiv.style.cursor=resizeCursor}this._splitPaneDiv.appendChild(this._separatorDiv)}else{this._separatorDiv=null}for(var i=0;i<childCount&&i<2;++i){var child=this.component.getComponent(i);this._renderAddChild(update,child,i)}parentElement.appendChild(this._splitPaneDiv);if(this._resizable){Core.Web.Event.add(this._separatorDiv,"mousedown",Core.method(this,this._processSeparatorMouseDown),false);Core.Web.Event.add(this._separatorDiv,"mouseover",Core.method(this,this._processSeparatorRolloverEnter),false);Core.Web.Event.add(this._separatorDiv,"mouseout",Core.method(this,this._processSeparatorRolloverExit),false)}},_renderAddChild:function(update,child,index){var childIndex=this.component.indexOf(child);var paneDiv=document.createElement("div");this._paneDivs[index]=paneDiv;paneDiv.style.cssText="position: absolute; overflow: auto; z-index: 1;";var layoutData=child.render("layoutData");if(layoutData){Echo.Sync.Alignment.render(layoutData.alignment,paneDiv,false,this.component);Echo.Sync.Color.render(layoutData.background,paneDiv,"backgroundColor");Echo.Sync.FillImage.render(layoutData.backgroundImage,paneDiv);if(!child.pane){Echo.Sync.Insets.render(layoutData.insets,paneDiv,"padding");switch(layoutData.overflow){case Echo.SplitPane.OVERFLOW_HIDDEN:paneDiv.style.overflow="hidden";break;case Echo.SplitPane.OVERFLOW_SCROLL:paneDiv.style.overflow="scroll";break}}}if(child.pane){paneDiv.style.overflow="hidden"}if(this._orientationVertical){paneDiv.style.left=0;paneDiv.style.right=0;if((this._orientationTopLeft&&index===0)||(!this._orientationTopLeft&&index==1)){paneDiv.style.top=0}else{paneDiv.style.bottom=0}}else{paneDiv.style.top="0";paneDiv.style.bottom="0";if((this._orientationTopLeft&&index===0)||(!this._orientationTopLeft&&index==1)){paneDiv.style.left=0}else{paneDiv.style.right=0}}Echo.Render.renderComponentAdd(update,child,paneDiv);this._splitPaneDiv.appendChild(paneDiv);if(this._childPanes[index]&&this._childPanes[index].component==child){this._childPanes[index].scrollRequired=true}else{this._childPanes[index]=new Echo.Sync.SplitPane.ChildPane(this,child)}},renderDisplay:function(){Core.Web.VirtualPosition.redraw(this._splitPaneDiv);Core.Web.VirtualPosition.redraw(this._paneDivs[0]);Core.Web.VirtualPosition.redraw(this._paneDivs[1]);this._size=null;if(this._childPanes[0]){this._childPanes[0].loadDisplayData()}if(this._childPanes[1]){this._childPanes[1].loadDisplayData()}var position=this._requested;if(position==null&&this._autoPositioned&&this._paneDivs[0]){if(this.component.children[0].peer.getPreferredSize){var prefSize=this.component.children[0].peer.getPreferredSize(this._orientationVertical?Echo.Render.ComponentSync.SIZE_HEIGHT:Echo.Render.ComponentSync.SIZE_WIDTH);position=prefSize?(this._orientationVertical?prefSize.height:prefSize.width):null}if(position==null&&this._orientationVertical&&!this.component.children[0].pane){this._paneDivs[0].style.height="";var bounds0=new Core.Web.Measure.Bounds(this._paneDivs[0]);position=bounds0.height}if(position!=null&&!this._initialAutoSizeComplete){this._initialAutoSizeComplete=true;var imageListener=Core.method(this,function(){if(this.component){Echo.Render.renderComponentDisplay(this.component)}});Core.Web.Image.monitor(this._paneDivs[0],imageListener)}}if(position==null){position=Echo.SplitPane.DEFAULT_SEPARATOR_POSITION}if(Echo.Sync.Extent.isPercent(position)){var totalSize=this._orientationVertical?this._getSize().height:this._getSize().width;position=Math.round((parseInt(position,10)/100)*totalSize)}else{position=Math.round(Echo.Sync.Extent.toPixels(position,!this._orientationVertical))}this._rendered=this._getBoundedSeparatorPosition(position);this._redraw(this._rendered);Core.Web.VirtualPosition.redraw(this._paneDivs[0]);Core.Web.VirtualPosition.redraw(this._paneDivs[1]);for(var i=0;i<this._childPanes.length;++i){if(this._childPanes[i]&&this._childPanes[i].scrollRequired&&this._paneDivs[i]){this._childPanes[i].loadScrollPositions(this._paneDivs[i]);this._childPanes[i].scrollRequired=false}}},renderDispose:function(update){this._overlayRemove();for(var i=0;i<2;++i){if(this._paneDivs[i]){if(this._childPanes[i]){this._childPanes[i].storeScrollPositions(this._paneDivs[i])}this._paneDivs[i]=null}}if(this._separatorDiv){Core.Web.Event.removeAll(this._separatorDiv);this._separatorDiv=null}Core.Web.Event.removeAll(this._splitPaneDiv);this._splitPaneDiv=null},_renderRemoveChild:function(update,child){var index;if(this._childPanes[0]&&this._childPanes[0].component==child){index=0}else if(this._childPanes[1]&&this._childPanes[1].component==child){index=1}else{return}this._childPanes[index]=null;Core.Web.DOM.removeNode(this._paneDivs[index]);this._paneDivs[index]=null},renderUpdate:function(update){var fullRender=false,i;if(this._hasRelocatedChildren()){fullRender=true}else if(update.hasUpdatedProperties()||update.hasUpdatedLayoutDataChildren()){if(update.isUpdatedPropertySetIn({separatorPosition:true})){this._requested=this.component.render("separatorPosition")}else{fullRender=true}}if(!fullRender&&(update.hasAddedChildren()||update.hasRemovedChildren())){var removedChildren=update.getRemovedChildren();if(removedChildren){for(i=0;i<removedChildren.length;++i){this._renderRemoveChild(update,removedChildren[i])}}var addedChildren=update.getAddedChildren();if(addedChildren){for(i=0;i<addedChildren.length;++i){this._renderAddChild(update,addedChildren[i],this.component.indexOf(addedChildren[i]))}}}if(fullRender){var element=this._splitPaneDiv;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement)}return fullRender}});Echo.Sync.TextComponent=Core.extend(Echo.Render.ComponentSync,{$abstract:true,$virtual:{getSupportedPartialProperties:function(){return["text","editable","selectionStart","selectionEnd"]},processBlur:function(e){this._focused=false;this._storeSelection();this._storeValue();return true},processFocus:function(e){this._focused=true;if(this.client){if(this.component.isActive()){this.client.application.setFocusedComponent(this.component)}else{this._resetFocus()}}return false},sanitizeInput:function(){var maximumLength=this.component.render("maximumLength",-1);if(maximumLength>=0){if(this.input.value&&this.input.value.length>maximumLength){this.input.value=this.input.value.substring(0,maximumLength)}}}},input:null,container:null,_focused:false,_lastProcessedValue:null,percentWidth:false,_selectionStart:0,_selectionEnd:0,_renderStyle:function(){if(this.component.isRenderEnabled()){Echo.Sync.renderComponentDefaults(this.component,this.input);Echo.Sync.Border.render(this.component.render("border"),this.input);Echo.Sync.FillImage.render(this.component.render("backgroundImage"),this.input)}else{Echo.Sync.LayoutDirection.render(this.component.getLayoutDirection(),this.input);Echo.Sync.Color.render(Echo.Sync.getEffectProperty(this.component,"foreground","disabledForeground",true),this.input,"color");Echo.Sync.Color.render(Echo.Sync.getEffectProperty(this.component,"background","disabledBackground",true),this.input,"backgroundColor");Echo.Sync.Border.render(Echo.Sync.getEffectProperty(this.component,"border","disabledBorder",true),this.input);Echo.Sync.Font.render(Echo.Sync.getEffectProperty(this.component,"font","disabledFont",true),this.input);Echo.Sync.FillImage.render(Echo.Sync.getEffectProperty(this.component,"backgroundImage","disabledBackgroundImage",true),this.input)}Echo.Sync.Alignment.render(this.component.render("alignment"),this.input,false,null);Echo.Sync.Insets.render(this.component.render("insets"),this.input,"padding");var width=this.component.render("width");this.percentWidth=Echo.Sync.Extent.isPercent(width);if(width){if(this.percentWidth){this.input.style.width="5px"}else{this.input.style.width=Echo.Sync.Extent.toCssValue(width,true)}}var height=this.component.render("height");if(height){this.input.style.height=Echo.Sync.Extent.toCssValue(height,false)}var toolTipText=this.component.render("toolTipText");if(toolTipText){this.input.title=toolTipText}},_addEventHandlers:function(){Core.Web.Event.add(this.input,"keydown",Core.method(this,this._processKeyDown),false);Core.Web.Event.add(this.input,"click",Core.method(this,this._processClick),false);Core.Web.Event.add(this.input,"focus",Core.method(this,this.processFocus),false);Core.Web.Event.add(this.input,"blur",Core.method(this,this.processBlur),false)},_adjustPercentWidth:function(percentValue,reducePixels,containerPixels){var value=(100-(100*reducePixels/containerPixels))*percentValue/100;return value>0?value:0},clientKeyDown:function(e){this._storeValue(e);if(this.client&&this.component.isActive()){if(!this.component.doKeyDown(e.keyCode)){Core.Web.DOM.preventEventDefault(e.domEvent)}}return true},clientKeyPress:function(e){this._storeValue(e);if(this.client&&this.component.isActive()){if(!this.component.doKeyPress(e.keyCode,e.charCode)){Core.Web.DOM.preventEventDefault(e.domEvent)}}return true},clientKeyUp:function(e){this._storeSelection();this._storeValue(e);return true},_processClick:function(e){if(!this.client||!this.component.isActive()){Core.Web.DOM.preventEventDefault(e);return true}this.client.application.setFocusedComponent(this.component);this._storeSelection();return false},_processKeyDown:function(e){if(!this.component.isActive()){Core.Web.DOM.preventEventDefault(e)}return true},_processRestrictionsClear:function(){if(!this.client){return}if(!this.client.verifyInput(this.component)||this.input.readOnly){this.input.value=this.component.get("text");return}this.component.set("text",this.input.value,true)},_resetFocus:function(){var div=document.createElement("div");div.style.cssText="position:absolute;width:0;height:0;overflow:hidden;";var input=document.createElement("input");input.type="text";div.appendChild(input);document.body.appendChild(div);input.focus();document.body.removeChild(div);div=null;input=null;this.client.forceRedraw();Echo.Render.updateFocus(this.client)},renderAddToParent:function(parentElement){if(Core.Web.Env.ENGINE_MSHTML&&this.percentWidth){this.container=document.createElement("div");this.container.appendChild(this.input);parentElement.appendChild(this.container)}else{parentElement.appendChild(this.input)}},renderDisplay:function(){var width=this.component.render("width");if(width&&Echo.Sync.Extent.isPercent(width)&&this.input.parentNode.offsetWidth){var border=this.component.render("border");var borderSize=border?(Echo.Sync.Border.getPixelSize(border,"left")+Echo.Sync.Border.getPixelSize(border,"right")):4;var insets=this.component.render("insets");if(insets){var insetsPx=Echo.Sync.Insets.toPixels(insets);borderSize+=insetsPx.left+insetsPx.right}if(Core.Web.Env.ENGINE_MSHTML){borderSize+=1;if(this.container){this.container.style.width=this._adjustPercentWidth(100,Core.Web.Measure.SCROLL_WIDTH,this.input.parentNode.offsetWidth)+"%"}else{borderSize+=Core.Web.Measure.SCROLL_WIDTH}}else if(Core.Web.Env.BROWSER_CHROME&&this.input.nodeName.toLowerCase()=="textarea"){borderSize+=3}else if(Core.Web.Env.BROWSER_SAFARI&&this.input.nodeName.toLowerCase()=="input"){borderSize+=1}else if(Core.Web.Env.ENGINE_PRESTO){borderSize+=1}this.input.style.width=this._adjustPercentWidth(parseInt(width,10),borderSize,this.input.parentNode.offsetWidth)+"%"}},renderDispose:function(update){Core.Web.Event.removeAll(this.input);this._focused=false;this.input=null;this.container=null},renderFocus:function(){if(this._focused){return}this._focused=true;Core.Web.DOM.focusElement(this.input)},renderUpdate:function(update){var fullRender=!Core.Arrays.containsAll(this.getSupportedPartialProperties(),update.getUpdatedPropertyNames(),true);if(fullRender){var element=this.container?this.container:this.input;var containerElement=element.parentNode;this.renderDispose(update);containerElement.removeChild(element);this.renderAdd(update,containerElement)}else{if(update.hasUpdatedProperties()){var textUpdate=update.getUpdatedProperty("text");if(textUpdate){var newValue=textUpdate.newValue==null?"":textUpdate.newValue;if(newValue!=this._lastProcessedValue){this.input.value=newValue;this._lastProcessedValue=newValue}}var editableUpdate=update.getUpdatedProperty("editable");if(editableUpdate!=null){this.input.readOnly=!editableUpdate.newValue}}}return false},_storeSelection:function(){var range,measureRange;if(!this.component){return}if(!Core.Web.Env.NOT_SUPPORTED_INPUT_SELECTION){this._selectionStart=this.input.selectionStart;this._selectionEnd=this.input.selectionEnd}else if(Core.Web.Env.PROPRIETARY_IE_RANGE){range=document.selection.createRange();if(range.parentElement()!=this.input){return}measureRange=range.duplicate();if(this.input.nodeName.toLowerCase()=="textarea"){measureRange.moveToElementText(this.input)}else{measureRange.expand("textedit")}measureRange.setEndPoint("EndToEnd",range);this._selectionStart=measureRange.text.length-range.text.length;this._selectionEnd=this._selectionStart+range.text.length}else{return}this.component.set("selectionStart",this._selectionStart,true);this.component.set("selectionEnd",this._selectionEnd,true)},_storeValue:function(keyEvent){if(!this.client||!this.component.isActive()){if(keyEvent){Core.Web.DOM.preventEventDefault(keyEvent)}return}this.sanitizeInput();if(!this.client.verifyInput(this.component)){this.client.registerRestrictionListener(this.component,Core.method(this,this._processRestrictionsClear));return}this.component.set("text",this.input.value,true);this._lastProcessedValue=this.input.value;if(keyEvent&&keyEvent.keyCode==13&&keyEvent.type=="keydown"){this.component.doAction()}}});Echo.Sync.TextArea=Core.extend(Echo.Sync.TextComponent,{$load:function(){Echo.Render.registerPeer("TextArea",this)},renderAdd:function(update,parentElement){this.input=document.createElement("textarea");this.input.id=this.component.renderId;if(!this.component.render("editable",true)){this.input.readOnly=true}this._renderStyle(this.input);this.input.style.overflow="auto";this._addEventHandlers(this.input);if(this.component.get("text")){this.input.value=this.component.get("text")}this.renderAddToParent(parentElement)}});Echo.Sync.TextField=Core.extend(Echo.Sync.TextComponent,{$load:function(){Echo.Render.registerPeer("TextField",this)},$virtual:{_type:"text"},getFocusFlags:function(){return Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_UP|Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_DOWN},renderAdd:function(update,parentElement){this.input=document.createElement("input");this.input.id=this.component.renderId;if(!this.component.render("editable",true)){this.input.readOnly=true}this.input.type=this._type;var maximumLength=this.component.render("maximumLength",-1);if(maximumLength>=0){this.input.maxLength=maximumLength}this._renderStyle(this.input);this._addEventHandlers(this.input);if(this.component.get("text")){this.input.value=this.component.get("text")}this.renderAddToParent(parentElement)},sanitizeInput:function(){}});Echo.Sync.PasswordField=Core.extend(Echo.Sync.TextField,{$load:function(){Echo.Render.registerPeer("PasswordField",this)},_type:"password"});Echo.Sync.ToggleButton=Core.extend(Echo.Sync.Button,{$load:function(){Echo.Render.registerPeer("ToggleButton",this)},$abstract:{inputType:null},_selected:false,_stateElement:null,doAction:function(){this.setSelected(!this._selected);Echo.Sync.Button.prototype.doAction.call(this)},getStateIcon:function(rollover,pressed){var icon;if(this._selected){icon=Echo.Sync.getEffectProperty(this.component,"selectedStateIcon","disabledSelectedStateIcon",!this.enabled);if(icon){if(pressed){icon=this.component.render("pressedSelectedStateIcon",icon)}else if(rollover){icon=this.component.render("rolloverSelectedStateIcon",icon)}}}if(!icon){icon=Echo.Sync.getEffectProperty(this.component,"stateIcon","disabledStateIcon",!this.enabled);if(icon){if(pressed){icon=this.component.render("pressedStateIcon",icon)}else if(rollover){icon=this.component.render("rolloverStateIcon",icon)}}}return icon},_processStateChange:function(e){this._updateStateElement()},renderAdd:function(update,parentElement){this._selected=this.component.render("selected");Echo.Sync.Button.prototype.renderAdd.call(this,update,parentElement)},renderContent:function(){var text=this.component.render("text");var icon=this.component.render("icon");var orientation,margin,tct;var entityCount=(text!=null?1:0)+(icon?1:0)+1;if(entityCount==1){if(text!=null){this.renderButtonText(this.div,text)}else if(icon){this.iconImg=this.renderButtonIcon(this.div,icon)}else{this._stateElement=this._renderButtonState(this.div)}}else if(entityCount==2){orientation=Echo.Sync.TriCellTable.getInvertedOrientation(this.component,"statePosition","leading");margin=this.component.render("stateMargin",Echo.Sync.Button._defaultIconTextMargin);tct=new Echo.Sync.TriCellTable(orientation,Echo.Sync.Extent.toPixels(margin));if(text!=null){this.renderButtonText(tct.tdElements[0],text);if(icon){this.iconImg=this.renderButtonIcon(tct.tdElements[1],icon)}else{this._stateElement=this._renderButtonState(tct.tdElements[1])}}else{this.iconImg=this.renderButtonIcon(tct.tdElements[0],icon);this._stateElement=this._renderButtonState(tct.tdElements[1])}this.div.appendChild(tct.tableElement)}else if(entityCount==3){orientation=Echo.Sync.TriCellTable.getOrientation(this.component,"textPosition");margin=this.component.render("iconTextMargin",Echo.Sync.Button._defaultIconTextMargin);var stateOrientation=Echo.Sync.TriCellTable.getInvertedOrientation(this.component,"statePosition","leading");var stateMargin=this.component.render("stateMargin",Echo.Sync.Button._defaultIconTextMargin);tct=new Echo.Sync.TriCellTable(orientation,Echo.Sync.Extent.toPixels(margin),stateOrientation,Echo.Sync.Extent.toPixels(stateMargin));this.renderButtonText(tct.tdElements[0],text);this.iconImg=this.renderButtonIcon(tct.tdElements[1],icon);this._stateElement=this._renderButtonState(tct.tdElements[2]);this.div.appendChild(tct.tableElement)}},renderDispose:function(update){Echo.Sync.Button.prototype.renderDispose.call(this,update);if(this._stateElement){Core.Web.Event.removeAll(this._stateElement);this._stateElement=null}},_renderButtonState:function(parent){var stateIcon=this.getStateIcon();var stateElement;if(stateIcon){stateElement=document.createElement("img");Echo.Sync.ImageReference.renderImg(stateIcon,stateElement)}else{stateElement=document.createElement("input");stateElement.type=this.inputType;if(this.inputType=="radio"){stateElement.name="__echo_"+Echo.Sync.RadioButton._nextNameId++}stateElement.defaultChecked=this._selected?true:false;Core.Web.Event.add(stateElement,"change",Core.method(this,this._processStateChange),false);Core.Web.Event.add(this.div,"click",Core.method(this,this._processStateChange),false)}parent.appendChild(stateElement);var stateAlignment=this.component.render("stateAlignment");if(stateAlignment){Echo.Sync.Alignment.render(stateAlignment,parent,true,this.component)}return stateElement},setPressedState:function(pressedState){Echo.Sync.Button.prototype.setPressedState.call(this,pressedState);var stateIcon=this.getStateIcon(false,pressedState);if(stateIcon){var url=Echo.Sync.ImageReference.getUrl(stateIcon);if(this._stateElement.src!=url){this._stateElement.src=url}}},setRolloverState:function(rolloverState){Echo.Sync.Button.prototype.setRolloverState.call(this,rolloverState);var stateIcon=this.getStateIcon(rolloverState,false);if(stateIcon){var url=Echo.Sync.ImageReference.getUrl(stateIcon);if(this._stateElement.src!=url){this._stateElement.src=url}}},setSelected:function(newState){if(this._selected==newState){return}this._selected=newState;this.component.set("selected",newState);this._updateStateElement()},_updateStateElement:function(){var stateIcon=this.getStateIcon();if(stateIcon){this._stateElement.src=Echo.Sync.ImageReference.getUrl(stateIcon)}else{this._stateElement.checked=this._selected?true:false}}});Echo.Sync.CheckBox=Core.extend(Echo.Sync.ToggleButton,{$load:function(){Echo.Render.registerPeer("CheckBox",this)},inputType:"checkbox"});Echo.Sync.RadioButton=Core.extend(Echo.Sync.ToggleButton,{$static:{_nextNameId:0,_groups:new Core.Arrays.LargeMap()},$load:function(){Echo.Render.registerPeer("RadioButton",this)},inputType:"radio",_group:null,doAction:function(){if(this._group){this._group.deselect()}Echo.Sync.ToggleButton.prototype.doAction.call(this)},renderAdd:function(update,parentElement){var groupId=this.component.render("group");if(groupId!=null){var group=Echo.Sync.RadioButton._groups.map[groupId];if(!group){group=new Echo.Sync.RadioButton.Group(groupId);Echo.Sync.RadioButton._groups.map[groupId]=group}group.add(this);this._group=group}Echo.Sync.ToggleButton.prototype.renderAdd.call(this,update,parentElement)},renderDispose:function(update){Echo.Sync.ToggleButton.prototype.renderDispose.call(this,update);if(this._group){this._group.remove(this);if(this._group.size()===0){Echo.Sync.RadioButton._groups.remove(this._group.id)}this._group=null}}});Echo.Sync.RadioButton.Group=Core.extend({id:null,_buttons:null,$construct:function(id){this.id=id;this._buttons=[]},add:function(button){this._buttons.push(button)},deselect:function(){for(var i=0;i<this._buttons.length;++i){this._buttons[i].setSelected(false)}},remove:function(button){var buttonIndex=-1;for(var i=0;i<this._buttons.length;++i){if(this._buttons[i]==button){buttonIndex=i;break}}if(buttonIndex==-1){throw new Error("No such button: "+button.component.renderId);}if(this._buttons.length==1){this._buttons=[]}else{this._buttons[buttonIndex]=this._buttons[this._buttons.length-1];this._buttons.length=this._buttons.length-1}},size:function(){return this._buttons.length}});Echo.Sync.WindowPane=Core.extend(Echo.Render.ComponentSync,{$static:{CURSORS:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],PARTIAL_PROPERTIES:{background:true,backgroundImage:true,border:true,closable:true,closeIcon:true,closeIconInsets:true,controlsInsets:true,font:true,foreground:true,height:true,icon:true,iconInsets:true,insets:true,maximizeEnabled:true,maximizeIcon:true,maximumHeight:true,maximumWidth:true,minimizeEnabled:true,minimizeIcon:true,minimumHeight:true,minimumWidth:true,movable:true,positionX:true,positionY:true,resizable:true,title:true,titleBackground:true,titleBackgroundImage:true,titleFont:true,titleForeground:true,titleHeight:true,titleInsets:true,width:true},NON_RENDERED_PROPERTIES:{zIndex:true},PARTIAL_PROPERTIES_POSITION_SIZE:{positionX:true,positionY:true,width:true,height:true}},$load:function(){Echo.Render.registerPeer("WindowPane",this)},_initialAutoSizeComplete:false,_requested:null,_rendered:null,_dragInit:null,_dragOrigin:null,_resizeIncrement:null,_containerSize:null,_processBorderMouseMoveRef:null,_processBorderMouseUpRef:null,_processTitleBarMouseMoveRef:null,_processTitleBarMouseUpRef:null,_controlIcons:null,_overlay:null,$construct:function(){this._processBorderMouseMoveRef=Core.method(this,this._processBorderMouseMove);this._processBorderMouseUpRef=Core.method(this,this._processBorderMouseUp);this._processTitleBarMouseMoveRef=Core.method(this,this._processTitleBarMouseMove);this._processTitleBarMouseUpRef=Core.method(this,this._processTitleBarMouseUp)},_loadPositionAndSize:function(){this._requested={x:this.component.render("positionX","50%"),y:this.component.render("positionY","50%"),contentWidth:this.component.render("contentWidth"),contentHeight:this.component.render("contentHeight")};this._requested.width=this.component.render("width",this._requested.contentWidth?null:Echo.WindowPane.DEFAULT_WIDTH);this._requested.height=this.component.render("height")},_loadContainerSize:function(){this._containerSize=this.component.parent.peer.getSize()},_overlayAdd:function(){if(this._overlay){return}this._overlay=document.createElement("div");this._overlay.style.cssText="position:absolute;z-index:32600;width:100%;height:100%;";Echo.Sync.FillImage.render(this.client.getResourceUrl("Echo","resource/Transparent.gif"),this._overlay);document.body.appendChild(this._overlay)},_overlayRemove:function(){if(!this._overlay){return}document.body.removeChild(this._overlay);this._overlay=null},_processBorderMouseDown:function(e){if(!this.client||!this.client.verifyInput(this.component)){return true}Core.Web.dragInProgress=true;Core.Web.DOM.preventEventDefault(e);this._overlayAdd();this._loadContainerSize();this._dragInit={x:this._rendered.x,y:this._rendered.y,width:this._rendered.width,height:this._rendered.height};this._dragOrigin={x:e.clientX,y:e.clientY};switch(e.target){case this._borderDivs[0]:this._resizeIncrement={x:0,y:-1};break;case this._borderDivs[1]:this._resizeIncrement={x:1,y:-1};break;case this._borderDivs[2]:this._resizeIncrement={x:1,y:0};break;case this._borderDivs[3]:this._resizeIncrement={x:1,y:1};break;case this._borderDivs[4]:this._resizeIncrement={x:0,y:1};break;case this._borderDivs[5]:this._resizeIncrement={x:-1,y:1};break;case this._borderDivs[6]:this._resizeIncrement={x:-1,y:0};break;case this._borderDivs[7]:this._resizeIncrement={x:-1,y:-1};break}Core.Web.Event.add(document.body,"mousemove",this._processBorderMouseMoveRef,true);Core.Web.Event.add(document.body,"mouseup",this._processBorderMouseUpRef,true)},_processBorderMouseMove:function(e){this._setBounds({x:this._resizeIncrement.x==-1?this._dragInit.x+e.clientX-this._dragOrigin.x:null,y:this._resizeIncrement.y==-1?this._dragInit.y+e.clientY-this._dragOrigin.y:null,width:this._dragInit.width+(this._resizeIncrement.x*(e.clientX-this._dragOrigin.x)),height:this._dragInit.height+(this._resizeIncrement.y*(e.clientY-this._dragOrigin.y))},true);Echo.Sync.FillImageBorder.renderContainerDisplay(this._div)},_processBorderMouseUp:function(e){Core.Web.DOM.preventEventDefault(e);Core.Web.dragInProgress=false;this._overlayRemove();this._removeBorderListeners();this.component.set("positionX",this._rendered.x);this.component.set("positionY",this._rendered.y);this.component.set("width",this._rendered.width);this.component.set("height",this._rendered.height);this._requested={x:this._rendered.x,y:this._rendered.y,width:this._rendered.width,height:this._rendered.height};Echo.Sync.FillImageBorder.renderContainerDisplay(this._div);Core.Web.VirtualPosition.redraw(this._contentDiv);Core.Web.VirtualPosition.redraw(this._maskDiv);Echo.Render.notifyResize(this.component)},_processControlClick:function(e){if(!this.client||!this.client.verifyInput(this.component)){return true}switch(e.registeredTarget._controlData.name){case"close":this.component.userClose();break;case"maximize":this.component.userMaximize();Echo.Render.processUpdates(this.client);break;case"minimize":this.component.userMinimize();break}},_processControlRolloverEnter:function(e){if(!this.client||!this.client.verifyInput(this.component)){return true}Echo.Sync.ImageReference.renderImg(e.registeredTarget._controlData.rolloverIcon,e.registeredTarget.firstChild)},_processControlRolloverExit:function(e){Echo.Sync.ImageReference.renderImg(e.registeredTarget._controlData.icon,e.registeredTarget.firstChild)},clientKeyDown:function(e){if(e.keyCode==27){if(this.component.render("closable",true)){this.component.userClose();Core.Web.DOM.preventEventDefault(e.domEvent);return false}}return true},_processFocusClick:function(e){if(!this.client||!this.client.verifyInput(this.component)){return true}this.component.parent.peer.raise(this.component);return true},_processTitleBarMouseDown:function(e){if(!this.client||!this.client.verifyInput(this.component)){return true}var target=e.target;while(target!=e.registeredTarget){if(target._controlData){return}target=target.parentNode}this.component.parent.peer.raise(this.component);Core.Web.dragInProgress=true;Core.Web.DOM.preventEventDefault(e);this._overlayAdd();this._loadContainerSize();this._dragInit={x:this._rendered.x,y:this._rendered.y};this._dragOrigin={x:e.clientX,y:e.clientY};Core.Web.Event.add(document.body,"mousemove",this._processTitleBarMouseMoveRef,true);Core.Web.Event.add(document.body,"mouseup",this._processTitleBarMouseUpRef,true)},_processTitleBarMouseMove:function(e){this._setBounds({x:this._dragInit.x+e.clientX-this._dragOrigin.x,y:this._dragInit.y+e.clientY-this._dragOrigin.y},true)},_processTitleBarMouseUp:function(e){Core.Web.dragInProgress=false;this._overlayRemove();this._removeTitleBarListeners();this.component.set("positionX",this._rendered.x);this.component.set("positionY",this._rendered.y);this._requested.x=this._rendered.x;this._requested.y=this._rendered.y},_redraw:function(){if(this._rendered.width<=0||this._rendered.height<=0){return}var borderSideWidth=this._rendered.width-this._borderInsets.left-this._borderInsets.right;var borderSideHeight=this._rendered.height-this._borderInsets.top-this._borderInsets.bottom;this._div.style.left=this._rendered.x+"px";this._div.style.top=this._rendered.y+"px";this._div.style.width=this._rendered.width+"px";this._div.style.height=this._rendered.height+"px";this._titleBarDiv.style.width=(this._rendered.width-this._contentInsets.left-this._contentInsets.right)+"px";Echo.Sync.FillImageBorder.renderContainerDisplay(this._div);Core.Web.VirtualPosition.redraw(this._contentDiv);Core.Web.VirtualPosition.redraw(this._maskDiv)},_removeBorderListeners:function(){Core.Web.Event.remove(document.body,"mousemove",this._processBorderMouseMoveRef,true);Core.Web.Event.remove(document.body,"mouseup",this._processBorderMouseUpRef,true)},_removeTitleBarListeners:function(){Core.Web.Event.remove(document.body,"mousemove",this._processTitleBarMouseMoveRef,true);Core.Web.Event.remove(document.body,"mouseup",this._processTitleBarMouseUpRef,true)},renderAdd:function(update,parentElement){this._initialAutoSizeComplete=false;this._rtl=!this.component.getRenderLayoutDirection().isLeftToRight();this._contentDiv=document.createElement("div");var componentCount=this.component.getComponentCount();if(componentCount==1){Echo.Render.renderComponentAdd(update,this.component.getComponent(0),this._contentDiv)}else if(componentCount>1){throw new Error("Too many children: "+componentCount);}if(Core.Web.Env.QUIRK_IE_SELECT_Z_INDEX){this._maskDiv=document.createElement("div");this._maskDiv.style.cssText="filter:alpha(opacity=0);z-index:1;position:absolute;left:0,right:0,top:0,bottom:0,borderWidth:0;";var maskIFrameElement=document.createElement("iframe");maskIFrameElement.style.cssText="width:100%;height:100%;";maskIFrameElement.src=this.client.getResourceUrl("Echo","resource/Blank.html");this._maskDiv.appendChild(maskIFrameElement)}Echo.Sync.LayoutDirection.render(this.component.getLayoutDirection(),this._div);this._renderAddFrame(parentElement)},_renderAddFrame:function(parentElement){this._loadPositionAndSize();this._div=document.createElement("div");this._div.id=this.component.renderId;this._div.tabIndex="0";this._minimumWidth=Echo.Sync.Extent.toPixels(this.component.render("minimumWidth",Echo.WindowPane.DEFAULT_MINIMUM_WIDTH),true);this._minimumHeight=Echo.Sync.Extent.toPixels(this.component.render("minimumHeight",Echo.WindowPane.DEFAULT_MINIMUM_HEIGHT),false);this._maximumWidth=Echo.Sync.Extent.toPixels(this.component.render("maximumWidth"),true);this._maximumHeight=Echo.Sync.Extent.toPixels(this.component.render("maximumHeight"),false);this._resizable=this.component.render("resizable",true);var border=this.component.render("border",Echo.WindowPane.DEFAULT_BORDER);this._borderInsets=Echo.Sync.Insets.toPixels(border.borderInsets);this._contentInsets=Echo.Sync.Insets.toPixels(border.contentInsets);var movable=this.component.render("movable",true);var closable=this.component.render("closable",true);var maximizeEnabled=this.component.render("maximizeEnabled",false);var minimizeEnabled=this.component.render("minimizeEnabled",false);var hasControlIcons=closable||maximizeEnabled||minimizeEnabled;var fillImageFlags=this.component.render("ieAlphaRenderBorder")?Echo.Sync.FillImage.FLAG_ENABLE_IE_PNG_ALPHA_FILTER:0;this._div=Echo.Sync.FillImageBorder.renderContainer(border,{absolute:true});this._div.style.outlineStyle="none";this._div.style.overflow="hidden";this._div.style.zIndex=1;this._borderDivs=Echo.Sync.FillImageBorder.getBorder(this._div);var mouseDownHandler=this._resizable?Core.method(this,this._processBorderMouseDown):null;for(var i=0;i<8;++i){if(this._borderDivs[i]){if(this._resizable){this._borderDivs[i].style.zIndex=2;this._borderDivs[i].style.cursor=Echo.Sync.WindowPane.CURSORS[i];Core.Web.Event.add(this._borderDivs[i],"mousedown",mouseDownHandler,true)}}}this._titleBarDiv=document.createElement("div");this._titleBarDiv.style.position="absolute";this._titleBarDiv.style.zIndex=3;var icon=this.component.render("icon");if(icon){var titleIconDiv=document.createElement("div");titleIconDiv.style[Core.Web.Env.CSS_FLOAT]=this._rtl?"right":"left";Echo.Sync.Insets.render(this.component.render("iconInsets"),titleIconDiv,"padding");this._titleBarDiv.appendChild(titleIconDiv);var img=document.createElement("img");Echo.Sync.ImageReference.renderImg(icon,img);titleIconDiv.appendChild(img)}var title=this.component.render("title");var titleTextDiv=document.createElement("div");if(icon){titleTextDiv.style[Core.Web.Env.CSS_FLOAT]=this._rtl?"right":"left"}titleTextDiv.style.whiteSpace="nowrap";Echo.Sync.Font.render(this.component.render("titleFont"),titleTextDiv);Echo.Sync.Insets.render(this.component.render("titleInsets",Echo.WindowPane.DEFAULT_TITLE_INSETS),titleTextDiv,"padding");titleTextDiv.appendChild(document.createTextNode(title?title:"\u00a0"));this._titleBarDiv.appendChild(titleTextDiv);var titleBarHeight=this.component.render("titleHeight");if(titleBarHeight){this._titleBarHeight=Echo.Sync.Extent.toPixels(titleBarHeight)}if(!titleBarHeight){var titleMeasure=new Core.Web.Measure.Bounds(this._titleBarDiv);if(titleMeasure.height){this._titleBarHeight=titleMeasure.height}else{this._titleBarHeight=Echo.Sync.Extent.toPixels(Echo.WindowPane.DEFAULT_TITLE_HEIGHT)}}this._titleBarDiv.style.top=this._contentInsets.top+"px";this._titleBarDiv.style.left=this._contentInsets.left+"px";this._titleBarDiv.style.height=this._titleBarHeight+"px";this._titleBarDiv.style.overflow="hidden";if(movable){this._titleBarDiv.style.cursor="move";Core.Web.Event.add(this._titleBarDiv,"mousedown",Core.method(this,this._processTitleBarMouseDown),true)}Echo.Sync.Color.render(this.component.render("titleForeground"),this._titleBarDiv,"color");var titleBackground=this.component.render("titleBackground");var titleBackgroundImage=this.component.render("titleBackgroundImage");if(titleBackground){this._titleBarDiv.style.backgroundColor=titleBackground}if(titleBackgroundImage){Echo.Sync.FillImage.render(titleBackgroundImage,this._titleBarDiv)}if(!titleBackground&&!titleBackgroundImage){this._titleBarDiv.style.backgroundColor=Echo.WindowPane.DEFAULT_TITLE_BACKGROUND}if(hasControlIcons){this._controlDiv=document.createElement("div");this._controlDiv.style.cssText="position:absolute;top:0;";this._controlDiv.style[this._rtl?"left":"right"]=0;Echo.Sync.Insets.render(this.component.render("controlsInsets",Echo.WindowPane.DEFAULT_CONTROLS_INSETS),this._controlDiv,"margin");this._titleBarDiv.appendChild(this._controlDiv);if(closable){this._renderControlIcon("close",this.client.getResourceUrl("Echo","resource/WindowPaneClose.gif"),"[X]")}if(maximizeEnabled){this._renderControlIcon("maximize",this.client.getResourceUrl("Echo","resource/WindowPaneMaximize.gif"),"[+]")}if(minimizeEnabled){this._renderControlIcon("minimize",this.client.getResourceUrl("Echo","resource/WindowPaneMinimize.gif"),"[-]")}}this._div.appendChild(this._titleBarDiv);this._contentDiv.style.cssText="position:absolute;z-index:2;top:"+(this._contentInsets.top+this._titleBarHeight)+"px;bottom:"+this._contentInsets.bottom+"px;left:"+this._contentInsets.left+"px;right:"+this._contentInsets.right+"px;"+"overflow:"+((this.component.children.length===0||this.component.children[0].pane)?"hidden;":"auto;");Echo.Sync.Font.renderClear(this.component.render("font"),this._contentDiv);if(this.component.children.length>0&&!this.component.children[0].pane){Echo.Sync.Insets.render(this.component.render("insets"),this._contentDiv,"padding")}Echo.Sync.Color.render(this.component.render("background",Echo.WindowPane.DEFAULT_BACKGROUND),this._contentDiv,"backgroundColor");Echo.Sync.Color.render(this.component.render("foreground",Echo.WindowPane.DEFAULT_FOREGROUND),this._contentDiv,"color");Echo.Sync.FillImage.render(this.component.render("backgroundImage"),this._contentDiv);this._div.appendChild(this._contentDiv);if(Core.Web.Env.QUIRK_IE_SELECT_Z_INDEX){this._div.appendChild(this._maskDiv)}Core.Web.Event.add(this._div,"click",Core.method(this,this._processFocusClick),true);parentElement.appendChild(this._div)},_renderControlIcon:function(name,defaultIcon,altText){var controlDiv=document.createElement("div"),icon=this.component.render(name+"Icon",defaultIcon),rolloverIcon=this.component.render(name+"RolloverIcon");var controlSpacing=Echo.Sync.Extent.toCssValue(this.component.render("controlsSpacing",Echo.WindowPane.DEFAULT_CONTROLS_SPACING));controlDiv.style.cssText=this._rtl?("float:left;cursor:pointer;margin-right:"+controlSpacing):("float:right;cursor:pointer;margin-left:"+controlSpacing);Echo.Sync.Insets.render(this.component.render(name+"Insets"),controlDiv,"padding");if(icon){var img=document.createElement("img");Echo.Sync.ImageReference.renderImg(icon,img);controlDiv.appendChild(img);if(rolloverIcon){Core.Web.Event.add(controlDiv,"mouseover",Core.method(this,this._processControlRolloverEnter),false);Core.Web.Event.add(controlDiv,"mouseout",Core.method(this,this._processControlRolloverExit),false)}}else{controlDiv.appendChild(document.createTextNode(altText))}Core.Web.Event.add(controlDiv,"click",Core.method(this,this._processControlClick),false);this._controlDiv.appendChild(controlDiv);if(this._controlIcons==null){this._controlIcons=[]}this._controlIcons.push(controlDiv);controlDiv._controlData={name:name,icon:icon,rolloverIcon:rolloverIcon}},renderDisplay:function(){this._loadContainerSize();this._setBounds(this._requested,false);Core.Web.VirtualPosition.redraw(this._contentDiv);Core.Web.VirtualPosition.redraw(this._maskDiv);if(!this._initialAutoSizeComplete){this._initialAutoSizeComplete=true;var imageListener=Core.method(this,function(){if(this.component){Echo.Render.renderComponentDisplay(this.component)}});Core.Web.Image.monitor(this._contentDiv,imageListener)}},renderDispose:function(update){this._overlayRemove();this._renderDisposeFrame();this._maskDiv=null;this._contentDiv=null},_renderDisposeFrame:function(){var i;Core.Web.Event.removeAll(this._div);for(i=0;i<8;++i){if(this._borderDivs[i]){Core.Web.Event.removeAll(this._borderDivs[i])}}this._borderDivs=null;if(this._controlIcons!=null){for(i=0;i<this._controlIcons.length;++i){Core.Web.Event.removeAll(this._controlIcons[i])}this._controlIcons=null}Core.Web.Event.removeAll(this._titleBarDiv);this._titleBarDiv=null;this._div=null},renderFocus:function(){Core.Web.DOM.focusElement(this._div)},renderUpdate:function(update){if(update.hasAddedChildren()||update.hasRemovedChildren()){}else if(update.isUpdatedPropertySetIn(Echo.Sync.WindowPane.NON_RENDERED_PROPERTIES)){return false}else if(update.isUpdatedPropertySetIn(Echo.Sync.WindowPane.PARTIAL_PROPERTIES_POSITION_SIZE)){this._loadPositionAndSize();return false}else if(update.isUpdatedPropertySetIn(Echo.Sync.WindowPane.PARTIAL_PROPERTIES)){this._renderUpdateFrame();return false}var element=this._div;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement);return true},_renderUpdateFrame:function(){var element=this._div;var containerElement=element.parentNode;this._renderDisposeFrame();containerElement.removeChild(element);this._renderAddFrame(containerElement)},_setBounds:function(specBounds,userAdjusting){var pxBounds={},calculatedHeight=false;if(userAdjusting){if(specBounds.x!=null&&specBounds.x<0){specBounds.x=0}if(specBounds.y!=null&&specBounds.y<0){specBounds.y=0}}if(specBounds.width!=null){pxBounds.width=Math.round(Echo.Sync.Extent.isPercent(specBounds.width)?(parseInt(specBounds.width,10)*this._containerSize.width/100):Echo.Sync.Extent.toPixels(specBounds.width,true))}else if(specBounds.contentWidth!=null){pxBounds.contentWidth=Math.round(Echo.Sync.Extent.isPercent(specBounds.contentWidth)?(parseInt(specBounds.contentWidth,10)*this._containerSize.width/100):Echo.Sync.Extent.toPixels(specBounds.contentWidth,true));pxBounds.width=this._contentInsets.left+this._contentInsets.right+pxBounds.contentWidth}if(specBounds.height!=null){pxBounds.height=Math.round(Echo.Sync.Extent.isPercent(specBounds.height)?(parseInt(specBounds.height,10)*this._containerSize.height/100):Echo.Sync.Extent.toPixels(specBounds.height,false))}else if(specBounds.contentHeight!=null){pxBounds.contentHeight=Math.round(Echo.Sync.Extent.isPercent(specBounds.contentHeight)?(parseInt(specBounds.contentHeight,10)*this._containerSize.height/100):Echo.Sync.Extent.toPixels(specBounds.contentHeight,false));pxBounds.height=this._contentInsets.top+this._contentInsets.bottom+this._titleBarHeight+pxBounds.contentHeight}else if(!userAdjusting){calculatedHeight=true;if(this.component.children[0]){var contentWidth=pxBounds.contentWidth?pxBounds.contentWidth:pxBounds.width-(this._contentInsets.left+this._contentInsets.right);var contentDivCss=this._contentDiv.style.cssText;if(this.component.children[0].peer.getPreferredSize){this._contentDiv.style.cssText="position:absolute;width:"+contentWidth+"px;height:"+this._containerSize.height+"px";var prefSize=this.component.children[0].peer.getPreferredSize(Echo.Render.ComponentSync.SIZE_HEIGHT);if(prefSize.height){pxBounds.height=this._contentInsets.top+this._contentInsets.bottom+this._titleBarHeight+prefSize.height}this._contentDiv.style.cssText=contentDivCss}if(!pxBounds.height&&!this.component.children[0].pane){var insets=Echo.Sync.Insets.toPixels(this.component.render("insets"));this._contentDiv.style.position="static";this._contentDiv.style.width=(contentWidth-insets.left-insets.right)+"px";this._contentDiv.style.height="";this._contentDiv.style.padding="";var measuredHeight=new Core.Web.Measure.Bounds(this._contentDiv).height;if(measuredHeight){pxBounds.height=this._contentInsets.top+this._contentInsets.bottom+this._titleBarHeight+measuredHeight+insets.top+insets.bottom}this._contentDiv.style.cssText=contentDivCss}}if(!pxBounds.height){pxBounds.height=Echo.Sync.Extent.toPixels(Echo.WindowPane.DEFAULT_HEIGHT,false)}}if(specBounds.x!=null){if(Echo.Sync.Extent.isPercent(specBounds.x)){pxBounds.x=Math.round((this._containerSize.width-pxBounds.width)*(parseInt(specBounds.x,10)/100));if(pxBounds.x<0){pxBounds.x=0}}else{pxBounds.x=Math.round(Echo.Sync.Extent.toPixels(specBounds.x,true));if(pxBounds.x<0){pxBounds.x+=this._containerSize.width-pxBounds.width}}}if(specBounds.y!=null){if(Echo.Sync.Extent.isPercent(specBounds.y)){pxBounds.y=Math.round((this._containerSize.height-pxBounds.height)*(parseInt(specBounds.y,10)/100));if(pxBounds.y<0){pxBounds.y=0}}else{pxBounds.y=Math.round(Echo.Sync.Extent.toPixels(specBounds.y,false));if(pxBounds.y<0){pxBounds.y+=this._containerSize.height-pxBounds.height}}}if(this._rendered==null){this._rendered={}}if(pxBounds.width!=null){if(this._resizable&&pxBounds.width>this._containerSize.width){pxBounds.width=this._containerSize.width}if(this._maximumWidth&&pxBounds.width>this._maximumWidth){if(userAdjusting&&pxBounds.x!=null){pxBounds.x+=(pxBounds.width-this._maximumWidth)}pxBounds.width=this._maximumWidth}if(pxBounds.width<this._minimumWidth){if(userAdjusting&&pxBounds.x!=null){pxBounds.x+=(pxBounds.width-this._minimumWidth)}pxBounds.width=this._minimumWidth}this._rendered.width=Math.round(pxBounds.width)}if(pxBounds.height!=null){if((calculatedHeight||this._resizable)&&pxBounds.height>this._containerSize.height){pxBounds.height=this._containerSize.height}if(this._maximumHeight&&pxBounds.height>this._maximumHeight){if(userAdjusting&&pxBounds.y!=null){pxBounds.y+=(pxBounds.height-this._maximumHeight)}pxBounds.height=this._maximumHeight}if(pxBounds.height<this._minimumHeight){if(userAdjusting&&pxBounds.y!=null){pxBounds.y+=(pxBounds.height-this._minimumHeight)}pxBounds.height=this._minimumHeight}this._rendered.height=Math.round(pxBounds.height)}if(pxBounds.x!=null){if(this._containerSize.width>0&&pxBounds.x>this._containerSize.width-this._rendered.width){pxBounds.x=this._containerSize.width-this._rendered.width}if(pxBounds.x<0){pxBounds.x=0}this._rendered.x=Math.round(pxBounds.x)}if(pxBounds.y!=null){if(this._containerSize.height>0&&pxBounds.y>this._containerSize.height-this._rendered.height){pxBounds.y=this._containerSize.height-this._rendered.height}if(pxBounds.y<0){pxBounds.y=0}this._rendered.y=Math.round(pxBounds.y)}this._redraw()}});Extras={uniqueId:0};Extras.Serial={PROPERTY_TYPE_PREFIX:"Extras.Serial."};Extras.Sync={};Extras.Sync.Animation=Core.extend({stepIndex:0,startTime:null,endTime:null,_listenerList:null,_runnable:null,$virtual:{runTime:0,sleepInterval:10},$abstract:{init:function(){},complete:function(abort){},step:function(progress){}},_doStep:function(){var currentTime=new Date().getTime();if(currentTime<this.endTime){if(this.stepIndex===0){this.init()}else{this.step((currentTime-this.startTime)/this.runTime)}++this.stepIndex;Core.Web.Scheduler.add(this._runnable)}else{this.complete(false);if(this._completeMethod){this._completeMethod(false)}}},abort:function(){Core.Web.Scheduler.remove(this._runnable);this.complete(true);if(this._completeMethod){this._completeMethod(true)}},start:function(completeMethod){this._runnable=new Core.Web.Scheduler.MethodRunnable(Core.method(this,this._doStep),this.sleepInterval,false);this.startTime=new Date().getTime();this.endTime=this.startTime+this.runTime;this._completeMethod=completeMethod;Core.Web.Scheduler.add(this._runnable)}});Extras.AccordionPane=Core.extend(Echo.Component,{$static:{DEFAULT_ANIMATION_TIME:350},$load:function(){Echo.ComponentFactory.registerType("Extras.AccordionPane",this)},componentType:"Extras.AccordionPane",pane:true,$construct:function(properties){Echo.Component.call(this,properties);this.addListener("property",Core.method(this,this._tabChangeListener))},doTabSelect:function(tabId){var tabComponent=this.application.getComponentByRenderId(tabId);if(!tabComponent||tabComponent.parent!=this){throw new Error("doTabSelect(): Invalid tab: "+tabId);}this.set("activeTabId",tabId);this.fireEvent({type:"tabSelect",source:this,tab:tabComponent,data:tabId})},_tabChangeListener:function(e){var i;switch(e.propertyName){case"activeTabId":if(this.application){for(i=0;i<this.children.length;++i){if(this.children[i].renderId==e.newValue){if(this.get("activeTabIndex")!=i){this.set("activeTabIndex",i)}return}}}break;case"activeTabIndex":i=parseInt(e.newValue,10);if(this.application&&this.children[i]&&this.get("activeTabId")!=this.children[i].renderId){this.set("activeTabId",this.children[i].renderId)}break}}});Extras.BorderPane=Core.extend(Echo.Component,{$static:{DEFAULT_BORDER:{color:"#00007f",contentInsets:20,borderInsets:3}},$load:function(){Echo.ComponentFactory.registerType("Extras.BorderPane",this)},componentType:"Extras.BorderPane",pane:true});Extras.CalendarSelect=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.CalendarSelect",this)},componentType:"Extras.CalendarSelect"});Extras.ColorSelect=Core.extend(Echo.Component,{$static:{DEFAULT_VALUE_WIDTH:"12em",DEFAULT_SATURATION_HEIGHT:"12em",DEFAULT_HUE_WIDTH:"2em"},$load:function(){Echo.ComponentFactory.registerType("Extras.ColorSelect",this)},componentType:"Extras.ColorSelect"});Extras.DataGrid=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.DataGrid",this)},componentType:"Extras.DataGrid",pane:true});Extras.DataGrid.Model=Core.extend({$abstract:{get:function(column,row){},getColumnCount:function(){},getRowCount:function(){}},$virtual:{prefetch:null}});Extras.DragSource=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.DragSource",this)},componentType:"Extras.DragSource",doDrop:function(dropTarget,specificTarget){this.fireEvent({type:"drop",source:this,dropTarget:dropTarget,specificTarget:specificTarget,data:specificTarget})}});Extras.Group=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.Group",this)},componentType:"Extras.Group"});Extras.MenuComponent=Core.extend(Echo.Component,{$abstract:true,modalSupport:true,focusable:true,doAction:function(itemModel){var path=itemModel.getItemPositionPath().join(".");if(itemModel instanceof Extras.ToggleOptionModel){this._toggleItem(itemModel)}this.fireEvent({type:"action",source:this,data:path,modelId:itemModel.modelId})},_toggleItem:function(itemModel){var model=this.get("model");var stateModel=this.get("stateModel");if(itemModel.groupId){var groupItems=model.findItemGroup(itemModel.groupId);for(var i=0;i<groupItems.length;++i){stateModel.setSelected(groupItems[i].modelId,false)}}if(stateModel){stateModel.setSelected(itemModel.modelId,!stateModel.isSelected(itemModel.modelId))}}});Extras.ContextMenu=Core.extend(Extras.MenuComponent,{$static:{ACTIVATION_MODE_CLICK:1,ACTIVATION_MODE_CONTEXT_CLICK:2},$load:function(){Echo.ComponentFactory.registerType("Extras.ContextMenu",this)},componentType:"Extras.ContextMenu"});Extras.DropDownMenu=Core.extend(Extras.MenuComponent,{$load:function(){Echo.ComponentFactory.registerType("Extras.DropDownMenu",this)},componentType:"Extras.DropDownMenu"});Extras.MenuBarPane=Core.extend(Extras.MenuComponent,{$load:function(){Echo.ComponentFactory.registerType("Extras.MenuBarPane",this)},componentType:"Extras.MenuBarPane"});Extras.ItemModel=Core.extend({$abstract:true,modelId:null,parent:null});Extras.MenuModel=Core.extend(Extras.ItemModel,{text:null,icon:null,items:null,$construct:function(modelId,text,icon,items){this.modelId=modelId;this.id=Extras.uniqueId++;this.parent=null;this.text=text;this.icon=icon;if(items){for(var i=0;i<items.length;++i){items[i].parent=this}}this.items=items?items:[]},addItem:function(item){this.items.push(item);item.parent=this},findItem:function(id){var i;for(i=0;i<this.items.length;++i){if(this.items[i].id==id){return this.items[i]}}for(i=0;i<this.items.length;++i){if(this.items[i]instanceof Extras.MenuModel){var itemModel=this.items[i].findItem(id);if(itemModel){return itemModel}}}return null},findItemGroup:function(groupId){var groupItems=[];for(var i=0;i<this.items.length;++i){if(this.items[i]instanceof Extras.MenuModel){var subGroupItems=this.items[i].findItemGroup(groupId);for(var j=0;j<subGroupItems.length;++j){groupItems.push(subGroupItems[j])}}else if(this.items[i].groupId==groupId){groupItems.push(this.items[i])}}return groupItems},getItemModelFromPositions:function(itemPositions){var menuModel=this;for(var i=0;i<itemPositions.length;++i){menuModel=menuModel.items[parseInt(itemPositions[i],10)]}return menuModel},indexOfItem:function(item){for(var i=0;i<this.items.length;++i){if(this.items[i]==item){return i}}return-1},toString:function(){return"MenuModel \""+this.text+"\" Items:"+this.items.length}});Extras.OptionModel=Core.extend(Extras.ItemModel,{text:null,icon:null,$construct:function(modelId,text,icon){this.modelId=modelId;this.id=Extras.uniqueId++;this.parent=null;this.text=text;this.icon=icon},getItemPositionPath:function(){var path=[];var itemModel=this;while(itemModel.parent!=null){path.unshift(itemModel.parent.indexOfItem(itemModel));itemModel=itemModel.parent}return path},toString:function(){return"OptionModel \""+this.text+"\""}});Extras.ToggleOptionModel=Core.extend(Extras.OptionModel,{$construct:function(modelId,text){Extras.OptionModel.call(this,modelId,text,null)}});Extras.RadioOptionModel=Core.extend(Extras.ToggleOptionModel,{groupId:null,$construct:function(modelId,text,groupId){Extras.ToggleOptionModel.call(this,modelId,text);this.groupId=groupId}});Extras.SeparatorModel=Core.extend(Extras.ItemModel,{});Extras.MenuStateModel=Core.extend({_disabledItems:null,_selectedItems:null,$construct:function(){this._disabledItems=[];this._selectedItems=[]},isEnabled:function(modelId){if(modelId){for(var i=0;i<this._disabledItems.length;i++){if(this._disabledItems[i]==modelId){return false}}}return true},isSelected:function(modelId){if(modelId){for(var i=0;i<this._selectedItems.length;i++){if(this._selectedItems[i]==modelId){return true}}}return false},setEnabled:function(modelId,enabled){if(enabled){Core.Arrays.remove(this._disabledItems,modelId)}else{if(Core.Arrays.indexOf(this._disabledItems,modelId)==-1){this._disabledItems.push(modelId)}}},setSelected:function(modelId,selected){if(selected){if(Core.Arrays.indexOf(this._selectedItems,modelId)==-1){this._selectedItems.push(modelId)}}else{Core.Arrays.remove(this._selectedItems,modelId)}}});Extras.RichTextArea=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.RichTextArea",this)},componentType:"Extras.RichTextArea",focusable:true,doAction:function(){this.fireEvent({source:this,type:"action"})},execCommand:function(commandName,value){this.fireEvent({type:"execCommand",source:this,commandName:commandName,value:value})},insertHtml:function(html){this.execCommand("insertHtml",html)}});Extras.RichTextInput=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.RichTextInput",this)},componentType:"Extras.RichTextInput",focusable:true,doAction:function(){this.fireEvent({source:this,type:"action"})},doCursorStyleChange:function(style){this.fireEvent({source:this,type:"cursorStyleChange",style:style})},execCommand:function(commandName,value){this.fireEvent({type:"execCommand",source:this,commandName:commandName,value:value})},insertHtml:function(html){this.execCommand("insertHtml",html)}});Extras.TabPane=Core.extend(Echo.Component,{$static:{BORDER_TYPE_NONE:0,BORDER_TYPE_ADJACENT_TO_TABS:1,BORDER_TYPE_PARALLEL_TO_TABS:2,BORDER_TYPE_SURROUND:3,TAB_POSITION_TOP:0,TAB_POSITION_BOTTOM:1},$load:function(){Echo.ComponentFactory.registerType("Extras.TabPane",this)},componentType:"Extras.TabPane",pane:true,$construct:function(properties){Echo.Component.call(this,properties);this.addListener("property",Core.method(this,this._tabChangeListener))},doTabClose:function(tabId){var tabComponent=this.application.getComponentByRenderId(tabId);if(!tabComponent||tabComponent.parent!=this){throw new Error("doTabClose(): Invalid tab: "+tabId);}this.fireEvent({type:"tabClose",source:this,tab:tabComponent,data:tabId})},doTabSelect:function(tabId){var tabComponent=this.application.getComponentByRenderId(tabId);if(!tabComponent||tabComponent.parent!=this){throw new Error("doTabSelect(): Invalid tab: "+tabId);}this.set("activeTabId",tabId);this.fireEvent({type:"tabSelect",source:this,tab:tabComponent,data:tabId})},_tabChangeListener:function(e){var i;switch(e.propertyName){case"activeTabId":if(this.application){for(i=0;i<this.children.length;++i){if(this.children[i].renderId==e.newValue){if(this.get("activeTabIndex")!=i){this.set("activeTabIndex",i)}return}}}break;case"activeTabIndex":i=parseInt(e.newValue,10);if(this.application&&this.children[i]&&this.get("activeTabId")!=this.children[i].renderId){this.set("activeTabId",this.children[i].renderId)}break}}});Extras.ToolTipContainer=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.ToolTipContainer",this)},componentType:"Extras.ToolTipContainer"});Extras.TransitionPane=Core.extend(Echo.Component,{$static:{DEFAULT_DURATION:350,DEFAULT_TYPE:0,TYPE_IMMEDIATE_REPLACE:0,TYPE_CAMERA_PAN_LEFT:1,TYPE_CAMERA_PAN_RIGHT:2,TYPE_CAMERA_PAN_UP:3,TYPE_CAMERA_PAN_DOWN:4,TYPE_BLIND_BLACK_IN:5,TYPE_BLIND_BLACK_OUT:6,TYPE_FADE_TO_BLACK:7,TYPE_FADE_TO_WHITE:8,TYPE_FADE:9},$load:function(){Echo.ComponentFactory.registerType("Extras.TransitionPane",this)},componentType:"Extras.TransitionPane",pane:true});Extras.Serial.ItemModel=Core.extend(Echo.Serial.PropertyTranslator,{$static:{parseIcon:function(client,pElement){var icon=Core.Web.DOM.getChildElementByTagName(pElement,"icon");if(icon){return Echo.Serial.ImageReference.toProperty(client,icon)}return null},toProperty:function(client,pElement){var type=pElement.getAttribute("t");if(type.indexOf(Extras.Serial.PROPERTY_TYPE_PREFIX)===0){type=type.substring(Extras.Serial.PROPERTY_TYPE_PREFIX.length)}var translator=Extras.Serial[type];if(translator){return translator.toProperty(client,pElement)}else{throw new Error("Unsupported model type: "+type);}}}});Extras.Serial.MenuModel=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(client,pElement){var id=pElement.getAttribute("id");var text=pElement.getAttribute("text");var icon=Extras.Serial.ItemModel.parseIcon(client,pElement);var model=new Extras.MenuModel(id,text,icon);var children=Core.Web.DOM.getChildElementsByTagName(pElement,"item");for(var i=0;i<children.length;i++){var childElement=children[i];var subModel=Extras.Serial.ItemModel.toProperty(client,childElement);model.addItem(subModel)}return model}},$load:function(){Echo.Serial.addPropertyTranslator("Extras.Serial.MenuModel",this)}});Extras.Serial.OptionModel=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(client,pElement){var id=pElement.getAttribute("id");var text=pElement.getAttribute("text");var icon=Extras.Serial.ItemModel.parseIcon(client,pElement);return new Extras.OptionModel(id,text,icon)}},$load:function(){Echo.Serial.addPropertyTranslator("Extras.Serial.OptionModel",this)}});Extras.Serial.RadioOptionModel=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(client,pElement){var id=pElement.getAttribute("id");var text=pElement.getAttribute("text");var icon=Extras.Serial.ItemModel.parseIcon(client,pElement);return new Extras.RadioOptionModel(id,text,icon)}},$load:function(){Echo.Serial.addPropertyTranslator("Extras.Serial.RadioOptionModel",this)}});Extras.Serial.ToggleOptionModel=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(client,pElement){var id=pElement.getAttribute("id");var text=pElement.getAttribute("text");var icon=Extras.Serial.ItemModel.parseIcon(client,pElement);return new Extras.ToggleOptionModel(id,text,icon)}},$load:function(){Echo.Serial.addPropertyTranslator("Extras.Serial.ToggleOptionModel",this)}});Extras.Serial.SeparatorModel=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(client,pElement){return new Extras.SeparatorModel()}},$load:function(){Echo.Serial.addPropertyTranslator("Extras.Serial.SeparatorModel",this)}});Extras.Serial.MenuStateModel=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(client,pElement){var stateModel=new Extras.MenuStateModel();var children=Core.Web.DOM.getChildElementsByTagName(pElement,"i");for(var i=0;i<children.length;i++){var childElement=children[i];var enabledValue=childElement.getAttribute("enabled");if(enabledValue!=null){stateModel.setEnabled(childElement.getAttribute("id"),enabledValue=="true")}var selectedValue=childElement.getAttribute("selected");if(selectedValue!=null){stateModel.setSelected(childElement.getAttribute("id"),selectedValue=="true")}}return stateModel}},$load:function(){Echo.Serial.addPropertyTranslator("Extras.Serial.MenuStateModel",this)}});Extras.Sync.AccordionPane=Core.extend(Echo.Render.ComponentSync,{$static:{_DEFAULTS:{tabBackground:"#cfcfcf",tabBorder:"1px outset #cfcfcf",tabForeground:"#000000",tabInsets:"2px 5px",tabContentInsets:0}},$load:function(){Echo.Render.registerPeer("Extras.AccordionPane",this)},_animationTime:0,div:null,_activeTabId:null,_newImagesLoaded:null,_pendingRenderDisplay:false,rotation:null,tabs:null,resetOverflowForAnimation:false,_tabSelectListenerRef:null,imageMonitorRef:null,$construct:function(){this.tabs=[];this.resetOverflowForAnimation=Core.Web.Env.ENGINE_GECKO||Core.Web.Env.ENGINE_MSHTML;this._tabSelectListenerRef=Core.method(this,this._tabSelectListener);this.imageMonitorRef=Core.method(this,this._imageMonitor)},_getTabById:function(tabId){for(var i=0;i<this.tabs.length;++i){var tab=this.tabs[i];if(tab.childComponent.renderId==tabId){return tab}}return null},getTabHeight:function(beginIndex,endIndex){if(endIndex==null||endIndex<beginIndex){throw new Error("Invalid indices: begin="+beginIndex+",end="+endIndex);}else{var tabHeight=0;for(var i=beginIndex;i<endIndex;++i){tabHeight+=this.tabs[i].tabDiv.offsetHeight}return tabHeight}},_imageMonitor:function(){if(this._newImagesLoaded){return}this._newImagesLoaded=true;Core.Web.Scheduler.run(Core.method(this,function(){if(this.client&&!this._pendingRenderDisplay){this.redrawTabs(false)}this._newImagesLoaded=false}))},redrawTabs:function(notifyComponentUpdate){if(this.rotation){this.rotation.abort()}if(this._activeTabId==null||this._getTabById(this._activeTabId)==null){if(this.tabs.length>0){this._activeTabId=this.tabs[0].childComponent.renderId}else{this._activeTabId=null}}var selectionPassed=false;for(var i=0;i<this.tabs.length;++i){if(selectionPassed){this.tabs[i].tabDiv.style.top="";this.tabs[i].tabDiv.style.bottom=this.getTabHeight(i+1,this.tabs.length)+"px"}else{this.tabs[i].tabDiv.style.bottom="";this.tabs[i].tabDiv.style.top=this.getTabHeight(0,i)+"px"}this.tabs[i].containerDiv.style.height="";if(this._activeTabId==this.tabs[i].childComponent.renderId){selectionPassed=true;this.tabs[i].containerDiv.style.display="block";this.tabs[i].containerDiv.style.top=this.getTabHeight(0,i+1)+"px";this.tabs[i].containerDiv.style.bottom=this.getTabHeight(i+1,this.tabs.length)+"px";this.tabs[i].contentDiv.style.top=0;this.tabs[i].contentDiv.style.bottom=0;this.tabs[i].contentDiv.style.height="";Core.Web.VirtualPosition.redraw(this.tabs[i].contentDiv)}else{this.tabs[i].containerDiv.style.display="none"}}if(notifyComponentUpdate){Echo.Render.notifyResize(this.component);this.renderDisplayTabs()}},renderAdd:function(update,parentElement){this.component.addListener("tabSelect",this._tabSelectListenerRef);this._animationTime=this.component.render("animationTime",Extras.AccordionPane.DEFAULT_ANIMATION_TIME);this._activeTabId=this.component.get("activeTabId");this.div=document.createElement("div");this.div.id=this.component.renderId;this.div.style.cssText="position:absolute;width:100%;height:100%;";Echo.Sync.renderComponentDefaults(this.component,this.div);var componentCount=this.component.getComponentCount();for(var i=0;i<componentCount;++i){var child=this.component.getComponent(i);var tab=new Extras.Sync.AccordionPane.Tab(child,this);this.tabs.push(tab);tab.render(update);this.div.appendChild(tab.tabDiv);this.div.appendChild(tab.containerDiv)}parentElement.appendChild(this.div);this._pendingRenderDisplay=true},renderDisplay:function(){this._pendingRenderDisplay=false;if(!this.rotation){this.redrawTabs(false)}this.renderDisplayTabs()},renderDisplayTabs:function(){for(var i=0;i<this.tabs.length;++i){this.tabs[i].renderDisplay()}},renderDispose:function(update){this.component.removeListener("tabSelect",this._tabSelectListenerRef);if(this.rotation){this.rotation.abort()}this._activeTabId=null;for(var i=0;i<this.tabs.length;i++){this.tabs[i].dispose()}this.tabs=[];this.div=null},renderUpdate:function(update){var fullRender;if(update.hasUpdatedLayoutDataChildren()||update.hasAddedChildren()||update.hasRemovedChildren()){fullRender=true}else{var propertyNames=update.getUpdatedPropertyNames();if(propertyNames.length==1&&propertyNames[0]=="activeTabId"){this._selectTab(update.getUpdatedProperty("activeTabId").newValue);fullRender=false}else{fullRender=true}}if(fullRender){var element=this.div;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement)}return fullRender},_rotateTabs:function(oldTabId,newTabId){var oldTab=this._getTabById(oldTabId);if(oldTab==null){this.redrawTabs(true);return}if(this.rotation){this.rotation.abort();this.redrawTabs(true)}else{var newTab=this._getTabById(newTabId);this.rotation=new Extras.Sync.AccordionPane.Rotation(this,oldTab,newTab);this.rotation.runTime=this._animationTime;this.rotation.start()}},_selectTab:function(tabId){if(tabId==this._activeTabId){return}var oldTabId=this._activeTabId;this._activeTabId=tabId;if(oldTabId!=null&&this._animationTime>0){this._rotateTabs(oldTabId,tabId)}else{this.redrawTabs(true)}},_tabSelectListener:function(e){this._selectTab(e.tab.renderId)}});Extras.Sync.AccordionPane.Tab=Core.extend({tabDiv:null,_parent:null,containerDiv:null,contentDiv:null,childComponent:null,$construct:function(childComponent,parent){this.childComponent=childComponent;this._parent=parent},_addEventListeners:function(){Core.Web.Event.add(this.tabDiv,"click",Core.method(this,this._processClick),false);if(this._parent.component.render("tabRolloverEnabled",true)){Core.Web.Event.add(this.tabDiv,Core.Web.Env.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED?"mouseenter":"mouseover",Core.method(this,this._processEnter),false);Core.Web.Event.add(this.tabDiv,Core.Web.Env.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED?"mouseleave":"mouseout",Core.method(this,this._processExit),false)}Core.Web.Event.Selection.disable(this.tabDiv)},dispose:function(){Core.Web.Event.removeAll(this.tabDiv);this._parent=null;this.childComponent=null;this.tabDiv=null;this.containerDiv=null},getContentInsets:function(){if(this.childComponent.pane){return 0}else{var insets=this._parent.component.render("defaultContentInsets");return insets?insets:Extras.Sync.AccordionPane._DEFAULTS.tabContentInsets}},_processClick:function(e){if(!this._parent||!this._parent.client||!this._parent.client.verifyInput(this._parent.component)){return}this._parent.component.doTabSelect(this.childComponent.renderId)},_processEnter:function(e){if(!this._parent||!this._parent.client||!this._parent.client.verifyInput(this._parent.component)){return}this._renderState(true)},_processExit:function(e){if(!this._parent||!this._parent.client||!this._parent.client.verifyInput(this._parent.component)){return}this._renderState(false)},render:function(update){var layoutData=this.childComponent.render("layoutData")||{};this.tabDiv=document.createElement("div");this.tabDiv.id=this._parent.component.renderId+"_tab_"+this.childComponent.renderId;this.tabDiv.style.cssText="cursor:pointer;position:absolute;left:0;right:0;overflow:hidden;";Echo.Sync.Insets.render(this._parent.component.render("tabInsets",Extras.Sync.AccordionPane._DEFAULTS.tabInsets),this.tabDiv,"padding");if(layoutData.icon){var img=document.createElement("img");Echo.Sync.ImageReference.renderImg(layoutData.icon,img);img.style.paddingRight="3px";this.tabDiv.appendChild(img);Core.Web.Image.monitor(this.tabDiv,this._parent.imageMonitorRef)}this.tabDiv.appendChild(document.createTextNode(layoutData.title?layoutData.title:"\u00a0"));this.containerDiv=document.createElement("div");this.containerDiv.style.cssText="display:none;position:absolute;left:0;right:0;overflow:hidden;";this.contentDiv=document.createElement("div");this.contentDiv.style.cssText="position:absolute;left:0;right:0;overflow:auto;";Echo.Sync.Insets.render(this.getContentInsets(),this.contentDiv,"padding");Echo.Render.renderComponentAdd(update,this.childComponent,this.contentDiv);this.containerDiv.appendChild(this.contentDiv);this._renderState(false);this._addEventListeners()},_renderState:function(rollover){var tabDiv=this.tabDiv,border=this._parent.component.render("tabBorder",Extras.Sync.AccordionPane._DEFAULTS.tabBorder),borderData,borderDataBottom,background=this._parent.component.render("tabBackground",Extras.Sync.AccordionPane._DEFAULTS.tabBackground);if(rollover){var rolloverBackground=this._parent.component.render("tabRolloverBackground");if(!rolloverBackground){rolloverBackground=Echo.Sync.Color.adjust(background,20,20,20)}Echo.Sync.Color.render(rolloverBackground,tabDiv,"backgroundColor");var backgroundImage=this._parent.component.render("tabRolloverBackgroundImage");if(backgroundImage){tabDiv.style.backgroundImage="";tabDiv.style.backgroundPosition="";tabDiv.style.backgroundRepeat="";Echo.Sync.FillImage.render(backgroundImage,tabDiv,null)}var foreground=this._parent.component.render("tabRolloverForeground");if(foreground){Echo.Sync.Color.render(foreground,tabDiv,"color")}Echo.Sync.Font.render(this._parent.component.render("tabRolloverFont"),tabDiv);var rolloverBorder=this._parent.component.render("tabRolloverBorder");if(!rolloverBorder){rolloverBorder=border;if(Echo.Sync.Border.isMultisided(rolloverBorder)){borderData=Echo.Sync.Border.parse(rolloverBorder.top);borderDataBottom=Echo.Sync.Border.parse(rolloverBorder.bottom);rolloverBorder={top:Echo.Sync.Border.compose(borderData.size,borderData.style,Echo.Sync.Color.adjust(borderData.color,20,20,20)),bottom:Echo.Sync.Border.compose(borderDataBottom.size,borderDataBottom.style,Echo.Sync.Color.adjust(borderDataBottom.color,20,20,20))}}else{borderData=Echo.Sync.Border.parse(rolloverBorder);rolloverBorder=Echo.Sync.Border.compose(borderData.size,borderData.style,Echo.Sync.Color.adjust(borderData.color,20,20,20))}}}else{Echo.Sync.Color.render(background,tabDiv,"backgroundColor");Echo.Sync.Color.render(this._parent.component.render("tabForeground",Extras.Sync.AccordionPane._DEFAULTS.tabForeground),tabDiv,"color");Echo.Sync.Font.renderClear(this._parent.component.render("tabFont"),tabDiv);tabDiv.style.backgroundImage="";tabDiv.style.backgroundPosition="";tabDiv.style.backgroundRepeat="";Echo.Sync.FillImage.render(this._parent.component.render("tabBackgroundImage"),tabDiv)}if(Echo.Sync.Border.isMultisided(border)){Echo.Sync.Border.render(border.top,tabDiv,"borderTop");Echo.Sync.Border.render(border.bottom,tabDiv,"borderBottom")}else{Echo.Sync.Border.render(border,tabDiv,"borderTop");Echo.Sync.Border.render(border,tabDiv,"borderBottom")}},renderDisplay:function(){Core.Web.VirtualPosition.redraw(this.tabDiv);Core.Web.VirtualPosition.redraw(this.containerDiv);Core.Web.VirtualPosition.redraw(this.contentDiv)}});Extras.Sync.AccordionPane.Rotation=Core.extend(Extras.Sync.Animation,{_parent:null,_oldTab:null,_newTab:null,_oldTabIndex:null,_newTabIndex:null,_directionDown:null,_rotatingTabCount:null,_regionHeight:null,_numberOfTabsAbove:null,_numberOfTabsBelow:null,_startPosition:null,_animationDistance:null,$construct:function(parent,oldTab,newTab){this._parent=parent;this._oldTab=oldTab;this._newTab=newTab;this._regionHeight=this._parent.div.offsetHeight;this._oldTabIndex=Core.Arrays.indexOf(this._parent.tabs,this._oldTab);this._newTabIndex=Core.Arrays.indexOf(this._parent.tabs,this._newTab);this._rotatingTabCount=Math.abs(this._newTabIndex-this._oldTabIndex);this._directionDown=this._newTabIndex<this._oldTabIndex;if(this._directionDown){this._numberOfTabsAbove=this._newTabIndex+1;this._numberOfTabsBelow=this._parent.tabs.length-1-this._newTabIndex;this._startPosition=this._parent.getTabHeight(0,this._newTabIndex+1);this._animationDistance=this._regionHeight-this._parent.getTabHeight(this._newTabIndex+1,this._parent.tabs.length)-this._startPosition}else{this._numberOfTabsAbove=this._newTabIndex;this._numberOfTabsBelow=this._parent.tabs.length-1-this._newTabIndex;this._startPosition=this._parent.getTabHeight(this._newTabIndex+1,this._parent.tabs.length);this._animationDistance=this._regionHeight-this._parent.getTabHeight(0,this._newTabIndex+1)-this._startPosition}},complete:function(){this._parent.rotation=null;var parent=this._parent;if(this._parent.resetOverflowForAnimation){this._oldTab.contentDiv.style.overflow="auto";this._newTab.contentDiv.style.overflow="auto"}var renderId=this._parent.component.renderId;this._parent=null;this._oldTab=null;this._newTab=null;parent.redrawTabs(true)},init:function(){this._newTab.containerDiv.style.height="";if(this._directionDown){this._oldTab.containerDiv.style.bottom="";this._newTab.containerDiv.style.top=this._parent.getTabHeight(0,this._newTabIndex+1)+"px"}else{this._newTab.containerDiv.style.top="";this._newTab.containerDiv.style.bottom=this._parent.getTabHeight(this._newTabIndex+1,this._parent.tabs.length)+"px"}this._newTab.containerDiv.style.display="block";var regionContentHeight=this._parent.div.offsetHeight-this._parent.getTabHeight(0,this._parent.tabs.length);var oldTabInsets=Echo.Sync.Insets.toPixels(this._oldTab.getContentInsets());var newTabInsets=Echo.Sync.Insets.toPixels(this._newTab.getContentInsets());var oldContentHeight=regionContentHeight-oldTabInsets.top-oldTabInsets.bottom;var newContentHeight=regionContentHeight-newTabInsets.top-newTabInsets.bottom;oldContentHeight=oldContentHeight>0?oldContentHeight:0;newContentHeight=newContentHeight>0?newContentHeight:0;if(this._parent.resetOverflowForAnimation){this._oldTab.contentDiv.style.overflow="hidden";this._newTab.contentDiv.style.overflow="hidden"}this._oldTab.contentDiv.style.bottom="";this._newTab.contentDiv.style.bottom="";this._oldTab.contentDiv.style.height=oldContentHeight+"px";this._newTab.contentDiv.style.height=newContentHeight+"px"},step:function(progress){var i,oldContainerHeight,newContainerHeight,stepPosition=Math.round(progress*this._animationDistance);if(this._directionDown){for(i=this._oldTabIndex;i>this._newTabIndex;--i){this._parent.tabs[i].tabDiv.style.top=(stepPosition+this._startPosition+this._parent.getTabHeight(this._newTabIndex+1,i))+"px"}newContainerHeight=stepPosition;if(newContainerHeight<0){newContainerHeight=0}this._newTab.containerDiv.style.height=newContainerHeight+"px";var oldTop=stepPosition+this._startPosition+this._parent.getTabHeight(this._newTabIndex+1,this._oldTabIndex+1);this._oldTab.containerDiv.style.top=oldTop+"px";oldContainerHeight=this._regionHeight-this._parent.getTabHeight(this._newTabIndex,this._oldTabIndex);if(oldContainerHeight<0){oldContainerHeight=0}this._oldTab.containerDiv.style.height=oldContainerHeight+"px"}else{for(i=this._oldTabIndex+1;i<=this._newTabIndex;++i){this._parent.tabs[i].tabDiv.style.bottom=(stepPosition+this._startPosition+this._parent.getTabHeight(i+1,this._newTabIndex+1))+"px"}oldContainerHeight=this._regionHeight-stepPosition-this._parent.getTabHeight(this._oldTabIndex,this._newTabIndex);if(oldContainerHeight<0){oldContainerHeight=0}this._oldTab.containerDiv.style.height=oldContainerHeight+"px";newContainerHeight=stepPosition;if(newContainerHeight<0){newContainerHeight=0}this._newTab.containerDiv.style.height=newContainerHeight+"px"}}});Extras.Sync.BorderPane=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.BorderPane",this)},_div:null,_content:null,renderAdd:function(update,parentElement){this._div=Echo.Sync.FillImageBorder.renderContainer(this.component.render("border",Extras.BorderPane.DEFAULT_BORDER),{absolute:true,content:true});this._div.id=this.component.renderId;this._div.style.top=this._div.style.right=this._div.style.bottom=this._div.style.left=0;this._content=Echo.Sync.FillImageBorder.getContainerContent(this._div);Echo.Sync.renderComponentDefaults(this.component,this._content);Echo.Sync.FillImage.render(this.component.render("backgroundImage"),this._content);var componentCount=this.component.getComponentCount();if(componentCount==1){var child=this.component.getComponent(0);var insets=child.pane?null:this.component.render("insets");if(insets){Echo.Sync.Insets.render(insets,this._content,"padding")}Echo.Render.renderComponentAdd(update,child,this._content)}else if(componentCount>1){throw new Error("Too many children: "+componentCount);}parentElement.appendChild(this._div)},renderDisplay:function(){Echo.Sync.FillImageBorder.renderContainerDisplay(this._div);Core.Web.VirtualPosition.redraw(this._content);Core.Web.VirtualPosition.redraw(this._div)},renderDispose:function(update){this._content=null;this._div=null},renderUpdate:function(update){var element=this._div;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement);return true}});Extras.Sync.CalendarSelect=Core.extend(Echo.Render.ComponentSync,{$static:{DEFAULTS:{border:"1px outset #cfcfcf",background:"#cfcfcf",foreground:"#000000",font:{size:"10pt"},dateForeground:"#000000",dateBackground:"#dfdfdf",dateBorder:{top:"1px solid #efefef",left:"1px solid #efefef",right:"1px solid #bfbfbf",bottom:"1px solid #bfbfbf"},selectedDateForeground:"#ffffff",selectedDateBackground:"#2f2f6f",adjacentMonthDateForeground:"#8f8f8f"},MINIMUM_YEAR:1582,MAXIMUM_YEAR:9999,_DAYS_IN_MONTH:[31,null,31,30,31,30,31,31,30,31,30,31],resource:new Core.ResourceBundle({"DayOfWeek.0":"Sunday","DayOfWeek.1":"Monday","DayOfWeek.2":"Tuesday","DayOfWeek.3":"Wednesday","DayOfWeek.4":"Thursday","DayOfWeek.5":"Friday","DayOfWeek.6":"Saturday","Month.0":"January","Month.1":"February","Month.2":"March","Month.3":"April","Month.4":"May","Month.5":"June","Month.6":"July","Month.7":"August","Month.8":"September","Month.9":"October","Month.10":"November","Month.11":"December","FirstDayOfWeek":0}),Animation:Core.extend(Extras.Sync.Animation,{_container:null,_containerBounds:null,_oldContent:null,_newContent:null,_vertical:null,_forward:null,_travel:null,_overlap:null,_oldColor:null,_newColor:null,_adjust:null,runTime:500,$construct:function(container,oldContent,newContent,vertical,forward,overlap,oldColor,newColor){this._container=container;this._oldContent=oldContent;this._newContent=newContent;this._vertical=vertical;this._forward=forward;this._overlap=overlap||0;this._oldColor=oldColor;this._newColor=newColor},init:function(){this._containerBounds=new Core.Web.Measure.Bounds(this._container);this._travel=(this._vertical?this._containerBounds.height:this._containerBounds.width)-this._overlap;this._adjust=this._vertical?(this._forward?"top":"bottom"):(this._forward?"left":"right");this._newContent.style[this._adjust]=this._travel+"px";this._container.appendChild(this._newContent)},step:function(progress){var position=Math.round(this._travel*(1-progress));this._oldContent.style.color=Echo.Sync.Color.blend(this._oldColor,this._newColor,2*progress);this._oldContent.style[this._adjust]=(position-this._travel)+"px";this._newContent.style[this._adjust]=position+"px"},complete:function(abort){this._newContent.style.left=this._newContent.style.top=this._newContent.style.right=this._newContent.style.bottom="";if(this._oldContent.parentNode){this._oldContent.parentNode.removeChild(this._oldContent)}}}),MonthData:Core.extend({firstDayOfMonth:null,daysInMonth:null,daysInPreviousMonth:null,year:null,month:null,weekCount:null,firstCellPosition:null,$construct:function(year,month,firstDayOfWeek){this.year=year;this.month=month;var firstDate=new Date(year,month,1);this.firstDayOfMonth=firstDate.getDay();this.daysInMonth=Extras.Sync.CalendarSelect.getDaysInMonth(year,month);this.daysInPreviousMonth=month===0?Extras.Sync.CalendarSelect.getDaysInMonth(year-1,11):this._daysInPreviousMonth=Extras.Sync.CalendarSelect.getDaysInMonth(year,month-1);this.firstCellPosition=(7+this.firstDayOfMonth-firstDayOfWeek)%7;this.nextMonthWeek=Math.floor((this.firstCellPosition+this.daysInMonth)/7);this.weekCount=Math.ceil((this.firstCellPosition+this.daysInMonth)/7)},getCellDate:function(cellIndex){var date;if(cellIndex<this.firstCellPosition){date=this.month===0?{month:11,year:this.year-1}:{month:this.month-1,year:this.year};date.day=this.daysInPreviousMonth-this.firstDayOfMonth+cellIndex+1}else if(cellIndex>=(this.firstDayOfMonth+this.daysInMonth)){date=this.month===11?{month:0,year:this.year+1}:{month:this.month+1,year:this.year};date.day=cellIndex-this.firstDayOfMonth-this.daysInMonth+1}else{date={month:this.month,year:this.year,day:cellIndex-this.firstDayOfMonth+1}}return date},getCellIndex:function(day){return day+this.firstCellPosition-1},isCellAdjacent:function(cellIndex){return cellIndex<this.firstCellPosition||cellIndex>=(this.firstDayOfMonth+this.daysInMonth)}}),getDaysInMonth:function(year,month){if(month==1){if(year%400===0){return 29}else if(year%100===0){return 28}else if(year%4===0){return 29}else{return 28}}else{return this._DAYS_IN_MONTH[month]}}},$load:function(){Echo.Render.registerPeer("Extras.CalendarSelect",this)},_div:null,_monthYearInput:null,_monthSelect:null,_yearField:null,_dateRolloverBackground:null,_dateRolloverBackgroundImage:null,_dateRolloverBorder:null,_dateRolloverForeground:null,_dateSelectedBackground:null,_dateSelectedBackgroundImage:null,_dateSelectedBorder:null,_dateSelectedForeground:null,_rolloverCellIndex:null,_displayedMonth:null,_displayedYear:null,_firstDayOfWeek:null,_date:null,_msg:null,_icons:null,_animateUpdate:function(vertical,forward,rowOverlap){if(this._animation){this._animation.abort()}var newDayContainerDiv=this._createDayContainer();var overlap=rowOverlap?(rowOverlap*this._cellHeight+(rowOverlap-1)*this._vCellSpacing):0;this._animation=new Extras.Sync.CalendarSelect.Animation(this._scrollContainer,this._dayContainerDiv,newDayContainerDiv,vertical,forward,overlap,this._dateForeground,this._dateAdjacentForeground);this._animation.start(Core.method(this,function(abort){this._dayContainerDiv=newDayContainerDiv;this._animation=null}))},_createDayContainer:function(){var dayContainerDiv=document.createElement("div");dayContainerDiv.style.cssText="position:absolute;";dayContainerDiv.style.width=this._rowWidth+"px";dayContainerDiv.style.height=(this._ySize*this._cellHeight+(this._ySize-1)*this._vCellSpacing)+"px";for(var y=0;y<this._ySize;++y){var rowDiv=this._createWeek(y);rowDiv.style.top=(y*(this._cellHeight+this._vCellSpacing))+"px";dayContainerDiv.appendChild(rowDiv)}return dayContainerDiv},_createMonthYearInput:function(){var i,option,img,enabled=this.component.isRenderEnabled(),span=document.createElement("span");this._monthSelect=document.createElement("select");for(i=0;i<12;++i){option=document.createElement("option");option.appendChild(document.createTextNode(this._msg["Month."+i]));this._monthSelect.appendChild(option)}if(!enabled){this._monthSelect.disabled=true}span.appendChild(this._monthSelect);span.appendChild(document.createTextNode(" "));this._yearDecSpan=document.createElement("span");this._yearDecSpan.style.cursor="pointer";img=document.createElement("img");img.src=this._icons.decrement?this._icons.decrement:this.client.getResourceUrl("Extras","image/calendar/Decrement.gif");img.alt="-";this._yearDecSpan.appendChild(img);span.appendChild(this._yearDecSpan);this._yearField=document.createElement("input");this._yearField.type="text";this._yearField.style.textAlign="center";this._yearField.maxLength=4;this._yearField.size=5;if(!enabled){this._yearField.readOnly=true}span.appendChild(this._yearField);this._yearIncSpan=document.createElement("span");this._yearIncSpan.style.cursor="pointer";img=document.createElement("img");img.src=this._icons.increment?this._icons.increment:this.client.getResourceUrl("Extras","image/calendar/Increment.gif");img.alt="+";this._yearIncSpan.appendChild(img);span.appendChild(this._yearIncSpan);return span},_createWeek:function(line){var day=1-this._monthData.firstCellPosition+(7*line);var rowDiv=document.createElement("div");rowDiv.style.cssText="position:absolute;overflow:hidden;cursor:pointer;";rowDiv.style.width=this._rowWidth+"px";rowDiv.style.height=this._cellHeight+"px";for(var x=0;x<this._xSize;++x,++day){var cellDiv=document.createElement("div");cellDiv._cellIndex=7*line+x;cellDiv.style.cssText="position:absolute;text-align:right;";cellDiv.style.left=(x*(this._cellWidth+this._hCellSpacing))+"px";cellDiv.style.width=this._renderedCellWidth+"px";cellDiv.style.height=this._renderedCellHeight+"px";Echo.Sync.Border.render(this._dateBorder,cellDiv);cellDiv.style.padding="2px 4px";cellDiv.style.overflow="hidden";var displayDay;if(day<1){cellDiv.style.color=this._dateAdjacentForeground;displayDay=this._monthData.daysInPreviousMonth+day}else if(day>this._monthData.daysInMonth){cellDiv.style.color=this._dateAdjacentForeground;displayDay=day-this._monthData.daysInMonth}else{if(this._date.day==day){Echo.Sync.Color.render(this._dateSelectedBackground,cellDiv,"backgroundColor");Echo.Sync.Color.render(this._dateSelectedForeground,cellDiv,"color");Echo.Sync.FillImage.render(this._dateSelectedBackgroundImage,cellDiv);Echo.Sync.Border.render(this._dateSelectedBorder,cellDiv)}displayDay=day}cellDiv.appendChild(document.createTextNode(displayDay));rowDiv.appendChild(cellDiv)}return rowDiv},_getCell:function(cellIndex){return this._dayContainerDiv.childNodes[Math.floor(cellIndex/7)].childNodes[cellIndex%7]},_loadRenderData:function(){this._font=this.component.render("font",Extras.Sync.CalendarSelect.DEFAULTS.font);this._dateBackground=this.component.render("dateBackground",Extras.Sync.CalendarSelect.DEFAULTS.dateBackground);this._dateBorder=this.component.render("dateBorder",Extras.Sync.CalendarSelect.DEFAULTS.dateBorder);this._dateBackgroundImage=this.component.render("dateBackgroundImage");this._dateForeground=this.component.render("dateForeground",Extras.Sync.CalendarSelect.DEFAULTS.dateForeground);this._dateSelectedBackground=this.component.render("selectedDateBackground",Extras.Sync.CalendarSelect.DEFAULTS.selectedDateBackground);this._dateSelectedBackgroundImage=this.component.render("selectedDateBackgroundImage");this._dateSelectedBorder=this.component.render("selectedDateBorder");this._dateSelectedForeground=this.component.render("selectedDateForeground",Extras.Sync.CalendarSelect.DEFAULTS.selectedDateForeground);this._dateRolloverBackground=this.component.render("rolloverDateBackground");this._dateRolloverBackgroundImage=this.component.render("rolloverDateBackgroundImage");this._dateRolloverBorder=this.component.render("rolloverDateBorder");this._dateRolloverForeground=this.component.render("rolloverDateForeground");if(!this._dateRolloverBackground){this._dateRolloverBackground=Echo.Sync.Color.adjust(this._dateBackground,0x20,0x20,0x20)}this._dateAdjacentForeground=this.component.render("adjacentMonthDateForeground",Extras.Sync.CalendarSelect.DEFAULTS.adjacentMonthDateForeground);this._dateAdjacentBackground=this.component.render("adjacentMonthDateBackground");var cellMeasure=document.createElement("span");cellMeasure.appendChild(document.createTextNode("96"));Echo.Sync.Font.render(this._font,cellMeasure);var cellBounds=new Core.Web.Measure.Bounds(cellMeasure);this._padding={top:2,bottom:2,left:4,right:4};this._borderSize={top:1,bottom:1,left:1,right:1};this._cellWidth=cellBounds.width+this._padding.left+this._padding.right+this._borderSize.left+this._borderSize.right;if(this._cellWidth*7<this._monthYearWidth){this._cellWidth=Math.ceil(this._monthYearWidth/7)}this._cellHeight=cellBounds.height+this._padding.top+this._padding.bottom+this._borderSize.top+this._borderSize.bottom;this._hCellSpacing=0;this._vCellSpacing=0;this._headerHeight=cellBounds.height;this._headerMargin=0;this._xSize=7;this._ySize=6;this._rowWidth=this._xSize*this._cellWidth+(this._xSize-1)*this._hCellSpacing;this._calendarHeight=this._ySize*this._cellHeight+(this._ySize-1)*this._vCellSpacing+this._headerHeight+this._headerMargin;this._renderedCellWidth=this._cellWidth-this._borderSize.left-this._borderSize.right-this._padding.left-this._padding.right;this._renderedCellHeight=this._cellHeight-this._borderSize.top-this._borderSize.bottom-this._padding.top-this._padding.bottom},_processDateRolloverEnter:function(e){if(!this.client||!this.client.verifyInput(this.component)||e.target._cellIndex==null||this._animation){return}if(this._rolloverCellIndex!=null){this._setCellStyle(this._rolloverCellIndex,false)}this._rolloverCellIndex=e.target._cellIndex;this._setCellStyle(this._rolloverCellIndex,true)},_processDateRolloverExit:function(e){if(this._rolloverCellIndex){this._setCellStyle(this._rolloverCellIndex,false);this._rolloverCellIndex=null}},_processDateSelect:function(e){if(!this.client||!this.client.verifyInput(this.component)||e.target._cellIndex==null||this._animation){return}this._setDate(this._monthData.getCellDate(e.target._cellIndex))},_processMonthSelect:function(e){if(!this.client||!this.client.verifyInput(this.component)){this._monthSelect.selectedIndex=this._date.month;return}this._setDate({year:this._date.year,month:this._monthSelect.selectedIndex,day:this._date.day})},_processYearChange:function(e){var newValue=parseInt(this._yearField.value,10);if(!this.client||!this.client.verifyInput(this.component)||isNaN(newValue)){this._yearField.value=this._date.year;return}this._setDate({year:newValue,month:this._date.month,day:this._date.day})},_processYearKeyUp:function(e){if(e.keyCode==13){this._processYearChange(e)}},_processYearDecrement:function(e){if(!this.client||!this.client.verifyInput(this.component)){return}this._setDate({year:this._date.year-1,month:this._date.month,day:this._date.day})},_processYearIncrement:function(e){if(!this.client||!this.client.verifyInput(this.component)){return}this._setDate({year:this._date.year+1,month:this._date.month,day:this._date.day})},_rangeCheck:function(date){if(date.year<Extras.Sync.CalendarSelect.MINIMUM_YEAR){date.year=Extras.Sync.CalendarSelect.MINIMUM_YEAR}else if(date.year>Extras.Sync.CalendarSelect.MAXIMUM_YEAR){date.year=Extras.Sync.CalendarSelect.MAXIMUM_YEAR}},renderAdd:function(update,parentElement){update=null;this._msg=Extras.Sync.CalendarSelect.resource.get(this.component.getRenderLocale());this._icons={};var i,j,td,tr,x,cellDiv,dayOfWeekName,monthYearDiv,headerWidth,enabled=this.component.isRenderEnabled(),dayOfWeekNameAbbreviationLength=parseInt(this.component.render("dayOfWeekNameAbbreviationLength",2),10),date=this.component.get("date");this._firstDayOfWeek=parseInt(this._msg["FirstDayOfWeek"],10)||0;if(!date){date=new Date()}this._date={year:date.getFullYear(),month:date.getMonth(),day:date.getDate()};this._monthData=new Extras.Sync.CalendarSelect.MonthData(this._date.year,this._date.month,this._firstDayOfWeek);this._monthYearInput=this._createMonthYearInput();this._monthYearWidth=new Core.Web.Measure.Bounds(this._monthYearInput).width+10;this._loadRenderData();this._div=document.createElement("div");this._div.id=this.component.renderId;this._div.style.cssText="width:"+(this._cellWidth*this._xSize)+"px;";Echo.Sync.LayoutDirection.render(this.component.getLayoutDirection(),this._div);Echo.Sync.Font.render(this._font,this._div);Echo.Sync.Color.render(this.component.render("foreground",Extras.Sync.CalendarSelect.DEFAULTS.foreground),this._div,"color");Echo.Sync.Color.render(this.component.render("background",Extras.Sync.CalendarSelect.DEFAULTS.background),this._div,"backgroundColor");Echo.Sync.FillImage.render(this.component.render("backgroundImage"),this._div);Echo.Sync.Border.render(this.component.render("border",Extras.Sync.CalendarSelect.DEFAULTS.border),this._div);Echo.Sync.Font.render(this.component.render("font"),this._div);monthYearDiv=document.createElement("div");monthYearDiv.align="center";monthYearDiv.style.cssText="padding:2px 5px;white-space:nowrap;overflow:hidden;";monthYearDiv.appendChild(this._monthYearInput);this._div.appendChild(monthYearDiv);this._calendarDiv=document.createElement("div");this._calendarDiv.style.cssText="position:relative;";this._calendarDiv.style.width=this._rowWidth+"px";this._calendarDiv.style.height=this._calendarHeight+"px";this._div.appendChild(this._calendarDiv);this._currentRowDivs=[];var headerDiv=document.createElement("div");headerDiv.style.cssText="position:absolute;";headerDiv.style.width=(this._cellWidth*7)+"px";headerDiv.style.height=this._headerHeight+"px";Echo.Sync.Color.render(this.component.render("headerForeground",Extras.Sync.CalendarSelect.DEFAULTS.foreground),headerDiv,"color");Echo.Sync.Color.render(this.component.render("headerBackground",Extras.Sync.CalendarSelect.DEFAULTS.background),headerDiv,"backgroundColor");Echo.Sync.FillImage.render(this.component.render("headerBackgroundImage"),headerDiv);this._calendarDiv.appendChild(headerDiv);for(x=0;x<this._xSize;++x){cellDiv=document.createElement("div");cellDiv.style.cssText="position:absolute;text-align:center;";cellDiv.style.left=(x*(this._cellWidth+this._hCellSpacing))+"px";cellDiv.style.width=this._cellWidth+"px";cellDiv.style.height=this._headerHeight+"px";cellDiv.style.overflow="hidden";dayOfWeekName=this._msg["DayOfWeek."+((this._firstDayOfWeek+x)%7)];if(dayOfWeekNameAbbreviationLength>0){dayOfWeekName=dayOfWeekName.substring(0,dayOfWeekNameAbbreviationLength)}cellDiv.appendChild(document.createTextNode(dayOfWeekName));headerDiv.appendChild(cellDiv)}this._scrollContainer=document.createElement("div");this._scrollContainer.style.cssText="position:absolute;overflow:hidden;";this._scrollContainer.style.top=(this._headerHeight+this._headerMargin)+"px";this._scrollContainer.style.height=(this._ySize*this._cellHeight+(this._ySize-1)*this._vCellSpacing)+"px";this._scrollContainer.style.width=this._rowWidth+"px";Echo.Sync.Color.render(this._dateForeground,this._scrollContainer,"color");Echo.Sync.Color.render(this._dateBackground,this._scrollContainer,"backgroundColor");Echo.Sync.FillImage.render(this._dateBackgroundImage,this._scrollContainer);this._calendarDiv.appendChild(this._scrollContainer);this._dayContainerDiv=this._createDayContainer();this._scrollContainer.appendChild(this._dayContainerDiv);parentElement.appendChild(this._div);Core.Web.Event.add(this._monthSelect,"change",Core.method(this,this._processMonthSelect),false);Core.Web.Event.add(this._yearField,"change",Core.method(this,this._processYearChange),false);Core.Web.Event.add(this._yearField,"keyup",Core.method(this,this._processYearKeyUp),false);Core.Web.Event.add(this._yearDecSpan,"click",Core.method(this,this._processYearDecrement),false);Core.Web.Event.add(this._yearIncSpan,"click",Core.method(this,this._processYearIncrement),false);Core.Web.Event.add(this._calendarDiv,"click",Core.method(this,this._processDateSelect),false);Core.Web.Event.add(this._calendarDiv,"mouseover",Core.method(this,this._processDateRolloverEnter),false);Core.Web.Event.add(this._calendarDiv,"mouseout",Core.method(this,this._processDateRolloverExit),false);this._updateMonthYearSelection();Core.Web.Image.monitor(this._div,Core.method(this,function(){this._renderSizeUpdate()}))},renderDispose:function(update){update=null;Core.Web.Event.removeAll(this._monthSelect);Core.Web.Event.removeAll(this._yearField);Core.Web.Event.removeAll(this._yearDecSpan);Core.Web.Event.removeAll(this._yearIncSpan);Core.Web.Event.removeAll(this._calendarDiv);this._div=null;this._monthSelect=null;this._yearField=null;this._dayContainerDiv=null;this._scrollContainer=null;this._calendarDiv=null;this._monthYearInput=null},_renderSizeUpdate:function(){var monthYearWidth=new Core.Web.Measure.Bounds(this._monthYearInput).width+10;if(this._monthYearWidth===monthYearWidth){return}var element=this._div;var containerElement=element.parentNode;this.renderDispose(null);containerElement.removeChild(element);this.renderAdd(null,containerElement)},renderUpdate:function(update){if(update&&update.isUpdatedPropertySetIn({date:true})){var date=this.component.get("date")||new Date();if(this._date.month==date.getMonth()&&this._date.day==date.getDate()&&this._date.year==date.getFullYear()){return false}}if(this._animation){this._animation.abort()}var element=this._div;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement);return false},_setCellStyle:function(cellIndex,rollover,reset){var date=this._monthData.getCellDate(cellIndex);var cell=this._getCell(cellIndex);if(!reset&&date.day==this._date.day&&date.month==this._date.month&&date.year==this._date.year){Echo.Sync.Color.renderClear(this._dateSelectedBackground,cell,"backgroundColor");Echo.Sync.Color.renderClear(this._dateSelectedForeground,cell,"color");Echo.Sync.FillImage.render(this._dateSelectedBackgroundImage,cell);Echo.Sync.Border.render(this._dateSelectedBorder,cell)}else if(!reset&&rollover){Echo.Sync.Color.renderClear(this._dateRolloverBackground,cell,"backgroundColor");Echo.Sync.Color.renderClear(this._dateRolloverForeground,cell,"color");Echo.Sync.FillImage.render(this._dateRolloverBackgroundImage,cell);Echo.Sync.Border.render(this._dateRolloverBorder,cell)}else{if(this._monthData.isCellAdjacent(cellIndex)){Echo.Sync.Color.renderClear(this._dateAdjacentBackground,cell,"backgroundColor");Echo.Sync.Color.renderClear(this._dateAdjacentForeground,cell,"color")}else{Echo.Sync.Border.renderClear(this._dateBorder,cell);cell.style.backgroundImage="";cell.style.backgroundColor="";cell.style.color=""}}},_setDate:function(newValue){var oldValue=this._date,oldCellIndex=this._monthData.getCellIndex(this._date.day),newCellIndex,overlap;this._setCellStyle(oldCellIndex,false,true);this._rangeCheck(newValue);this._date=newValue;this._monthData=new Extras.Sync.CalendarSelect.MonthData(newValue.year,newValue.month,this._firstDayOfWeek);if(newValue.year==oldValue.year){if(newValue.month==oldValue.month){newCellIndex=this._monthData.getCellIndex(this._date.day);this._setCellStyle(newCellIndex,false)}else{if(oldValue.month-newValue.month==1){overlap=this._monthData.nextMonthWeek==4?2:1}else if(oldValue.month-newValue.month==-1){var oldMonthData=new Extras.Sync.CalendarSelect.MonthData(oldValue.year,oldValue.month,this._firstDayOfWeek);overlap=oldMonthData.nextMonthWeek==4?2:1}else{overlap=0}this._animateUpdate(true,oldValue.month<newValue.month,overlap)}}else{this._animateUpdate(false,oldValue.year<newValue.year)}this._updateMonthYearSelection();this._storeValue()},_storeValue:function(){this.component.set("date",new Date(this._date.year,this._date.month,this._date.day))},_updateMonthYearSelection:function(){if(parseInt(this._yearField.value,10)!==this._date.year){this._yearField.value=this._date.year}if(this._monthSelect.selectedIndex!=this._date.month){this._monthSelect.selectedIndex=this._date.month}}});Extras.Sync.ColorSelect=Core.extend(Echo.Render.ComponentSync,{$static:{RGB:Core.extend({r:null,g:null,b:null,$construct:function(r,g,b){this.r=this._clean(r);this.g=this._clean(g);this.b=this._clean(b)},_clean:function(value){value=value?parseInt(value,10):0;if(value<0){return 0}else if(value>255){return 255}else{return value}},toHexTriplet:function(){var rString=this.r.toString(16);if(rString.length==1){rString="0"+rString}var gString=this.g.toString(16);if(gString.length==1){gString="0"+gString}var bString=this.b.toString(16);if(bString.length==1){bString="0"+bString}return"#"+rString+gString+bString},toString:function(){return this.toHexTriplet()}})},$load:function(){Echo.Render.registerPeer("Extras.ColorSelect",this)},_h:0,_s:0,_v:0,_processHMouseMoveRef:null,_processHMouseUpRef:null,_processSVMouseMoveRef:null,_processSVMouseUpRef:null,$construct:function(){this._processHMouseMoveRef=Core.method(this,this._processHMouseMove);this._processHMouseUpRef=Core.method(this,this._processHMouseUp);this._processSVMouseMoveRef=Core.method(this,this._processSVMouseMove);this._processSVMouseUpRef=Core.method(this,this._processSVMouseUp)},_hsvToRgb:function(h,s,v){var r,g,b;if(s===0){r=g=b=v}else{h/=60;var i=Math.floor(h);var f=h-i;var p=v*(1-s);var q=v*(1-s*f);var t=v*(1-s*(1-f));switch(i){case 0:r=v;g=t;b=p;break;case 1:r=q;g=v;b=p;break;case 2:r=p;g=v;b=t;break;case 3:r=p;g=q;b=v;break;case 4:r=t;g=p;b=v;break;default:r=v;g=p;b=q;break}}return new Extras.Sync.ColorSelect.RGB(Math.round(r*255),Math.round(g*255),Math.round(b*255))},_processHMouseDown:function(e){if(!this.client||!this.client.verifyInput(this.component)||Core.Web.dragInProgress){return}Core.Web.Event.add(this._hListenerDiv,"mousemove",this._processHMouseMoveRef,false);Core.Web.Event.add(this._hListenerDiv,"mouseup",this._processHMouseUpRef,false);this._processHUpdate(e)},_processHMouseMove:function(e){this._processHUpdate(e)},_processHMouseUp:function(e){Core.Web.Event.remove(this._hListenerDiv,"mousemove",this._processHMouseMoveRef,false);Core.Web.Event.remove(this._hListenerDiv,"mouseup",this._processHMouseUpRef,false);this._storeColor()},_processHUpdate:function(e){var offset=Core.Web.DOM.getEventOffset(e);this._h=(this._saturationHeight-(offset.y-7))*360/this._saturationHeight;this._updateDisplayedColor()},_processSVMouseDown:function(e){if(!this.client||!this.client.verifyInput(this.component)||Core.Web.dragInProgress){return}Core.Web.Event.add(this._svListenerDiv,"mousemove",this._processSVMouseMoveRef,false);Core.Web.Event.add(this._svListenerDiv,"mouseup",this._processSVMouseUpRef,false);this._processSVUpdate(e)},_processSVMouseMove:function(e){this._processSVUpdate(e)},_processSVMouseUp:function(e){Core.Web.Event.remove(this._svListenerDiv,"mousemove",this._processSVMouseMoveRef,false);Core.Web.Event.remove(this._svListenerDiv,"mouseup",this._processSVMouseUpRef,false);this._storeColor()},_processSVUpdate:function(e){var offset=Core.Web.DOM.getEventOffset(e);this._v=(offset.x-7)/this._valueWidth;this._s=1-((offset.y-7)/this._saturationHeight);this._updateDisplayedColor()},renderAdd:function(update,parentElement){this._valueWidth=Echo.Sync.Extent.toPixels(this.component.render("valueWidth",Extras.ColorSelect.DEFAULT_VALUE_WIDTH),true);this._saturationHeight=Echo.Sync.Extent.toPixels(this.component.render("saturationHeight",Extras.ColorSelect.DEFAULT_SATURATION_HEIGHT),false);this._hueWidth=Echo.Sync.Extent.toPixels(this.component.render("hueWidth",Extras.ColorSelect.DEFAULT_HUE_WIDTH),true);var displayHeight=Core.Web.Measure.extentToPixels("1em",false);var svGradientImageSrc=this.client.getResourceUrl("Extras","image/colorselect/ColorSelectSVGradient.png");var hGradientImageSrc=this.client.getResourceUrl("Extras","image/colorselect/ColorSelectHGradient.png");var arrowDownImageSrc=this.client.getResourceUrl("Extras","image/colorselect/ColorSelectArrowDown.gif");var arrowUpImageSrc=this.client.getResourceUrl("Extras","image/colorselect/ColorSelectArrowUp.gif");var arrowRightImageSrc=this.client.getResourceUrl("Extras","image/colorselect/ColorSelectArrowRight.gif");var arrowLeftImageSrc=this.client.getResourceUrl("Extras","image/colorselect/ColorSelectArrowLeft.gif");this._div=document.createElement("div");this._div.id=this.component.renderId;this._div.style.cssText="position:relative;left:0;top:0;overflow:hidden;";this._div.style.width=(this._valueWidth+this._hueWidth+29)+"px";this._div.style.height=(this._saturationHeight+18+displayHeight)+"px";this._svDiv=document.createElement("div");this._svDiv.style.cssText="position:absolute;left:7px;top:7px;background-color:#ff0000";this._svDiv.style.width=this._valueWidth+"px";this._svDiv.style.height=this._saturationHeight+"px";this._div.appendChild(this._svDiv);if(svGradientImageSrc){if(Core.Web.Env.PROPRIETARY_IE_PNG_ALPHA_FILTER_REQUIRED){this._svDiv.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader("+"src='"+svGradientImageSrc+"', sizingMethod='scale');"}else{var svGradientImg=document.createElement("img");svGradientImg.src=svGradientImageSrc;svGradientImg.style.width=this._valueWidth+"px";svGradientImg.style.height=this._saturationHeight+"px";this._svDiv.appendChild(svGradientImg)}}this._vLineDiv=document.createElement("div");this._vLineDiv.style.cssText="position:absolute;left:2px;top:0;width:11px;overflow:hidden;";this._vLineDiv.style.height=(this._saturationHeight+14)+"px";this._div.appendChild(this._vLineDiv);if(arrowDownImageSrc){var vLineTopImg=document.createElement("img");vLineTopImg.src=arrowDownImageSrc;vLineTopImg.style.cssText="position:absolute;left:0;top:0;";this._vLineDiv.appendChild(vLineTopImg)}var vLineBarDiv=document.createElement("div");vLineBarDiv.style.cssText="position:absolute;top:7px;left:5px;width:1px;background-color:#000000;";vLineBarDiv.style.height=this._saturationHeight+"px";this._vLineDiv.appendChild(vLineBarDiv);if(arrowUpImageSrc){var vLineBottomImg=document.createElement("img");vLineBottomImg.src=arrowUpImageSrc;vLineBottomImg.style.cssText="position:absolute;left:0;";vLineBottomImg.style.top=(this._saturationHeight+7)+"px";this._vLineDiv.appendChild(vLineBottomImg)}this._sLineDiv=document.createElement("div");this._sLineDiv.style.cssText="position:absolute;left:0;height:11px;overflow:hidden;";this._sLineDiv.style.top=(this._saturationHeight+2)+"px";this._sLineDiv.style.width=(this._valueWidth+14)+"px";this._div.appendChild(this._sLineDiv);if(arrowRightImageSrc){var sLineLeftImg=document.createElement("img");sLineLeftImg.src=arrowRightImageSrc;sLineLeftImg.style.cssText="position:absolute;left:0;top:0;";this._sLineDiv.appendChild(sLineLeftImg)}var sLineBarDiv=document.createElement("div");sLineBarDiv.style.cssText="position:absolute;left:7px;top:5px;height:1px;font-size:1px;border-top:1px #000000 solid;line-height:0;";sLineBarDiv.style.width=this._valueWidth+"px";this._sLineDiv.appendChild(sLineBarDiv);if(arrowLeftImageSrc){var sLineRightImg=document.createElement("img");sLineRightImg.src=arrowLeftImageSrc;sLineRightImg.style.cssText="position:absolute;top:0;";sLineRightImg.style.left=this._valueWidth+7+"px";this._sLineDiv.appendChild(sLineRightImg)}var hDiv=document.createElement("div");hDiv.style.cssText="position:absolute;top:7px;";hDiv.style.left=(this._valueWidth+22)+"px";hDiv.style.width=this._hueWidth+"px";hDiv.style.height=this._saturationHeight+"px";this._div.appendChild(hDiv);if(hGradientImageSrc){var hGradientImg=document.createElement("img");hGradientImg.src=hGradientImageSrc;hGradientImg.style.cssText="position:absolute;left:0;top:0;";hGradientImg.style.width=this._hueWidth+"px";hGradientImg.style.height=this._saturationHeight+"px";hDiv.appendChild(hGradientImg)}this._hLineDiv=document.createElement("div");this._hLineDiv.style.cssText="position:absolute;height:11px;overflow:hidden;";this._hLineDiv.style.left=(this._valueWidth+15)+"px";this._hLineDiv.style.top=(this._saturationHeight+2)+"px";this._hLineDiv.style.width=(this._hueWidth+14)+"px";this._div.appendChild(this._hLineDiv);if(arrowRightImageSrc){var hLineLeftImg=document.createElement("img");hLineLeftImg.src=arrowRightImageSrc;hLineLeftImg.style.cssText="position:absolute;left:0;top:0;";this._hLineDiv.appendChild(hLineLeftImg)}if(arrowLeftImageSrc){var hLineRightImg=document.createElement("img");hLineRightImg.src=arrowLeftImageSrc;hLineRightImg.style.cssText="position:absolute;top:0;";hLineRightImg.style.left=(this._hueWidth+7)+"px";this._hLineDiv.appendChild(hLineRightImg)}var hLineBarDiv=document.createElement("div");hLineBarDiv.style.cssText="position:absolute;left:7px;top:5px;height:1px;font-size:1px;border-top:1px #000000 solid;line-height:0;";hLineBarDiv.style.width=this._hueWidth+"px";this._hLineDiv.appendChild(hLineBarDiv);this._colorDiv=document.createElement("div");this._colorDiv.style.cssText="position:absolute;left:7px;color:#ffffff;background-color:#000000;text-align:center;vertical-align:middle;"+"overflow:hidden;border:1px #000000 outset;font-family:monospace;text-align:center;";this._colorDiv.style.height=displayHeight+"px";this._colorDiv.style.top=(this._saturationHeight+16)+"px";this._colorDiv.style.width=(this._valueWidth+this._hueWidth+13)+"px";if(this.component.render("displayValue")){this._colorDiv.appendChild(document.createTextNode("#000000"))}this._div.appendChild(this._colorDiv);this._svListenerDiv=document.createElement("div");this._svListenerDiv.style.cssText="position:absolute;z-index:1;left:0;top:0;cursor:crosshair;";this._svListenerDiv.style.width=(this._valueWidth+14)+"px";this._svListenerDiv.style.height=(this._saturationHeight+14)+"px";this._svListenerDiv.style.backgroundImage="url("+this.client.getResourceUrl("Echo","resource/Transparent.gif")+")";this._div.appendChild(this._svListenerDiv);this._hListenerDiv=document.createElement("div");this._hListenerDiv.style.cssText="position:absolute;z-index:1;top:0;cursor:crosshair;";this._hListenerDiv.style.left=(this._valueWidth+15)+"px";this._hListenerDiv.style.width=(this._hueWidth+14)+"px";this._hListenerDiv.style.height=(this._saturationHeight+16)+"px";this._hListenerDiv.style.backgroundImage="url("+this.client.getResourceUrl("Echo","resource/Transparent.gif")+")";this._div.appendChild(this._hListenerDiv);parentElement.appendChild(this._div);Core.Web.Event.add(this._svListenerDiv,"mousedown",Core.method(this,this._processSVMouseDown),false);Core.Web.Event.add(this._hListenerDiv,"mousedown",Core.method(this,this._processHMouseDown),false);this._setColor(this.component.get("color"))},renderDispose:function(update){Core.Web.Event.removeAll(this._svListenerDiv);Core.Web.Event.removeAll(this._hListenerDiv);this._div=null;this._svDiv=null;this._svListenerDiv=null;this._hListenerDiv=null;this._hLineDiv=null;this._sLineDiv=null;this._vLineDiv=null},renderUpdate:function(update){var div=this._div;var parentElement=div.parentNode;Echo.Render.renderComponentDispose(update,update.parent);parentElement.removeChild(div);this.renderAdd(update,parentElement);return false},_setColor:function(color){var r,g,b;if(color){color=color.substring(1);r=Math.floor(parseInt(color,16)/0x10000)/255;g=(Math.floor(parseInt(color,16)/0x100)%0x100)/255;b=(parseInt(color,16)%0x100)/255}else{r=g=b=0}var min=Math.min(r,g,b);var max=Math.max(r,g,b);this._v=max;var delta=max-min;if(max===0||delta===0){this._s=0}else{this._s=delta/max;if(r==max){this._h=60*((g-b)/delta)}else if(g==max){this._h=60*(2+(b-r)/delta)}else{this._h=60*(4+(r-g)/delta)}if(this._h<0){this._h+=360}}this._updateDisplayedColor()},_storeColor:function(){var renderColor=this._hsvToRgb(this._h,this._s,this._v);var renderHexTriplet=renderColor.toHexTriplet();this.component.set("color",renderHexTriplet)},_updateDisplayedColor:function(){var baseColor;if(this.component.isRenderEnabled()){baseColor=this._hsvToRgb(this._h,1,1)}else{baseColor=this._hsvToRgb(this._h,0.3,0.7)}this._svDiv.style.backgroundColor=baseColor.toHexTriplet();var renderColor=this._hsvToRgb(this._h,this._s,this._v);var renderHexTriplet=renderColor.toHexTriplet();this._colorDiv.style.backgroundColor=renderHexTriplet;this._colorDiv.style.borderColor=renderHexTriplet;this._colorDiv.style.color=this._v<0.67?"#ffffff":"#000000";if(this.component.render("displayValue")){this._colorDiv.childNodes[0].nodeValue=renderHexTriplet}var sLineTop=Math.floor((1-this._s)*this._saturationHeight)+2;if(sLineTop<2){sLineTop=2}else if(sLineTop>this._saturationHeight+2){sLineTop=this._saturationHeight+2}this._sLineDiv.style.top=sLineTop+"px";var vLineLeft=Math.floor(this._v*this._valueWidth)+2;if(vLineLeft<2){vLineLeft=2}else if(vLineLeft>this._valueWidth+2){vLineLeft=this._valueWidth+2}this._vLineDiv.style.left=vLineLeft+"px";var hLineTop=Math.floor((360-this._h)/360*this._saturationHeight)+2;if(hLineTop<2){hLineTop=2}else if(hLineTop>this._saturationHeight+2){hLineTop=this._saturationHeight+2}this._hLineDiv.style.top=hLineTop+"px"}});Extras.Sync.DataGrid=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.DataGrid",this)},$static:{LEFT:{h:-1,v:0},RIGHT:{h:1,v:0},UP:{h:0,v:-1},DOWN:{h:0,v:1},REGION_LOCATIONS:{topLeft:{h:-1,v:-1},top:{h:0,v:-1},topRight:{h:1,v:-1},left:{h:-1,v:0},center:{h:0,v:0},right:{h:1,v:0},bottomLeft:{h:-1,v:1},bottom:{h:0,v:1},bottomRight:{h:1,v:1}},intersect:function(a1,a2,b1,b2){return(b1<=a1&&a1<=b2)||(a1<=b1&&b1<=a2)},CellRenderer:Core.extend({$abstract:{render:function(context,value,column,row){}},$virtual:{dispose:null}}),RenderContext:Core.extend({_states:null,dataGrid:null,$construct:function(dataGrid){this.dataGrid=dataGrid;this._states={}},dispose:function(){for(var x in this._states){}},getState:function(column,row){return this._states[column+","+row]},setState:function(column,row,state){this._states[column+","+row]=state}}),Tile:Core.extend({dataGrid:null,displayed:false,div:null,_table:null,region:null,edge:null,cellIndex:null,tileIndex:null,bounds:null,_renderContext:null,$construct:function(dataGrid,region,tileColumnIndex,tileRowIndex){this.dataGrid=dataGrid;this._renderContext=new Extras.Sync.DataGrid.RenderContext(dataGrid);this.containerElement=region.element;this.tileIndex={column:tileColumnIndex,row:tileRowIndex};this.region=region;this.edge={left:this.tileIndex.column===0,top:this.tileIndex.row===0};this.cellIndex={};switch(this.region.location.h){case-1:this.cellIndex.left=this.tileIndex.column*this.dataGrid.tileSize.columns;this.cellIndex.right=this.cellIndex.left+this.dataGrid.tileSize.columns-1;if(this.cellIndex.right>=this.dataGrid.fixedCells.left){this.cellIndex.right=this.dataGrid.fixedCells.left-1;this.edge.right=true}break;case 0:this.cellIndex.left=this.tileIndex.column*this.dataGrid.tileSize.columns+this.dataGrid.fixedCells.left;this.cellIndex.right=this.cellIndex.left+this.dataGrid.tileSize.columns-1;if(this.cellIndex.right>=this.dataGrid.size.columns-this.dataGrid.fixedCells.right-1){this.cellIndex.right=this.dataGrid.size.columns-this.dataGrid.fixedCells.right-1;this.edge.right=true}break;case 1:this.cellIndex.left=this.dataGrid.size.columns-this.dataGrid.fixedCells.right-(this.tileIndex.column*this.dataGrid.tileSize.columns);this.cellIndex.right=this.cellIndex.left+this.dataGrid.tileSize.columns-1;if(this.cellIndex.right>=this.dataGrid.size.columns-1){this.cellIndex.right=this.dataGrid.size.columns-1;this.edge.right=true}break}switch(this.region.location.v){case-1:this.cellIndex.top=this.tileIndex.row*this.dataGrid.tileSize.rows;this.cellIndex.bottom=this.cellIndex.top+this.dataGrid.tileSize.rows-1;if(this.cellIndex.bottom>=this.dataGrid.fixedCells.top){this.cellIndex.bottom=this.dataGrid.fixedCells.top-1;this.edge.bottom=true}break;case 0:this.cellIndex.top=this.tileIndex.row*this.dataGrid.tileSize.rows+this.dataGrid.fixedCells.top;this.cellIndex.bottom=this.cellIndex.top+this.dataGrid.tileSize.rows-1;if(this.cellIndex.bottom>=this.dataGrid.size.rows-this.dataGrid.fixedCells.bottom-1){this.cellIndex.bottom=this.dataGrid.size.rows-this.dataGrid.fixedCells.bottom-1;this.edge.bottom=true}break;case 1:this.cellIndex.top=this.dataGrid.size.rows-this.dataGrid.fixedCells.bottom-(this.tileIndex.row*this.dataGrid.tileSize.rows);this.cellIndex.bottom=this.cellIndex.top+this.dataGrid.tileSize.rows-1;if(this.cellIndex.bottom>=this.dataGrid.size.rows-1){this.cellIndex.bottom=this.dataGrid.size.rows-1;this.edge.bottom=true}break}},adjustPositionPx:function(h,v){if(this.div){if(h&&!this.region.location.h){this.bounds.left+=h;this.div.style.left=this.bounds.left+"px"}if(v&&!this.region.location.v){this.bounds.top+=v;this.div.style.top=this.bounds.top+"px"}}if(!this.isOnScreen()){this.remove()}},create:function(){var tr,td,row,column;var columnWidths=[];this.bounds={};this.bounds.width=0;for(column=this.cellIndex.left;column<=this.cellIndex.right;++column){this.bounds.width+=columnWidths[column]=this.dataGrid._getColumnWidth(column)}this.div=document.createElement("div");this.div.style.cssText="position:absolute;";this._table=this.dataGrid.getPrototypeTable().cloneNode(true);this._table.style.width=this.bounds.width+"px";this.div.appendChild(this._table);for(row=this.cellIndex.top;row<=this.cellIndex.bottom;++row){tr=document.createElement("tr");for(column=this.cellIndex.left;column<=this.cellIndex.right;++column){td=document.createElement("td");td.style.padding=0;Echo.Sync.Border.render(this.dataGrid._cellBorder,td);if(row===this.cellIndex.top){td.style.width=columnWidths[column]+"px"}var value=this.dataGrid._model.get(column,row);if(value==null){value="\u00a0"}td.appendChild(document.createTextNode(value));tr.appendChild(td)}this._table.firstChild.appendChild(tr)}this.bounds.height=new Core.Web.Measure.Bounds(this.div).height;this.div.style.width=this.bounds.width+"px"},display:function(left,top){if(this.displayed){return}if(!this.div){this.create()}this.bounds.top=top;this.bounds.left=left;this.div.style.top=top+"px";this.div.style.left=left+"px";this.containerElement.appendChild(this.div);this.displayed=true},dispose:function(){this._renderContext.dispose();this.div=this._table=null},isEdgeBottom:function(){return this.edge.bottom||(this.bounds.top<this.region.bounds.height&&this.bounds.top+this.bounds.height>=this.region.bounds.height)},isEdgeLeft:function(){return this.edge.left||this.tileIndex.column===0||(this.bounds.left<=0&&this.bounds.left+this.bounds.width>0)},isEdgeRight:function(){return this.edge.right||(this.bounds.left<this.region.bounds.width&&this.bounds.left+this.bounds.width>=this.region.bounds.width)},isEdgeTop:function(){return this.edge.top||this.tileIndex.row===0||(this.bounds.top<=0&&this.bounds.top+this.bounds.height>0)},isOnScreen:function(){if(!this.displayed){return false}return Extras.Sync.DataGrid.intersect(this.bounds.left,this.bounds.left+this.bounds.width,0,this.region.bounds.width)&&Extras.Sync.DataGrid.intersect(this.bounds.top,this.bounds.top+this.bounds.height,0,this.region.bounds.height)},remove:function(){if(this.displayed){this.div.parentNode.removeChild(this.div);this.displayed=false}},toString:function(){return"Tile ("+this.tileIndex.column+","+this.tileIndex.row+")"}}),Region:Core.extend({dataGrid:null,_tiles:null,bounds:null,name:null,location:null,$construct:function(dataGrid,name){this.dataGrid=dataGrid;this.name=name;this._tiles={};this.location=Extras.Sync.DataGrid.REGION_LOCATIONS[name];this.element=document.createElement("div");this.element.style.cssText="position:absolute;overflow:hidden;";if(this.location.h===-1){this.element.style.left=0}else if(this.location.h===1){this.element.style.right=0}if(this.location.v===-1){this.element.style.top=0}else if(this.location.h===1){this.element.style.bottom=0}},adjustPositionPx:function(x,y){if(this.location.h&&this.location.y){return}x=this.location.h?0:x;y=this.location.v?0:y;var row,tile;for(var rowIndex in this._tiles){row=this._tiles[rowIndex];for(var columnIndex in row){tile=row[columnIndex];tile.adjustPositionPx(x,y)}}this.fill(y>0)},clear:function(){for(var rowIndex in this._tiles){var row=this._tiles[rowIndex];for(var columnIndex in row){var tile=row[columnIndex];tile.remove();tile.dispose()}}this._tiles={}},displayTileAdjacent:function(tile,direction){if(!tile.displayed){throw new Error("Tile not displayed, cannot position adjacent tile: "+tile);}var adjacentTile=this.getTile(tile.tileIndex.column+direction.h,tile.tileIndex.row+direction.v);if(adjacentTile==null){return null}adjacentTile.display(tile.bounds.left+(tile.bounds.width*direction.h),tile.bounds.top+(tile.bounds.height*direction.v));return adjacentTile},fill:function(fromBottom){var originTile=this._findVerticalEdgeTile(fromBottom);while(!originTile.isEdgeLeft()){originTile=this.displayTileAdjacent(originTile,Extras.Sync.DataGrid.LEFT)}if(originTile==null){alert("FIXME...can't find origin tile, scenario not handled yet.")}else{do{var tile=originTile;while(tile.isOnScreen()&&!tile.isEdgeRight()){tile=this.displayTileAdjacent(tile,Extras.Sync.DataGrid.RIGHT)}originTile=this.displayTileAdjacent(originTile,fromBottom?Extras.Sync.DataGrid.UP:Extras.Sync.DataGrid.DOWN)}while(originTile!=null&&originTile.isOnScreen())}},_findVerticalEdgeTile:function(bottom){var row,tile,topRowIndex=null,rowIndex;for(rowIndex in this._tiles){if(topRowIndex==null||(bottom?(rowIndex>topRowIndex):(rowIndex<topRowIndex))){row=this._tiles[rowIndex];for(var columnIndex in row){if(row[columnIndex].isOnScreen()){tile=row[columnIndex];topRowIndex=rowIndex;break}}}}return tile},getTile:function(columnIndex,rowIndex){if(columnIndex<0||rowIndex<0||rowIndex>this.dataGrid.size.rows/this.dataGrid.tileSize.rows||columnIndex>this.dataGrid.size.columns/this.dataGrid.tileSize.columns){return null}var cachedRow=this._tiles[rowIndex];if(!cachedRow){cachedRow={};this._tiles[rowIndex]=cachedRow}var tile=cachedRow[columnIndex];if(!tile){tile=new Extras.Sync.DataGrid.Tile(this.dataGrid,this,columnIndex,rowIndex);cachedRow[columnIndex]=tile}return tile},setPosition:function(x,y){var tileRowIndex,tileColumnIndex,initTileColumnIndex,cursorXPx,cursorYPx,tile;this.clear();initTileColumnIndex=Math.floor(x/this.dataGrid.tileSize.columns);tileRowIndex=Math.floor(y/this.dataGrid.tileSize.rows);cursorYPx=0;while(cursorYPx<this.bounds.height){tileColumnIndex=initTileColumnIndex;cursorXPx=0;while(cursorXPx<this.bounds.width){tile=this.getTile(tileColumnIndex,tileRowIndex);tile.display(cursorXPx,cursorYPx);if(tile.isEdgeRight()){break}cursorXPx+=tile.bounds.width;++tileColumnIndex}if(tile.isEdgeBottom()){break}cursorYPx+=tile.bounds.height;++tileRowIndex}},updateBounds:function(left,top,right,bottom){this.bounds={};switch(this.location.h){case-1:this.element.style.width=left+"px";this.bounds.width=left;break;case 0:this.element.style.left=left+"px";this.element.style.right=right+"px";this.bounds.width=this.dataGrid.scrollContainer.bounds.width-left-right;break;case 1:this.element.style.width=right+"px";this.bounds.width=right;break}switch(this.location.v){case-1:this.element.style.height=top+"px";this.bounds.height=top;break;case 0:this.element.style.top=top+"px";this.element.style.bottom=bottom+"px";this.bounds.height=this.dataGrid.scrollContainer.bounds.height-top-bottom;break;case 1:this.element.style.height=bottom+"px";this.bounds.height=bottom;break}}})},tileSize:{columns:12,rows:6},_fullRenderRequired:null,_div:null,position:null,regions:null,_model:null,size:null,fixedCells:null,fixedCellSizes:null,scrollContainer:null,$construct:function(){this._div=null;this.position={x:0,y:0}},_adjustIndexByPx:function(px,horizontal){if(px===0){return}var index=horizontal?this.position.x:this.position.y,dist=Math.abs(px),inc=px<0?1:-1,value=0,getSize=horizontal?this._getColumnWidth:this._getRowHeight;Core.Debug.consoleWrite("px="+px);while(value<dist){var size=getSize(index);if(value+size>dist){Core.Debug.consoleWrite("dist-value = "+(dist-value));index+=inc*((dist-value)/size);value=dist}else{value+=size;index+=inc}}if(horizontal){this.position.x=index}else{this.position.y=index}Core.Debug.consoleWrite("Position: "+Core.Debug.toString(this.position))},adjustPositionPx:function(xPx,yPx){if(this.position.x<0&&xPx>0){xPx=0}if(this.position.y<0&&yPx>0){yPx=0}this._adjustIndexByPx(xPx,true);this._adjustIndexByPx(yPx,false);Core.Debug.consoleWrite(Core.Debug.toString(this.position));for(var name in this.regions){this.regions[name].adjustPositionPx(xPx,yPx)}this.scrollContainer.setPosition(this.position.x/this.size.columns,this.position.y/this.size.rows);Core.Debug.consoleWrite("ScrollPos: "+(this.position.y/this.size.rows))},_createRegions:function(){this.regions={};if(this.fixedCells.top){if(this.fixedCells.left){this.regions.topLeft=new Extras.Sync.DataGrid.Region(this,"topLeft")}this.regions.top=new Extras.Sync.DataGrid.Region(this,"top");if(this.fixedCells.right){this.regions.topRight=new Extras.Sync.DataGrid.Region(this,"topRight")}}if(this.fixedCells.bottom){if(this.fixedCells.left){this.regions.bottomLeft=new Extras.Sync.DataGrid.Region(this,"bottomLeft")}this.regions.bottom=new Extras.Sync.DataGrid.Region(this,"bottom");if(this.fixedCells.right){this.regions.bottomRight=new Extras.Sync.DataGrid.Region(this,"bottomRight")}}if(this.fixedCells.left){this.regions.left=new Extras.Sync.DataGrid.Region(this,"left")}this.regions.center=new Extras.Sync.DataGrid.Region(this,"center");if(this.fixedCells.right){this.regions.right=new Extras.Sync.DataGrid.Region(this,"right")}for(var name in this.regions){this.scrollContainer.contentElement.appendChild(this.regions[name].element)}this._updateRegionBounds()},_getCellBorderHeight:function(column,row){return 2},_getCellBorderWidth:function(column,row){return 2},_getColumnWidth:function(column){return 80},getPrototypeTable:function(){if(!this._prototypeTable){this._prototypeTable=document.createElement("table");this._prototypeTable.cellPadding=this._prototypeTable.cellSpacing=0;this._prototypeTable.style.cssText="table-layout:fixed;padding:0;border:0px none;";var tbody=document.createElement("tbody");this._prototypeTable.appendChild(tbody)}return this._prototypeTable},_getRowHeight:function(row){return 17},_loadProperties:function(){this._cellBorder=this.component.render("cellBorder");this._model=this.component.get("model");this.fixedCells={left:parseInt(this.component.render("fixedColumnsLeft",0),10),top:parseInt(this.component.render("fixedRowsTop",0),10),right:parseInt(this.component.render("fixedColumnsRight",0),10),bottom:parseInt(this.component.render("fixedRowsBottom",0),10)};this.fixedCellSizes={left:this.fixedCells.left*this._getColumnWidth(),top:this.fixedCells.top*this._getRowHeight(),right:this.fixedCells.right*this._getColumnWidth(),bottom:this.fixedCells.bottom*this._getRowHeight()}},_processScroll:function(e){if(e.verticalIncrement){this._scrollIncrementalVertical(e.verticalIncrement)}if(e.horizontalIncrement){this._scrollIncrementalHorizontal(e.horizontalIncrement)}Core.Debug.consoleWrite(this.y)},renderAdd:function(update,parentElement){this._div=document.createElement("div");this._div.style.cssText="position:absolute;top:0;left:0;right:0;bottom:0;";this._div.id=this.component.renderId;this.scrollContainer=new Extras.Sync.DataGrid.ScrollContainer();this.scrollContainer.configure(10,10);this.scrollContainer.onScroll=Core.method(this,this._processScroll);this._div.appendChild(this.scrollContainer.rootElement);this._loadProperties();this._fullRenderRequired=true;parentElement.appendChild(this._div)},renderDisplay:function(){Core.Web.VirtualPosition.redraw(this._div);this.scrollContainer.renderDisplay();if(this._fullRenderRequired){this._createRegions();if(this._model==null){this.size={columns:0,rows:0}}else{this.size={columns:this._model.getColumnCount(),rows:this._model.getRowCount()};var topRowIndex=Math.floor(this.position.y);var leftColumnIndex=Math.floor(this.position.x);this.setPosition(this.component.get("columnIndex")||0,this.component.get("rowIndex")||0)}this._fullRenderRequired=false}this._updateRegionBounds()},renderDispose:function(update){this._cachedTileRows={};this._prototypeTable=null;this.regions=null;this._div=null},renderUpdate:function(update){var element=this._div;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement);return true},_scrollIncrementalHorizontal:function(percent){var scrollPixels=Math.round(this.scrollContainer.bounds.width*percent/10);this.adjustPositionPx(0-scrollPixels,0)},_scrollIncrementalVertical:function(percent){var scrollPixels=Math.round(this.scrollContainer.bounds.height*percent/10);this.adjustPositionPx(0,0-scrollPixels)},_scrollRowPercentVertical:function(percent){var row=this.size.rows*percent/100},setPosition:function(x,y){for(var name in this.regions){this.regions[name].setPosition(x,y)}},_updateRegionBounds:function(){var i,name,left=0,top=0,right=0,bottom=0;if(this.fixedCells.top){for(i=0;i<this.fixedCells.top;++i){top+=this._getRowHeight(i)}}if(this.fixedCells.bottom){for(i=0;i<this.fixedCells.bottom;++i){bottom+=this._getRowHeight(this.size.rows-i-1)}}if(this.fixedCells.left){for(i=0;i<this.fixedCells.left;++i){left+=this._getColumnWidth(i)}}if(this.fixedCells.right){for(i=0;i<this.fixedCells.right;++i){right+=this._getColumnWidth(this.size.columns-i-1)}}for(name in this.regions){this.regions[name].updateBounds(left,top,right,bottom)}}});Extras.Sync.DataGrid.ScrollContainer=Core.extend({_hScrollAccumulator:0,_vScrollAccumulator:0,bounds:null,rootElement:null,contentElement:null,_lastScrollSetTime:0,size:5,scrollX:0,scrollY:0,onScroll:null,$construct:function(horizontal,vertical){this.rootElement=document.createElement("div");this.rootElement.style.cssText="position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;";this._vScrollContainer=document.createElement("div");this._vScrollContainer.style.cssText="position:absolute;top:0;bottom:0;right:0;overflow:scroll;";this._vScrollContainer.style.width=(1+Core.Web.Measure.SCROLL_WIDTH)+"px";this._vScrollContent=document.createElement("div");this._vScrollContent.style.cssText="width:1px;height:"+(this.size*100)+"%;";this._vScrollContainer.appendChild(this._vScrollContent);this.rootElement.appendChild(this._vScrollContainer);this._hScrollContainer=document.createElement("div");this._hScrollContainer.style.cssText="position:absolute;;bottom:0;left:0;right:0;overflow:scroll;";this._hScrollContainer.style.height=(1+Core.Web.Measure.SCROLL_HEIGHT)+"px";this._hScrollContent=document.createElement("div");this._hScrollContent.style.cssText="height:1px;width:"+(this.size*100)+"%;";this._hScrollContainer.appendChild(this._hScrollContent);this.rootElement.appendChild(this._hScrollContainer);this.contentElement=document.createElement("div");this.contentElement.style.cssText="position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;background:white;";this.rootElement.appendChild(this.contentElement);Core.Web.Event.add(this._vScrollContainer,"scroll",Core.method(this,this._processScrollV),true);Core.Web.Event.add(this._hScrollContainer,"scroll",Core.method(this,this._processScrollH),true);Core.Web.Event.add(this.rootElement,Core.Web.Env.BROWSER_MOZILLA?"DOMMouseScroll":"mousewheel",Core.method(this,this._processWheel),true)},_accumulatedScroll:function(){if(this._vScrollAccumulator||this._hScrollAccumulator){var v=this._vScrollAccumulator;this._vScrollAccumulator=0;var h=this._hScrollAccumulator;this._hScrollAccumulator=0;if(this.onScroll){this.onScroll({source:this,type:"scroll",horizontalIncrement:h,verticalIncrement:v})}}},configure:function(horizontal,vertical){if(horizontal>1){this._vScrollContainer.style.bottom=this.contentElement.style.bottom=Core.Web.Measure.SCROLL_HEIGHT+"px"}else{this._vScrollContainer.style.bottom=this.contentElement.style.bottom=0}if(vertical>1){this._hScrollContainer.style.right=this.contentElement.style.right=Core.Web.Measure.SCROLL_WIDTH+"px"}else{this._hScrollContainer.style.right=this.contentElement.style.right=0}},dispose:function(){Core.Web.Event.removeAll(this._hScrollContainer);Core.Web.Event.removeAll(this._vScrollContainer);Core.Web.Event.removeAll(this.rootElement);this.rootElement=null;this.contentElement=null},_isUserScroll:function(){return(new Date().getTime()-this._lastScrollSetTime)>100},_processScrollH:function(e){if(!this._isUserScroll()){return}this.scrollX=this._hScrollContainer.scrollLeft/((this.size-1)*this.bounds.width);Core.Debug.consoleWrite("hscroll:"+this.scrollX);if(this.onScroll){}},_processScrollV:function(e){if(!this._isUserScroll()){return}this.scrollY=this._vScrollContainer.scrollTop/((this.size-1)*this.bounds.height);Core.Debug.consoleWrite("vscroll:"+this.scrollY);if(this.onScroll){}},_processWheel:function(e){var wheelScroll;if(e.wheelDelta){wheelScroll=e.wheelDelta/-120}else if(e.detail){wheelScroll=e.detail/3}else{return}if(e.shiftKey){this._hScrollAccumulator+=wheelScroll}else{this._vScrollAccumulator+=wheelScroll}Core.Web.Scheduler.run(Core.method(this,this._accumulatedScroll),10);Core.Web.DOM.preventEventDefault(e);return true},renderDisplay:function(){Core.Web.VirtualPosition.redraw(this.rootElement);Core.Web.VirtualPosition.redraw(this.contentElement);Core.Web.VirtualPosition.redraw(this._hScrollContainer);Core.Web.VirtualPosition.redraw(this._vScrollContainer);this.bounds=new Core.Web.Measure.Bounds(this.contentElement);this._scrollHeight=new Core.Web.Measure.Bounds(this._hScrollContent).height;this._scrollWidth=new Core.Web.Measure.Bounds(this._vScrollContent).width;Core.Debug.consoleWrite(this.bounds)},setPosition:function(scrollX,scrollY){this.scrollX=scrollX;this.scrollY=scrollY;this._hScrollContainer.scrollLeft=this.scrollX*((this.size-1)*this.bounds.width);this._vScrollContainer.scrollTop=this.scrollY*((this.size-1)*this.bounds.height)}});Extras.Sync.DragSource=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.DragSource",this)},_dragDiv:null,_div:null,_overlayDiv:null,_processMouseMoveRef:null,_processMouseUpRef:null,$construct:function(){this._processMouseMoveRef=Core.method(this,this._processMouseMove);this._processMouseUpRef=Core.method(this,this._processMouseUp)},_dragStart:function(e){this._dragStop();this._overlayDiv=document.createElement("div");this._overlayDiv.style.cssText="position:absolute;z-index:30000;width:100%;height:100%;cursor:pointer;";Echo.Sync.FillImage.render(this.client.getResourceUrl("Echo","resource/Transparent.gif"),this._overlayDiv);this._dragDiv=this._div.cloneNode(true);this._dragDiv.style.position="absolute";this._setDragOpacity(0.75);this._overlayDiv.appendChild(this._dragDiv);document.body.appendChild(this._overlayDiv);Core.Web.Event.add(document.body,"mousemove",this._processMouseMoveRef,true);Core.Web.Event.add(document.body,"mouseup",this._processMouseUpRef,true);this._dragUpdate(e)},_dragDrop:function(e){var i,specificTarget=null,dropTarget,testTarget,dropTargetIds,targetElement=this._findElement(this.client.domainElement,e.clientX,e.clientY);while(!specificTarget&&targetElement&&targetElement!=this.client.domainElement){if(targetElement.id){specificTarget=this.client.application.getComponentByRenderId(targetElement.id)}targetElement=targetElement.parentNode}if(!specificTarget){return}dropTargetIds=this.component.get("dropTargetIds");if(!dropTargetIds){dropTargetIds=[]}testTarget=specificTarget;while(testTarget&&!dropTarget){for(i=0;i<dropTargetIds.length;++i){if(dropTargetIds[i]==testTarget.renderId){dropTarget=testTarget;break}}testTarget=testTarget.parent}if(!dropTarget){return}this.component.doDrop(dropTarget.renderId,specificTarget.renderId)},_dragStop:function(){Core.Web.Event.remove(document.body,"mousemove",this._processMouseMoveRef,true);Core.Web.Event.remove(document.body,"mouseup",this._processMouseUpRef,true);if(this._overlayDiv){document.body.removeChild(this._overlayDiv);this._overlayDiv=null}this._dragDiv=null},_dragUpdate:function(e){this._dragDiv.style.top=e.clientY+"px";this._dragDiv.style.left=e.clientX+"px"},_findElement:function(searchElement,x,y){if(searchElement.style.display=="none"||searchElement.style.visibility=="hidden"||(searchElement.nodeName&&searchElement.nodeName.toLowerCase()=="colgroup")){return null}var searchElementIsCandidate=false;if(!(searchElement.nodeName&&searchElement.nodeName.toLowerCase()=="tr")){var bounds=new Core.Web.Measure.Bounds(searchElement);if(this._isBoundsDefined(bounds)){if(this._isInBounds(bounds,x,y)){searchElementIsCandidate=true}else{return null}}}var candidates=null;for(var i=0;i<searchElement.childNodes.length;++i){if(searchElement.childNodes[i].nodeType!=1){continue}var resultElement=this._findElement(searchElement.childNodes[i],x,y);if(resultElement){if(candidates==null){candidates=[]}candidates.push(resultElement)}}if(candidates!=null){if(candidates.length==1){return candidates[0]}else{return this._findHighestCandidate(searchElement,candidates)}}return searchElementIsCandidate?searchElement:null},_findHighestCandidate:function(searchElement,candidates){var candidatePaths=[];var candidateIndex;for(candidateIndex=0;candidateIndex<candidates.length;++candidateIndex){candidatePaths[candidateIndex]=[];var element=candidates[candidateIndex];if(element.style.zIndex){candidatePaths[candidateIndex].unshift(element.style.zIndex)}while(element!=searchElement){element=element.parentNode;if(element.style.zIndex){candidatePaths[candidateIndex].unshift(element.style.zIndex)}}}var elementIndex=0;var elementsFoundOnIteration;do{elementsFoundOnIteration=false;var highestZIndex=0;var highestCandidateIndices=[];for(candidateIndex=0;candidateIndex<candidatePaths.length;++candidateIndex){if(elementIndex<candidatePaths[candidateIndex].length){var zIndex=candidatePaths[candidateIndex][elementIndex];if(zIndex&&zIndex>0&&zIndex>=highestZIndex){if(zIndex==highestZIndex){highestCandidateIndices.push(candidateIndex)}else{highestCandidateIndices=[];highestCandidateIndices.push(candidateIndex)}}elementsFoundOnIteration=true}}if(highestCandidateIndices.length==1){return candidates[highestCandidateIndices[0]]}else if(highestCandidateIndices.length>0){var remainingCandidates=[];for(var i=0;i<highestCandidateIndices.length;++i){remainingCandidates[i]=candidates[highestCandidateIndices[i]]}candidates=remainingCandidates}}while(elementsFoundOnIteration);return candidates[candidates.length-1]},_isBoundsDefined:function(bounds){return bounds.width!==0&&bounds.height!==0},_isInBounds:function(bounds,x,y){return x>=bounds.left&&y>=bounds.top&&x<=bounds.left+bounds.width&&y<=bounds.top+bounds.height},_processMouseDown:function(e){Core.Web.DOM.preventEventDefault(e);if(!this.client||!this.client.verifyInput(this.component)){return}this._dragStart(e)},_processMouseMove:function(e){this._dragUpdate(e)},_processMouseUp:function(e){this._dragStop();this._dragDrop(e)},renderAdd:function(update,parentElement){this._div=document.createElement("div");this._div.id=this.component.renderId;this._div.style.cssText="cursor:pointer;";if(this.component.children.length>0){Echo.Render.renderComponentAdd(update,this.component.children[0],this._div)}Core.Web.Event.add(this._div,"mousedown",Core.method(this,this._processMouseDown),true);parentElement.appendChild(this._div)},renderDispose:function(update){this._dragStop();Core.Web.Event.removeAll(this._div);this._dragDiv=null;this._div=null},renderUpdate:function(update){var element=this._div;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement)},_setDragOpacity:function(value){if(Core.Web.Env.NOT_SUPPORTED_CSS_OPACITY){if(Core.Web.Env.PROPRIETARY_IE_OPACITY_FILTER_REQUIRED){this._dragDiv.style.filter="alpha(opacity="+(value*100)+")"}}else{this._dragDiv.style.opacity=value}}});Extras.Sync.Group=Core.extend(Echo.Render.ComponentSync,{$static:{DEFAULTS:{borderImages:["image/group/GroupBorderTopLeft.png","image/group/GroupBorderTop.png","image/group/GroupBorderTopRight.png","image/group/GroupBorderLeft.png","image/group/GroupBorderRight.png","image/group/GroupBorderBottomLeft.png","image/group/GroupBorderBottom.png","image/group/GroupBorderBottomRight.png"],borderInsets:"10px",titleInsets:"0px 2px"}},$load:function(){Echo.Render.registerPeer("Extras.Group",this)},_div:null,_borderImages:null,_getBorderImage:function(position,repeat,x,y){var image=this._borderImages?this._borderImages[position]:this.client.getResourceUrl("Extras",Extras.Sync.Group.DEFAULTS.borderImages[position]);return image?{url:image,repeat:repeat,x:x,y:y}:null},renderAdd:function(update,parentElement){this._borderImages=this.component.render("borderImage");this._div=document.createElement("div");this._div.id=this.component.renderId;Echo.Sync.Color.render(this.component.render("foreground"),this._div,"color");Echo.Sync.LayoutDirection.render(this.component.getLayoutDirection(),this._div);this._renderBorder(update);parentElement.appendChild(this._div)},_renderBorder:function(update){var borderInsets=this.component.render("borderInsets",Extras.Sync.Group.DEFAULTS.borderInsets);var borderPixelInsets=Echo.Sync.Insets.toPixels(borderInsets);var flags=this.component.render("ieAlphaRenderBorder")?Echo.Sync.FillImage.FLAG_ENABLE_IE_PNG_ALPHA_FILTER:0;var topRightDiv=document.createElement("div");topRightDiv.style.width="100%";Echo.Sync.FillImage.render(this._getBorderImage(2,"no-repeat","100%","100%"),topRightDiv,flags);var topLeftDiv=document.createElement("div");topLeftDiv.style.paddingRight=borderPixelInsets.right+"px";topLeftDiv.style.paddingLeft=borderPixelInsets.left+"px";Echo.Sync.FillImage.render(this._getBorderImage(0,"no-repeat",0,"100%"),topLeftDiv,flags);topRightDiv.appendChild(topLeftDiv);var title=this.component.render("title");if(title){var topTable=document.createElement("table");topTable.style.padding="0px";topTable.style.borderCollapse="collapse";topTable.style.width="100%";var topTbody=document.createElement("tbody");topTable.appendChild(topTbody);var topTr=document.createElement("tr");topTbody.appendChild(topTr);var titlePosition=this.component.render("titlePosition");if(titlePosition){var topPositionTd=document.createElement("td");if(Echo.Sync.Extent.isPercent(titlePosition)){topPositionTd.style.width=titlePosition.toString()}var topPositionImg=document.createElement("img");topPositionImg.src=this.client.getResourceUrl("Echo","resource/Transparent.gif");if(Echo.Sync.Extent.isPercent(titlePosition)){topPositionImg.style.width=titlePosition.toString()}topPositionImg.style.height="1px";topPositionTd.appendChild(topPositionImg);Echo.Sync.FillImage.render(this._getBorderImage(1,"repeat-x",0,"100%"),topPositionTd,flags);topTr.appendChild(topPositionTd)}var titleTd=document.createElement("td");titleTd.style.whiteSpace="nowrap";Echo.Sync.Font.render(this.component.render("titleFont"),titleTd);Echo.Sync.Insets.render(this.component.render("titleInsets",Extras.Sync.Group.DEFAULTS.titleInsets),titleTd,"padding");var titleImage=this.component.render("titleBackgroundImage");if(titleImage){Echo.Sync.FillImage.render({url:titleImage,repeat:"repeat-x",x:0,y:"100%"},titleTd,flags)}titleTd.appendChild(document.createTextNode(title));topTr.appendChild(titleTd);var topFillTd=document.createElement("td");if(titlePosition&&Echo.Sync.Extent.isPercent(titlePosition)){topFillTd.style.width=(100-parseInt(titlePosition,10))+"%"}else{topFillTd.style.width="100%"}topFillTd.style.height=borderPixelInsets.top+"px";Echo.Sync.FillImage.render(this._getBorderImage(1,"repeat-x",0,"100%"),topFillTd,flags);topTr.appendChild(topFillTd);topLeftDiv.appendChild(topTable)}else{var topDiv=document.createElement("div");topDiv.style.width="100%";topDiv.style.height=borderPixelInsets.top+"px";topDiv.style.fontSize="1px";Echo.Sync.FillImage.render(this._getBorderImage(1,"repeat-x",0,"100%"),topDiv,flags);topLeftDiv.appendChild(topDiv)}this._div.appendChild(topRightDiv);var rightDiv=document.createElement("div");rightDiv.style.width="100%";Echo.Sync.FillImage.render(this._getBorderImage(4,"repeat-y","100%",0),rightDiv,flags);var leftDiv=document.createElement("div");leftDiv.style.paddingRight=borderPixelInsets.right+"px";leftDiv.style.paddingLeft=borderPixelInsets.left+"px";Echo.Sync.FillImage.render(this._getBorderImage(3,"repeat-y",0,0),leftDiv,flags);this._renderContent(update,leftDiv);rightDiv.appendChild(leftDiv);this._div.appendChild(rightDiv);var bottomRightDiv=document.createElement("div");bottomRightDiv.style.width="100%";bottomRightDiv.style.height=borderPixelInsets.bottom+"px";bottomRightDiv.style.fontSize="1px";Echo.Sync.FillImage.render(this._getBorderImage(7,"no-repeat","100%","100%"),bottomRightDiv,flags);var bottomLeftDiv=document.createElement("div");bottomLeftDiv.style.paddingRight=borderPixelInsets.right+"px";bottomLeftDiv.style.paddingLeft=borderPixelInsets.left+"px";Echo.Sync.FillImage.render(this._getBorderImage(5,"no-repeat",0,"100%"),bottomLeftDiv,flags);bottomRightDiv.appendChild(bottomLeftDiv);var bottomDiv=document.createElement("div");bottomDiv.style.width="100%";bottomDiv.style.height=borderPixelInsets.bottom+"px";bottomDiv.style.fontSize="1px";Echo.Sync.FillImage.render(this._getBorderImage(6,"repeat-x",0,"100%"),bottomDiv,flags);bottomLeftDiv.appendChild(bottomDiv);this._div.appendChild(bottomRightDiv)},_renderContent:function(update,parentElement){var div=document.createElement("div");Echo.Sync.FillImage.render(this.component.render("backgroundImage"),div);Echo.Sync.Color.render(this.component.render("background"),div,"backgroundColor");Echo.Sync.Font.render(this.component.render("font"),div);Echo.Sync.Insets.render(this.component.render("insets"),div,"padding");var componentCount=this.component.getComponentCount();for(var i=0;i<componentCount;i++){var child=this.component.getComponent(i);Echo.Render.renderComponentAdd(update,child,div)}parentElement.appendChild(div)},renderDispose:function(update){this._borderImages=null;this._div=null},renderUpdate:function(update){var element=this._div;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement);return true}});Extras.Sync.Menu=Core.extend(Echo.Render.ComponentSync,{$static:{DEFAULTS:{foreground:"#000000",background:"#cfcfcf",disabledForeground:"#7f7f7f",selectionForeground:"#ffffff",selectionBackground:"#3f3f3f",border:"1px outset #cfcfcf"}},menuModel:null,stateModel:null,element:null,active:false,_openMenuPath:null,_maskDeployed:false,_processMaskClickRef:null,_overlay:null,$construct:function(){this._processMaskClickRef=Core.method(this,this._processMaskClick);this._openMenuPath=[]},$abstract:{getSubMenuPosition:function(menuModel){},renderMain:function(update){}},$virtual:{activate:function(){if(this.active){return false}this.component.set("modal",true);this.active=true;this.addMask();this.client.application.setFocusedComponent(this.component);Core.Web.DOM.focusElement(this.element);return true},activateItem:function(itemModel){if(this.stateModel&&!this.stateModel.isEnabled(itemModel.modelId)){return}if(itemModel instanceof Extras.OptionModel){this.deactivate();this.processAction(itemModel)}else if(itemModel instanceof Extras.MenuModel){this._openMenu(itemModel)}},processAction:function(itemModel){this.component.doAction(itemModel)}},addMenu:function(menu){this._openMenuPath.push(menu)},addMask:function(){if(this.maskDeployed){return}this.maskDeployed=true;this._overlayAdd(new Core.Web.Measure.Bounds(this.element));Core.Web.Event.add(document.body,"click",this._processMaskClickRef,false);Core.Web.Event.add(document.body,"contextmenu",this._processMaskClickRef,false)},clientKeyDown:function(e){if(e.keyCode==27){this.deactivate();return false}return true},closeAll:function(){while(this._openMenuPath.length>0){var menu=this._openMenuPath.pop();menu.close()}},closeDescendants:function(parentMenu){while(parentMenu!=this._openMenuPath[this._openMenuPath.length-1]){var menu=this._openMenuPath.pop();menu.close()}},deactivate:function(){this.component.set("modal",false);if(!this.active){return}this.active=false;this.closeAll();this.removeMask()},isOpen:function(menuModel){for(var i=0;i<this._openMenuPath.length;++i){if(this._openMenuPath[i].menuModel==menuModel){return true}}return false},_overlayAdd:function(bounds){this._overlayRemove();var bottom=bounds.top+bounds.height,right=bounds.left+bounds.width,domainBounds=new Core.Web.Measure.Bounds(document.body);this._overlay={};if(bounds.top>0){this._overlay.top=document.createElement("div");this._overlay.top.style.cssText="position:absolute;z-index:30000;top:0;left:0;width:100%;"+"height:"+bounds.top+"px;";document.body.appendChild(this._overlay.top)}if(bottom<domainBounds.height){this._overlay.bottom=document.createElement("div");this._overlay.bottom.style.cssText="position:absolute;z-index:30000;bottom:0;left:0;width:100%;"+"top:"+bottom+"px;";document.body.appendChild(this._overlay.bottom)}if(bounds.left>0){this._overlay.left=document.createElement("div");this._overlay.left.style.cssText="position:absolute;z-index:30000;left:0;"+"width:"+bounds.left+"px;top:"+bounds.top+"px;height:"+bounds.height+"px;";document.body.appendChild(this._overlay.left)}if(right<domainBounds.width){this._overlay.right=document.createElement("div");this._overlay.right.style.cssText="position:absolute;z-index:30000;right:0;"+"left:"+right+"px;top:"+bounds.top+"px;height:"+bounds.height+"px;";document.body.appendChild(this._overlay.right)}for(var name in this._overlay){Echo.Sync.FillImage.render(this.client.getResourceUrl("Echo","resource/Transparent.gif"),this._overlay[name]);Core.Web.VirtualPosition.redraw(this._overlay[name])}this.client.forceRedraw()},_overlayRemove:function(){if(!this._overlay){return}for(var name in this._overlay){document.body.removeChild(this._overlay[name])}this._overlay=null;this.client.forceRedraw()},_openMenu:function(menuModel){if(this.isOpen(menuModel)){return}var subMenu=new Extras.Sync.Menu.RenderedMenu(this,menuModel);subMenu.create();var parentMenu=null;for(var i=0;i<this._openMenuPath.length;++i){if(this._openMenuPath[i].menuModel==menuModel.parent){parentMenu=this._openMenuPath[i];break}}if(parentMenu==null){parentMenu=this}else{this.closeDescendants(parentMenu)}var position=parentMenu.getSubMenuPosition(menuModel);var windowBounds=new Core.Web.Measure.Bounds(document.body);if(position.x+subMenu.width>windowBounds.width){position.x=windowBounds.width-subMenu.width;if(position.x<0){position.x=0}}if(position.y+subMenu.height>windowBounds.height){position.y=windowBounds.height-subMenu.height;if(position.y<0){position.y=0}}subMenu.open(position.x,position.y);this.addMenu(subMenu)},_processMaskClick:function(e){this.deactivate();return true},removeMask:function(){if(!this.maskDeployed){return}this._overlayRemove();this.maskDeployed=false;Core.Web.Event.remove(document.body,"click",this._processMaskClickRef,false);Core.Web.Event.remove(document.body,"contextmenu",this._processMaskClickRef,false)},renderAdd:function(update,parentElement){this.menuModel=this.component.get("model");this.stateModel=this.component.get("stateModel");this.element=this.renderMain(update);this.element.tabIndex="-1";this.element.style.outlineStyle="none";parentElement.appendChild(this.element)},renderDispose:function(update){this.deactivate()},renderFocus:function(){Core.Web.DOM.focusElement(this.element)},renderHide:function(){this.deactivate()},renderUpdate:function(update){if(update.isUpdatedPropertySetIn({modal:true})){return}var element=this.element;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement);return false}});Extras.Sync.Menu.RenderedMenu=Core.extend({$static:{DEFAULTS:{iconTextMargin:5,menuInsets:"2px",menuItemInsets:"1px 12px"},FadeAnimation:Core.extend(Extras.Sync.Animation,{_element:null,$construct:function(element,runTime){this._element=element;this.runTime=runTime},init:function(){},step:function(progress){this._element.style.opacity=progress},complete:function(abort){this._element.style.opacity=1}})},menuSync:null,component:null,client:null,element:null,itemElements:null,menuModel:null,width:null,height:null,_activeItem:null,stateModel:null,$construct:function(menuSync,menuModel){this.menuSync=menuSync;this.menuModel=menuModel;this.component=this.menuSync.component;this.client=this.menuSync.client;this.stateModel=this.menuSync.stateModel;this.itemElements={}},close:function(){Core.Web.Event.removeAll(this.element);document.body.removeChild(this.element);this.client.forceRedraw();this.element=null;this.itemElements=null;this._activeItem=null},create:function(){var i,item,img,menuItemContentTd,menuItemIconTd,menuItemTr;this.element=document.createElement("div");this.element.style.position="absolute";this.element.style.zIndex=30050;var opacity=(Core.Web.Env.NOT_SUPPORTED_CSS_OPACITY?100:this.component.render("menuOpacity",100))/100;var menuContentDiv=document.createElement("div");menuContentDiv.style.cssText="position:relative;z-index:10;";this.element.appendChild(menuContentDiv);Echo.Sync.LayoutDirection.render(this.component.getLayoutDirection(),menuContentDiv);Echo.Sync.Insets.render(Extras.Sync.Menu.RenderedMenu.DEFAULTS.menuInsets,menuContentDiv,"padding");Echo.Sync.Border.render(this.component.render("menuBorder",Extras.Sync.Menu.DEFAULTS.border),menuContentDiv);var foreground;var menuForeground=this.component.render("menuForeground");if(menuForeground){foreground=menuForeground}else{foreground=this.component.render("foreground",Extras.Sync.Menu.DEFAULTS.foreground)}Echo.Sync.Color.render(foreground,menuContentDiv,"color");var font=this.component.render("menuFont");if(!font){font=this.component.render("font")}if(font){Echo.Sync.Font.render(font,menuContentDiv)}var backgroundDiv;if(opacity<1){backgroundDiv=document.createElement("div");backgroundDiv.style.cssText="position:absolute;z-index:1;width:100%;height:100%;top:0;bottom:0;";backgroundDiv.style.opacity=opacity;this.element.appendChild(backgroundDiv)}else{backgroundDiv=this.element}var background;var menuBackground=this.component.render("menuBackground");if(menuBackground){background=menuBackground}else{background=this.component.render("background",Extras.Sync.Menu.DEFAULTS.background)}Echo.Sync.Color.render(background,backgroundDiv,"backgroundColor");var backgroundImage;var menuBackgroundImage=this.component.render("menuBackgroundImage");if(menuBackgroundImage){backgroundImage=menuBackgroundImage}else if(menuBackground==null){backgroundImage=this.component.render("backgroundImage")}if(backgroundImage){Echo.Sync.FillImage.render(backgroundImage,backgroundDiv,null)}var menuTable=document.createElement("table");menuTable.style.borderCollapse="collapse";menuContentDiv.appendChild(menuTable);var menuTbody=document.createElement("tbody");menuTable.appendChild(menuTbody);var items=this.menuModel.items;var hasIcons=false;for(i=0;i<items.length;++i){item=items[i];if(item.icon||item instanceof Extras.ToggleOptionModel){hasIcons=true;break}}var textPadding,iconPadding;if(hasIcons){var pixelInsets=Echo.Sync.Insets.toPixels(Extras.Sync.Menu.RenderedMenu.DEFAULTS.menuItemInsets);iconPadding="0px 0px 0px "+pixelInsets.left+"px";textPadding=pixelInsets.top+"px "+pixelInsets.right+"px "+pixelInsets.bottom+"px "+pixelInsets.left+"px"}else{textPadding=Extras.Sync.Menu.RenderedMenu.DEFAULTS.menuItemInsets}for(i=0;i<items.length;++i){item=items[i];if(item instanceof Extras.OptionModel||item instanceof Extras.MenuModel){menuItemTr=document.createElement("tr");this.itemElements[item.id]=menuItemTr;menuItemTr.style.cursor="pointer";menuTbody.appendChild(menuItemTr);if(hasIcons){menuItemIconTd=document.createElement("td");Echo.Sync.Insets.render(iconPadding,menuItemIconTd,"padding");if(item instanceof Extras.ToggleOptionModel){var iconIdentifier;var selected=this.stateModel&&this.stateModel.isSelected(item.modelId);if(item instanceof Extras.RadioOptionModel){iconIdentifier=selected?"image/menu/RadioOn.gif":"image/menu/RadioOff.gif"}else{iconIdentifier=selected?"image/menu/ToggleOn.gif":"image/menu/ToggleOff.gif"}img=document.createElement("img");img.src=this.client.getResourceUrl("Extras",iconIdentifier);menuItemIconTd.appendChild(img)}else if(item.icon){img=document.createElement("img");Echo.Sync.ImageReference.renderImg(item.icon,img);menuItemIconTd.appendChild(img)}menuItemTr.appendChild(menuItemIconTd)}menuItemContentTd=document.createElement("td");Echo.Sync.Insets.render(textPadding,menuItemContentTd,"padding");menuItemContentTd.style.whiteSpace="nowrap";if(this.stateModel&&!this.stateModel.isEnabled(item.modelId)){Echo.Sync.Color.render(this.component.render("disabledForeground",Extras.Sync.Menu.DEFAULTS.disabledForeground),menuItemContentTd,"color")}menuItemContentTd.appendChild(document.createTextNode(item.text));menuItemTr.appendChild(menuItemContentTd);if(item instanceof Extras.MenuModel){var menuItemArrowTd=document.createElement("td");menuItemArrowTd.style.textAlign="right";img=document.createElement("img");var expandImage=this.component.render("menuExpandIcon",this.client.getResourceUrl("Extras","image/menu/ArrowRight.gif"));img.setAttribute("src",expandImage.url?expandImage.url:expandImage);img.setAttribute("alt","");menuItemArrowTd.appendChild(img);menuItemTr.appendChild(menuItemArrowTd)}else{menuItemContentTd.colSpan=2}}else if(item instanceof Extras.SeparatorModel){if(i===0||i===items.length-1||items[i-1]instanceof Extras.SeparatorModel||items[i+1]instanceof Extras.SeparatorModel){continue}menuItemTr=document.createElement("tr");menuTbody.appendChild(menuItemTr);menuItemContentTd=document.createElement("td");menuItemContentTd.colSpan=hasIcons?3:2;menuItemContentTd.style.padding="3px 0px";var hrDiv=document.createElement("div");hrDiv.style.cssText="border-top:1px solid #a7a7a7;height:0;font-size:1px;line-height:0";menuItemContentTd.appendChild(hrDiv);menuItemTr.appendChild(menuItemContentTd)}}var bounds=new Core.Web.Measure.Bounds(this.element);this.width=bounds.width;this.height=bounds.height},_getItemElement:function(element){if(element==null){return null}while(element.nodeName.toLowerCase()!="tr"){if(element==this.element){return null}element=element.parentNode}return element},_getItemModel:function(element){var itemModelId=null;element=this._getItemElement(element);if(element==null){return null}for(var x in this.itemElements){if(this.itemElements[x]==element){itemModelId=x;break}}if(itemModelId==null){return null}else{return this.menuModel.findItem(itemModelId)}},getSubMenuPosition:function(menuModel){var menuElement=this.itemElements[menuModel.id];var itemBounds=new Core.Web.Measure.Bounds(menuElement);var menuBounds=new Core.Web.Measure.Bounds(this.element);return{x:menuBounds.left+menuBounds.width,y:itemBounds.top}},open:function(x,y){this.element.style.left=x+"px";this.element.style.top=y+"px";var animationTime=this.component.render("animationTime",0);if(animationTime&&!Core.Web.Env.NOT_SUPPORTED_CSS_OPACITY){this.element.style.opacity=0;var fadeAnimation=new Extras.Sync.Menu.RenderedMenu.FadeAnimation(this.element,animationTime);fadeAnimation.start()}document.body.appendChild(this.element);this.client.forceRedraw();Core.Web.Event.add(this.element,"click",Core.method(this,this._processClick),false);Core.Web.Event.add(this.element,"mouseover",Core.method(this,this._processItemEnter),false);Core.Web.Event.add(this.element,"mouseout",Core.method(this,this._processItemExit),false);Core.Web.Event.Selection.disable(this.element)},_processClick:function(e){Core.Web.DOM.preventEventDefault(e);var itemModel=this._getItemModel(Core.Web.DOM.getEventTarget(e));if(itemModel){this._setActiveItem(itemModel,true)}},_processItemEnter:function(e){this._processRollover(e,true)},_processItemExit:function(e){this._processRollover(e,false)},_processRollover:function(e,state){if(!this.client||!this.client.verifyInput(this.component)||Core.Web.dragInProgress){return true}var element=this._getItemElement(Core.Web.DOM.getEventTarget(e));if(!element){return}var itemModel=this._getItemModel(element);if(!itemModel){return}if(this.stateModel&&!this.stateModel.isEnabled(itemModel.modelId)){return}if(state){this._setActiveItem(itemModel,false)}},_setActiveItem:function(itemModel,execute){if(this._activeItem){this._setItemHighlight(this._activeItem,false);this._activeItem=null}if(itemModel instanceof Extras.MenuModel){this.menuSync.activateItem(itemModel)}else{if(execute){this.menuSync.activateItem(itemModel);return}else{this.menuSync.closeDescendants(this)}}if(itemModel){this._activeItem=itemModel;this._setItemHighlight(this._activeItem,true)}},_setItemHighlight:function(itemModel,state){var element=this.itemElements[itemModel.id];if(state){Echo.Sync.FillImage.render(this.component.render("selectionBackgroundImage"),element);Echo.Sync.Color.render(this.component.render("selectionBackground",Extras.Sync.Menu.DEFAULTS.selectionBackground),element,"backgroundColor");Echo.Sync.Color.render(this.component.render("selectionForeground",Extras.Sync.Menu.DEFAULTS.selectionForeground),element,"color")}else{element.style.backgroundImage="";element.style.backgroundColor="";element.style.color=""}}});Extras.Sync.ContextMenu=Core.extend(Extras.Sync.Menu,{$load:function(){Echo.Render.registerPeer("Extras.ContextMenu",this)},_mouseX:null,_mouseY:null,getSubMenuPosition:function(menuModel){return{x:this._mouseX,y:this._mouseY}},_processContextClick:function(e){if(!this.client||!this.client.verifyInput(this.component)||Core.Web.dragInProgress){return true}Core.Web.DOM.preventEventDefault(e);this._mouseX=e.pageX||(e.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft));this._mouseY=e.pageY||(e.clientY+(document.documentElement.scrollTop||document.body.scrollTop));this.activate();this.activateItem(this.menuModel)},renderDispose:function(update){Core.Web.Event.removeAll(this.element);Extras.Sync.Menu.prototype.renderDispose.call(this,update)},renderMain:function(update){var contextMenuDiv=document.createElement("div");contextMenuDiv.id=this.component.renderId;var activationMode=this.component.render("activationMode",Extras.ContextMenu.ACTIVATION_MODE_CONTEXT_CLICK);if(activationMode&Extras.ContextMenu.ACTIVATION_MODE_CLICK){Core.Web.Event.add(contextMenuDiv,"click",Core.method(this,this._processContextClick),false)}if(activationMode&Extras.ContextMenu.ACTIVATION_MODE_CONTEXT_CLICK){Core.Web.Event.add(contextMenuDiv,"contextmenu",Core.method(this,this._processContextClick),false)}var componentCount=this.component.getComponentCount();if(componentCount>0){Echo.Render.renderComponentAdd(update,this.component.getComponent(0),contextMenuDiv)}return contextMenuDiv},renderUpdate:function(update){if(update.isUpdatedPropertySetIn({stateModel:true,model:true})){var removedChildren=update.getRemovedChildren();if(removedChildren){Core.Web.DOM.removeNode(this.element.firstChild)}var addedChildren=update.getAddedChildren();if(addedChildren){Echo.Render.renderComponentAdd(update,addedChildren[0],this.element)}var modelUpdate=update.getUpdatedProperty("model");var stateModelUpdate=update.getUpdatedProperty("stateModel");var reOpenMenu=this.maskDeployed&&(modelUpdate||stateModelUpdate);if(reOpenMenu){this.deactivate()}if(modelUpdate){this.menuModel=modelUpdate.newValue}if(stateModelUpdate){this.stateModel=stateModelUpdate.newValue}if(reOpenMenu){this.activate();this.activateItem(this.menuModel)}return false}Extras.Sync.Menu.prototype.renderUpdate.call(this,update);return true}});Extras.Sync.DropDownMenu=Core.extend(Extras.Sync.Menu,{$load:function(){Echo.Render.registerPeer("Extras.DropDownMenu",this)},_contentDiv:null,_selectedItem:null,_createSelectionContent:function(itemModel){var img;if(itemModel.icon){if(itemModel.text){var table=document.createElement("table");table.style.cssText="border-collapse:collapse;padding:0;";var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td=document.createElement("td");td.style.cssText="padding:0vertical-align:top;";img=document.createElement("img");Echo.Sync.ImageReference.renderImg(itemModel.icon,img);td.appendChild(img);tr.appendChild(td);td=document.createElement("td");td.style.cssText="padding:width:3px;";var spacingDiv=document.createElement("div");spacingDiv.style.cssText="width:3px";td.appendChild(spacingDiv);tr.appendChild(td);td=document.createElement("td");td.style.cssText="padding:0vertical-align:top;";td.appendChild(document.createTextNode(itemModel.text));tr.appendChild(td);tbody.appendChild(tr);table.appendChild(tbody);return table}else{img=document.createElement("img");Echo.Sync.ImageReference.renderImg(itemModel.icon,img);return img}}else{return document.createTextNode(itemModel.text?itemModel.text:"\u00a0")}},getSubMenuPosition:function(menuModel){var bounds=new Core.Web.Measure.Bounds(this.element);return{x:bounds.left,y:bounds.top+bounds.height}},processAction:function(itemModel){if(this.component.render("selectionEnabled")){this._setSelection(itemModel)}var path=itemModel.getItemPositionPath().join(".");this.component.set("selection",path);Extras.Sync.Menu.prototype.processAction.call(this,itemModel)},_processClick:function(e){if(!this.client||!this.client.verifyInput(this.component)||Core.Web.dragInProgress){return true}Core.Web.DOM.preventEventDefault(e);this.activate();this.activateItem(this.menuModel)},renderDispose:function(update){Core.Web.Event.removeAll(this.element);this._contentDiv=null;Extras.Sync.Menu.prototype.renderDispose.call(this,update)},renderMain:function(){var dropDownDiv=document.createElement("div");dropDownDiv.id=this.component.renderId;dropDownDiv.style.cssText="overflow:hidden;cursor:pointer;";Echo.Sync.LayoutDirection.render(this.component.getLayoutDirection(),dropDownDiv);Echo.Sync.Color.render(this.component.render("foreground",Extras.Sync.Menu.DEFAULTS.foreground),dropDownDiv,"color");Echo.Sync.Color.render(this.component.render("background",Extras.Sync.Menu.DEFAULTS.background),dropDownDiv,"backgroundColor");Echo.Sync.FillImage.render(this.component.render("backgroundImage"),dropDownDiv);Echo.Sync.Border.render(this.component.render("border",Extras.Sync.Menu.DEFAULTS.border),dropDownDiv);Echo.Sync.Extent.render(this.component.render("width"),dropDownDiv,"width",true,true);Echo.Sync.Extent.render(this.component.render("height"),dropDownDiv,"height",false,true);var relativeDiv=document.createElement("div");relativeDiv.style.cssText="float:right;position:relative;";dropDownDiv.appendChild(relativeDiv);var expandDiv=document.createElement("div");expandDiv.style.cssText="position:absolute;top:2px;right:2px;";var expandIcon=this.component.render("expandIcon",this.client.getResourceUrl("Extras","image/menu/ArrowDown.gif"));var img=document.createElement("img");Echo.Sync.ImageReference.renderImg(expandIcon,img);expandDiv.appendChild(img);relativeDiv.appendChild(expandDiv);this._contentDiv=document.createElement("div");this._contentDiv.style.cssText="float:left;";if(!this.component.render("lineWrap")){this._contentDiv.style.whiteSpace="nowrap"}Echo.Sync.Insets.render(this.component.render("insets","2px 5px"),this._contentDiv,"padding");dropDownDiv.appendChild(this._contentDiv);var clearDiv=document.createElement("div");clearDiv.style.cssText="clear:both;";dropDownDiv.appendChild(clearDiv);Core.Web.Event.add(dropDownDiv,"click",Core.method(this,this._processClick),false);Core.Web.Event.Selection.disable(dropDownDiv);if(this.component.render("selectionEnabled")){var selection=this.component.render("selection");if(selection){this._selectedItem=this.menuModel.getItemModelFromPositions(selection.split("."))}}else{this._selectedItem=null}if(this._selectedItem){this._contentDiv.appendChild(this._createSelectionContent(this._selectedItem))}else{var contentText=this.component.render("selectionText");this._contentDiv.appendChild(document.createTextNode(contentText?contentText:"\u00a0"))}if(!this.component.render("height")){var contentBounds=new Core.Web.Measure.Bounds(this._contentDiv);relativeDiv.style.height=contentBounds.height+"px"}return dropDownDiv},_setSelection:function(itemModel){this._selectedItem=itemModel;for(var i=this._contentDiv.childNodes.length-1;i>=0;--i){this._contentDiv.removeChild(this._contentDiv.childNodes[i])}this._contentDiv.appendChild(this._createSelectionContent(itemModel))}});Extras.Sync.MenuBarPane=Core.extend(Extras.Sync.Menu,{$static:{DEFAULTS:{itemInsets:"0px 12px",insets:"3px 0px"}},$load:function(){Echo.Render.registerPeer("Extras.MenuBarPane",this)},_activeItem:null,_menuBarTable:null,_menuBarBorderHeight:null,itemElements:null,$construct:function(){Extras.Sync.Menu.call(this);this.itemElements={}},activate:function(){if(Extras.Sync.Menu.prototype.activate.call(this)){this.addMenu(this)}},close:function(){if(this._activeItem){this._setItemHighlight(this._activeItem,false);this._activeItem=null}},_getItemElement:function(element){if(element==null){return null}while(element.nodeName.toLowerCase()!="td"){if(element==this.element){return null}element=element.parentNode}return element},_getItemModel:function(element){var itemModelId=null;element=this._getItemElement(element);if(element==null){return null}for(var x in this.itemElements){if(this.itemElements[x]==element){itemModelId=x;break}}if(itemModelId==null){return null}else{return this.menuModel.findItem(itemModelId)}},getPreferredSize:function(){this._menuBarTable.style.height="";var insets=Echo.Sync.Insets.toPixels(this.component.render("insets",Extras.Sync.MenuBarPane.DEFAULTS.insets));return{height:new Core.Web.Measure.Bounds(this.element).height+insets.top+insets.bottom}},getSubMenuPosition:function(menuModel){var itemElement=this.itemElements[menuModel.id];if(!itemElement){throw new Error("Invalid menu: "+menuModel);}var containerBounds=new Core.Web.Measure.Bounds(this.element);var itemBounds=new Core.Web.Measure.Bounds(itemElement);return{x:itemBounds.left,y:containerBounds.top+containerBounds.height}},_processClick:function(e){if(!this.client||!this.client.verifyInput(this.component)){return true}Core.Web.DOM.preventEventDefault(e);var itemModel=this._getItemModel(Core.Web.DOM.getEventTarget(e));if(itemModel){if(itemModel instanceof Extras.OptionModel){this.deactivate();this.processAction(itemModel)}else{this.activate();this._setActiveItem(itemModel,true)}}else{this.deactivate()}},_processItemEnter:function(e){this._processRollover(e,true)},_processItemExit:function(e){this._processRollover(e,false)},_processRollover:function(e,state){if(!this.client||!this.client.verifyInput(this.component)||Core.Web.dragInProgress){return true}var element=this._getItemElement(Core.Web.DOM.getEventTarget(e));if(!element){return}var itemModel=this._getItemModel(element);if(this.stateModel&&!this.stateModel.isEnabled(itemModel.modelId)){return}if(this.active){if(state){this._setActiveItem(itemModel,itemModel instanceof Extras.MenuModel)}}else{this._setItemHighlight(itemModel,state)}},renderDisplay:function(){Core.Web.VirtualPosition.redraw(this.element);var bounds=new Core.Web.Measure.Bounds(this.element.parentNode);var height=bounds.height-this._menuBarBorderHeight;this._menuBarTable.style.height=height<=0?"":height+"px"},renderDispose:function(update){this._menuBarTable=null;Core.Web.Event.removeAll(this.element);Extras.Sync.Menu.prototype.renderDispose.call(this,update)},renderMain:function(update){var menuBarDiv=document.createElement("div");menuBarDiv.id=this.component.renderId;menuBarDiv.style.cssText="overflow:hidden;";Echo.Sync.renderComponentDefaults(this.component,menuBarDiv);var border=this.component.render("border",Extras.Sync.Menu.DEFAULTS.border);var multisided=Echo.Sync.Border.isMultisided(border);this._menuBarBorderHeight=Echo.Sync.Border.getPixelSize(border,"top")+Echo.Sync.Border.getPixelSize(border,"bottom");Echo.Sync.Border.render(multisided?border.top:border,menuBarDiv,"borderTop");Echo.Sync.Border.render(multisided?border.bottom:border,menuBarDiv,"borderBottom");Echo.Sync.FillImage.render(this.component.render("backgroundImage"),menuBarDiv);this._menuBarTable=document.createElement("table");this._menuBarTable.style.borderCollapse="collapse";menuBarDiv.appendChild(this._menuBarTable);var menuBarTbody=document.createElement("tbody");this._menuBarTable.appendChild(menuBarTbody);var menuBarTr=document.createElement("tr");menuBarTbody.appendChild(menuBarTr);if(this.menuModel!=null){var items=this.menuModel.items;for(var i=0;i<items.length;++i){var item=items[i];if(item instanceof Extras.OptionModel||item instanceof Extras.MenuModel){var menuBarItemTd=document.createElement("td");this.itemElements[item.id]=menuBarItemTd;menuBarItemTd.style.padding="0px";menuBarItemTd.style.cursor="pointer";menuBarTr.appendChild(menuBarItemTd);var menuBarItemDiv=document.createElement("div");menuBarItemDiv.style.whiteSpace="nowrap";Echo.Sync.Insets.render(Extras.Sync.MenuBarPane.DEFAULTS.itemInsets,menuBarItemDiv,"padding");menuBarItemTd.appendChild(menuBarItemDiv);if(item.icon){var img=document.createElement("img");img.style.verticalAlign="middle";img.src=item.icon;menuBarItemDiv.appendChild(img);if(item.text){img.style.paddingRight="1ex"}}if(item.text){var textSpan=document.createElement("span");textSpan.style.verticalAlign="middle";textSpan.appendChild(document.createTextNode(item.text));menuBarItemDiv.appendChild(textSpan)}}}}Core.Web.Event.add(menuBarDiv,"click",Core.method(this,this._processClick),false);Core.Web.Event.add(menuBarDiv,"mouseover",Core.method(this,this._processItemEnter),false);Core.Web.Event.add(menuBarDiv,"mouseout",Core.method(this,this._processItemExit),false);Core.Web.Event.Selection.disable(menuBarDiv);return menuBarDiv},_setActiveItem:function(itemModel,execute){if(this._activeItem==itemModel){return}if(this._activeItem){this._setItemHighlight(this._activeItem,false);this._activeItem=null}if(execute){this.activateItem(itemModel)}if(itemModel){this._activeItem=itemModel;this._setItemHighlight(this._activeItem,true)}},_setItemHighlight:function(itemModel,state){var element=this.itemElements[itemModel.id];if(state){Echo.Sync.FillImage.render(this.component.render("selectionBackgroundImage"),element);Echo.Sync.Color.render(this.component.render("selectionBackground",Extras.Sync.Menu.DEFAULTS.selectionBackground),element,"backgroundColor");Echo.Sync.Color.render(this.component.render("selectionForeground",Extras.Sync.Menu.DEFAULTS.selectionForeground),element,"color")}else{element.style.backgroundImage="";element.style.backgroundColor="";element.style.color=""}}});Extras.Sync.RichTextArea=Core.extend(Echo.Arc.ComponentSync,{$static:{DEFAULTS:{controlPaneStyle:{separatorColor:"#dfdfef",separatorHeight:1,autoPositioned:true},controlPaneRowStyle:{insets:"2px 10px",cellSpacing:3,layoutData:{overflow:Echo.SplitPane.OVERFLOW_HIDDEN,background:"#cfcfdf"}},controlPaneButtonStyle:{insets:"0px 8px",lineWrap:false,foreground:"#000000",rolloverEnabled:true,rolloverForeground:"#6f0f0f"},features:{menu:true,toolbar:true,undo:true,clipboard:true,alignment:true,foreground:true,background:true,list:true,table:true,image:true,horizontalRule:true,hyperlink:true,subscript:true,bold:true,italic:true,underline:true,strikethrough:true,paragraphStyle:true,indent:true}},resource:new Core.ResourceBundle({"ColorDialog.Title.Foreground":"Text Color","ColorDialog.Title.Background":"Highlight Color","ColorDialog.PromptForeground":"Foreground:","ColorDialog.PromptBackground":"Background:","Error.ClipboardAccessDisabled":"This browser has clipboard access disabled. "+"Use keyboard shortcuts or change your security settings.","Generic.Cancel":"Cancel","Generic.Error":"Error","Generic.Ok":"Ok","HyperlinkDialog.Title":"Insert Hyperlink","HyperlinkDialog.PromptURL":"URL:","HyperlinkDialog.PromptDescription":"Description Text:","HyperlinkDialog.ErrorDialogTitle":"Cannot Insert Hyperlink","HyperlinkDialog.ErrorDialog.URL":"The URL entered is not valid.","ImageDialog.Title":"Insert Image","ImageDialog.PromptURL":"URL:","ImageDialog.ErrorDialogTitle":"Cannot Insert Image","ImageDialog.ErrorDialog.URL":"The URL entered is not valid.","Menu.Edit":"Edit","Menu.Undo":"Undo","Menu.Redo":"Redo","Menu.Cut":"Cut","Menu.Copy":"Copy","Menu.Paste":"Paste","Menu.Delete":"Delete","Menu.SelectAll":"Select All","Menu.Insert":"Insert","Menu.InsertImage":"Image...","Menu.InsertHyperlink":"Hyperlink...","Menu.InsertHorizontalRule":"Horizontal Rule","Menu.Table":"Table","Menu.Table.New":"New Table...","Menu.Table.DeleteRow":"Delete Row","Menu.Table.DeleteColumn":"Delete Column","Menu.Table.InsertRow":"Insert Row","Menu.Table.InsertColumn":"Insert Column","Menu.BulletedList":"Bulleted List","Menu.NumberedList":"Numbered List","Menu.Format":"Format","Menu.Bold":"Bold","Menu.Italic":"Italic","Menu.Underline":"Underline","Menu.Strikethrough":"Strikethrough","Menu.Superscript":"Superscript","Menu.Subscript":"Subscript","Menu.PlainText":"Plain Text","Menu.TextStyle":"Text Style","Menu.ParagraphStyle":"Paragraph Style","Menu.Alignment":"Alignment","Menu.Left":"Left","Menu.Right":"Right","Menu.Center":"Center","Menu.Justified":"Justified","Menu.Indent":"Indent","Menu.Outdent":"Outdent","Menu.SetForeground":"Set Text Color...","Menu.SetBackground":"Set Highlight Color...","Menu.Heading1":"Heading 1","Menu.Heading2":"Heading 2","Menu.Heading3":"Heading 3","Menu.Heading4":"Heading 4","Menu.Heading5":"Heading 5","Menu.Heading6":"Heading 6","Menu.Normal":"Normal","Menu.Preformatted":"Preformatted","TableDialog.Title":"Insert Table","TableDialog.PromptRows":"Rows:","TableDialog.PromptColumns":"Columns:","TableDialog.ErrorDialogTitle":"Cannot Insert Table","TableDialog.ErrorDialog.Columns":"The entered columns value is not valid.  "+"Please specify a number between 1 and 50.","TableDialog.ErrorDialog.Rows":"The entered rows value is not valid.  Please specify a number between 1 and 50."})},_processDialogCloseRef:null,_execCommandListener:null,$load:function(){Echo.Render.registerPeer("Extras.RichTextArea",this)},$virtual:{getIcons:function(){var icons=this._getDefaultIcons();var customIcons=this.component.get("icons");if(customIcons){for(var x in customIcons){icons[x]=customIcons[x]}}return icons},processInsertHyperlink:function(e){var hyperlinkDialog=new Extras.Sync.RichTextArea.HyperlinkDialog(this.component);hyperlinkDialog.addListener("insertHyperlink",Core.method(this,function(e){this._richTextInput.insertHtml("<a href=\""+e.data.url+"\">"+(e.data.description?e.data.description:e.data.url)+"</a>");this.focusDocument()}));this._openDialog(hyperlinkDialog)},processInsertImage:function(e){var imageDialog=new Extras.Sync.RichTextArea.ImageDialog(this.component);imageDialog.addListener("insertImage",Core.method(this,function(e){this._richTextInput.insertHtml("<img src=\""+e.data.url+"\">");this.focusDocument()}));this._openDialog(imageDialog)},processNewTable:function(e){var tableDialog=new Extras.Sync.RichTextArea.TableDialog(this.component);tableDialog.addListener("tableInsert",Core.method(this,function(e){this.newTable(e.data.columns,e.data.rows);this.focusDocument()}));this._openDialog(tableDialog)},processSetBackground:function(e){var colorDialog=new Extras.Sync.RichTextArea.ColorDialog(this.component,true,this._toolbarButtons.background.get("color"));colorDialog.addListener("colorSelect",Core.method(this,function(e){this.execCommand("background",e.data);this._toolbarButtons.background.set("color",e.data);this.focusDocument()}));this._openDialog(colorDialog)},processSetForeground:function(e){var colorDialog=new Extras.Sync.RichTextArea.ColorDialog(this.component,false,this._toolbarButtons.foreground.get("color"));colorDialog.addListener("colorSelect",Core.method(this,function(e){this.execCommand("foreground",e.data);this._toolbarButtons.foreground.set("color",e.data);this.focusDocument()}));this._openDialog(colorDialog)}},msg:null,icons:null,_paneRender:false,_toolbarButtons:null,_styleSelect:null,_richTextInput:null,_mainDiv:null,$construct:function(){this._execCommandListener=Core.method(this,function(e){this.execCommand(e.commandName,e.value)});this._processDialogCloseRef=Core.method(this,this._processDialogClose);this._toolbarButtons={}},_addComponentListeners:function(){this.component.addListener("execCommand",this._execCommandListener)},createComponent:function(){var features=this.component.render("features",Extras.Sync.RichTextArea.DEFAULTS.features);var contentPane=new Echo.ContentPane();var cursor=contentPane;if(features.menu){var menuSplitPane=new Echo.SplitPane({orientation:Echo.SplitPane.ORIENTATION_VERTICAL_TOP_BOTTOM,autoPositioned:true,children:[this._createMenu()]});cursor.add(menuSplitPane);cursor=menuSplitPane}if(features.toolbar){var toolbarContainer=new Echo.SplitPane({orientation:Echo.SplitPane.ORIENTATION_VERTICAL_TOP_BOTTOM,autoPositioned:true,children:[this._createToolbar()]});cursor.add(toolbarContainer);cursor=toolbarContainer}this._richTextInput=new Extras.RichTextInput({layoutData:{overflow:Echo.SplitPane.OVERFLOW_HIDDEN},background:this.component.render("background"),backgroundImage:this.component.render("backgroundImage"),border:this.component.render("border"),foreground:this.component.render("foreground"),text:this.component.get("text"),events:{action:Core.method(this,function(e){this.component.doAction()}),cursorStyleChange:Core.method(this,this._processCursorStyleChange),property:Core.method(this,function(e){if(e.propertyName=="text"){this._processTextUpdate(e)}})}});cursor.add(this._richTextInput);return contentPane},_createMainMenuBarModel:function(){var features=this.component.render("features",Extras.Sync.RichTextArea.DEFAULTS.features);var menu=new Extras.MenuModel(null,null,null);if(features.undo||features.clipboard){var editMenu=new Extras.MenuModel(null,this.msg["Menu.Edit"],null);if(features.undo){editMenu.addItem(new Extras.OptionModel("/undo",this.msg["Menu.Undo"],this.icons.undo));editMenu.addItem(new Extras.OptionModel("/redo",this.msg["Menu.Redo"],this.icons.redo))}if(features.undo&&features.clipboard){editMenu.addItem(new Extras.SeparatorModel())}if(features.clipboard){editMenu.addItem(new Extras.OptionModel("cut",this.msg["Menu.Cut"],this.icons.cut));editMenu.addItem(new Extras.OptionModel("copy",this.msg["Menu.Copy"],this.icons.copy));editMenu.addItem(new Extras.OptionModel("paste",this.msg["Menu.Paste"],this.icons.paste));editMenu.addItem(new Extras.OptionModel("delete",this.msg["Menu.Delete"],this.icons["delete"]));editMenu.addItem(new Extras.SeparatorModel());editMenu.addItem(new Extras.OptionModel("/selectall",this.msg["Menu.SelectAll"],this.icons.selectAll))}menu.addItem(editMenu)}if(features.list||features.horizontalRule||features.image||features.hyperlink){var insertMenu=new Extras.MenuModel(null,this.msg["Menu.Insert"],null);if(features.list||features.unorderedList){insertMenu.addItem(new Extras.OptionModel("/insertunorderedlist",this.msg["Menu.BulletedList"],this.icons.bulletedList))}if(features.list||features.orderedList){insertMenu.addItem(new Extras.OptionModel("/insertorderedlist",this.msg["Menu.NumberedList"],this.icons.numberedList))}insertMenu.addItem(new Extras.SeparatorModel());if(features.horizontalRule){insertMenu.addItem(new Extras.OptionModel("/inserthorizontalrule",this.msg["Menu.InsertHorizontalRule"],this.icons.horizontalRule))}if(features.image){insertMenu.addItem(new Extras.OptionModel("insertimage",this.msg["Menu.InsertImage"],this.icons.image))}if(features.hyperlink){insertMenu.addItem(new Extras.OptionModel("inserthyperlink",this.msg["Menu.InsertHyperlink"],this.icons.hyperlink))}menu.addItem(insertMenu)}if(features.bold||features.italic||features.underline||features.strikeThrough||features.subscript||features.paragraphStyle||features.alignment||features.indent||features.foreground||features.background){var formatMenu=new Extras.MenuModel(null,this.msg["Menu.Format"],null);if(features.bold||features.italic||features.underline||features.strikeThrough||features.subscript){}if(features.paragraphStyle){formatMenu.addItem(new Extras.MenuModel(null,this.msg["Menu.ParagraphStyle"],this.icons.paragraphStyle,[new Extras.OptionModel("/formatblock/<p>",this.msg["Menu.Normal"],this.icons.styleNormal),new Extras.OptionModel("/formatblock/<pre>",this.msg["Menu.Preformatted"],this.icons.stylePreformatted),new Extras.OptionModel("/formatblock/<h1>",this.msg["Menu.Heading1"],this.icons.styleH1),new Extras.OptionModel("/formatblock/<h2>",this.msg["Menu.Heading2"],this.icons.styleH2),new Extras.OptionModel("/formatblock/<h3>",this.msg["Menu.Heading3"],this.icons.styleH3),new Extras.OptionModel("/formatblock/<h4>",this.msg["Menu.Heading4"],this.icons.styleH4),new Extras.OptionModel("/formatblock/<h5>",this.msg["Menu.Heading5"],this.icons.styleH5),new Extras.OptionModel("/formatblock/<h6>",this.msg["Menu.Heading6"],this.icons.styleH6)]))}if(features.bold||features.italic||features.underline||features.strikeThrough||features.subscript){var textMenu=new Extras.MenuModel(null,this.msg["Menu.TextStyle"],this.icons.textStyle);textMenu.addItem(new Extras.OptionModel("/removeformat",this.msg["Menu.PlainText"],this.icons.plainText));textMenu.addItem(new Extras.SeparatorModel());if(features.bold){textMenu.addItem(new Extras.OptionModel("/bold",this.msg["Menu.Bold"],this.icons.bold))}if(features.italic){textMenu.addItem(new Extras.OptionModel("/italic",this.msg["Menu.Italic"],this.icons.italic))}if(features.underline){textMenu.addItem(new Extras.OptionModel("/underline",this.msg["Menu.Underline"],this.icons.underline))}if(features.strikethrough){textMenu.addItem(new Extras.OptionModel("/strikethrough",this.msg["Menu.Strikethrough"],this.icons.strikethrough))}textMenu.addItem(new Extras.SeparatorModel());if(features.subscript){textMenu.addItem(new Extras.OptionModel("/superscript",this.msg["Menu.Superscript"],this.icons.superscript));textMenu.addItem(new Extras.OptionModel("/subscript",this.msg["Menu.Subscript"],this.icons.subscript))}formatMenu.addItem(textMenu)}if(features.alignment){formatMenu.addItem(new Extras.MenuModel(null,this.msg["Menu.Alignment"],this.icons.alignment,[new Extras.OptionModel("/justifyleft",this.msg["Menu.Left"],this.icons.alignmentLeft),new Extras.OptionModel("/justifycenter",this.msg["Menu.Center"],this.icons.alignmentCenter),new Extras.OptionModel("/justifyright",this.msg["Menu.Right"],this.icons.alignmentRight),new Extras.OptionModel("/justifyfull",this.msg["Menu.Justified"],this.icons.alignmentJustify)]))}formatMenu.addItem(new Extras.SeparatorModel());if(features.indent){formatMenu.addItem(new Extras.OptionModel("/indent",this.msg["Menu.Indent"],this.icons.indent));formatMenu.addItem(new Extras.OptionModel("/outdent",this.msg["Menu.Outdent"],this.icons.outdent))}formatMenu.addItem(new Extras.SeparatorModel());if(features.foreground||features.background){if(features.foreground){formatMenu.addItem(new Extras.OptionModel("foreground",this.msg["Menu.SetForeground"],this.icons.foreground))}if(features.background){formatMenu.addItem(new Extras.OptionModel("background",this.msg["Menu.SetBackground"],this.icons.background))}}menu.addItem(formatMenu)}if(features.table){var tableMenu=new Extras.MenuModel(null,this.msg["Menu.Table"],null);tableMenu.addItem(new Extras.OptionModel("tableNew",this.msg["Menu.Table.New"],this.icons.table));tableMenu.addItem(new Extras.SeparatorModel());tableMenu.addItem(new Extras.OptionModel("/tableInsertRow",this.msg["Menu.Table.InsertRow"],this.icons.tableInsertRow));tableMenu.addItem(new Extras.OptionModel("/tableInsertColumn",this.msg["Menu.Table.InsertColumn"],this.icons.tableInsertColumn));tableMenu.addItem(new Extras.SeparatorModel());tableMenu.addItem(new Extras.OptionModel("/tableDeleteRow",this.msg["Menu.Table.DeleteRow"],this.icons.tableDeleteRow));tableMenu.addItem(new Extras.OptionModel("/tableDeleteColumn",this.msg["Menu.Table.DeleteColumn"],this.icons.tableDeleteColumn));menu.addItem(tableMenu)}return menu},_createMenu:function(){return new Extras.MenuBarPane({styleName:this.component.render("menuStyleName"),model:this._createMainMenuBarModel(),events:{action:Core.method(this,this._processMenuAction)}})},_createToolbar:function(){var row,button;var features=this.component.render("features",Extras.Sync.RichTextArea.DEFAULTS.features);var controlsRow;var panel=new Echo.Panel({styleName:this.component.render("toolbarPanelStyleName"),layoutData:{overflow:Echo.SplitPane.OVERFLOW_HIDDEN},insets:2,children:[controlsRow=new Echo.Row({styleName:this.component.render("toolbarRowStyleName"),cellSpacing:10})]});if(features.paragraphStyle){var actionListener=Core.method(this,function(e){var style=this._styleSelect.get("selectedId");this._richTextInput.execCommand("formatblock","<"+style+">")});this._styleSelect=new Echo.SelectField({items:[{id:"p",text:this.msg["Menu.Normal"]},{id:"pre",text:this.msg["Menu.Preformatted"]},{id:"h1",text:this.msg["Menu.Heading1"]},{id:"h2",text:this.msg["Menu.Heading2"]},{id:"h3",text:this.msg["Menu.Heading3"]},{id:"h4",text:this.msg["Menu.Heading4"]},{id:"h5",text:this.msg["Menu.Heading5"]},{id:"h6",text:this.msg["Menu.Heading6"]}],events:{action:actionListener}});controlsRow.add(this._styleSelect)}if(features.undo){controlsRow.add(new Echo.Row({children:[this._createToolbarButton("<<<",this.icons.undo,this.msg["Menu.Undo"],this._processCommand,"undo"),this._createToolbarButton(">>>",this.icons.redo,this.msg["Menu.Redo"],this._processCommand,"redo")]}))}if(features.bold||features.italic||features.underline){row=new Echo.Row();if(features.bold){button=this._createToolbarButton("B",this.icons.bold,this.msg["Menu.Bold"],this._processCommand,"bold");button.set("toggle",true);row.add(button)}if(features.italic){button=this._createToolbarButton("I",this.icons.italic,this.msg["Menu.Italic"],this._processCommand,"italic");button.set("toggle",true);row.add(button)}if(features.underline){button=this._createToolbarButton("U",this.icons.underline,this.msg["Menu.Underline"],this._processCommand,"underline");button.set("toggle",true);row.add(button)}controlsRow.add(row)}if(features.subscript){controlsRow.add(new Echo.Row({children:[this._createToolbarButton("^",this.icons.superscript,this.msg["Menu.Superscript"],this._processCommand,"superscript"),this._createToolbarButton("v",this.icons.subscript,this.msg["Menu.Subscript"],this._processCommand,"subscript")]}))}if(features.alignment){controlsRow.add(new Echo.Row({children:[this._createToolbarButton("<-",this.icons.alignmentLeft,this.msg["Menu.Left"],this._processCommand,"justifyleft"),this._createToolbarButton("-|-",this.icons.alignmentCenter,this.msg["Menu.Center"],this._processCommand,"justifycenter"),this._createToolbarButton("->",this.icons.alignmentRight,this.msg["Menu.Right"],this._processCommand,"justifyright"),this._createToolbarButton("||",this.icons.alignmentJustify,this.msg["Menu.Justified"],this._processCommand,"justifyfull")]}))}if(features.foreground||features.background){row=new Echo.Row();if(features.foreground){row.add(this._createToolbarButton("FG",this.icons.foreground,this.msg["Menu.SetForeground"],this.processSetForeground,"foreground"))}if(features.background){row.add(this._createToolbarButton("BG",this.icons.background,this.msg["Menu.SetBackground"],this.processSetBackground,"background"))}controlsRow.add(row)}if(features.list||features.horizontalRule||features.image||features.hyperlink||features.table){row=new Echo.Row();if(features.list||features.unorderedList){row.add(this._createToolbarButton("Bulleted List",this.icons.bulletedList,this.msg["Menu.BulletedList"],this._processCommand,"insertunorderedlist"))}if(features.list||features.orderedList){row.add(this._createToolbarButton("Numbered List",this.icons.numberedList,this.msg["Menu.NumberedList"],this._processCommand,"insertorderedlist"))}if(features.horizontalRule){row.add(this._createToolbarButton("Horizontal Rule",this.icons.horizontalRule,this.msg["Menu.InsertHorizontalRule"],this._processCommand,"inserthorizontalrule"))}if(features.image){row.add(this._createToolbarButton("Image",this.icons.image,this.msg["Menu.InsertImage"],this.processInsertImage))}if(features.hyperlink){row.add(this._createToolbarButton("Hyperlink",this.icons.hyperlink,this.msg["Menu.InsertHyperlink"],this.processInsertHyperlink))}if(features.table){row.add(this._createToolbarButton("Table",this.icons.table,this.msg["Menu.NewTable"],this.processNewTable))}controlsRow.add(row)}return panel},_createToolbarButton:function(text,icon,toolTipText,eventMethod,actionCommand){var button=new Extras.Sync.RichTextArea.ToolbarButton({actionCommand:actionCommand,styleName:this.component.render("toolbarButtonStyleName"),text:icon?null:text,icon:icon,toolTipText:toolTipText});if(eventMethod){button.addListener("action",Core.method(this,eventMethod))}this._toolbarButtons[actionCommand]=button;return button},execCommand:function(commandName,value){this._richTextInput.execCommand(commandName,value)},focusDocument:function(){this.arcApplication.setFocusedComponent(this._richTextInput)},getDomainElement:function(){return this._mainDiv},_getDefaultIcons:function(){var iconNames={"16":["alignment","alignmentCenter","alignmentJustify","alignmentLeft","alignmentRight","background","bold","bulletedList","cancel","copy","cut","delete","foreground","horizontalRule","hyperlink","image","indent","italic","numberedList","ok","outdent","paragraphStyle","paste","plainText","redo","selectAll","strikethrough","subscript","superscript","table","tableInsertRow","tableDeleteRow","tableInsertColumn","tableDeleteColumn","textStyle","underline","undo"],"24":["ok","cancel"]};var defaultIcons={};for(var size in iconNames){for(var i=0;i<iconNames[size].length;++i){var iconResource=iconNames[size][i].charAt(0).toUpperCase()+iconNames[size][i].substring(1);defaultIcons[iconNames[size][i]]=this.client.getResourceUrl("Extras","image/richtext/Icon"+size+iconResource+".png")}}return defaultIcons},insertImage:function(url){this._richTextInput.insertHtml("<img src=\""+url+"\">")},newTable:function(columns,rows){var rowHtml="",i,cellContent=Core.Web.Env.ENGINE_MSHTML?"":"<br/>";for(i=0;i<columns;++i){rowHtml+="<td>"+cellContent+"</td>"}rowHtml="<tr>"+rowHtml+"</tr>";var tableHtml="<table width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"1\"><tbody>";for(i=0;i<rows;++i){tableHtml+=rowHtml}tableHtml+="</tbody></table>";this._richTextInput.insertHtml(tableHtml)},_openDialog:function(dialogWindow){var contentPane;if(this._overlayPane==null){this._overlayPane=new Extras.Sync.RichTextArea.OverlayPane();this._overlayPane.rta=this.component;contentPane=new Echo.ContentPane();this._overlayPane.add(contentPane);this.baseComponent.add(this._overlayPane)}else{contentPane=this._overlayPane.children[0]}contentPane.add(dialogWindow);dialogWindow.addListener("parent",this._processDialogCloseRef)},_processCommand:function(e){this.execCommand(e.actionCommand);this.focusDocument()},_processCursorStyleChange:function(e){if(this._toolbarButtons.bold){this._toolbarButtons.bold.set("pressed",e.style.bold)}if(this._toolbarButtons.italic){this._toolbarButtons.italic.set("pressed",e.style.italic)}if(this._toolbarButtons.underline){this._toolbarButtons.underline.set("pressed",e.style.underline)}if(this._toolbarButtons.foreground){this._toolbarButtons.foreground.set("color",e.style.foreground||"#000000")}if(this._toolbarButtons.background){this._toolbarButtons.background.set("color",e.style.background||"#ffffff")}if(this._styleSelect){this._styleSelect.set("selectedId",e.style.paragraphStyle)}},_processDialogClose:function(e){if(e.newValue!=null){return}if(this._overlayPane.children[0].children.length===0){this.baseComponent.remove(this._overlayPane);this._overlayPane=null}e.source.removeListener("parent",this._processDialogCloseRef)},_processMenuAction:function(e){if(e.modelId.charAt(0)=='/'){var separatorIndex=e.modelId.indexOf("/",1);if(separatorIndex==-1){this._richTextInput.execCommand(e.modelId.substring(1))}else{this._richTextInput.execCommand(e.modelId.substring(1,separatorIndex),e.modelId.substring(separatorIndex+1))}}else{switch(e.modelId){case"foreground":this.processSetForeground();break;case"background":this.processSetBackground();break;case"tableNew":this.processNewTable();break;case"inserthyperlink":this.processInsertHyperlink();break;case"insertimage":this.processInsertImage();break;case"cut":case"copy":case"paste":case"delete":try{this._richTextInput.execCommand(e.modelId)}catch(ex){this._openDialog(new Extras.Sync.RichTextArea.MessageDialog(this.component,this.msg["Generic.Error"],this.msg["Error.ClipboardAccessDisabled"]))}}}},_processTextUpdate:function(e){this.component.set("text",e.newValue)},_removeComponentListeners:function(){this.component.removeListener("execCommand",this._execCommandListener)},renderAdd:function(update,parentElement){this._addComponentListeners();this.msg=Extras.Sync.RichTextArea.resource.get(this.component.getRenderLocale());this.icons=this.getIcons();if(!this.icons){this.icons={}}this._paneRender=this.component.parent.pane;this._mainDiv=document.createElement("div");this._mainDiv.id=this.component.renderId;if(this._paneRender){this._mainDiv.style.cssText="position:absolute;top:0px;left:0px;right:0px;bottom:0px;"}else{this._mainDiv.style.position="relative";this._mainDiv.style.height="300px"}parentElement.appendChild(this._mainDiv)},renderDisplay:function(){Core.Web.VirtualPosition.redraw(this._mainDiv);Echo.Arc.ComponentSync.prototype.renderDisplay.call(this)},renderDispose:function(update){this._removeComponentListeners();Echo.Arc.ComponentSync.prototype.renderDispose.call(this,update);this._mainDiv=null},renderFocus:function(){this.arcApplication.setFocusedComponent(this._richTextInput)},renderUpdate:function(update){if(update.isUpdatedPropertySetIn({text:true})){this._richTextInput.set("text",this.component.get("text"));update.renderContext.displayRequired=[];return}var element=this._mainDiv;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement)}});Extras.Sync.RichTextArea.AbstractDialog=Core.extend(Echo.WindowPane,{$static:{TYPE_OK:0,TYPE_OK_CANCEL:1},$abstract:true,rta:null,$construct:function(rta,type,properties,content){this.rta=rta;var controlPaneSplitPaneStyleName=rta.render("controlPaneSplitPaneStyleName");var controlPaneRowStyleName=rta.render("controlPaneRowStyleName");var controlPaneButtonStyleName=rta.render("controlPaneButtonStyleName");Echo.WindowPane.call(this,{styleName:rta.render("windowPaneStyleName"),iconInsets:"6px 10px",contentWidth:"25em",modal:true,resizable:false,events:{close:Core.method(this,this.processCancel)},children:[new Echo.SplitPane({orientation:Echo.SplitPane.ORIENTATION_VERTICAL_BOTTOM_TOP,autoPositioned:true,styleName:controlPaneSplitPaneStyleName,style:controlPaneSplitPaneStyleName?null:Extras.Sync.RichTextArea.DEFAULTS.controlPaneStyle,children:[this.controlsRow=new Echo.Row({styleName:controlPaneRowStyleName,style:controlPaneRowStyleName?null:Extras.Sync.RichTextArea.DEFAULTS.controlPaneRowStyle}),content]})]});this.controlsRow.add(new Echo.Button({styleName:controlPaneButtonStyleName,style:controlPaneButtonStyleName?null:Extras.Sync.RichTextArea.DEFAULTS.controlPaneButtonStyle,text:rta.peer.msg["Generic.Ok"],icon:rta.peer.icons.ok,events:{action:Core.method(this,this.processOk)}}));if(type==Extras.Sync.RichTextArea.AbstractDialog.TYPE_OK_CANCEL){this.controlsRow.add(new Echo.Button({styleName:controlPaneButtonStyleName,style:controlPaneButtonStyleName?null:Extras.Sync.RichTextArea.DEFAULTS.controlPaneButtonStyle,text:rta.peer.msg["Generic.Cancel"],icon:rta.peer.icons.cancel,events:{action:Core.method(this,this.processCancel)}}))}for(var x in properties){this.set(x,properties[x])}},$virtual:{processCancel:function(e){this.parent.remove(this)},processOk:function(e){this.parent.remove(this)}}});Extras.Sync.RichTextArea.ColorDialog=Core.extend(Extras.Sync.RichTextArea.AbstractDialog,{$static:{COLORS:["#fce94f","#edd400","#c4a000","#fcaf3e","#f57900","#e8b86e","#e9b96e","#c17d11","#8f5902","#8ae234","#73d216","#4e9a06","#729fcf","#3465a4","#204a87","#ad7fa8","#75507b","#5c3566","#ef2929","#cc0000","#a40000","#eeeeec","#d3d7cf","#babdb6","#888a85","#555753","#2e3436","#ffffff","#7f7f7f","#000000"]},$construct:function(rta,setBackground,initialColor){Extras.Sync.RichTextArea.AbstractDialog.call(this,rta,Extras.Sync.RichTextArea.AbstractDialog.TYPE_OK_CANCEL,{title:rta.peer.msg[setBackground?"ColorDialog.Title.Background":"ColorDialog.Title.Foreground"],icon:setBackground?rta.peer.icons.background:rta.peer.icons.foreground,contentWidth:"32em"},new Echo.Row({cellSpacing:"1em",insets:"1em",children:[new Echo.Column({children:[new Echo.Label({text:rta.peer.msg[setBackground?"ColorDialog.PromptBackground":"ColorDialog.PromptForeground"]}),this._colorSelect=new Extras.ColorSelect({color:initialColor,displayValue:true})]}),new Echo.Grid({insets:2,size:3,children:this._createSwatches()})]}))},_createSwatches:function(){var children=[];var COLORS=Extras.Sync.RichTextArea.ColorDialog.COLORS;var actionListener=Core.method(this,function(e){this._colorSelect.set("color",e.actionCommand)});for(var i=0;i<COLORS.length;++i){children.push(new Echo.Button({height:"1em",width:"3em",background:COLORS[i],border:"1px outset "+COLORS[i],actionCommand:COLORS[i],events:{action:actionListener}}))}return children},processOk:function(e){var color=this._colorSelect.get("color");this.parent.remove(this);this.fireEvent({type:"colorSelect",source:this,data:color})}});Extras.Sync.RichTextArea.HyperlinkDialog=Core.extend(Extras.Sync.RichTextArea.AbstractDialog,{$construct:function(rta){Extras.Sync.RichTextArea.AbstractDialog.call(this,rta,Extras.Sync.RichTextArea.AbstractDialog.TYPE_OK_CANCEL,{title:rta.peer.msg["HyperlinkDialog.Title"],icon:rta.peer.icons.hyperlink},new Echo.Column({insets:10,children:[new Echo.Label({text:rta.peer.msg["HyperlinkDialog.PromptURL"]}),this._urlField=new Echo.TextField({width:"100%"}),new Echo.Label({text:rta.peer.msg["HyperlinkDialog.PromptDescription"]}),this._descriptionField=new Echo.TextField({width:"100%"})]}))},processOk:function(e){var data={url:this._urlField.get("text"),description:this._descriptionField.get("text")};if(!data.url){this.parent.add(new Extras.Sync.RichTextArea.MessageDialog(this.rta,this.rta.peer.msg["HyperlinkDialog.ErrorDialogTitle"],this.rta.peer.msg["HyperlinkDialog.ErrorDialog.URL"]));return}this.parent.remove(this);this.fireEvent({type:"insertHyperlink",source:this,data:data})}});Extras.Sync.RichTextArea.ImageDialog=Core.extend(Extras.Sync.RichTextArea.AbstractDialog,{$construct:function(rta){Extras.Sync.RichTextArea.AbstractDialog.call(this,rta,Extras.Sync.RichTextArea.AbstractDialog.TYPE_OK_CANCEL,{title:rta.peer.msg["ImageDialog.Title"],icon:rta.peer.icons.image},new Echo.Column({insets:10,children:[new Echo.Label({text:rta.peer.msg["ImageDialog.PromptURL"]}),this._urlField=new Echo.TextField({width:"100%"})]}))},processOk:function(e){var data={url:this._urlField.get("text")};if(!data.url){this.parent.add(new Extras.Sync.RichTextArea.MessageDialog(this.rta,this.rta.peer.msg["ImageDialog.ErrorDialogTitle"],this.rta.peer.msg["ImageDialog.ErrorDialog.URL"]));return}this.parent.remove(this);this.fireEvent({type:"insertImage",source:this,data:data})}});Extras.Sync.RichTextArea.OverlayPane=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.RichTextOverlayPane",this)},rta:null,componentType:"Extras.RichTextOverlayPane",floatingPane:true,pane:true});Extras.Sync.RichTextArea.OverlayPanePeer=Core.extend(Echo.Render.ComponentSync,{_div:null,$load:function(){Echo.Render.registerPeer("Extras.RichTextOverlayPane",this)},renderAdd:function(update,parentElement){this._div=document.createElement("div");this.client.addElement(this._div);this._div.style.cssText="position:absolute;top:0;right:0;bottom:0;left:0;z-index:20000;";if(this.component.children.length==1){Echo.Render.renderComponentAdd(update,this.component.children[0],this._div)}else if(this.component.children.length>1){throw new Error("Too many children added to OverlayPane.");}document.body.appendChild(this._div)},renderDisplay:function(update){if(this._div.style.display!="block"){this._div.style.display="block";this.client.forceRedraw()}Core.Web.VirtualPosition.redraw(this._div)},renderDispose:function(update){if(!this._div){return}this.client.removeElement(this._div);if(this._div.parentNode){this._div.parentNode.removeChild(this._div)}this._div=null},renderHide:function(){this._div.style.display="none"},renderUpdate:function(update){var element=this._div;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement);return true}});Extras.Sync.RichTextArea.MessageDialog=Core.extend(Extras.Sync.RichTextArea.AbstractDialog,{$construct:function(rta,title,message){Extras.Sync.RichTextArea.AbstractDialog.call(this,rta,Extras.Sync.RichTextArea.AbstractDialog.TYPE_OK,{title:title},new Echo.Label({text:message,layoutData:{insets:30}}))}});Extras.Sync.RichTextArea.TableDialog=Core.extend(Extras.Sync.RichTextArea.AbstractDialog,{$construct:function(rta){Extras.Sync.RichTextArea.AbstractDialog.call(this,rta,Extras.Sync.RichTextArea.AbstractDialog.TYPE_OK_CANCEL,{title:rta.peer.msg["TableDialog.Title"],icon:rta.peer.icons.table,contentWidth:"35em"},new Echo.Row({insets:"1em",cellSpacing:"1em",children:[this._sizeSelector=new Extras.Sync.RichTextArea.TableSizeSelector({rows:2,columns:3,events:{property:Core.method(this,this._processSelectorUpdate)}}),new Echo.Grid({width:"100%",insets:3,children:[new Echo.Label({text:rta.peer.msg["TableDialog.PromptRows"],layoutData:{alignment:"trailing"}}),this._rowsField=new Echo.TextField({text:"2",alignment:"center",width:"5em",events:{property:Core.method(this,this._processTextUpdate)}}),new Echo.Label({text:rta.peer.msg["TableDialog.PromptColumns"],layoutData:{alignment:"trailing"}}),this._columnsField=new Echo.TextField({text:"3",alignment:"center",width:"5em",events:{property:Core.method(this,this._processTextUpdate)}})]})]}))},processOk:function(e){var data={rows:parseInt(this._rowsField.get("text"),10),columns:parseInt(this._columnsField.get("text"),10)};if(isNaN(data.rows)||data.rows<1||data.rows>50){this.parent.add(new Extras.Sync.RichTextArea.MessageDialog(this.rta,this.rta.peer.msg["TableDialog.ErrorDialogTitle"],this.rta.peer.msg["TableDialog.ErrorDialog.Rows"]));return}if(isNaN(data.columns)||data.columns<1||data.columns>50){this.parent.add(new Extras.Sync.RichTextArea.MessageDialog(this.rta,this.rta.peer.msg["TableDialog.ErrorDialogTitle"],this.rta.peer.msg["TableDialog.ErrorDialog.Columns"]));return}this.parent.remove(this);this.fireEvent({type:"tableInsert",source:this,data:data})},_processSelectorUpdate:function(e){var columns=parseInt(this._sizeSelector.get("columns"),10),rows=parseInt(this._sizeSelector.get("rows"),10);this._columnsField.set("text",columns);this._rowsField.set("text",rows)},_processTextUpdate:function(e){var columns=parseInt(this._columnsField.get("text"),10),rows=parseInt(this._rowsField.get("text"),10);if(!isNaN(columns)){this._sizeSelector.set("columns",columns)}if(!isNaN(rows)){this._sizeSelector.set("rows",rows)}return true}});Extras.Sync.RichTextArea.TableSizeSelector=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Extras.RichTextTableSizeSelector",this)},componentType:"Extras.RichTextTableSizeSelector"});Extras.Sync.RichTextArea.TableSizeSelectorPeer=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.RichTextTableSizeSelector",this)},_div:null,_table:null,_dragInProgress:false,_drawSelection:function(){var rows=parseInt(this.component.render("rows",0),10),columns=parseInt(this.component.render("columns",0),10),tr=this._table.firstChild.firstChild,y=0,td,x,selected,border,background;while(tr){td=tr.firstChild;x=0;while(td){selected=x<columns&&y<rows;background=selected?this._selectedBackground:null;border=selected?this._selectedBorder:this._border;Echo.Sync.Color.renderClear(background,td,"backgroundColor");Echo.Sync.Border.renderClear(border,td);td=td.nextSibling;++x}tr=tr.nextSibling;++y}},_processMouseDown:function(e){this._dragInProgress=true;this._processMouseSelection(e);return true},_processMouseMove:function(e){if(this._dragInProgress){this._processMouseSelection(e)}return true},_processMouseSelection:function(e){var x=0,y=0,element=e.target;if(!element.nodeName||element.nodeName.toLowerCase()!="td"){return}while(element.previousSibling){++x;element=element.previousSibling}element=element.parentNode;while(element.previousSibling){++y;element=element.previousSibling}this.component.set("columns",x+1);this.component.set("rows",y+1)},_processMouseUp:function(e){this._dragInProgress=false;return true},renderAdd:function(update,parentElement){var tbody,protoTr,tr,td,y,x;this._rowSize=this.component.render("rowSize",10);this._columnSize=this.component.render("columnSize",15);this._border=this.component.render("border","1px outset #dfdfdf");this._selectedBorder=this.component.render("selectedBorder","1px outset #4f4f5f");this._selectedBackground=this.component.render("selectedBackground","#4f4f5f");this._div=document.createElement("div");this._div.id=this.component.renderId;this._table=document.createElement("table");this._table.cellPadding=0;this._table.cellSpacing=0;this._table.style.cssText="padding:0;border:none;font-size:1px;";this._table.style.width=(this._columnSize*18)+"px";Echo.Sync.Color.render(this.component.render("background","#dfdfdf"),this._table,"backgroundColor");tbody=document.createElement("tbody");this._table.appendChild(tbody);protoTr=document.createElement("tr");for(x=0;x<this._columnSize;++x){td=document.createElement("td");td.style.cssText="padding:0;width:16px;height:16px;";td.appendChild(document.createTextNode("\u00a0"));Echo.Sync.Border.render(this._border,td);protoTr.appendChild(td)}for(y=0;y<this._rowSize;++y){tbody.appendChild(protoTr.cloneNode(true))}this._div.appendChild(this._table);Core.Web.Event.Selection.disable(this._div);Core.Web.Event.add(this._div,"mousedown",Core.method(this,this._processMouseDown),false);Core.Web.Event.add(this._div,"mousemove",Core.method(this,this._processMouseMove),false);Core.Web.Event.add(this._div,"mouseup",Core.method(this,this._processMouseUp),false);parentElement.appendChild(this._div);this._drawSelection()},renderDispose:function(update){Core.Web.Event.removeAll(this._div);this._table=null;this._div=null},renderUpdate:function(update){if(update.isUpdatedPropertySetIn({columns:true,rows:true})){this._drawSelection();return}var element=this._div;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement);return true}});Extras.Sync.RichTextArea.ToolbarButton=Core.extend(Echo.Button,{$load:function(){Echo.ComponentFactory.registerType("Extras.RichTextToolbarButton",this)},componentType:"Extras.RichTextToolbarButton",doAction:function(){if(this.render("toggle")){this.set("pressed",!this.get("pressed"))}this.fireEvent({source:this,type:"action",actionCommand:this.render("actionCommand")})}});Extras.Sync.RichTextArea.ToolbarButtonPeer=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.RichTextToolbarButton",this)},_div:null,_processClick:function(e){if(!this.client||!this.client.verifyInput(this.component)){return true}this.client.application.setFocusedComponent(this.component);this.component.doAction()},_processRolloverEnter:function(e){if(!this.client||!this.client.verifyInput(this.component)){return true}this._renderButtonState(true)},_processRolloverExit:function(e){this._renderButtonState(false)},renderAdd:function(update,parentElement){var icon=this.component.render("icon");this._div=document.createElement("div");this._div.style.cssText="position:relative;";this._renderButtonState(false);if(this.component.render("color")){this._renderColor()}Echo.Sync.Insets.render(this.component.render("insets"),this._div,"padding");if(icon){var imgElement=document.createElement("img");Echo.Sync.ImageReference.renderImg(icon,imgElement);this._div.appendChild(imgElement)}Core.Web.Event.add(this._div,"click",Core.method(this,this._processClick),false);Core.Web.Event.add(this._div,"mouseover",Core.method(this,this._processRolloverEnter),false);Core.Web.Event.add(this._div,"mouseout",Core.method(this,this._processRolloverExit),false);parentElement.appendChild(this._div)},_renderButtonState:function(rolloverState){var foreground=this.component.render("foreground");var background=this.component.render("background");var border=this.component.render("border");var backgroundImage=this.component.render("backgroundImage");if(this.component.render("pressed")){foreground=this.component.render("pressedForeground",foreground);background=this.component.render("presssedBackground",background);border=this.component.render("pressedBorder",border);backgroundImage=this.component.render("pressedBackgroundImage",backgroundImage)}if(rolloverState){foreground=this.component.render("rolloverForeground",foreground);background=this.component.render("rolloverBackground",background);backgroundImage=this.component.render("rolloverBackgroundImage",backgroundImage)}Echo.Sync.Color.renderClear(foreground,this._div,"color");Echo.Sync.Color.renderClear(background,this._div,"backgroundColor");Echo.Sync.Border.renderClear(border,this._div);Echo.Sync.FillImage.renderClear(backgroundImage,this._div)},_renderColor:function(){var color=this.component.render("color");if(!this._colorDiv){this._colorDiv=document.createElement("div");this._colorDiv.style.cssText="position:absolute;bottom:0;left:0;right:0;height:5px;line-height:0px;font-size:1px;";if(Core.Web.Env.BROWSER_INTERNET_EXPLORER&&Core.Web.Env.BROWSER_VERSION_MAJOR===6){this._colorDiv.style.width="16px"}this._colorDiv.style.backgroundColor=color||"#ffffff";this._div.appendChild(this._colorDiv)}},renderDispose:function(update){Core.Web.Event.removeAll(this._div);this._div=null;this._colorDiv=null},renderFocus:function(){},renderUpdate:function(update){var element=this._div;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement);return true}});Extras.Sync.RichTextInput=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.RichTextInput",this)},$static:{DEFAULTS:{border:"1px inset #7f7f7f"},BLOCK_NODES:{p:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,pre:true,li:true},EditedHtml:Core.extend({_peer:null,className:"Extras.RichTextInput.EditedHtml",$construct:function(peer){this._peer=peer},toString:function(){return this._peer._getProcessedHtml()}}),Html:{_LEADING_WHITESPACE:/^(\s|<br\/?>|&nbsp;)+/i,_TRAILING_WHITESPACE:/(\s|<br\/?>|&nbsp;)+$/i,_MSIE_INVALID_FONT_COLOR_REPL:/(<font .*?color\=)(#[0-9a-fA-F]{3,6})(.*?>)/ig,_MSIE_INVALID_FONT_BACKGROUND_REPL:/(<font .*?)(background-color)/ig,_CSS_BOLD:/font-weight\:\s*bold/i,_CSS_FOREGROUND_TEST:/^-?color\:/i,_CSS_FOREGROUND_RGB:/^-?color\:\s*rgb\s*\(\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})/i,_CSS_BACKGROUND_TEST:/background-color\:/i,_CSS_BACKGROUND_RGB:/background-color\:\s*rgb\s*\(\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})/i,_CSS_ITALIC:/font-style\:\s*italic/i,_CSS_UNDERLINE:/text-decoration\:\s*underline/i,StyleData:Core.extend({bold:false,italic:false,underline:false,paragraphStyle:null,foreground:null,background:null,$construct:function(node){var rgb;while(node){if(node.nodeType==1){switch(node.nodeName.toLowerCase()){case"b":case"strong":this.bold=true;break;case"i":case"em":this.italic=true;break;case"u":this.underline=true;break;case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"p":case"pre":if(!this.paragraphStyle){this.paragraphStyle=node.nodeName.toLowerCase()}break}var css=node.style.cssText;this.bold|=Extras.Sync.RichTextInput.Html._CSS_BOLD.test(css);this.italic|=Extras.Sync.RichTextInput.Html._CSS_ITALIC.test(css);this.underline|=Extras.Sync.RichTextInput.Html._CSS_UNDERLINE.test(css);if(!this.foreground&&Extras.Sync.RichTextInput.Html._CSS_FOREGROUND_TEST.test(css)){rgb=Extras.Sync.RichTextInput.Html._CSS_FOREGROUND_RGB.exec(css);if(rgb){this.foreground=Echo.Sync.Color.toHex(parseInt(rgb[1],10),parseInt(rgb[2],10),parseInt(rgb[3],10))}}if(!this.background&&Extras.Sync.RichTextInput.Html._CSS_BACKGROUND_TEST.test(css)){rgb=Extras.Sync.RichTextInput.Html._CSS_BACKGROUND_RGB.exec(css);if(rgb){this.background=Echo.Sync.Color.toHex(parseInt(rgb[1],10),parseInt(rgb[2],10),parseInt(rgb[3],10))}}}node=node.parentNode}}}),clean:function(html){html=html||"<p></p>";html=html.replace(Extras.Sync.RichTextInput.Html._LEADING_WHITESPACE,"");html=html.replace(Extras.Sync.RichTextInput.Html._TRAILING_WHITESPACE,"");if(Core.Web.Env.ENGINE_MSHTML){html=html.replace(Extras.Sync.RichTextInput.Html._MSIE_INVALID_FONT_COLOR_REPL,"$1\"$2\"$3");html=html.replace(Extras.Sync.RichTextInput.Html._MSIE_INVALID_FONT_BACKGROUND_REPL,"$1background-color")}return html}},Range:Core.extend({ieRange:null,domRange:null,window:null,$construct:function(targetWindow){this.window=targetWindow;if(Core.Web.Env.ENGINE_MSHTML){this.ieRange=targetWindow.document.selection.createRange();if(this.ieRange.parentElement().ownerDocument!=targetWindow.document){targetWindow.focus();this.ieRange=targetWindow.document.selection.createRange();if(this.ieRange.parentElement().ownerDocument!=targetWindow.document){this.ieRange=null}}}else{this.domRange=targetWindow.getSelection().getRangeAt(0)}},activate:function(){if(this.domRange){var selection=this.window.getSelection();if(!selection){return}selection.removeAllRanges();selection.addRange(this.domRange)}else if(this.ieRange){this.ieRange.select()}},dispose:function(){this.domRange=null;this.ieRange=null;this.window=null},getContainingNode:function(elementName){var node;if(this.domRange){node=this.domRange.commonAncestorContainer}else if(this.ieRange){node=this.ieRange.parentElement()}if(elementName){while(node!=null){if(node.nodeType==1&&node.nodeName.toLowerCase()==elementName){return node}node=node.parentNode}}return node}}),_NAVIGATION_KEY_CODES:{38:1,40:1,37:1,39:1,33:1,34:1,36:1,35:1,8:1,46:1}},_cursorStyleUpdateRequired:false,_fireAction:false,_renderedHtml:null,_propertyListener:null,_execCommandListener:null,_div:null,_iframe:null,_document:null,_temporaryCssStyleEnabled:false,$construct:function(){this._propertyListener=Core.method(this,function(e){if(e.propertyName=="text"){this._loadData()}});this._execCommandListener=Core.method(this,function(e){this._execCommand(e.commandName,e.value)})},_addComponentListeners:function(){this.component.addListener("execCommand",this._execCommandListener);this.component.addListener("property",this._propertyListener)},_deleteTableColumn:function(){var action=Core.method(this,function(td){td.parentNode.removeChild(td)});this._updateSelectedTableColumn(action)},_deleteTableRow:function(){var tr=this._selectionRange.getContainingNode("tr");if(!tr){return}tr.parentNode.removeChild(tr)},_disposeRange:function(){if(this._selectionRange){this._selectionRange.dispose()}},_execCommand:function(commandName,value){if(this._temporaryCssStyleEnabled){this._document.execCommand("styleWithCSS",false,false);this._temporaryCssStyleEnabled=false}if(this._selectionRange){this._loadRange()}else{this._storeRange()}switch(commandName){case"tableDeleteColumn":this._deleteTableColumn();break;case"tableDeleteRow":this._deleteTableRow();break;case"tableInsertColumn":this._insertTableColumn();break;case"tableInsertRow":this._insertTableRow();break;case"foreground":this._document.execCommand("forecolor",false,value);break;case"background":if(Core.Web.Env.ENGINE_GECKO){this._document.execCommand("styleWithCSS",false,true);this._document.execCommand("hilitecolor",false,value);this._temporaryCssStyleEnabled=true}else{this._document.execCommand(Core.Web.Env.ENGINE_MSHTML?"backcolor":"hilitecolor",false,value)}break;case"insertHtml":if(Core.Web.Env.ENGINE_MSHTML){if(!this._selectionRange){this._storeRange()}this._selectionRange.ieRange.pasteHTML(value)}else{this._document.execCommand("inserthtml",false,value)}this._storeRange();break;default:this._document.execCommand(commandName,false,value);break}this._storeData();this.client.forceRedraw();this._cursorStyleUpdateRequired=true},focusDocument:function(){this.client.application.setFocusedComponent(this.component);this.client.forceRedraw()},_getProcessedHtml:function(){if(this._renderedHtml==null){this._renderedHtml=this._document.body.innerHTML}return Extras.Sync.RichTextInput.Html.clean(this._renderedHtml)},_getTableColumnIndex:function(td){var tr=td.parentNode;if(tr.nodeName.toLowerCase()!="tr"){return-1}var index=0;var node=tr.firstChild;while(node&&node!=td){var nodeName=node.nodeName.toLowerCase();if(nodeName=="td"||nodeName=="th"){++index}node=node.nextSibling}if(!node){return-1}return index},_insertTableColumn:function(){var action=Core.method(this,function(td){var newTd=this._document.createElement("td");if(!Core.Web.Env.ENGINE_MSHTML){newTd.appendChild(this._document.createElement("br"))}td.parentNode.insertBefore(newTd,td)});this._updateSelectedTableColumn(action)},_insertTableRow:function(){var tr=this._selectionRange.getContainingNode("tr");var table=this._selectionRange.getContainingNode("table");if(!tr||!table){return}var newTr=this._document.createElement("tr");var node=tr.firstChild;while(node){if(node.nodeType==1&&(node.nodeName.toLowerCase()=="td"||node.nodeName.toLowerCase()=="th")){var newTd=this._document.createElement("td");if(!Core.Web.Env.ENGINE_MSHTML){newTd.appendChild(this._document.createElement("br"))}newTr.appendChild(newTd)}node=node.nextSibling}tr.parentNode.insertBefore(newTr,tr)},_loadData:function(){var text=this.component.get("text")||(Core.Web.Env.ENGINE_GECKO?"<p><br/></p>":"<p></p>");if(text instanceof Extras.Sync.RichTextInput.EditedHtml){return}if(this._renderedHtml==null){this._renderedHtml=this._document.body.innerHTML}if(text==this._renderedHtml){return}this._renderedHtml=text;this._document.body.innerHTML=text;this.component.doCursorStyleChange(new Extras.Sync.RichTextInput.Html.StyleData(this._selectionRange.getContainingNode()))},_loadRange:function(){Core.Debug.consoleWrite("LOADRANGE");if(this._selectionRange){this._selectionRange.activate();if(Core.Web.Env.ENGINE_MSHTML&&this.component.application.getFocusedComponent()!=this.component){this._iframe.contentWindow.blur()}}},_notifyCursorStyleChange:function(){this._cursorStyleUpdateRequired=false;Core.Web.Scheduler.run(Core.method(this,function(){this.component.doCursorStyleChange(new Extras.Sync.RichTextInput.Html.StyleData(this._selectionRange.getContainingNode()))}))},_processFocus:function(e){if(!this.client||!this.client.verifyInput(this.component)){Core.Web.DOM.preventEventDefault(e);return}this.client.application.setFocusedComponent(this.component)},_processKeyDown:function(e){if(!this.client||!this.client.verifyInput(this.component)){Core.Web.DOM.preventEventDefault(e);return}if(e.keyCode==13){this._processNewLine();this._fireAction=true}},_processKeyPress:function(e){if(!this.client||!this.client.verifyInput(this.component)){Core.Web.DOM.preventEventDefault(e);return}},_processKeyUp:function(e){if(!this.client||!this.client.verifyInput(this.component)){return}this._storeData();this._storeRange();if(this._cursorStyleUpdateRequired||Extras.Sync.RichTextInput._NAVIGATION_KEY_CODES[e.keyCode]){this._notifyCursorStyleChange()}if(this._fireAction){this._fireAction=false;this.component.doAction()}},_processMouseDown:function(e){if(!this.client||!this.client.verifyInput(this.component)){Core.Web.DOM.preventEventDefault(e);return}this.client.application.setFocusedComponent(this.component)},_processMouseUp:function(e){if(!this.client||!this.client.verifyInput(this.component)){Core.Web.DOM.preventEventDefault(e);return}this._storeRange();this._notifyCursorStyleChange()},_processNewLine:function(){var node,inBlock;if(!Core.Web.Env.ENGINE_GECKO&&!Core.Web.Env.ENGINE_WEBKIT){return}this._storeRange();node=this._selectionRange.domRange.endContainer;inBlock=false;while(node.nodeType!=1||node.nodeName.toLowerCase()!="body"){if(node.nodeType==1&&Extras.Sync.RichTextInput.BLOCK_NODES[node.nodeName.toLowerCase()]){inBlock=true;break}node=node.parentNode}if(inBlock){return}this._document.execCommand("formatblock",null,"<p>")},_removeComponentListeners:function(){this.component.removeListener("execCommand",this._execCommandListener);this.component.removeListener("property",this._propertyListener)},renderAdd:function(update,parentElement){this._addComponentListeners();this._div=document.createElement("div");Echo.Sync.Border.render(this.component.render("border",Extras.Sync.RichTextInput.DEFAULTS.border),this._div);this._iframe=document.createElement("iframe");this._iframe.style.width=this.width?this.width:"100%";if(!this.component.get("paneRender")){this._iframe.style.height=this.height?this.height:"200px"}this._iframe.style.border="0px none";this._iframe.frameBorder="0";this._div.appendChild(this._iframe);parentElement.appendChild(this._div)},_renderDocument:function(){var element=this._iframe;while(element!=document.body){if(element==null){return}if(element.nodeType==1&&element.style.display=="none"){return}element=element.parentNode}var style="height:100%;width:100%;margin:0px;padding:0px;";var foreground=this.component.render("foreground");if(foreground){style+="color:"+foreground+";"}var background=this.component.render("background");if(background){style+="background-color:"+background+";"}var backgroundImage=this.component.render("backgroundImage");if(backgroundImage){style+="background-attachment: fixed;";style+="background-image:url("+Echo.Sync.FillImage.getUrl(backgroundImage)+");";var backgroundRepeat=Echo.Sync.FillImage.getRepeat(backgroundImage);if(backgroundRepeat){style+="background-repeat:"+backgroundRepeat+";"}var backgroundPosition=Echo.Sync.FillImage.getPosition(backgroundImage);if(backgroundPosition){style+="background-position:"+backgroundPosition+";"}}var text=this.component.get("text");this._document=this._iframe.contentWindow.document;this._document.open();this._document.write("<html><body tabindex=\"0\" width=\"100%\" height=\"100%\""+(style?(" style=\""+style+"\""):"")+">"+(text||"")+"</body></html>");this._document.close();if(Core.Web.Env.BROWSER_MOZILLA&&!Core.Web.Env.BROWSER_FIREFOX){var setDesignModeOn=function(){this._document.designMode="on"};setTimeout(setDesignModeOn,0)}else{this._document.designMode="on";if(Core.Web.Env.ENGINE_GECKO||Core.Web.Env.ENGINE_WEBKIT){this._document.execCommand("insertbronreturn",false,false);this._document.execCommand("stylewithcss",false,false);this._document.execCommand("enableObjectResizing",false,false);this._document.execCommand("enableInlineTableEditing",false,false)}}Core.Web.Event.add(this._document,"focus",Core.method(this,this._processFocus),false);Core.Web.Event.add(this._document,"keydown",Core.method(this,this._processKeyDown),false);Core.Web.Event.add(this._document,"keypress",Core.method(this,this._processKeyPress),false);Core.Web.Event.add(this._document,"keyup",Core.method(this,this._processKeyUp),false);Core.Web.Event.add(this._document,"mousedown",Core.method(this,this._processMouseDown),false);Core.Web.Event.add(this._document,"mouseup",Core.method(this,this._processMouseUp),false);this._documentRendered=true},_renderDocumentRemove:function(){Core.Web.Event.removeAll(this._document);while(this._document.body.firstChild){this._document.body.removeChild(this._document.body.firstChild)}this._documentRendered=false},renderDispose:function(update){this._removeComponentListeners();Core.Web.Event.removeAll(this._document);this._div=null;this._iframe=null;this._document=null;this._documentRendered=false;this._selectionRange=null},renderDisplay:function(){if(!this._documentRendered){this._renderDocument()}this.client.forceRedraw();var bounds=new Core.Web.Measure.Bounds(this._div.parentNode);if(bounds.height){var border=this.component.render("border",Extras.Sync.RichTextInput.DEFAULTS.border);var borderSize=Echo.Sync.Border.getPixelSize(border,"top")+Echo.Sync.Border.getPixelSize(border,"bottom");var calculatedHeight=(bounds.height<100?100:bounds.height-borderSize)+"px";if(this._iframe.style.height!=calculatedHeight){this._iframe.style.height=calculatedHeight}}},renderFocus:function(){if(Core.Web.Env.BROWSER_SAFARI){window.focus()}Core.Web.DOM.focusElement(this._iframe.contentWindow);this.client.forceRedraw()},renderHide:function(){this._disposeRange();this._renderedHtml=this._document.body.innerHTML;this._renderDocumentRemove()},renderUpdate:function(update){if(update.isUpdatedPropertySetIn({text:true})){this._loadData();update.renderContext.displayRequired=[];return}var element=this._div;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement)},_storeData:function(){this._renderedHtml=null;this.component.set("text",new Extras.Sync.RichTextInput.EditedHtml(this),true)},_storeRange:function(){this._disposeRange();this._selectionRange=new Extras.Sync.RichTextInput.Range(this._iframe.contentWindow)},_updateSelectedTableColumn:function(action){var td=this._selectionRange.getContainingNode("td");if(!td){return}var index=this._getTableColumnIndex(td);if(index===-1){return}var table=this._selectionRange.getContainingNode("table");this._updateTableColumnFromTbody(table,index,action)},_updateTableColumnFromTbody:function(tbody,index,action){var node=tbody.firstChild;while(node){if(node.nodeType==1){var nodeName=node.nodeName.toLowerCase();if(nodeName=="tbody"){this._updateTableColumnFromTbody(node,index,action)}else if(nodeName=="tr"){this._updateTableColumnFromTr(node,index,action)}}node=node.nextSibling}},_updateTableColumnFromTr:function(tr,index,action){var i=-1;var node=tr.firstChild;while(node){if(node.nodeType==1){var nodeName=node.nodeName.toLowerCase();if(nodeName=="td"||nodeName=="th"){++i;if(i==index){action(node);return}}}node=node.nextSibling}}});Extras.Sync.TabPane=Core.extend(Echo.Render.ComponentSync,{$static:{_TABLE:null,_createTable:function(){if(!this._TABLE){this._TABLE=document.createElement("table");this._TABLE.style.cssText="border-collapse:collapse;padding:0;";var tbody=document.createElement("tbody");this._TABLE.appendChild(tbody);var tr=document.createElement("tr");tbody.appendChild(tr)}return this._TABLE.cloneNode(true)},_supportedPartialProperties:["activeTabId","activeTabIndex"],_DEFAULTS:{borderType:Extras.TabPane.BORDER_TYPE_ADJACENT_TO_TABS,foreground:"#000000",insets:2,tabActiveBorder:"1px solid #00004f",tabActiveHeightIncrease:2,tabAlignment:"top",tabCloseIconTextMargin:5,tabContentInsets:0,tabIconTextMargin:5,tabInactiveBorder:"1px solid #7f7f7f",tabInset:10,tabInsets:"1px 8px",tabPosition:Extras.TabPane.TAB_POSITION_TOP,tabSpacing:0},ScrollRunnable:Core.extend(Core.Web.Scheduler.Runnable,{repeat:true,timeInterval:20,reverse:false,distance:0,clickDistance:50,pixelsPerSecond:400,initialPosition:null,disposed:false,peer:null,lastInvokeTime:null,$construct:function(peer,reverse){this.peer=peer;this.reverse=reverse;this.initialPosition=peer.scrollPosition;this.lastInvokeTime=new Date().getTime()},dispose:function(){if(!this.disposed){Core.Web.Scheduler.remove(this)}this.disposed=true},finish:function(){if(this.distance<this.clickDistance){this.distance=this.clickDistance;this.updatePosition()}this.peer.renderDisplay();this.dispose()},run:function(){var time=new Date().getTime();this.distance+=Math.ceil(this.pixelsPerSecond*(time-this.lastInvokeTime)/1000);this.lastInvokeTime=time;this.updatePosition()},updatePosition:function(){var position=this.initialPosition+((this.reverse?-1:1)*this.distance);if(!this.peer.setScrollPosition(position)){this.dispose()}}})},$load:function(){Echo.Render.registerPeer("Extras.TabPane",this)},_icons:null,_div:null,_contentContainerDiv:null,_headerContainerBoundsDiv:null,_headerContainerDiv:null,_activeTabId:null,_displayedTabId:null,_previousControlDiv:null,_nextControlDiv:null,_pendingRollover:null,_rolloverTabId:null,_rolloverTabCloseState:false,_rolloverRunnable:null,_tabs:null,_totalTabWidth:0,_headerHeight:null,_layoutRequired:false,_headerUpdateRequired:false,_tabSelectListenerRef:null,_scrollRunnable:null,scrollPosition:0,_rtl:false,$construct:function(){this._tabs=[];this._tabSelectListenerRef=Core.method(this,this._tabSelectListener)},_addTab:function(update,tab,index){if(index==null||index==this._tabs.length){this._tabs.push(tab);tab._renderAdd(update);this._headerContainerDiv.appendChild(tab._headerDiv);this._contentContainerDiv.appendChild(tab._contentDiv)}else{this._tabs.splice(index,0,tab);tab._renderAdd(update);this._headerContainerDiv.insertBefore(tab._headerDiv,this._headerContainerDiv.childNodes[index]);this._contentContainerDiv.insertBefore(tab._contentDiv,this._contentContainerDiv.childNodes[index])}},_renderLayout:function(){if(!this._layoutRequired){return}this._renderHeaderPositions();if(this._headerHeight===0){return}this._layoutRequired=false;if(this._borderDiv){this._borderDiv.style[this._tabSide]=(this._headerHeight-this._ibContentInsetsPx[this._tabSide])+"px"}var borderSize=this._borderType==Extras.TabPane.BORDER_TYPE_NONE?0:Echo.Sync.Border.getPixelSize(this._border);this._headerContainerBoundsDiv.style.height=this._headerHeight+"px";this._contentContainerDiv.style.left=this._contentContainerDiv.style.right=this._contentContainerDiv.style[this._oppositeSide]=0;this._contentContainerDiv.style[this._tabSide]=(this._headerHeight-borderSize)+"px";Core.Web.VirtualPosition.redraw(this._contentContainerDiv);Core.Web.VirtualPosition.redraw(this._headerContainerDiv);Core.Web.VirtualPosition.redraw(this._headerContainerBoundsDiv);for(var i=0;i<this._tabs.length;++i){this._tabs[i]._renderDisplay()}var imageListener=Core.method(this,function(){if(this.component){this._layoutRequired=true;this._renderLayout()}});Core.Web.Image.monitor(this._headerContainerDiv,imageListener)},_renderHeaderPositions:function(){var maxActiveHeight=0,maxInactiveHeight=0,tabActiveHeight,tabInactiveHeight,i,clearHeight=this._tabHeight?(this._tabHeight+"px"):"";this._totalTabWidth=0;this._headerHeight=0;var maximumTabWidth=this.component.render("tabWidth")?null:this.component.render("tabMaximumWidth");var maximumTabWidthPx;if(maximumTabWidth){if(Echo.Sync.Extent.isPercent(maximumTabWidth)){var percent=parseInt(maximumTabWidth,10);maximumTabWidthPx=Math.floor(this._tabContainerWidth*percent/100)}else{maximumTabWidthPx=Echo.Sync.Extent.toPixels(maximumTabWidth)}}for(i=0;i<this._tabs.length;++i){this._tabs[i]._heightTd.style.height=clearHeight;if(maximumTabWidthPx){this._tabs[i]._textDiv.style.width="";var labelBounds=new Core.Web.Measure.Bounds(this._tabs[i]._textDiv,{flags:Core.Web.Measure.Bounds.FLAG_MEASURE_DIMENSION});if(labelBounds.width>maximumTabWidthPx){this._tabs[i]._textDiv.style.width=maximumTabWidthPx+"px"}}var headerDivBounds=new Core.Web.Measure.Bounds(this._tabs[i]._headerDiv,{flags:Core.Web.Measure.Bounds.FLAG_MEASURE_DIMENSION});var adjust=this._tabActiveHeightIncreasePx+this._tabInactivePositionAdjustPx+this._tabs[i]._activeSurroundHeight-this._tabs[i]._inactiveSurroundHeight;if(this._tabs[i]._active){tabActiveHeight=headerDivBounds.height;tabInactiveHeight=headerDivBounds.height-adjust}else{tabInactiveHeight=headerDivBounds.height;tabActiveHeight=headerDivBounds.height+adjust}maxInactiveHeight=tabInactiveHeight>maxInactiveHeight?tabInactiveHeight:maxInactiveHeight;maxActiveHeight=tabActiveHeight>maxActiveHeight?tabActiveHeight:maxActiveHeight;this._tabs[i]._headerDiv.style.left=this._totalTabWidth+"px";this._tabs[i]._headerDiv.style.zIndex=(this._rolloverTabId===this._tabs[i].id)?(this._tabs.length):(this._tabs[i]._active?this._tabs.length+1:i);this._totalTabWidth+=headerDivBounds.width;if(i<this._tabs.length-1){this._totalTabWidth+=this._tabSpacingPx}}for(i=0;i<this._tabs.length;++i){if(this._tabs[i]._active){this._tabs[i]._heightTd.style.height=(maxActiveHeight-(this._tabs[i]._activeSurroundHeight+this._tabInactivePositionAdjustPx+this._tabActiveHeightIncreasePx))+"px"}else{this._tabs[i]._heightTd.style.height=(maxInactiveHeight-this._tabs[i]._inactiveSurroundHeight)+"px"}}this._headerHeight=maxActiveHeight>maxInactiveHeight?maxActiveHeight:maxInactiveHeight;if(Core.Web.VirtualPosition.enabled){for(i=0;i<this._tabs.length;++i){if(this._tabs[i]._fibContainer){Echo.Sync.FillImageBorder.renderContainerDisplay(this._tabs[i]._fibContainer);Core.Web.VirtualPosition.redraw(this._tabs[i]._backgroundDiv)}}}},_getActiveTabId:function(){var activeTabId=this.component.get("activeTabId");if(!activeTabId){var activeTabIndex=this.component.get("activeTabIndex");if(activeTabIndex!=null&&activeTabIndex<this.component.children.length){activeTabId=this.component.children[activeTabIndex].renderId}}return activeTabId},_getSeparatorHeight:function(){if(this._borderType==Extras.TabPane.BORDER_TYPE_NONE){return 0}if(this._imageBorder){return 0}return Echo.Sync.Border.getPixelSize(this._border,this._tabSide)},_getTabById:function(tabId){for(var i=0;i<this._tabs.length;++i){var tab=this._tabs[i];if(tab.id==tabId){return tab}}return null},isChildVisible:function(component){return component.renderId==this._activeTabId},_processScrollRollover:function(e){if(!this.client||!this.client.verifyInput(this.component)){return}var previous=e.registeredTarget===this._previousControlDiv;var enter=e.type=="mouseover";var icon;if(enter){icon=previous?this._icons.rolloverScrollLeftIcon:this._icons.rolloverScrollRightIcon;if(!icon&&!(previous?this._icons.scrollLeftIcon:this._icons.scrollRightIcon)){icon=this.client.getResourceUrl("Extras",previous?"image/tabpane/PreviousRollover.png":"image/tabpane/NextRollover.png")}}else{icon=previous?this._icons.scrollLeftIcon:this._icons.scrollRightIcon;if(!icon){icon=this.client.getResourceUrl("Extras",previous?"image/tabpane/Previous.png":"image/tabpane/Next.png")}}if(icon){e.registeredTarget.firstChild.src=Echo.Sync.ImageReference.getUrl(icon)}},_processScrollStart:function(e){if(!this.client||!this.client.verifyInput(this.component)){return}this._scrollRunnable=new Extras.Sync.TabPane.ScrollRunnable(this,e.registeredTarget===this._previousControlDiv);Core.Web.Scheduler.add(this._scrollRunnable)},_processScrollStop:function(e){if(!this._scrollRunnable){return}this._scrollRunnable.finish();this._scrollRunnable=null},_removeTab:function(tab){var tabIndex=Core.Arrays.indexOf(this._tabs,tab);if(tabIndex==-1){return}if(tab.id==this._activeTabId){this._activeTabId=null}this._tabs.splice(tabIndex,1);Core.Web.DOM.removeNode(tab._headerDiv);Core.Web.DOM.removeNode(tab._contentDiv);tab._renderDispose()},renderAdd:function(update,parentElement){this.component.addListener("tabSelect",this._tabSelectListenerRef);this._icons={scrollLeftIcon:this.component.render("scrollLeftIcon"),scrollRightIcon:this.component.render("scrollRightIcon"),rolloverScrollLeftIcon:this.component.render("rolloverScrollLeftIcon"),rolloverScrollRightIcon:this.component.render("rolloverScrollRightIcon")};this._rtl=!this.component.getRenderLayoutDirection().isLeftToRight();this._activeTabId=this._getActiveTabId();this._tabRolloverEnabled=this.component.render("tabRolloverEnabled");this._insets=this.component.render("insets",Extras.Sync.TabPane._DEFAULTS.insets);this._tabActiveBorder=this.component.render("tabActiveBorder",Extras.Sync.TabPane._DEFAULTS.tabActiveBorder);this._imageBorder=this.component.render("imageBorder");this._border=this._imageBorder?null:this._border=this.component.render("border",this._tabActiveBorder);this._borderType=this.component.render("borderType",Extras.Sync.TabPane._DEFAULTS.borderType);this._tabInactiveBorder=this.component.render("tabInactiveBorder",Extras.Sync.TabPane._DEFAULTS.tabInactiveBorder);this._tabInsetPx=Echo.Sync.Extent.toPixels(this.component.render("tabInset",Extras.Sync.TabPane._DEFAULTS.tabInset));this._tabPositionBottom=this.component.render("tabPosition",Extras.Sync.TabPane._DEFAULTS.tabPosition)==Extras.TabPane.TAB_POSITION_BOTTOM;this._tabSide=this._tabPositionBottom?"bottom":"top";this._oppositeSide=this._tabPositionBottom?"top":"bottom";this._tabSpacingPx=Echo.Sync.Extent.toPixels(this.component.render("tabSpacing",Extras.Sync.TabPane._DEFAULTS.tabSpacing));this._tabActiveHeightIncreasePx=Echo.Sync.Extent.toPixels(this.component.render("tabActiveHeightIncrease",Extras.Sync.TabPane._DEFAULTS.tabActiveHeightIncrease));this._tabInactivePositionAdjustPx=this._getSeparatorHeight();this._tabCloseEnabled=this.component.render("tabCloseEnabled",false);if(this._tabCloseEnabled){this._icons.defaultIcon=this.component.render("tabCloseIcon");this._icons.disabledIcon=this.component.render("tabDisabledCloseIcon");this._icons.rolloverIcon=this.component.render("tabRolloverCloseIcon")}this._tabActiveInsets=Echo.Sync.Insets.toPixels(this.component.render("tabActiveInsets"));this._tabInactiveInsets=Echo.Sync.Insets.toPixels(this.component.render("tabInactiveInsets"));this._tabHeight=Echo.Sync.Extent.toPixels(this.component.render("tabHeight"),false)||0;var pixelInsets=Echo.Sync.Insets.toPixels(this._insets);if(this._imageBorder){this._ibBorderInsetsPx=Echo.Sync.Insets.toPixels(this._imageBorder.borderInsets);this._ibContentInsetsPx=Echo.Sync.Insets.toPixels(this._imageBorder.contentInsets)}if(this._borderType==Extras.TabPane.BORDER_TYPE_SURROUND){if(this._imageBorder){pixelInsets[this._oppositeSide]+=this._ibContentInsetsPx[this._oppositeSide];pixelInsets.left+=this._ibContentInsetsPx.left;pixelInsets.right+=this._ibContentInsetsPx.right}}else if(this._borderType==Extras.TabPane.BORDER_TYPE_PARALLEL_TO_TABS){if(this._imageBorder){this._imageBorder={color:this._imageBorder.color,borderInsets:this._ibBorderInsetsPx.top+"px 0 "+this._ibBorderInsetsPx.bottom+"px",contentInsets:this._ibContentInsetsPx.top+"px 0 "+this._ibContentInsetsPx.bottom+"px",top:this._imageBorder.top,bottom:this._imageBorder.bottom};pixelInsets[this._oppositeSide]+=this._ibContentInsetsPx[this._oppositeSide]}pixelInsets.left=pixelInsets.right=0}else{if(this._imageBorder){var pre=this._tabPositionBottom?"0 0 ":"";var post=this._tabPositionBottom?"":" 0 0";this._imageBorder={color:this._imageBorder.color,borderInsets:pre+this._ibBorderInsetsPx[this._tabSide]+"px"+post,contentInsets:pre+this._ibContentInsetsPx[this._tabSide]+"px"+post,top:this._imageBorder.top}}pixelInsets.left=pixelInsets.right=pixelInsets[this._oppositeSide]=0}this._div=document.createElement("div");this._div.id=this.component.renderId;this._div.style.cssText="position:absolute;top:"+pixelInsets.top+"px;right:"+pixelInsets.right+"px;bottom:"+pixelInsets.bottom+"px;left:"+pixelInsets.left+"px;";this._headerContainerBoundsDiv=document.createElement("div");this._headerContainerBoundsDiv.style.cssText="position:absolute;overflow:hidden;z-index:1;"+(this._tabPositionBottom?"bottom":"top")+":0;"+"left:"+this._tabInsetPx+"px;right:"+this._tabInsetPx+"px;";this._div.appendChild(this._headerContainerBoundsDiv);this._headerContainerDiv=document.createElement("div");this._headerContainerDiv.style.cssText="position:absolute;left:0;right:0;top:0;bottom:0;";Echo.Sync.Font.render(this.component.render("font"),this._headerContainerDiv);Echo.Sync.FillImage.render(this.component.render("tabBackgroundImage"),this._headerContainerDiv);this._headerContainerBoundsDiv.appendChild(this._headerContainerDiv);if(this._imageBorder){this._borderDiv=Echo.Sync.FillImageBorder.renderContainer(this._imageBorder,{absolute:true});if(this._tabPositionBottom){this._borderDiv.style.top=(0-this._ibContentInsetsPx.top)+"px";this._borderDiv.style.bottom=0}else{this._borderDiv.style.top=0;this._borderDiv.style.bottom=(0-this._ibContentInsetsPx.bottom)+"px"}this._borderDiv.style.left=(0-this._ibContentInsetsPx.left)+"px";this._borderDiv.style.right=(0-this._ibContentInsetsPx.right)+"px";this._div.appendChild(this._borderDiv)}this._contentContainerDiv=document.createElement("div");this._contentContainerDiv.style.cssText="position:absolute;overflow:hidden;";Echo.Sync.renderComponentDefaults(this.component,this._contentContainerDiv);if(this._border){if(this._borderType==Extras.TabPane.BORDER_TYPE_NONE){this._contentContainerDiv.style.border="0 none"}else if(this._borderType==Extras.TabPane.BORDER_TYPE_SURROUND){Echo.Sync.Border.render(this._border,this._contentContainerDiv)}else if(this._borderType==Extras.TabPane.BORDER_TYPE_PARALLEL_TO_TABS){Echo.Sync.Border.render(this._border,this._contentContainerDiv,"borderTop");Echo.Sync.Border.render(this._border,this._contentContainerDiv,"borderBottom")}else if(this._tabPositionBottom){Echo.Sync.Border.render(this._border,this._contentContainerDiv,"borderBottom")}else{Echo.Sync.Border.render(this._border,this._contentContainerDiv,"borderTop")}}this._div.appendChild(this._contentContainerDiv);this._verifyActiveTabAvailable();for(var i=0;i<this.component.children.length;++i){var tab=new Extras.Sync.TabPane.Tab(this.component.children[i],this);this._addTab(update,tab)}this._layoutRequired=true;parentElement.appendChild(this._div)},renderDisplay:function(){var i,tab;Core.Web.VirtualPosition.redraw(this._div);this._tabContainerWidth=new Core.Web.Measure.Bounds(this._div,{flags:Core.Web.Measure.Bounds.FLAG_MEASURE_DIMENSION}).width-(2*this._tabInsetPx);this._renderHeaderUpdate();this._renderLayout();if(this._displayedTabId!=this._activeTabId){if(this._displayedTabId!=null){tab=this._getTabById(this._displayedTabId);tab._renderState(false)}if(this._activeTabId!=null){tab=this._getTabById(this._activeTabId);tab._renderState(true)}this._displayedTabId=this._activeTabId}this._renderHeaderPositions();if(this._borderDiv){Core.Web.VirtualPosition.redraw(this._borderDiv);Echo.Sync.FillImageBorder.renderContainerDisplay(this._borderDiv)}Core.Web.VirtualPosition.redraw(this._contentContainerDiv);Core.Web.VirtualPosition.redraw(this._headerContainerDiv);for(i=0;i<this._tabs.length;++i){this._tabs[i]._renderDisplay()}this.setScrollPosition(this.scrollPosition)},renderDispose:function(update){this.component.removeListener("tabSelect",this._tabSelectListenerRef);this._activeTabId=null;for(var i=0;i<this._tabs.length;i++){this._tabs[i]._renderDispose()}this._tabs=[];this._div=null;this._borderDiv=null;this._headerContainerBoundsDiv=null;this._headerContainerDiv=null;this._contentContainerDiv=null;if(this._previousControlDiv){Core.Web.Event.removeAll(this._previousControlDiv);this._previousControlDiv=null}if(this._nextControlDiv){Core.Web.Event.removeAll(this._nextControlDiv);this._nextControlDiv=null}},_renderHeaderUpdate:function(){if(!this._headerUpdateRequired){return}this._headerUpdateRequired=false;for(var i=0;i<this._tabs.length;++i){this._tabs[i]._loadProperties();this._tabs[i]._renderHeaderState(this._tabs[i].id===this._activeTabId,false,true)}},renderUpdate:function(update){var fullRender=false,tab,i;if(update.hasUpdatedLayoutDataChildren()){this._headerUpdateRequired=true}if(!fullRender){if(!Core.Arrays.containsAll(Extras.Sync.TabPane._supportedPartialProperties,update.getUpdatedPropertyNames(),true)){fullRender=true}}if(!fullRender){var activeTabRemoved=false;var removedChildren=update.getRemovedChildren();if(removedChildren){for(i=0;i<removedChildren.length;++i){tab=this._getTabById(removedChildren[i].renderId);if(!tab){continue}if(removedChildren[i].renderId==this._displayedTabId){this._displayedTabId=null}this._removeTab(tab)}}var addedChildren=update.getAddedChildren();if(addedChildren){for(i=0;i<addedChildren.length;++i){tab=new Extras.Sync.TabPane.Tab(addedChildren[i],this);this._addTab(update,tab,this.component.indexOf(addedChildren[i]))}}if(update.hasUpdatedProperties()){if(update.getUpdatedProperty("activeTabId")){this._activeTabId=update.getUpdatedProperty("activeTabId").newValue}else if(update.getUpdatedProperty("activeTabIndex")){var newIndex=update.getUpdatedProperty("activeTabIndex").newValue;if(newIndex>=0&&newIndex<this.component.children.length){this._activeTabId=this.component.children[newIndex].renderId}}}this._verifyActiveTabAvailable();this._layoutRequired=true}if(fullRender){var div=this._div;var containerElement=div.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(div);this.renderAdd(update,containerElement)}return fullRender},_setOversizeEnabled:function(previous,enabled){var controlDiv=previous?this._previousControlDiv:this._nextControlDiv,img;if(enabled){if(controlDiv){controlDiv.style.display="block"}else{controlDiv=document.createElement("div");controlDiv.style.cssText="position:absolute;z-index:2;cursor:pointer;";controlDiv.style[previous?"left":"right"]="2px";img=document.createElement("img");controlDiv.appendChild(img);Core.Web.Event.add(controlDiv,"mousedown",Core.method(this,this._processScrollStart));Core.Web.Event.add(controlDiv,"mouseup",Core.method(this,this._processScrollStop));Core.Web.Event.add(controlDiv,"mouseover",Core.method(this,this._processScrollRollover));Core.Web.Event.add(controlDiv,"mouseout",Core.method(this,this._processScrollRollover));Core.Web.Event.Selection.disable(controlDiv);if(previous){img.src=this._icons.scrollLeftIcon?Echo.Sync.ImageReference.getUrl(this._icons.scrollLeftIcon):this.client.getResourceUrl("Extras","image/tabpane/Previous.png");this._previousControlDiv=controlDiv}else{img.src=this._icons.scrollRightIcon?Echo.Sync.ImageReference.getUrl(this._icons.scrollRightIcon):this.client.getResourceUrl("Extras","image/tabpane/Next.png");this._nextControlDiv=controlDiv}this._div.appendChild(controlDiv);var tabContainerHeight=new Core.Web.Measure.Bounds(this._headerContainerDiv,{flags:Core.Web.Measure.Bounds.FLAG_MEASURE_DIMENSION}).height;var imageListener=Core.method(this,function(){if(img.height&&!isNaN(img.height)){var imgOffset=Math.floor((tabContainerHeight-img.height)/2);if(imgOffset>0){controlDiv.style[this._tabPositionBottom?"bottom":"top"]=imgOffset+"px"}}});Core.Web.Image.monitor(controlDiv,imageListener);imageListener()}}else if(controlDiv){controlDiv.style.display="none"}},_setRolloverTab:function(tabId,state){this._pendingRollover={tabId:tabId,state:state};if(!this._rolloverRunnable){this._rolloverRunnable=new Core.Web.Scheduler.MethodRunnable(Core.method(this,function(){this._setRolloverTabImpl(this._pendingRollover.tabId,this._pendingRollover.state)}))}Core.Web.Scheduler.add(this._rolloverRunnable)},_setRolloverTabImpl:function(tabId,state){var rolloverTab=this._rolloverTabId&&this._getTabById(this._rolloverTabId);var tab=this._getTabById(tabId);if(state){if(this._rolloverTabId!=tabId){if(rolloverTab){rolloverTab.setRollover(false,false)}this._rolloverTabId=tabId;tab.setRollover(true)}}else{if(this._rolloverTabId==tabId){this._rolloverTabId=null;rolloverTab.setRollover(false,false)}else{}}},setScrollPosition:function(position){var bounded=false,oversize=this._totalTabWidth>this._tabContainerWidth;position=oversize?position:0;if(position<0){position=0;bounded=true}else if(position>0&&position>this._totalTabWidth-this._tabContainerWidth){position=this._totalTabWidth-this._tabContainerWidth;bounded=true}this.scrollPosition=position;this._headerContainerDiv.style.left=(0-position)+"px";if(oversize){this._setOversizeEnabled(true,position>0);this._setOversizeEnabled(false,position<this._totalTabWidth-this._tabContainerWidth)}else{this._setOversizeEnabled(true,false);this._setOversizeEnabled(false,false)}return!bounded},_tabSelectListener:function(e){this._activeTabId=e.tab.renderId;Echo.Render.renderComponentDisplay(this.component)},_verifyActiveTabAvailable:function(){for(var i=0;i<this.component.children.length;++i){if(this.component.children[i].renderId==this._activeTabId){return}}this._activeTabId=this.component.children.length===0?null:this.component.children[0].renderId}});Extras.Sync.TabPane.Tab=Core.extend({_active:null,_childComponent:null,_fibContainer:null,_parent:null,_headerDiv:null,_contentDiv:null,_closeIconTd:null,_tabCloseEnabled:false,_defaultZIndex:0,_activeSurroundHeight:null,_inactiveSurroundHeight:null,_labelDiv:null,_textDiv:null,id:null,$construct:function(childComponent,parent){this.id=childComponent.renderId;this._childComponent=childComponent;this._parent=parent},_getCloseImage:function(rollover){var icons=this._parent._icons;var icon;if(this._tabCloseEnabled){if(rollover&&this._parent.component.render("tabCloseIconRolloverEnabled")){icon=icons.rolloverIcon}}else{icon=icons.disabledIcon}return icon?icon:icons.defaultIcon||this._parent.client.getResourceUrl("Extras","image/tabpane/Close.gif")},_getContentInsets:function(){if(this._childComponent.pane){return 0}else{return this._parent.component.render("defaultContentInsets",Extras.Sync.TabPane._DEFAULTS.tabContentInsets)}},_getProperty:function(name,active,rollover){var value=this._layoutData[(active?"active":"inactive")+name]||this._parent.component.render((active?"tabActive":"tabInactive")+name);if(!active&&rollover){value=this._layoutData["rollover"+name]||this._parent.component.render("tabRollover"+name)||value}return value},_getSurroundHeight:function(active){var insets,imageBorder,border,padding;insets=Echo.Sync.Insets.toPixels(this._getProperty("Insets",active,false)||Extras.Sync.TabPane._DEFAULTS.tabInsets);padding=insets.top+insets.bottom;if(this._useImageBorder){imageBorder=this._getProperty("ImageBorder",active,false);insets=Echo.Sync.Insets.toPixels(imageBorder.contentInsets);return padding+insets.top+insets.bottom}else{border=this._getProperty("Border",active,false)||(active?this._parent._tabActiveBorder:this._parent._tabInactiveBorder);return padding+Echo.Sync.Border.getPixelSize(border,this._parent._tabSide)}},_loadProperties:function(){this._layoutData=this._childComponent.render("layoutData")||{};this._useImageBorder=this._getProperty("ImageBorder",false,false);this._tabCloseEnabled=this._parent._tabCloseEnabled&&this._layoutData.closeEnabled;this._activeSurroundHeight=this._getSurroundHeight(true);this._inactiveSurroundHeight=this._getSurroundHeight(false)},_processClick:function(e){if(!this._parent||!this._parent.client||!this._parent.client.verifyInput(this._parent.component)){return true}if(this._closeIconTd&&Core.Web.DOM.isAncestorOf(this._closeIconTd,e.target)){if(!this._tabCloseEnabled){return}this._parent.component.doTabClose(this.id)}else{this._parent.component.doTabSelect(this.id)}},_processCloseRollover:function(e){var enter=e.type=="mouseover"||e.type=="mouseenter";if(enter&&(!this._parent||!this._parent.client||!this._parent.client.verifyInput(this._parent.component))){return true}this._closeIconTd.firstChild.src=Echo.Sync.ImageReference.getUrl(this._getCloseImage(enter));return true},_processRollover:function(e){var enter=e.type=="mouseover"||e.type=="mouseenter";if(enter&&(!this._parent||!this._parent.client||!this._parent.client.verifyInput(this._parent.component))){return true}this._parent._setRolloverTab(this.id,enter)},_renderAdd:function(update){this._loadProperties();this._headerDiv=document.createElement("div");this._headerDiv.style.cssText="position:absolute;";this._contentDiv=document.createElement("div");this._contentDiv.style.cssText="position:absolute;top:0;left:0;overflow:auto;";if(Core.Web.Env.BROWSER_MOZILLA&&!Core.Web.Env.BROWSER_FIREFOX){this._contentDiv.style.right="100%";this._contentDiv.style.bottom="100%"}else{this._contentDiv.style.display="none";this._contentDiv.style.right="0";this._contentDiv.style.bottom="0"}Echo.Sync.Insets.render(this._getContentInsets(),this._contentDiv,"padding");Echo.Render.renderComponentAdd(update,this._childComponent,this._contentDiv);this._renderState(this.id==this._parent._activeTabId)},_renderDisplay:function(){if(this._fibContainer){Echo.Sync.FillImageBorder.renderContainerDisplay(this._fibContainer);Core.Web.VirtualPosition.redraw(this._backgroundDiv)}Core.Web.VirtualPosition.redraw(this._contentDiv)},_renderDispose:function(){Core.Web.Event.removeAll(this._headerDiv);if(this._rolloverRunnable){Core.Web.Scheduler.remove(this._rolloverRunnable)}this._fibContainer=null;this._parent=null;this._childComponent=null;this._headerDiv=null;this._contentDiv=null;this._closeIconTd=null;this._iconImg=null;this._textDiv=null;this._closeImg=null;this._heightTd=null;this._labelDiv=null;this._backgroundDiv=null},_renderHeader:function(active){var tabPane=this._parent.component,img,table,tr,td;Core.Web.Event.removeAll(this._headerDiv);Core.Web.DOM.removeAllChildren(this._headerDiv);this._headerDiv.style[this._parent._tabPositionBottom?"top":"bottom"]=active?0:(this._parent._tabInactivePositionAdjustPx+"px");if(this._layoutData.toolTipText){this._headerDiv.title=this._layoutData.toolTipText}this._labelDiv=document.createElement("div");this._labelDiv.style.cssText="position:relative;white-space:nowrap;overflow:hidden;";Echo.Sync.Extent.render(this._parent.component.render("tabWidth"),this._labelDiv,"width",true,false);var headerDivContent=this._labelDiv;if(this._useImageBorder){var imageBorder=this._getProperty("ImageBorder",active,false);var backgroundInsets=this._getProperty("BackgroundInsets",active,false);this._fibContainer=headerDivContent=Echo.Sync.FillImageBorder.renderContainer(imageBorder,{child:this._labelDiv});var fibContent=Echo.Sync.FillImageBorder.getContainerContent(this._fibContainer);fibContent.style.zIndex=2;this._backgroundDiv=document.createElement("div");this._backgroundDiv.style.cssText="position:absolute;z-index:1;";Echo.Sync.Insets.renderPosition(backgroundInsets||imageBorder.borderInsets,this._backgroundDiv);this._fibContainer.appendChild(this._backgroundDiv);if(Core.Web.Env.BROWSER_INTERNET_EXPLORER&&Core.Web.Env.BROWSER_VERSION_MAJOR===6){headerDivContent=Extras.Sync.TabPane._createTable();td=document.createElement("td");td.style.cssText="padding:0;";td.appendChild(this._fibContainer);headerDivContent.firstChild.firstChild.appendChild(td)}}else{var border=this._getProperty("Border",active,false)||(active?this._parent._tabActiveBorder:this._parent._tabInactiveBorder);this._backgroundDiv=null;this._fibContainer=null;Echo.Sync.Border.render(border,this._labelDiv,this._parent._tabPositionBottom?"borderBottom":"borderTop");Echo.Sync.Border.render(border,this._labelDiv,"borderLeft");Echo.Sync.Border.render(border,this._labelDiv,"borderRight")}var icon=this._layoutData&&this._layoutData.icon;var title=(this._layoutData?this._layoutData.title:null)||"*";var closeIcon=this._parent._tabCloseEnabled&&(this._tabCloseEnabled||this._parent._icons.disabledIcon);table=Extras.Sync.TabPane._createTable();tr=table.firstChild.firstChild;if(icon){td=document.createElement("td");td.style.cssText="padding:0;";Echo.Sync.Alignment.render(this._parent.component.render("tabAlignment",Extras.Sync.TabPane._DEFAULTS.tabAlignment),td,true,this._parent.component);this._iconImg=document.createElement("img");this._iconImg.style.marginRight=Echo.Sync.Extent.toCssValue(this._parent.component.render("tabIconTextMargin",Extras.Sync.TabPane._DEFAULTS.tabIconTextMargin),true,false);td.appendChild(this._iconImg);tr.appendChild(td)}this._heightTd=document.createElement("td");this._heightTd.style.cssText="padding:0px;width:0px;";tr.appendChild(this._heightTd);td=document.createElement("td");td.style.cssText="padding:0;";Echo.Sync.Alignment.render(tabPane.render("tabAlignment",Extras.Sync.TabPane._DEFAULTS.tabAlignment),td,true,tabPane);this._textDiv=document.createElement("div");this._textDiv.style.cssText="overflow:hidden;white-space:nowrap;";this._textDiv.appendChild(document.createTextNode(title));td.appendChild(this._textDiv);tr.appendChild(td);if(closeIcon){this._closeIconTd=document.createElement("td");this._closeIconTd.style.cssText="padding:0;";Echo.Sync.Alignment.render(this._parent.component.render("tabAlignment",Extras.Sync.TabPane._DEFAULTS.tabAlignment),this._closeIconTd,true,this._parent.component);this._closeIconTd.style.padding="0 0 0 "+Echo.Sync.Extent.toCssValue(this._parent.component.render("tabCloseIconTextMargin",Extras.Sync.TabPane._DEFAULTS.tabCloseIconTextMargin),true,false);this._closeIconTd.style.cursor="pointer";this._closeImg=document.createElement("img");Echo.Sync.ImageReference.renderImg(this._getCloseImage(false),this._closeImg);this._closeIconTd.appendChild(this._closeImg);tr.appendChild(this._closeIconTd)}this._labelDiv.appendChild(table);Core.Web.Event.Selection.disable(this._headerDiv);Core.Web.Event.add(this._headerDiv,"click",Core.method(this,this._processClick),false);Core.Web.Event.add(this._headerDiv,Core.Web.Env.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED?"mouseenter":"mouseover",Core.method(this,this._processRollover),false);Core.Web.Event.add(this._headerDiv,Core.Web.Env.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED?"mouseleave":"mouseout",Core.method(this,this._processRollover),false);if(this._tabCloseEnabled){Core.Web.Event.add(this._closeIconTd,Core.Web.Env.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED?"mouseenter":"mouseover",Core.method(this,this._processCloseRollover),false);Core.Web.Event.add(this._closeIconTd,Core.Web.Env.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED?"mouseleave":"mouseout",Core.method(this,this._processCloseRollover),false)}this._headerDiv.appendChild(headerDivContent)},_renderHeaderState:function(active,rollover,force){var fullRender=!this._labelDiv||force;if(fullRender){this._renderHeader(active)}if(!force&&this._active==active&&(active||!this._parent._tabRolloverEnabled||this._rolloverState==rollover)){return}if(rollover){this._defaultZIndex=this._headerDiv.style.zIndex;this._headerDiv.style.zIndex=this._parent.component.children.length}else{this._headerDiv.style.zIndex=this._defaultZIndex}this._rolloverState=rollover;var tabPane=this._parent.component,img,table,tr,td;Echo.Sync.Color.renderClear(this._getProperty("Foreground",active,rollover),this._labelDiv,"color");Echo.Sync.Font.renderClear(this._getProperty("Font",active,rollover),this._labelDiv);this._labelDiv.style.cursor=active?"default":"pointer";Echo.Sync.Insets.render(this._getProperty("Insets",active,false)||Extras.Sync.TabPane._DEFAULTS.tabInsets,this._labelDiv,"padding");this._headerDiv.style[this._parent._tabPositionBottom?"top":"bottom"]=active?0:(this._parent._tabInactivePositionAdjustPx+"px");if(active){this._labelDiv.style[this._parent._tabPositionBottom?"paddingTop":"paddingBottom"]=(parseInt(this._labelDiv.style[this._parent._tabPositionBottom?"paddingTop":"paddingBottom"],10)+(this._parent._tabActiveHeightIncreasePx+this._parent._tabInactivePositionAdjustPx))+"px"}if(!fullRender){if(this._useImageBorder){var imageBorder=this._getProperty("ImageBorder",active,rollover);var backgroundInsets=this._getProperty("BackgroundInsets",active,rollover);Echo.Sync.FillImageBorder.renderContainer(imageBorder,{update:this._fibContainer});Echo.Sync.Insets.renderPosition(backgroundInsets||imageBorder.borderInsets,this._backgroundDiv)}else{var border=this._getProperty("Border",active,rollover)||(active?this._parent._tabActiveBorder:this._parent._tabInactiveBorder);Echo.Sync.Border.render(border,this._labelDiv,this._parent._tabPositionBottom?"borderBottom":"borderTop");Echo.Sync.Border.render(border,this._labelDiv,"borderLeft");Echo.Sync.Border.render(border,this._labelDiv,"borderRight")}}Echo.Sync.Color.renderClear(this._getProperty("Background",active,rollover),this._backgroundDiv||this._labelDiv,"backgroundColor");Echo.Sync.FillImage.renderClear(this._getProperty("BackgroundImage",active,rollover),this._backgroundDiv||this._labelDiv,null);if(this._layoutData&&this._layoutData.icon){Echo.Sync.ImageReference.renderImg((active&&this._layoutData.activeIcon)||(rollover&&this._layoutData.rolloverIcon)||this._layoutData.icon,this._iconImg)}},_renderState:function(active){if(this._active===active){return}this._renderHeaderState(active);if(this._active!==null&&!active){Echo.Render.renderComponentHide(this._childComponent)}if(Core.Web.Env.BROWSER_MOZILLA&&!Core.Web.Env.BROWSER_FIREFOX){this._contentDiv.style.right=active?"0":"100%";this._contentDiv.style.bottom=active?"0":"100%"}else{this._contentDiv.style.display=active?"block":"none"}this._active=active},setRollover:function(rollover){this._renderHeaderState(this._active,rollover);this._parent._renderHeaderPositions()}});Extras.Sync.ToolTipContainer=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.ToolTipContainer",this)},_div:null,_applyDiv:null,_toolTipDiv:null,_positionToolTip:function(e){this._toolTipDiv.style.height="";var cursorX=(e.pageX||(e.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)));var cursorY=(e.pageY||(e.clientY+(document.documentElement.scrollTop||document.body.scrollTop)));var bodyBounds=new Core.Web.Measure.Bounds(document.body);var tipBounds=new Core.Web.Measure.Bounds(this._toolTipDiv.firstChild);var tipX=cursorX+10;var tipY=cursorY+10;if(tipY+tipBounds.height>bodyBounds.height){tipY=bodyBounds.height-tipBounds.height;if(tipY<0){tipY=0}}if(cursorY<tipY&&(tipX+tipBounds.width>bodyBounds.width)){tipX=bodyBounds.width-tipBounds.width;if(tipX<0){tipX=0}}this._toolTipDiv.style.left=tipX+"px";this._toolTipDiv.style.top=tipY+"px";Core.Web.VirtualPosition.redraw(this._toolTipDiv)},_processMove:function(e){if(!this.client||!this.client.verifyInput(this.component)||Core.Web.dragInProgress){return}this._positionToolTip(e);return true},_processRolloverEnter:function(e){if(!this.client||!this.client.verifyInput(this.component)||Core.Web.dragInProgress){return}if(this._toolTipDiv.parentNode!==document.body){document.body.appendChild(this._toolTipDiv);this._positionToolTip(e)}return true},_processRolloverExit:function(e){if(!this.client||!this.client.verifyInput(this.component)){return}if(this._toolTipDiv.parentNode===document.body){document.body.removeChild(this._toolTipDiv)}return true},renderAdd:function(update,parentElement){this._div=document.createElement("div");this._div.id=this.component.renderId;if(this.component.children.length>0){this._applyDiv=document.createElement("div");this._applyDiv.style.cursor="default";Echo.Render.renderComponentAdd(update,this.component.children[0],this._applyDiv);this._div.appendChild(this._applyDiv);if(this.component.children.length>1){Core.Web.Event.add(this._applyDiv,Core.Web.Env.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED?"mouseenter":"mouseover",Core.method(this,this._processRolloverEnter),true);Core.Web.Event.add(this._applyDiv,Core.Web.Env.PROPRIETARY_EVENT_MOUSE_ENTER_LEAVE_SUPPORTED?"mouseleave":"mouseout",Core.method(this,this._processRolloverExit),true);Core.Web.Event.add(this._applyDiv,"mousemove",Core.method(this,this._processMove),true);this._toolTipDiv=document.createElement("div");this._toolTipDiv.style.cssText="position:absolute;z-index:30000;overflow:hidden;right:0;bottom:0;";var toolTipContentDiv=document.createElement("div");toolTipContentDiv.style.cssText="position:absolute;";var width=this.component.render("width");if(width){toolTipContentDiv.style.width=Echo.Sync.Extent.toCssValue(width)}Echo.Render.renderComponentAdd(update,this.component.children[1],toolTipContentDiv);this._toolTipDiv.appendChild(toolTipContentDiv)}}parentElement.appendChild(this._div)},renderDispose:function(update){this._div=null;if(this._applyDiv){Core.Web.Event.removeAll(this._applyDiv);this._applyDiv=null}if(this._toolTipDiv&&this._toolTipDiv.parentNode===document.body){document.body.removeChild(this._toolTipDiv);this._toolTipDiv=null}},renderUpdate:function(update){var element=this._div;var containerElement=element.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(element);this.renderAdd(update,containerElement);return true}});Extras.Sync.TransitionPane=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Extras.TransitionPane",this)},_containerDiv:null,contentDiv:null,type:null,_transition:null,_transitionClass:null,oldChildDiv:null,childDiv:null,_initialContentLoaded:false,doImmediateTransition:function(){this.removeOldContent();if(this.childDiv){this.showContent()}},_loadTransition:function(){this.type=this.component.render("type");switch(this.type){case Extras.TransitionPane.TYPE_FADE:this._transitionClass=Extras.Sync.TransitionPane.FadeOpacityTransition;break;case Extras.TransitionPane.TYPE_FADE_TO_BLACK:case Extras.TransitionPane.TYPE_FADE_TO_WHITE:this._transitionClass=Extras.Sync.TransitionPane.FadeOpacityColorTransition;break;case Extras.TransitionPane.TYPE_CAMERA_PAN_DOWN:case Extras.TransitionPane.TYPE_CAMERA_PAN_LEFT:case Extras.TransitionPane.TYPE_CAMERA_PAN_RIGHT:case Extras.TransitionPane.TYPE_CAMERA_PAN_UP:this._transitionClass=Extras.Sync.TransitionPane.CameraPanTransition;break;case Extras.TransitionPane.TYPE_BLIND_BLACK_IN:case Extras.TransitionPane.TYPE_BLIND_BLACK_OUT:this._transitionClass=Extras.Sync.TransitionPane.BlindTransition;break;default:this._transitionClass=null}},removeOldContent:function(){if(this.oldChildDiv){this.contentDiv.removeChild(this.oldChildDiv);this.oldChildDiv=null}},showContent:function(){if(this.childDiv){this.childDiv.style.visibility="visible"}},renderAdd:function(update,parentElement){this._containerDiv=document.createElement("div");this._containerDiv.id=this.component.renderId;this._containerDiv.style.cssText="position:absolute;overflow:auto;top:0;left:0;width:100%;height:100%;";this.contentDiv=document.createElement("div");this.contentDiv.style.cssText="position:absolute;overflow:hidden;top:0;left:0;width:100%;height:100%;";this._containerDiv.appendChild(this.contentDiv);parentElement.appendChild(this._containerDiv);if(this.component.children.length>0){this._renderAddChild(update)}},_renderAddChild:function(update){this._loadTransition();this.childDiv=document.createElement("div");this.childDiv.style.cssText="position:absolute;top:0;left:0;width:100%;height:100%;";Echo.Render.renderComponentAdd(update,this.component.children[0],this.childDiv);if(this._initialContentLoaded){this.childDiv.style.visibility="hidden";if(this._transitionClass){this._transitionStart()}else{this.doImmediateTransition()}}else{this._initialContentLoaded=true}this.contentDiv.appendChild(this.childDiv)},renderDispose:function(update){this._initialContentLoaded=false;if(this._transition){this._transition.abort()}this._childDiv=null;this.contentDiv=null;this._containerDiv=null},renderUpdate:function(update){var fullRender=false;if(update.hasUpdatedLayoutDataChildren()){fullRender=true}else if(update.hasUpdatedProperties()){var propertyNames=update.getUpdatedPropertyNames();if(!(propertyNames.length==1&&propertyNames[0]=="type")){fullRender=true}}if(fullRender){var contentDiv=this._containerDiv;var containerElement=contentDiv.parentNode;Echo.Render.renderComponentDispose(update,update.parent);containerElement.removeChild(contentDiv);this.renderAdd(update,containerElement)}else{if(this._transition){this._transition.abort()}var removedChildren=update.getRemovedChildren();if(removedChildren){this.oldChildDiv=this.childDiv;this.childDiv=null}var addedChildren=update.getAddedChildren();if(update.parent.children>1){throw new Error("Cannot render more than one child in a TransitionPane.");}if(addedChildren){this._renderAddChild(update)}}return fullRender},_transitionStart:function(){this._transition=new this._transitionClass(this);this._transition.runTime=this.component.render("duration",this._transition.runTime);this._transition.start(Core.method(this,this._transitionFinish))},_transitionFinish:function(abort){if(this._transition){this._transition=null;this.showContent()}this.removeOldContent();if(this.component&&this.component.application){var focusedComponent=this.component.application.getFocusedComponent();if(focusedComponent!=null&&this.component.isAncestorOf(focusedComponent)){Echo.Render.updateFocus(this.client)}}}});Extras.Sync.TransitionPane.Transition=Core.extend(Extras.Sync.Animation,{transitionPane:null,runTime:350,sleepInterval:10,$abstract:true,$construct:function(transitionPane){this.transitionPane=transitionPane}});Extras.Sync.TransitionPane.BlindTransition=Core.extend(Extras.Sync.TransitionPane.Transition,{runTime:700,_maskDiv:null,_stepCount:14,_swapStep:null,_reverse:false,complete:function(abort){this._maskDiv.parentNode.removeChild(this._maskDiv)},init:function(){this._swapStep=Math.floor(this._stepCount)/2+1;this._reverse=this.transitionPane.type===Extras.TransitionPane.TYPE_BLIND_BLACK_OUT;this._maskDiv=document.createElement("div");this._maskDiv.style.cssText="position:absolute;width:100%;height:100%;z-index:30000;";this.transitionPane.contentDiv.appendChild(this._maskDiv)},step:function(progress){var currentStep=Math.ceil(progress*this._stepCount);if(currentStep===0){currentStep=1}if(currentStep===this._renderedStep){return}var url=this.transitionPane.client.getResourceUrl("Extras","image/transitionpane/blindblack/Frame"+currentStep+".gif");this._maskDiv.style.backgroundImage="url("+url+")";if(currentStep<this._swapStep){if(this.transitionPane.oldChildDiv){if(this._reverse){this.transitionPane.oldChildDiv.style.top=currentStep+"px"}else{this.transitionPane.oldChildDiv.style.top=(0-currentStep)+"px"}}}else{if(this._renderedStep<this._swapStep){this.transitionPane.showContent();this.transitionPane.removeOldContent()}if(this.transitionPane.childDiv){if(this._reverse){this.transitionPane.childDiv.style.top=(currentStep-this._stepCount)+"px"}else{this.transitionPane.childDiv.style.top=(this._stepCount-currentStep)+"px"}}}this._renderedStep=currentStep}});Extras.Sync.TransitionPane.CameraPanTransition=Core.extend(Extras.Sync.TransitionPane.Transition,{_newChildOnScreen:false,_travel:null,complete:function(abort){if(this.transitionPane.childDiv){this.transitionPane.childDiv.style.zIndex=0;this.transitionPane.childDiv.style.top="0px";this.transitionPane.childDiv.style.left="0px"}},init:function(){var bounds=new Core.Web.Measure.Bounds(this.transitionPane.contentDiv);this._travel=(this.transitionPane.type==Extras.TransitionPane.TYPE_CAMERA_PAN_DOWN||this.transitionPane.type==Extras.TransitionPane.TYPE_CAMERA_PAN_UP)?bounds.height:bounds.width;if(this.transitionPane.oldChildDiv){this.transitionPane.oldChildDiv.style.zIndex=1}},step:function(progress){switch(this.transitionPane.type){case Extras.TransitionPane.TYPE_CAMERA_PAN_DOWN:if(this.transitionPane.childDiv){this.transitionPane.childDiv.style.top=((1-progress)*this._travel)+"px"}if(this.transitionPane.oldChildDiv){this.transitionPane.oldChildDiv.style.top=(0-(progress*this._travel))+"px"}break;case Extras.TransitionPane.TYPE_CAMERA_PAN_UP:if(this.transitionPane.childDiv){this.transitionPane.childDiv.style.top=(0-((1-progress)*this._travel))+"px"}if(this.transitionPane.oldChildDiv){this.transitionPane.oldChildDiv.style.top=(progress*this._travel)+"px"}break;case Extras.TransitionPane.TYPE_CAMERA_PAN_RIGHT:if(this.transitionPane.childDiv){this.transitionPane.childDiv.style.left=((1-progress)*this._travel)+"px"}if(this.transitionPane.oldChildDiv){this.transitionPane.oldChildDiv.style.left=(0-(progress*this._travel))+"px"}break;default:if(this.transitionPane.childDiv){this.transitionPane.childDiv.style.left=(0-((1-progress)*this._travel))+"px"}if(this.transitionPane.oldChildDiv){this.transitionPane.oldChildDiv.style.left=(progress*this._travel)+"px"}break}if(!this._newChildOnScreen&&this.transitionPane.childDiv){this.transitionPane.showContent();this.transitionPane.childDiv.style.zIndex=2;this._newChildOnScreen=true}}});Extras.Sync.TransitionPane.FadeOpacityTransition=Core.extend(Extras.Sync.TransitionPane.Transition,{runTime:1000,complete:function(abort){if(this.transitionPane.childDiv){this.transitionPane.childDiv.style.zIndex=0;if(Core.Web.Env.PROPRIETARY_IE_OPACITY_FILTER_REQUIRED){this.transitionPane.childDiv.style.filter=""}else{this.transitionPane.childDiv.style.opacity=1}}},init:function(){if(this.transitionPane.childDiv){if(Core.Web.Env.PROPRIETARY_IE_OPACITY_FILTER_REQUIRED){this.transitionPane.childDiv.style.filter="alpha(opacity=0)"}else{this.transitionPane.childDiv.style.opacity=0}}this.transitionPane.showContent()},step:function(progress){var percent;if(this.transitionPane.childDiv){if(Core.Web.Env.PROPRIETARY_IE_OPACITY_FILTER_REQUIRED){percent=Math.floor(progress*100);this.transitionPane.childDiv.style.filter="alpha(opacity="+percent+")"}else{this.transitionPane.childDiv.style.opacity=progress}}else if(this.transitionPane.oldChildDiv){if(Core.Web.Env.PROPRIETARY_IE_OPACITY_FILTER_REQUIRED){percent=Math.floor((1-progress)*100);this.transitionPane.oldChildDiv.style.filter="alpha(opacity="+percent+")"}else{this.transitionPane.oldChildDiv.style.opacity=1-progress}}}});Extras.Sync.TransitionPane.FadeOpacityColorTransition=Core.extend(Extras.Sync.TransitionPane.Transition,{runTime:1000,_maskDiv:null,_swapped:false,complete:function(abort){this._maskDiv.parentNode.removeChild(this._maskDiv)},init:function(){this._maskDiv=document.createElement("div");this._maskDiv.style.cssText="position:absolute;width:100%;height:100%;z-index:30000;";if(Core.Web.Env.PROPRIETARY_IE_OPACITY_FILTER_REQUIRED){this._maskDiv.style.filter="alpha(opacity=0)"}else{this._maskDiv.style.opacity=0}if(this.transitionPane.type===Extras.TransitionPane.TYPE_FADE_TO_WHITE){this._maskDiv.style.backgroundColor="#ffffff"}else{this._maskDiv.style.backgroundColor="#000000"}this.transitionPane.contentDiv.appendChild(this._maskDiv)},step:function(progress){var opacity=1-Math.abs(progress*2-1);if(progress>0.5&&!this._swapped){this.transitionPane.showContent();this.transitionPane.removeOldContent();this._swapped=true}if(Core.Web.Env.PROPRIETARY_IE_OPACITY_FILTER_REQUIRED){var percent=Math.floor(opacity*100);this._maskDiv.style.filter="alpha(opacity="+percent+")"}else{this._maskDiv.style.opacity=opacity}}});Extras.Sync.CalendarSelect.resource.set("de",{"DayOfWeek.0":"Sonntag","DayOfWeek.1":"Montag","DayOfWeek.2":"Dienstag","DayOfWeek.3":"Mittwoch","DayOfWeek.4":"Donnerstag","DayOfWeek.5":"Freitag","DayOfWeek.6":"Samstag","Month.0":"Januar","Month.1":"Februar","Month.2":"M\u00e4rz","Month.3":"April","Month.4":"Mai","Month.5":"Juni","Month.6":"Juli","Month.7":"August","Month.8":"September","Month.10":"November","Month.11":"Dezember","FirstDayOfWeek":"1"});Extras.Sync.RichTextArea.resource.set("de",{"ColorDialog.Title.Foreground":"Textfarbe","ColorDialog.Title.Background":"Hintergrundfarbe","ColorDialog.PromptForeground":"Textfarbe:","ColorDialog.PromptBackground":"Hintergrundfarbe:","Error.ClipboardAccessDisabled":"Der Zugriff auf die Zwischenablage ist in diesem Browser deaktiviert. "+"Bitte benutzen Sie die entsprechenden Tastenkombinationen oder \u00e4ndern Sie die "+"Sicherheitseinstellungen des Browsers.","Generic.Cancel":"Abbrechen","Generic.Error":"Fehler","Generic.Ok":"Ok","HyperlinkDialog.Title":"Hyperlink einf\u00fcgen","HyperlinkDialog.PromptURL":"URL:","HyperlinkDialog.PromptDescription":"Beschreibung:","HyperlinkDialog.ErrorDialogTitle":"Hyperlink konnte nicht eingef\u00fcgt werden","HyperlinkDialog.ErrorDialog.URL":"Die eingegebene URL ist nicht g\u00fcltig.","ImageDialog.Title":"Bild einf\u00fcgen","ImageDialog.PromptURL":"URL:","ImageDialog.ErrorDialogTitle":"Bild konnte nicht eingef\u00fcgt werden","ImageDialog.ErrorDialog.URL":"Die eingegebene URL ist nicht g\u00fcltig.","Menu.Edit":"Bearbeiten","Menu.Undo":"R\u00fcckg\u00e4ngig","Menu.Redo":"Wiederherstellen","Menu.Cut":"Ausschneiden","Menu.Copy":"Kopie","Menu.Paste":"Einf\u00fcgen","Menu.Delete":"L\u00f6schen","Menu.SelectAll":"Alles ausw\u00e4hlen","Menu.Insert":"Einf\u00fcgen","Menu.InsertImage":"Bild...","Menu.InsertHyperlink":"Hyperlink...","Menu.InsertHorizontalRule":"Trennstrich","Menu.InsertTable":"Tabelle...","Menu.BulletedList":"Aufz\u00e4hlung (symbolisch)","Menu.NumberedList":"Aufz\u00e4hlung (numeriert)","Menu.Format":"Format","Menu.Bold":"Fett","Menu.Italic":"Kursiv","Menu.Underline":"Unterstrichen","Menu.Strikethrough":"Durchgestrichen","Menu.Superscript":"Hochgestellt","Menu.Subscript":"Tiefgestellt","Menu.PlainText":"Einfacher Text","Menu.TextStyle":"Textstil","Menu.ParagraphStyle":"Absatzstil","Menu.Alignment":"Ausrichtung","Menu.Left":"Linksb\u00fcndig","Menu.Right":"Rechtsb\u00fcndig","Menu.Center":"Zentriert","Menu.Justified":"Blocksatz","Menu.Indent":"Einr\u00fccken","Menu.Outdent":"Ausr\u00fccken","Menu.SetForeground":"Textfarbe setzen...","Menu.SetBackground":"Hintergrundfarbe setzen...","Menu.Heading1":"\u00dcberschrift 1","Menu.Heading2":"\u00dcberschrift 2","Menu.Heading3":"\u00dcberschrift 3","Menu.Heading4":"\u00dcberschrift 4","Menu.Heading5":"\u00dcberschrift 5","Menu.Heading6":"\u00dcberschrift 6","Menu.Normal":"Normal","Menu.Preformatted":"Formatiert","TableDialog.Title":"Tabelle einf\u00fcgen","TableDialog.PromptRows":"Zeilen:","TableDialog.PromptColumns":"Spalten:","TableDialog.ErrorDialogTitle":"Tabelle konnte nicht eingef\u00fcgt werden","TableDialog.ErrorDialog.Columns":"Die Anzahl der Spalten ist nicht g\u00fcltig. "+"Bitte geben Sie eine Zahl zwischen 1 und 50 ein.","TableDialog.ErrorDialog.Rows":"Die Anzahl der Zeilen ist nicht g\u00fcltig. "+"Bitte geben Sie eine Zahl zwischen 1 und 50 ein."});
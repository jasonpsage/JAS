<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>
<title>JAS/JegasCRM Developer Reference: uj_sessions</title>
<meta name="generator" content="PasDoc 0.14.0">
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<link rel="StyleSheet" type="text/css" href="pasdoc.css">
</head>
<body>
<table class="container"><tr><td class="navigation">
<h2>JAS/JegasCRM Developer Reference</h2><p><a href="AllUnits.html" class="navigation">Units</a></p><p><a href="ClassHierarchy.html" class="navigation">Class Hierarchy</a></p><p><a href="AllClasses.html" class="navigation">Classes, Interfaces, Objects and Records</a></p><p><a href="AllTypes.html" class="navigation">Types</a></p><p><a href="AllVariables.html" class="navigation">Variables</a></p><p><a href="AllConstants.html" class="navigation">Constants</a></p><p><a href="AllFunctions.html" class="navigation">Functions and Procedures</a></p><p><a href="AllIdentifiers.html" class="navigation">Identifiers</a></p></td><td class="content">
JegasAPI - Jegas, LLC - Copyright(c)2016
<h1 class="unit">Unit uj_sessions</h1>
<table class="sections wide_list">
<tr>
<td><a class="section" href="#PasDoc-Description">Description</a></td><td>Uses</td><td>Classes, Interfaces, Objects and Records</td><td><a class="section" href="#PasDoc-FuncsProcs">Functions and Procedures</a></td><td>Types</td><td><a class="section" href="#PasDoc-Constants">Constants</a></td><td>Variables</td></tr></table>
<a name="PasDoc-Description"></a><h2 class="description">Description</h2>
<p>
JAS Specific Functions</p>
<a name="PasDoc-Uses"></a><h2 class="overview">Overview</h2>
<a name="PasDoc-FuncsProcs"></a><h3 class="summary">Functions and Procedures</h3>
<table class="summary wide_list">
<tr class="list">
<td class="itemcode"><code>function <b><a  href="uj_sessions.html#bJAS_CreateSession">bJAS_CreateSession</a></b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>):boolean;</code></td>
</tr>
<tr class="list2">
<td class="itemcode"><code>function <b><a  href="uj_sessions.html#bJAS_ValidateSession">bJAS_ValidateSession</a></b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>): boolean;</code></td>
</tr>
<tr class="list">
<td class="itemcode"><code>Function <b><a  href="uj_sessions.html#bJAS_RemoveSession">bJAS_RemoveSession</a></b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>):Boolean;</code></td>
</tr>
<tr class="list2">
<td class="itemcode"><code>function <b><a  href="uj_sessions.html#saJAS_GetSessionKey">saJAS_GetSessionKey</a></b>: ansistring;</code></td>
</tr>
<tr class="list">
<td class="itemcode"><code>function <b><a  href="uj_sessions.html#bJAS_GenerateSecKeys">bJAS_GenerateSecKeys</a></b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>): boolean;</code></td>
</tr>
<tr class="list2">
<td class="itemcode"><code>function <b><a  href="uj_sessions.html#bJAS_PurgeConnections">bJAS_PurgeConnections</a></b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>; p_iMinutesOld: integer):boolean;</code></td>
</tr>
<tr class="list">
<td class="itemcode"><code>function <b><a  href="uj_sessions.html#bJAS_PurgeOrphanedSessionData">bJAS_PurgeOrphanedSessionData</a></b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>): boolean;</code></td>
</tr>
<tr class="list2">
<td class="itemcode"><code>function <b><a  href="uj_sessions.html#bJAS_LoadSessionData">bJAS_LoadSessionData</a></b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>): boolean;</code></td>
</tr>
<tr class="list">
<td class="itemcode"><code>function <b><a  href="uj_sessions.html#bJAS_SaveSessionData">bJAS_SaveSessionData</a></b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>): boolean;</code></td>
</tr>
<tr class="list2">
<td class="itemcode"><code>function <b><a  href="uj_sessions.html#bJAS_ValidateSessionPeek">bJAS_ValidateSessionPeek</a></b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>; p_JSess_JSession_UID: ansistring; var p_JUser_Name_ReturnedHere: ansistring): boolean;</code></td>
</tr>
<tr class="list">
<td class="itemcode"><code>function <b><a  href="uj_sessions.html#saJAS_DecryptSingleKey">saJAS_DecryptSingleKey</a></b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>; p_saData: ansistring; p_saSecKey: ansistring): ansistring;</code></td>
</tr>
</table>
<a name="PasDoc-Constants"></a><h3 class="summary">Constants</h3>
<table class="summary wide_list">
<tr class="list">
<td class="itemcode"><code><b><a  href="uj_sessions.html#cnMaxLoginAttempts">cnMaxLoginAttempts</a></b>=10;</code></td>
</tr>
</table>
<h2 class="description">Description</h2>
<h3 class="detail">Functions and Procedures</h3>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><a name="bJAS_CreateSession"></a><code>function <b>bJAS_CreateSession</b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>):boolean;</code></td>
</tr>
<tr><td colspan="1">
<p>
JASAPI function This function uses the following information from p_Context to decide if creating a session for a particular user will be attempted:<br><br> Required: p_Context.CGIENV.DataIn.FoundItem_saName('USERNAME',False)<br> Required: p_Context.CGIENV.DataIn.FoundItem_saName('PASSWORD',False)<br> Required: p_Context.CGIENV.ENVVAR.FoundItem_saName('REMOTE_ADDR',False)<br> Optional: p_Context.CGIENV.DataIn.FoundItem_saName('CHANGEPASSWORD',False)<br> Optional: p_Context.CGIENV.DataIn.FoundItem_saName('NEWPASSWORD1',False)<br> Optional: p_Context.CGIENV.DataIn.FoundItem_saName('NEWPASSWORD2',False)<br><br>

<p>Additionally, the user's AllowedSessions field in the juser table is taken into account. If the user's AllowedSessions field is set to 1, then if an existing session will be removed and the user is granted a new session.<br><br>

<p>IF a user is allowed numerous sessions, then a new session will be created unless they have exceeded their allowed number of logins. If they do exceed there AllowedSessions, then they will not be granted anymore.<br><br>

<p>We'd like to add a user interface so this scenario can be resolved by the user themselves but this is on our todo list. Systems such as VICI do not generally allow users multiple logins, and for telemarketing scenarios where VICI is used, it is easier to tie VICI logins to JAS users by limiting their AllowedSessions to one.<br><br>

<p>Above you might have noticed the IP address bit that this function analyzes. Basically if a request comes in from an IP address other than that of the session's originator - then access to the system is denied.<br><br>

<p>If the function returns true you are good to go. If you like, for instance an error is returned, you can interrogate what happened by getting the result code from: p_Context.rSession.i4ResultCode

<p>Upon successful session creation, a cookie with the SESSION ID (jdconnection.JDCon_JDConnection_UID) is stored on the client named JSID. Note that form variables override COOKIE. So, it's actually cleaner to not send JSID yourself in forms posts etc unless you have a good reason. If you do not follow this advice, have a web page up and your session times out, you can not login in another page and then refresh the page you were at because you essentially hardcoded the session id into the webpage.

<p>Values are defined in uxxj_definitions.pp Example: cnSession_PasswordsDoNotMatch</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><a name="bJAS_ValidateSession"></a><code>function <b>bJAS_ValidateSession</b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>): boolean;</code></td>
</tr>
<tr><td colspan="1">
<p>
Validate session does what it's name implies but it also removes old sessions from the database; in effect as the system is used, it takes care of itself. Validate Session gather the Session ID from either the request itself or from the cookie verifies the Session ID (jdconnection.JDCon_JDConnection_UID) exists.

<p>If the remote ip address doesn't match the session creator's, then access is denied. If the session has gone beyond it's configured timeout period its removed BY this function before this function attempts to look it up so timeout periods are enforced.</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><a name="bJAS_RemoveSession"></a><code>Function <b>bJAS_RemoveSession</b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>):Boolean;</code></td>
</tr>
<tr><td colspan="1">
<p>
Removes current user's session - essentially logging them out.</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><a name="saJAS_GetSessionKey"></a><code>function <b>saJAS_GetSessionKey</b>: ansistring;</code></td>
</tr>
<tr><td colspan="1">
<p>
This is just a random number generator</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><a name="bJAS_GenerateSecKeys"></a><code>function <b>bJAS_GenerateSecKeys</b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>): boolean;</code></td>
</tr>
<tr><td colspan="1">
<p>
This loads the jseckey table with BOTH public and private keys - 512 bytes saved as contiguas hex pairs per key. (1024 char/1K each key). One Row has two keys.</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><a name="bJAS_PurgeConnections"></a><code>function <b>bJAS_PurgeConnections</b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>; p_iMinutesOld: integer):boolean;</code></td>
</tr>
<tr><td colspan="1">
<p>
This function is what does the old session clean up, called internally by bJAS_ValidateSession.</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><a name="bJAS_PurgeOrphanedSessionData"></a><code>function <b>bJAS_PurgeOrphanedSessionData</b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>): boolean;</code></td>
</tr>
<tr><td colspan="1">
<p>
this function purges orphaned session data. Currently session data is database driven. Making a likely faster filebased session data mechanism is slated for developement.</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><a name="bJAS_LoadSessionData"></a><code>function <b>bJAS_LoadSessionData</b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>): boolean;</code></td>
</tr>
<tr><td colspan="1">
<p>
this function saves session data Currently session data is database driven. Making a likely faster filebased session data mechanism is slated for developement.</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><a name="bJAS_SaveSessionData"></a><code>function <b>bJAS_SaveSessionData</b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>): boolean;</code></td>
</tr>
<tr><td colspan="1">
<p>
this function saves session data Currently session data is database driven. Making a likely faster filebased session data mechanism is slated for developement.</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><a name="bJAS_ValidateSessionPeek"></a><code>function <b>bJAS_ValidateSessionPeek</b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>; p_JSess_JSession_UID: ansistring; var p_JUser_Name_ReturnedHere: ansistring): boolean;</code></td>
</tr>
<tr><td colspan="1">
<p>
This function allows &quot;peeking&quot; to see if a passed session id (JSession UID) is valid and returns the user name owning the session.</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><a name="saJAS_DecryptSingleKey"></a><code>function <b>saJAS_DecryptSingleKey</b>(p_Context: <a  href="uj_context.TCONTEXT.html">TCONTEXT</a>; p_saData: ansistring; p_saSecKey: ansistring): ansistring;</code></td>
</tr>
<tr><td colspan="1">
<p>
this function takes the encrypted data and the UID passed as saSecKey and loads the record from the jseckey table and uses the public key to call uxxg_jcrypt.saJegasEncryptSingleKey to decrypt the passed data.</p>
</td></tr>
</table>
<h3 class="detail">Constants</h3>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><a name="cnMaxLoginAttempts"></a><code><b>cnMaxLoginAttempts</b>=10;</code></td>
</tr>
<tr><td colspan="1">
<p>
============================================================================= ============================================================================= ***************************************************************************** ============================================================================= ***************************************************************************** !@!Declarations ***************************************************************************** ============================================================================= *****************************************************************************</p>
</td></tr>
</table>
http://www.jegas.com
<hr noshade size="1"><span class="appinfo"><em>Generated by <a  href="http://pasdoc.sourceforge.net/">PasDoc 0.14.0</a>. </em>
</span>
</td></tr></table></body></html>
